[31m--[ [0m[34mMatch #[0m[33m1[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/__init__.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m5 | [0m[35mif os.environ.get("DD_INSTRUMENTATION_TELEMETRY_ENABLED") is None:[0m
[30;1m6 | [0m[35m    os.environ["DD_INSTRUMENTATION_TELEMETRY_ENABLED"] = "false"[0m
[30;1m7 | [0m[35m[0m
[30;1m8 | [0m[35mif os.environ.get("DD_API_SECURITY_ENABLED") is None:[0m
[30;1m9 | [0m[35m    os.environ["DD_API_SECURITY_ENABLED"] = "False"[0m
[30;1m10 | [0m[35m[0m
[30;1m11 | [0m[35minitialize_cold_start_tracing()[0m

[31m--[ [0m[34mMatch #[0m[33m2[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/__init__.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m2 | [0m[35mimport os[0m
[30;1m3 | [0m[35m[0m
[30;1m4 | [0m[35m[0m
[30;1m5 | [0m[35mif os.environ.get("DD_INSTRUMENTATION_TELEMETRY_ENABLED") is None:[0m
[30;1m6 | [0m[35m    os.environ["DD_INSTRUMENTATION_TELEMETRY_ENABLED"] = "false"[0m
[30;1m7 | [0m[35m[0m
[30;1m8 | [0m[35mif os.environ.get("DD_API_SECURITY_ENABLED") is None:[0m

[31m--[ [0m[34mMatch #[0m[33m3[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m101 | [0m[35m        return None[0m
[30;1m102 | [0m[35m[0m
[30;1m103 | [0m[35m    xray_trace_entity = parse_xray_header([0m
[30;1m104 | [0m[35m        os.environ.get(XrayDaemon.XRAY_TRACE_ID_HEADER_NAME, "")[0m
[30;1m105 | [0m[35m    )[0m
[30;1m106 | [0m[35m    if xray_trace_entity is None:[0m
[30;1m107 | [0m[35m        return None[0m

[31m--[ [0m[34mMatch #[0m[33m4[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m66 | [0m[35m[0m
[30;1m67 | [0m[35m        telemetry_writer.enable()[0m
[30;1m68 | [0m[35m[0m
[30;1m69 | [0m[35mis_lambda_context = os.environ.get(XrayDaemon.FUNCTION_NAME_HEADER_NAME) != ""[0m
[30;1m70 | [0m[35m[0m
[30;1m71 | [0m[35mpropagator = HTTPPropagator()[0m
[30;1m72 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m5[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m59 | [0m[35mif dd_tracing_enabled:[0m
[30;1m60 | [0m[35m    # Enable the telemetry client if the user has opted in[0m
[30;1m61 | [0m[35m    if ([0m
[30;1m62 | [0m[35m        os.environ.get("DD_INSTRUMENTATION_TELEMETRY_ENABLED", "false").lower()[0m
[30;1m63 | [0m[35m        == "true"[0m
[30;1m64 | [0m[35m    ):[0m
[30;1m65 | [0m[35m        from ddtrace.internal.telemetry import telemetry_writer[0m

[31m--[ [0m[34mMatch #[0m[33m6[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m55 | [0m[35mlogger = logging.getLogger(__name__)[0m
[30;1m56 | [0m[35m[0m
[30;1m57 | [0m[35mdd_trace_context = None[0m
[30;1m58 | [0m[35mdd_tracing_enabled = os.environ.get("DD_TRACE_ENABLED", "false").lower() == "true"[0m
[30;1m59 | [0m[35mif dd_tracing_enabled:[0m
[30;1m60 | [0m[35m    # Enable the telemetry client if the user has opted in[0m
[30;1m61 | [0m[35m    if ([0m

[31m--[ [0m[34mMatch #[0m[33m7[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m43 | [0m[35m)[0m
[30;1m44 | [0m[35m[0m
[30;1m45 | [0m[35mdd_trace_otel_enabled = ([0m
[30;1m46 | [0m[35m    os.environ.get("DD_TRACE_OTEL_ENABLED", "false").lower() == "true"[0m
[30;1m47 | [0m[35m)[0m
[30;1m48 | [0m[35mif dd_trace_otel_enabled:[0m
[30;1m49 | [0m[35m    from opentelemetry.trace import set_tracer_provider[0m

[31m--[ [0m[34mMatch #[0m[33m8[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000800[0m
       Tag: [34mSecurity.Backdoor.Obfuscation[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32mbase64|encodedcommand|obfuscate[0m
[30;1m557 | [0m[35m[0m
[30;1m558 | [0m[35m        import base64[0m
[30;1m559 | [0m[35m[0m
[30;1m560 | [0m[35m        injected_data = json.loads(base64.b64decode(dd_data_raw))[0m
[30;1m561 | [0m[35m[0m
[30;1m562 | [0m[35m        # Lambda authorizer's results can be cached. But the payload will still have the injected[0m
[30;1m563 | [0m[35m        # data in cached requests. How to distinguish cached case and ignore the injected data ?[0m

[31m--[ [0m[34mMatch #[0m[33m9[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000800[0m
       Tag: [34mSecurity.Backdoor.Obfuscation[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32mbase64|encodedcommand|obfuscate[0m
[30;1m555 | [0m[35m        if not dd_data_raw:[0m
[30;1m556 | [0m[35m            return None[0m
[30;1m557 | [0m[35m[0m
[30;1m558 | [0m[35m        import base64[0m
[30;1m559 | [0m[35m[0m
[30;1m560 | [0m[35m        injected_data = json.loads(base64.b64decode(dd_data_raw))[0m
[30;1m561 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m10[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000800[0m
       Tag: [34mSecurity.Backdoor.Obfuscation[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32mbase64|encodedcommand|obfuscate[0m
[30;1m376 | [0m[35m            import base64[0m
[30;1m377 | [0m[35m[0m
[30;1m378 | [0m[35m            b64_bytes = data.encode("ascii")[0m
[30;1m379 | [0m[35m            str_bytes = base64.b64decode(b64_bytes)[0m
[30;1m380 | [0m[35m            data_str = str_bytes.decode("ascii")[0m
[30;1m381 | [0m[35m            data_obj = json.loads(data_str)[0m
[30;1m382 | [0m[35m            dd_ctx = data_obj.get("_datadog")[0m

[31m--[ [0m[34mMatch #[0m[33m11[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000800[0m
       Tag: [34mSecurity.Backdoor.Obfuscation[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32mbase64|encodedcommand|obfuscate[0m
[30;1m373 | [0m[35m            return extract_context_from_lambda_context(lambda_context)[0m
[30;1m374 | [0m[35m        data = kinesis.get("data")[0m
[30;1m375 | [0m[35m        if data:[0m
[30;1m376 | [0m[35m            import base64[0m
[30;1m377 | [0m[35m[0m
[30;1m378 | [0m[35m            b64_bytes = data.encode("ascii")[0m
[30;1m379 | [0m[35m            str_bytes = base64.b64decode(b64_bytes)[0m

[31m--[ [0m[34mMatch #[0m[33m12[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000800[0m
       Tag: [34mSecurity.Backdoor.Obfuscation[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32mbase64|encodedcommand|obfuscate[0m
[30;1m364 | [0m[35m[0m
[30;1m365 | [0m[35mdef extract_context_from_kinesis_event(event, lambda_context):[0m
[30;1m366 | [0m[35m    """[0m
[30;1m367 | [0m[35m    Extract datadog trace context from a Kinesis Stream's base64 encoded data string[0m
[30;1m368 | [0m[35m    """[0m
[30;1m369 | [0m[35m    try:[0m
[30;1m370 | [0m[35m        record = get_first_record(event)[0m

[31m--[ [0m[34mMatch #[0m[33m13[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000800[0m
       Tag: [34mSecurity.Backdoor.Obfuscation[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32mbase64|encodedcommand|obfuscate[0m
[30;1m261 | [0m[35m[0m
[30;1m262 | [0m[35m                dd_json_data = dd_payload.get("binaryValue") or dd_payload.get("Value")[0m
[30;1m263 | [0m[35m                if dd_json_data:[0m
[30;1m264 | [0m[35m                    dd_json_data = base64.b64decode(dd_json_data)[0m
[30;1m265 | [0m[35m            elif dd_json_data_type == "String":[0m
[30;1m266 | [0m[35m                dd_json_data = dd_payload.get("stringValue") or dd_payload.get("Value")[0m
[30;1m267 | [0m[35m            else:[0m

[31m--[ [0m[34mMatch #[0m[33m14[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000800[0m
       Tag: [34mSecurity.Backdoor.Obfuscation[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32mbase64|encodedcommand|obfuscate[0m
[30;1m257 | [0m[35m            dd_json_data = None[0m
[30;1m258 | [0m[35m            dd_json_data_type = dd_payload.get("Type") or dd_payload.get("dataType")[0m
[30;1m259 | [0m[35m            if dd_json_data_type == "Binary":[0m
[30;1m260 | [0m[35m                import base64[0m
[30;1m261 | [0m[35m[0m
[30;1m262 | [0m[35m                dd_json_data = dd_payload.get("binaryValue") or dd_payload.get("Value")[0m
[30;1m263 | [0m[35m                if dd_json_data:[0m

[31m--[ [0m[34mMatch #[0m[33m15[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/handler.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m17 | [0m[35m    pass[0m
[30;1m18 | [0m[35m[0m
[30;1m19 | [0m[35m[0m
[30;1m20 | [0m[35mpath = os.environ.get("DD_LAMBDA_HANDLER", None)[0m
[30;1m21 | [0m[35mif path is None:[0m
[30;1m22 | [0m[35m    raise HandlerError([0m
[30;1m23 | [0m[35m        "DD_LAMBDA_HANDLER is not defined. Can't use prebuilt datadog handler"[0m

[31m--[ [0m[34mMatch #[0m[33m16[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000701[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Token[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tag_object.py[0m
   Pattern: [32m(npm owner|password|htpasswd|auth_?token|secret_?key|private_?key|authorized_keys?|npmrc|\.ssh|usersecrets?|api_?keys|nuget\.config|\.identityservice)[0m
[30;1m7 | [0m[35mimport logging[0m
[30;1m8 | [0m[35mimport ujson as json[0m
[30;1m9 | [0m[35m[0m
[30;1m10 | [0m[35mredactable_keys = ["authorization", "x-authorization", "password", "token"][0m
[30;1m11 | [0m[35mmax_depth = 10[0m
[30;1m12 | [0m[35mlogger = logging.getLogger(__name__)[0m
[30;1m13 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m17[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/xray.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m112 | [0m[35m    if sock.host_port_tuple is None:[0m
[30;1m113 | [0m[35m        return None[0m
[30;1m114 | [0m[35m    context = parse_xray_header([0m
[30;1m115 | [0m[35m        os.environ.get(XrayDaemon.XRAY_TRACE_ID_HEADER_NAME, "")[0m
[30;1m116 | [0m[35m    )[0m
[30;1m117 | [0m[35m    if context is None:[0m
[30;1m118 | [0m[35m        logger.debug([0m

[31m--[ [0m[34mMatch #[0m[33m18[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/xray.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m18 | [0m[35m    def host_port_tuple(self):[0m
[30;1m19 | [0m[35m        if not hasattr(self, "_host_port_tuple"):[0m
[30;1m20 | [0m[35m            self._host_port_tuple = self._get_xray_host_port([0m
[30;1m21 | [0m[35m                os.environ.get(XrayDaemon.XRAY_DAEMON_ADDRESS, "")[0m
[30;1m22 | [0m[35m            )[0m
[30;1m23 | [0m[35m        return self._host_port_tuple[0m
[30;1m24 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m19[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000800[0m
       Tag: [34mSecurity.Backdoor.Obfuscation[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32mbase64|encodedcommand|obfuscate[0m
[30;1m244 | [0m[35m        import base64[0m
[30;1m245 | [0m[35m[0m
[30;1m246 | [0m[35m        with gzip.GzipFile([0m
[30;1m247 | [0m[35m            fileobj=BytesIO(base64.b64decode(event.get("awslogs", {}).get("data")))[0m
[30;1m248 | [0m[35m        ) as decompress_stream:[0m
[30;1m249 | [0m[35m            data = b"".join(BufferedReader(decompress_stream))[0m
[30;1m250 | [0m[35m        logs = json.loads(data)[0m

[31m--[ [0m[34mMatch #[0m[33m20[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000800[0m
       Tag: [34mSecurity.Backdoor.Obfuscation[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32mbase64|encodedcommand|obfuscate[0m
[30;1m241 | [0m[35m[0m
[30;1m242 | [0m[35m    # e.g. arn:aws:logs:us-west-1:123456789012:log-group:/my-log-group-xyz[0m
[30;1m243 | [0m[35m    if source.event_type == EventTypes.CLOUDWATCH_LOGS:[0m
[30;1m244 | [0m[35m        import base64[0m
[30;1m245 | [0m[35m[0m
[30;1m246 | [0m[35m        with gzip.GzipFile([0m
[30;1m247 | [0m[35m            fileobj=BytesIO(base64.b64decode(event.get("awslogs", {}).get("data")))[0m

[31m--[ [0m[34mMatch #[0m[33m21[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m125 | [0m[35m[0m
[30;1m126 | [0m[35m        # Set DATADOG_HOST, to send data to a non-default Datadog datacenter[0m
[30;1m127 | [0m[35m        api._api_host = os.environ.get([0m
[30;1m128 | [0m[35m            "DATADOG_HOST", "https://api." + os.environ.get("DD_SITE", "datadoghq.com")[0m
[30;1m129 | [0m[35m        )[0m
[30;1m130 | [0m[35m        logger.debug("Setting DATADOG_HOST to %s", api._api_host)[0m
[30;1m131 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m22[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m124 | [0m[35m        logger.debug("Setting DATADOG_API_KEY of length %d", len(api._api_key))[0m
[30;1m125 | [0m[35m[0m
[30;1m126 | [0m[35m        # Set DATADOG_HOST, to send data to a non-default Datadog datacenter[0m
[30;1m127 | [0m[35m        api._api_host = os.environ.get([0m
[30;1m128 | [0m[35m            "DATADOG_HOST", "https://api." + os.environ.get("DD_SITE", "datadoghq.com")[0m
[30;1m129 | [0m[35m        )[0m
[30;1m130 | [0m[35m        logger.debug("Setting DATADOG_HOST to %s", api._api_host)[0m

[31m--[ [0m[34mMatch #[0m[33m23[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m112 | [0m[35m[0m
[30;1m113 | [0m[35m[0m
[30;1m114 | [0m[35mdef init_api():[0m
[30;1m115 | [0m[35m    if not os.environ.get("DD_FLUSH_TO_LOG", "").lower() == "true":[0m
[30;1m116 | [0m[35m        # Make sure that this package would always be lazy-loaded/outside from the critical path[0m
[30;1m117 | [0m[35m        # since underlying packages are quite heavy to load[0m
[30;1m118 | [0m[35m        # and useless with the extension unless sending metrics with timestamps[0m

[31m--[ [0m[34mMatch #[0m[33m24[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m62 | [0m[35m    DD_KMS_API_KEY = os.environ.get("DD_KMS_API_KEY", "")[0m
[30;1m63 | [0m[35m    DD_API_KEY = os.environ.get("DD_API_KEY", os.environ.get("DATADOG_API_KEY", ""))[0m
[30;1m64 | [0m[35m[0m
[30;1m65 | [0m[35m    LAMBDA_REGION = os.environ.get("AWS_REGION", "")[0m
[30;1m66 | [0m[35m    is_gov_region = LAMBDA_REGION.startswith("us-gov-")[0m
[30;1m67 | [0m[35m    if is_gov_region:[0m
[30;1m68 | [0m[35m        logger.debug([0m

[31m--[ [0m[34mMatch #[0m[33m25[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m60 | [0m[35m    DD_API_KEY_SECRET_ARN = os.environ.get("DD_API_KEY_SECRET_ARN", "")[0m
[30;1m61 | [0m[35m    DD_API_KEY_SSM_NAME = os.environ.get("DD_API_KEY_SSM_NAME", "")[0m
[30;1m62 | [0m[35m    DD_KMS_API_KEY = os.environ.get("DD_KMS_API_KEY", "")[0m
[30;1m63 | [0m[35m    DD_API_KEY = os.environ.get("DD_API_KEY", os.environ.get("DATADOG_API_KEY", ""))[0m
[30;1m64 | [0m[35m[0m
[30;1m65 | [0m[35m    LAMBDA_REGION = os.environ.get("AWS_REGION", "")[0m
[30;1m66 | [0m[35m    is_gov_region = LAMBDA_REGION.startswith("us-gov-")[0m

[31m--[ [0m[34mMatch #[0m[33m26[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m59 | [0m[35m[0m
[30;1m60 | [0m[35m    DD_API_KEY_SECRET_ARN = os.environ.get("DD_API_KEY_SECRET_ARN", "")[0m
[30;1m61 | [0m[35m    DD_API_KEY_SSM_NAME = os.environ.get("DD_API_KEY_SSM_NAME", "")[0m
[30;1m62 | [0m[35m    DD_KMS_API_KEY = os.environ.get("DD_KMS_API_KEY", "")[0m
[30;1m63 | [0m[35m    DD_API_KEY = os.environ.get("DD_API_KEY", os.environ.get("DATADOG_API_KEY", ""))[0m
[30;1m64 | [0m[35m[0m
[30;1m65 | [0m[35m    LAMBDA_REGION = os.environ.get("AWS_REGION", "")[0m

[31m--[ [0m[34mMatch #[0m[33m27[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m58 | [0m[35m        return api_key[0m
[30;1m59 | [0m[35m[0m
[30;1m60 | [0m[35m    DD_API_KEY_SECRET_ARN = os.environ.get("DD_API_KEY_SECRET_ARN", "")[0m
[30;1m61 | [0m[35m    DD_API_KEY_SSM_NAME = os.environ.get("DD_API_KEY_SSM_NAME", "")[0m
[30;1m62 | [0m[35m    DD_KMS_API_KEY = os.environ.get("DD_KMS_API_KEY", "")[0m
[30;1m63 | [0m[35m    DD_API_KEY = os.environ.get("DD_API_KEY", os.environ.get("DATADOG_API_KEY", ""))[0m
[30;1m64 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m28[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m57 | [0m[35m    if api_key:[0m
[30;1m58 | [0m[35m        return api_key[0m
[30;1m59 | [0m[35m[0m
[30;1m60 | [0m[35m    DD_API_KEY_SECRET_ARN = os.environ.get("DD_API_KEY_SECRET_ARN", "")[0m
[30;1m61 | [0m[35m    DD_API_KEY_SSM_NAME = os.environ.get("DD_API_KEY_SSM_NAME", "")[0m
[30;1m62 | [0m[35m    DD_KMS_API_KEY = os.environ.get("DD_KMS_API_KEY", "")[0m
[30;1m63 | [0m[35m    DD_API_KEY = os.environ.get("DD_API_KEY", os.environ.get("DATADOG_API_KEY", ""))[0m

[31m--[ [0m[34mMatch #[0m[33m29[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m26 | [0m[35m    is added. We need to try decrypting the API key both with and without the encryption context.[0m
[30;1m27 | [0m[35m    """[0m
[30;1m28 | [0m[35m    # Try without encryption context, in case API key was encrypted using the AWS CLI[0m
[30;1m29 | [0m[35m    function_name = os.environ.get("AWS_LAMBDA_FUNCTION_NAME")[0m
[30;1m30 | [0m[35m    try:[0m
[30;1m31 | [0m[35m        plaintext = kms_client.decrypt(CiphertextBlob=decoded_bytes)[[0m
[30;1m32 | [0m[35m            "Plaintext"[0m

[31m--[ [0m[34mMatch #[0m[33m30[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000800[0m
       Tag: [34mSecurity.Backdoor.Obfuscation[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32mbase64|encodedcommand|obfuscate[0m
[30;1m18 | [0m[35m        kms_client: The KMS client to use for decryption[0m
[30;1m19 | [0m[35m        ciphertext (string): The base64-encoded ciphertext to decrypt[0m
[30;1m20 | [0m[35m    """[0m
[30;1m21 | [0m[35m    decoded_bytes = base64.b64decode(ciphertext)[0m
[30;1m22 | [0m[35m[0m
[30;1m23 | [0m[35m    """[0m
[30;1m24 | [0m[35m    When the API key is encrypted using the AWS console, the function name is added as an[0m

[31m--[ [0m[34mMatch #[0m[33m31[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000800[0m
       Tag: [34mSecurity.Backdoor.Obfuscation[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32mbase64|encodedcommand|obfuscate[0m
[30;1m16 | [0m[35m[0m
[30;1m17 | [0m[35m    Args:[0m
[30;1m18 | [0m[35m        kms_client: The KMS client to use for decryption[0m
[30;1m19 | [0m[35m        ciphertext (string): The base64-encoded ciphertext to decrypt[0m
[30;1m20 | [0m[35m    """[0m
[30;1m21 | [0m[35m    decoded_bytes = base64.b64decode(ciphertext)[0m
[30;1m22 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m32[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000800[0m
       Tag: [34mSecurity.Backdoor.Obfuscation[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32mbase64|encodedcommand|obfuscate[0m
[30;1m11 | [0m[35m    import base64[0m
[30;1m12 | [0m[35m[0m
[30;1m13 | [0m[35m    """[0m
[30;1m14 | [0m[35m    Decodes and deciphers the base64-encoded ciphertext given as a parameter using KMS.[0m
[30;1m15 | [0m[35m    For this to work properly, the Lambda function must have the appropriate IAM permissions.[0m
[30;1m16 | [0m[35m[0m
[30;1m17 | [0m[35m    Args:[0m

[31m--[ [0m[34mMatch #[0m[33m33[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000800[0m
       Tag: [34mSecurity.Backdoor.Obfuscation[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32mbase64|encodedcommand|obfuscate[0m
[30;1m8 | [0m[35m[0m
[30;1m9 | [0m[35mdef decrypt_kms_api_key(kms_client, ciphertext):[0m
[30;1m10 | [0m[35m    from botocore.exceptions import ClientError[0m
[30;1m11 | [0m[35m    import base64[0m
[30;1m12 | [0m[35m[0m
[30;1m13 | [0m[35m    """[0m
[30;1m14 | [0m[35m    Decodes and deciphers the base64-encoded ciphertext given as a parameter using KMS.[0m

[31m--[ [0m[34mMatch #[0m[33m34[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000801[0m
       Tag: [34mSecurity.Backdoor.ExecuteObfuscatedCode[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\.get\(.*(fromhex|decode)[0m
[30;1m179 | [0m[35m                os.environ.get(DD_ENCODE_AUTHORIZER_CONTEXT, "true").lower() == "true"[0m
[30;1m180 | [0m[35m            )[0m
[30;1m181 | [0m[35m            self.decode_authorizer_context = depends_on_dd_tracing_enabled([0m
[30;1m182 | [0m[35m                os.environ.get(DD_DECODE_AUTHORIZER_CONTEXT, "true").lower() == "true"[0m
[30;1m183 | [0m[35m            )[0m
[30;1m184 | [0m[35m            self.cold_start_tracing = depends_on_dd_tracing_enabled([0m
[30;1m185 | [0m[35m                os.environ.get(DD_COLD_START_TRACING, "true").lower() == "true"[0m

[31m--[ [0m[34mMatch #[0m[33m35[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m218 | [0m[35m[0m
[30;1m219 | [0m[35m            # This prevents a breaking change in ddtrace v0.49 regarding the service name[0m
[30;1m220 | [0m[35m            # in requests-related spans[0m
[30;1m221 | [0m[35m            os.environ[DD_REQUESTS_SERVICE_NAME] = os.environ.get([0m
[30;1m222 | [0m[35m                DD_SERVICE, "aws.lambda"[0m
[30;1m223 | [0m[35m            )[0m
[30;1m224 | [0m[35m            # Patch third-party libraries for tracing[0m

[31m--[ [0m[34mMatch #[0m[33m36[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m187 | [0m[35m            self.min_cold_start_trace_duration = get_env_as_int([0m
[30;1m188 | [0m[35m                DD_MIN_COLD_START_DURATION, 3[0m
[30;1m189 | [0m[35m            )[0m
[30;1m190 | [0m[35m            self.local_testing_mode = os.environ.get([0m
[30;1m191 | [0m[35m                DD_LOCAL_TEST, "false"[0m
[30;1m192 | [0m[35m            ).lower() in ("true", "1")[0m
[30;1m193 | [0m[35m            self.cold_start_trace_skip_lib = [[0m

[31m--[ [0m[34mMatch #[0m[33m37[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m182 | [0m[35m                os.environ.get(DD_DECODE_AUTHORIZER_CONTEXT, "true").lower() == "true"[0m
[30;1m183 | [0m[35m            )[0m
[30;1m184 | [0m[35m            self.cold_start_tracing = depends_on_dd_tracing_enabled([0m
[30;1m185 | [0m[35m                os.environ.get(DD_COLD_START_TRACING, "true").lower() == "true"[0m
[30;1m186 | [0m[35m            )[0m
[30;1m187 | [0m[35m            self.min_cold_start_trace_duration = get_env_as_int([0m
[30;1m188 | [0m[35m                DD_MIN_COLD_START_DURATION, 3[0m

[31m--[ [0m[34mMatch #[0m[33m38[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m179 | [0m[35m                os.environ.get(DD_ENCODE_AUTHORIZER_CONTEXT, "true").lower() == "true"[0m
[30;1m180 | [0m[35m            )[0m
[30;1m181 | [0m[35m            self.decode_authorizer_context = depends_on_dd_tracing_enabled([0m
[30;1m182 | [0m[35m                os.environ.get(DD_DECODE_AUTHORIZER_CONTEXT, "true").lower() == "true"[0m
[30;1m183 | [0m[35m            )[0m
[30;1m184 | [0m[35m            self.cold_start_tracing = depends_on_dd_tracing_enabled([0m
[30;1m185 | [0m[35m                os.environ.get(DD_COLD_START_TRACING, "true").lower() == "true"[0m

[31m--[ [0m[34mMatch #[0m[33m39[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m176 | [0m[35m                os.environ.get(DD_TRACE_MANAGED_SERVICES, "true").lower() == "true"[0m
[30;1m177 | [0m[35m            )[0m
[30;1m178 | [0m[35m            self.encode_authorizer_context = depends_on_dd_tracing_enabled([0m
[30;1m179 | [0m[35m                os.environ.get(DD_ENCODE_AUTHORIZER_CONTEXT, "true").lower() == "true"[0m
[30;1m180 | [0m[35m            )[0m
[30;1m181 | [0m[35m            self.decode_authorizer_context = depends_on_dd_tracing_enabled([0m
[30;1m182 | [0m[35m                os.environ.get(DD_DECODE_AUTHORIZER_CONTEXT, "true").lower() == "true"[0m

[31m--[ [0m[34mMatch #[0m[33m40[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m173 | [0m[35m                lambda original_boolean: dd_tracing_enabled and original_boolean[0m
[30;1m174 | [0m[35m            )[0m
[30;1m175 | [0m[35m            self.make_inferred_span = depends_on_dd_tracing_enabled([0m
[30;1m176 | [0m[35m                os.environ.get(DD_TRACE_MANAGED_SERVICES, "true").lower() == "true"[0m
[30;1m177 | [0m[35m            )[0m
[30;1m178 | [0m[35m            self.encode_authorizer_context = depends_on_dd_tracing_enabled([0m
[30;1m179 | [0m[35m                os.environ.get(DD_ENCODE_AUTHORIZER_CONTEXT, "true").lower() == "true"[0m

[31m--[ [0m[34mMatch #[0m[33m41[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m165 | [0m[35m            )[0m
[30;1m166 | [0m[35m            self.function_name = os.environ.get(AWS_LAMBDA_FUNCTION_NAME, "function")[0m
[30;1m167 | [0m[35m            self.service = os.environ.get(DD_SERVICE, None)[0m
[30;1m168 | [0m[35m            self.extractor_env = os.environ.get(DD_TRACE_EXTRACTOR, None)[0m
[30;1m169 | [0m[35m            self.trace_extractor = None[0m
[30;1m170 | [0m[35m            self.span = None[0m
[30;1m171 | [0m[35m            self.inferred_span = None[0m

[31m--[ [0m[34mMatch #[0m[33m42[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m164 | [0m[35m                os.environ.get(DD_MERGE_XRAY_TRACES, "false").lower() == "true"[0m
[30;1m165 | [0m[35m            )[0m
[30;1m166 | [0m[35m            self.function_name = os.environ.get(AWS_LAMBDA_FUNCTION_NAME, "function")[0m
[30;1m167 | [0m[35m            self.service = os.environ.get(DD_SERVICE, None)[0m
[30;1m168 | [0m[35m            self.extractor_env = os.environ.get(DD_TRACE_EXTRACTOR, None)[0m
[30;1m169 | [0m[35m            self.trace_extractor = None[0m
[30;1m170 | [0m[35m            self.span = None[0m

[31m--[ [0m[34mMatch #[0m[33m43[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m163 | [0m[35m            self.merge_xray_traces = ([0m
[30;1m164 | [0m[35m                os.environ.get(DD_MERGE_XRAY_TRACES, "false").lower() == "true"[0m
[30;1m165 | [0m[35m            )[0m
[30;1m166 | [0m[35m            self.function_name = os.environ.get(AWS_LAMBDA_FUNCTION_NAME, "function")[0m
[30;1m167 | [0m[35m            self.service = os.environ.get(DD_SERVICE, None)[0m
[30;1m168 | [0m[35m            self.extractor_env = os.environ.get(DD_TRACE_EXTRACTOR, None)[0m
[30;1m169 | [0m[35m            self.trace_extractor = None[0m

[31m--[ [0m[34mMatch #[0m[33m44[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m161 | [0m[35m                os.environ.get(DD_LOGS_INJECTION, "true").lower() == "true"[0m
[30;1m162 | [0m[35m            )[0m
[30;1m163 | [0m[35m            self.merge_xray_traces = ([0m
[30;1m164 | [0m[35m                os.environ.get(DD_MERGE_XRAY_TRACES, "false").lower() == "true"[0m
[30;1m165 | [0m[35m            )[0m
[30;1m166 | [0m[35m            self.function_name = os.environ.get(AWS_LAMBDA_FUNCTION_NAME, "function")[0m
[30;1m167 | [0m[35m            self.service = os.environ.get(DD_SERVICE, None)[0m

[31m--[ [0m[34mMatch #[0m[33m45[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m158 | [0m[35m            self.func = func[0m
[30;1m159 | [0m[35m            self.flush_to_log = os.environ.get(DD_FLUSH_TO_LOG, "").lower() == "true"[0m
[30;1m160 | [0m[35m            self.logs_injection = ([0m
[30;1m161 | [0m[35m                os.environ.get(DD_LOGS_INJECTION, "true").lower() == "true"[0m
[30;1m162 | [0m[35m            )[0m
[30;1m163 | [0m[35m            self.merge_xray_traces = ([0m
[30;1m164 | [0m[35m                os.environ.get(DD_MERGE_XRAY_TRACES, "false").lower() == "true"[0m

[31m--[ [0m[34mMatch #[0m[33m46[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m156 | [0m[35m        """Executes when the wrapped function gets wrapped"""[0m
[30;1m157 | [0m[35m        try:[0m
[30;1m158 | [0m[35m            self.func = func[0m
[30;1m159 | [0m[35m            self.flush_to_log = os.environ.get(DD_FLUSH_TO_LOG, "").lower() == "true"[0m
[30;1m160 | [0m[35m            self.logs_injection = ([0m
[30;1m161 | [0m[35m                os.environ.get(DD_LOGS_INJECTION, "true").lower() == "true"[0m
[30;1m162 | [0m[35m            )[0m

[31m--[ [0m[34mMatch #[0m[33m47[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m99 | [0m[35m        DD_CAPTURE_LAMBDA_PAYLOAD_MAX_DEPTH, tag_object.max_depth[0m
[30;1m100 | [0m[35m    )[0m
[30;1m101 | [0m[35m[0m
[30;1m102 | [0m[35menv_env_var = os.environ.get(DD_ENV, None)[0m
[30;1m103 | [0m[35m[0m
[30;1m104 | [0m[35minit_timestamp_ns = time_ns()[0m
[30;1m105 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m48[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m89 | [0m[35m[0m
[30;1m90 | [0m[35m[0m
[30;1m91 | [0m[35mdd_capture_lambda_payload_enabled = ([0m
[30;1m92 | [0m[35m    os.environ.get(DD_CAPTURE_LAMBDA_PAYLOAD, "false").lower() == "true"[0m
[30;1m93 | [0m[35m)[0m
[30;1m94 | [0m[35m[0m
[30;1m95 | [0m[35mif dd_capture_lambda_payload_enabled:[0m

[31m--[ [0m[34mMatch #[0m[33m49[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m80 | [0m[35m[0m
[30;1m81 | [0m[35mdef get_env_as_int(env_key, default_value: int) -> int:[0m
[30;1m82 | [0m[35m    try:[0m
[30;1m83 | [0m[35m        return int(os.environ.get(env_key, default_value))[0m
[30;1m84 | [0m[35m    except Exception as e:[0m
[30;1m85 | [0m[35m        logger.warn([0m
[30;1m86 | [0m[35m            f"Failed to parse {env_key} as int. Using default value: {default_value}. Error: {e}"[0m

[31m--[ [0m[34mMatch #[0m[33m50[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m50 | [0m[35m    from ddtrace.profiling import profiler[0m
[30;1m51 | [0m[35m[0m
[30;1m52 | [0m[35mllmobs_api_key = None[0m
[30;1m53 | [0m[35mllmobs_env_var = os.environ.get("DD_LLMOBS_ENABLED", "false").lower() in ("true", "1")[0m
[30;1m54 | [0m[35mif llmobs_env_var:[0m
[30;1m55 | [0m[35m    from datadog_lambda.api import get_api_key[0m
[30;1m56 | [0m[35m    from ddtrace.llmobs import LLMObs[0m

[31m--[ [0m[34mMatch #[0m[33m51[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m45 | [0m[35m    extract_http_status_code_tag,[0m
[30;1m46 | [0m[35m)[0m
[30;1m47 | [0m[35m[0m
[30;1m48 | [0m[35mprofiling_env_var = os.environ.get("DD_PROFILING_ENABLED", "false").lower() == "true"[0m
[30;1m49 | [0m[35mif profiling_env_var:[0m
[30;1m50 | [0m[35m    from ddtrace.profiling import profiler[0m
[30;1m51 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m52[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000800[0m
       Tag: [34mSecurity.Backdoor.Obfuscation[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32mbase64|encodedcommand|obfuscate[0m
[30;1m275 | [0m[35m[0m
[30;1m276 | [0m[35m        import base64[0m
[30;1m277 | [0m[35m[0m
[30;1m278 | [0m[35m        datadog_data = base64.b64encode([0m
[30;1m279 | [0m[35m            json.dumps(injected_headers, escape_forward_slashes=False).encode()[0m
[30;1m280 | [0m[35m        ).decode()[0m
[30;1m281 | [0m[35m        self.response.setdefault("context", {})[0m

[31m--[ [0m[34mMatch #[0m[33m53[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000800[0m
       Tag: [34mSecurity.Backdoor.Obfuscation[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32mbase64|encodedcommand|obfuscate[0m
[30;1m273 | [0m[35m        if request_id is not None:[0m
[30;1m274 | [0m[35m            injected_headers[Headers.Authorizing_Request_Id] = request_id[0m
[30;1m275 | [0m[35m[0m
[30;1m276 | [0m[35m        import base64[0m
[30;1m277 | [0m[35m[0m
[30;1m278 | [0m[35m        datadog_data = base64.b64encode([0m
[30;1m279 | [0m[35m            json.dumps(injected_headers, escape_forward_slashes=False).encode()[0m

[31m--[ [0m[34mMatch #[0m[33m54[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/metric.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m71 | [0m[35m        )[0m
[30;1m72 | [0m[35m        return[0m
[30;1m73 | [0m[35m[0m
[30;1m74 | [0m[35m    flush_to_logs = os.environ.get("DD_FLUSH_TO_LOG", "").lower() == "true"[0m
[30;1m75 | [0m[35m    tags = [] if tags is None else list(tags)[0m
[30;1m76 | [0m[35m    tags.append(dd_lambda_layer_tag)[0m
[30;1m77 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m55[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/metric.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m35 | [0m[35m    lambda_stats = ThreadStatsWriter(flush_in_thread)[0m
[30;1m36 | [0m[35m[0m
[30;1m37 | [0m[35menhanced_metrics_enabled = ([0m
[30;1m38 | [0m[35m    os.environ.get("DD_ENHANCED_METRICS", "true").lower() == "true"[0m
[30;1m39 | [0m[35m)[0m
[30;1m40 | [0m[35m[0m
[30;1m41 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m56[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/metric.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m17 | [0m[35mlambda_stats = None[0m
[30;1m18 | [0m[35mextension_thread_stats = None[0m
[30;1m19 | [0m[35m[0m
[30;1m20 | [0m[35mflush_in_thread = os.environ.get("DD_FLUSH_IN_THREAD", "").lower() == "true"[0m
[30;1m21 | [0m[35m[0m
[30;1m22 | [0m[35mif should_use_extension:[0m
[30;1m23 | [0m[35m    from datadog_lambda.statsd_writer import StatsDWriter[0m

[31m--[ [0m[34mMatch #[0m[33m57[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/logger.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m18 | [0m[35m[0m
[30;1m19 | [0m[35mdef initialize_logging(name):[0m
[30;1m20 | [0m[35m    logger = logging.getLogger(name)[0m
[30;1m21 | [0m[35m    str_level = (os.environ.get("DD_LOG_LEVEL") or "INFO").upper()[0m
[30;1m22 | [0m[35m    level = _level_mappping.get(str_level)[0m
[30;1m23 | [0m[35m    if level is None:[0m
[30;1m24 | [0m[35m        logger.setLevel(logging.INFO)[0m

[31m--[ [0m[34mMatch #[0m[33m58[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/cold_start.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m150 | [0m[35m    if ([0m
[30;1m151 | [0m[35m        is_new_sandbox()[0m
[30;1m152 | [0m[35m        and os.environ.get("DD_TRACE_ENABLED", "true").lower() == "true"[0m
[30;1m153 | [0m[35m        and os.environ.get("DD_COLD_START_TRACING", "true").lower() == "true"[0m
[30;1m154 | [0m[35m    ):[0m
[30;1m155 | [0m[35m        from sys import meta_path[0m
[30;1m156 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m59[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/cold_start.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m149 | [0m[35mdef initialize_cold_start_tracing():[0m
[30;1m150 | [0m[35m    if ([0m
[30;1m151 | [0m[35m        is_new_sandbox()[0m
[30;1m152 | [0m[35m        and os.environ.get("DD_TRACE_ENABLED", "true").lower() == "true"[0m
[30;1m153 | [0m[35m        and os.environ.get("DD_COLD_START_TRACING", "true").lower() == "true"[0m
[30;1m154 | [0m[35m    ):[0m
[30;1m155 | [0m[35m        from sys import meta_path[0m

[31m--[ [0m[34mMatch #[0m[33m60[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/span_pointers.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m14 | [0m[35mlogger = logging.getLogger(__name__)[0m
[30;1m15 | [0m[35m[0m
[30;1m16 | [0m[35m[0m
[30;1m17 | [0m[35mdd_botocore_add_span_pointers = os.environ.get([0m
[30;1m18 | [0m[35m    "DD_BOTOCORE_ADD_SPAN_POINTERS", "true"[0m
[30;1m19 | [0m[35m).lower() in ("true", "1")[0m
[30;1m20 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m61[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/patch.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m44 | [0m[35m    Patch `requests` to log the outgoing requests for integration tests.[0m
[30;1m45 | [0m[35m    """[0m
[30;1m46 | [0m[35m    global _integration_tests_patched[0m
[30;1m47 | [0m[35m    is_in_tests = os.environ.get("DD_INTEGRATION_TEST", "false").lower() == "true"[0m
[30;1m48 | [0m[35m    if not _integration_tests_patched and is_in_tests:[0m
[30;1m49 | [0m[35m        wrap("requests", "Session.send", _log_request)[0m
[30;1m50 | [0m[35m        _integration_tests_patched = True[0m

[31m--[ [0m[34mMatch #[0m[33m62[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000600[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Windows[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/PKG-INFO[0m
   Pattern: [32m\s(advpack\.dll|appvlp|at|atbroker|bash|bginfo|bitsadmin|cdb|certutil|cl_invocation\.ps1|cl_mutexverifiers\.ps1|cmd|cmdkey|cmstp|comsvcs\.dll|control|csc|cscript|csi|devtoolslauncher|dfsvc|diskshadow|dnscmd|dnx|dotnet|dxcap|esentutl|eventvwr|excel|expand|extexport|extrac32|findstr|forfiles|ftp|gfxdownloadwrapper|gpscript|hh|ie4uinit|ieadvpack\.dll|ieaframe\.dll|ic|infdefaultinstall|installutil|jsc|makecab|manage-bde\.wsf|mavinject|mftrace|microsoft\.workflow\.compiler|mmc|msbuild|msconfig|msdeploy|msdt|mshta|mshtml\.dll|msc|msxsl|netsh|odbcconf|pcalua|pcwrun|pcwutl\.dll|pester\.bat|powerpnt|presentationhost|pubprn\.vbs|rcsi|reg|regasm|regedit|register-cimprovider|regsvcs|regsvr32|rpcping|rundll32|runonce|runscripthelper|sc|schtasks|scriptrunner|setupapi\.dll|shdocvw\.dll|shell32\.dll|slmgr\.vbs|sqldumper|sqlps|sqltoolsps|squirrel|syncappvpublishingserver|syncappvpublishingserver\.vbs|syssetup\.dll|te|tracker|tttracer|update|url\.dll|verclsid|vsjitdebugger|wab|winrm\.vbs|winword|wmic|wscript|wsl|wsreset|xwizard|zipfldr\.dll)\s[0m
[30;1m102 | [0m[35m[0m
[30;1m103 | [0m[35mUnless explicitly stated otherwise all files in this repository are licensed under the Apache Licens[0m
[30;1m104 | [0m[35m[0m
[30;1m105 | [0m[35mThis product includes software developed at Datadog (https://www.datadoghq.com/). Copyright 2019 Dat[0m
[30;1m106 | [0m[35m[0m
[30;1m107 | [0m[35m[1]: https://www.datadoghq.com/blog/troubleshoot-lambda-function-request-response-payloads/[0m
[30;1m108 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m63[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000600[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Windows[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/PKG-INFO[0m
   Pattern: [32m\s(advpack\.dll|appvlp|at|atbroker|bash|bginfo|bitsadmin|cdb|certutil|cl_invocation\.ps1|cl_mutexverifiers\.ps1|cmd|cmdkey|cmstp|comsvcs\.dll|control|csc|cscript|csi|devtoolslauncher|dfsvc|diskshadow|dnscmd|dnx|dotnet|dxcap|esentutl|eventvwr|excel|expand|extexport|extrac32|findstr|forfiles|ftp|gfxdownloadwrapper|gpscript|hh|ie4uinit|ieadvpack\.dll|ieaframe\.dll|ic|infdefaultinstall|installutil|jsc|makecab|manage-bde\.wsf|mavinject|mftrace|microsoft\.workflow\.compiler|mmc|msbuild|msconfig|msdeploy|msdt|mshta|mshtml\.dll|msc|msxsl|netsh|odbcconf|pcalua|pcwrun|pcwutl\.dll|pester\.bat|powerpnt|presentationhost|pubprn\.vbs|rcsi|reg|regasm|regedit|register-cimprovider|regsvcs|regsvr32|rpcping|rundll32|runonce|runscripthelper|sc|schtasks|scriptrunner|setupapi\.dll|shdocvw\.dll|shell32\.dll|slmgr\.vbs|sqldumper|sqlps|sqltoolsps|squirrel|syncappvpublishingserver|syncappvpublishingserver\.vbs|syssetup\.dll|te|tracker|tttracer|update|url\.dll|verclsid|vsjitdebugger|wab|winrm\.vbs|winword|wmic|wscript|wsl|wsreset|xwizard|zipfldr\.dll)\s[0m
[30;1m  | [0m[35mous Profiler](https://www.datadoghq.com/product/code-profiling/) is now available in beta for Python[0m
[30;1m  | [0m[35m[0m
[30;1m  | [0m[35mThe Continuous Profiler works by spawning a thread which periodically wakes up and takes a snapshot [0m
[30;1m  | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m64[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/PKG-INFO[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m92 | [0m[35m[0m
[30;1m93 | [0m[35m## Contributing[0m
[30;1m94 | [0m[35m[0m
[30;1m95 | [0m[35mIf you find an issue with this package and have a fix, please feel free to open a pull request follo[0m
[30;1m96 | [0m[35m[0m
[30;1m97 | [0m[35m## Community[0m
[30;1m98 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m65[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000600[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Windows[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/constants.py[0m
   Pattern: [32m\s(advpack\.dll|appvlp|at|atbroker|bash|bginfo|bitsadmin|cdb|certutil|cl_invocation\.ps1|cl_mutexverifiers\.ps1|cmd|cmdkey|cmstp|comsvcs\.dll|control|csc|cscript|csi|devtoolslauncher|dfsvc|diskshadow|dnscmd|dnx|dotnet|dxcap|esentutl|eventvwr|excel|expand|extexport|extrac32|findstr|forfiles|ftp|gfxdownloadwrapper|gpscript|hh|ie4uinit|ieadvpack\.dll|ieaframe\.dll|ic|infdefaultinstall|installutil|jsc|makecab|manage-bde\.wsf|mavinject|mftrace|microsoft\.workflow\.compiler|mmc|msbuild|msconfig|msdeploy|msdt|mshta|mshtml\.dll|msc|msxsl|netsh|odbcconf|pcalua|pcwrun|pcwutl\.dll|pester\.bat|powerpnt|presentationhost|pubprn\.vbs|rcsi|reg|regasm|regedit|register-cimprovider|regsvcs|regsvr32|rpcping|rundll32|runonce|runscripthelper|sc|schtasks|scriptrunner|setupapi\.dll|shdocvw\.dll|shell32\.dll|slmgr\.vbs|sqldumper|sqlps|sqltoolsps|squirrel|syncappvpublishingserver|syncappvpublishingserver\.vbs|syssetup\.dll|te|tracker|tttracer|update|url\.dll|verclsid|vsjitdebugger|wab|winrm\.vbs|winword|wmic|wscript|wsl|wsreset|xwizard|zipfldr\.dll)\s[0m
[30;1m1 | [0m[35m# Unless explicitly stated otherwise all files in this repository are licensed[0m
[30;1m2 | [0m[35m# under the Apache License Version 2.0.[0m
[30;1m3 | [0m[35m# This product includes software developed at Datadog (https://www.datadoghq.com/).[0m
[30;1m4 | [0m[35m# Copyright 2019 Datadog, Inc.[0m
[30;1m5 | [0m[35m[0m
[30;1m6 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m66[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/README.md[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m61 | [0m[35m[0m
[30;1m62 | [0m[35m## Contributing[0m
[30;1m63 | [0m[35m[0m
[30;1m64 | [0m[35mIf you find an issue with this package and have a fix, please feel free to open a pull request follo[0m
[30;1m65 | [0m[35m[0m
[30;1m66 | [0m[35m## Community[0m
[30;1m67 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m67[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000600[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Windows[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/README.md[0m
   Pattern: [32m\s(advpack\.dll|appvlp|at|atbroker|bash|bginfo|bitsadmin|cdb|certutil|cl_invocation\.ps1|cl_mutexverifiers\.ps1|cmd|cmdkey|cmstp|comsvcs\.dll|control|csc|cscript|csi|devtoolslauncher|dfsvc|diskshadow|dnscmd|dnx|dotnet|dxcap|esentutl|eventvwr|excel|expand|extexport|extrac32|findstr|forfiles|ftp|gfxdownloadwrapper|gpscript|hh|ie4uinit|ieadvpack\.dll|ieaframe\.dll|ic|infdefaultinstall|installutil|jsc|makecab|manage-bde\.wsf|mavinject|mftrace|microsoft\.workflow\.compiler|mmc|msbuild|msconfig|msdeploy|msdt|mshta|mshtml\.dll|msc|msxsl|netsh|odbcconf|pcalua|pcwrun|pcwutl\.dll|pester\.bat|powerpnt|presentationhost|pubprn\.vbs|rcsi|reg|regasm|regedit|register-cimprovider|regsvcs|regsvr32|rpcping|rundll32|runonce|runscripthelper|sc|schtasks|scriptrunner|setupapi\.dll|shdocvw\.dll|shell32\.dll|slmgr\.vbs|sqldumper|sqlps|sqltoolsps|squirrel|syncappvpublishingserver|syncappvpublishingserver\.vbs|syssetup\.dll|te|tracker|tttracer|update|url\.dll|verclsid|vsjitdebugger|wab|winrm\.vbs|winword|wmic|wscript|wsl|wsreset|xwizard|zipfldr\.dll)\s[0m
[30;1m71 | [0m[35m[0m
[30;1m72 | [0m[35mUnless explicitly stated otherwise all files in this repository are licensed under the Apache Licens[0m
[30;1m73 | [0m[35m[0m
[30;1m74 | [0m[35mThis product includes software developed at Datadog (https://www.datadoghq.com/). Copyright 2019 Dat[0m
[30;1m75 | [0m[35m[0m
[30;1m76 | [0m[35m[1]: https://www.datadoghq.com/blog/troubleshoot-lambda-function-request-response-payloads/[0m

[31m--[ [0m[34mMatch #[0m[33m68[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000600[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Windows[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/README.md[0m
   Pattern: [32m\s(advpack\.dll|appvlp|at|atbroker|bash|bginfo|bitsadmin|cdb|certutil|cl_invocation\.ps1|cl_mutexverifiers\.ps1|cmd|cmdkey|cmstp|comsvcs\.dll|control|csc|cscript|csi|devtoolslauncher|dfsvc|diskshadow|dnscmd|dnx|dotnet|dxcap|esentutl|eventvwr|excel|expand|extexport|extrac32|findstr|forfiles|ftp|gfxdownloadwrapper|gpscript|hh|ie4uinit|ieadvpack\.dll|ieaframe\.dll|ic|infdefaultinstall|installutil|jsc|makecab|manage-bde\.wsf|mavinject|mftrace|microsoft\.workflow\.compiler|mmc|msbuild|msconfig|msdeploy|msdt|mshta|mshtml\.dll|msc|msxsl|netsh|odbcconf|pcalua|pcwrun|pcwutl\.dll|pester\.bat|powerpnt|presentationhost|pubprn\.vbs|rcsi|reg|regasm|regedit|register-cimprovider|regsvcs|regsvr32|rpcping|rundll32|runonce|runscripthelper|sc|schtasks|scriptrunner|setupapi\.dll|shdocvw\.dll|shell32\.dll|slmgr\.vbs|sqldumper|sqlps|sqltoolsps|squirrel|syncappvpublishingserver|syncappvpublishingserver\.vbs|syssetup\.dll|te|tracker|tttracer|update|url\.dll|verclsid|vsjitdebugger|wab|winrm\.vbs|winword|wmic|wscript|wsl|wsreset|xwizard|zipfldr\.dll)\s[0m
[30;1m  | [0m[35mous Profiler](https://www.datadoghq.com/product/code-profiling/) is now available in beta for Python[0m
[30;1m  | [0m[35m[0m
[30;1m  | [0m[35mThe Continuous Profiler works by spawning a thread which periodically wakes up and takes a snapshot [0m
[30;1m  | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m69[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/__init__.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m5 | [0m[35mif os.environ.get("DD_INSTRUMENTATION_TELEMETRY_ENABLED") is None:[0m
[30;1m6 | [0m[35m    os.environ["DD_INSTRUMENTATION_TELEMETRY_ENABLED"] = "false"[0m
[30;1m7 | [0m[35m[0m
[30;1m8 | [0m[35mif os.environ.get("DD_API_SECURITY_ENABLED") is None:[0m
[30;1m9 | [0m[35m    os.environ["DD_API_SECURITY_ENABLED"] = "False"[0m
[30;1m10 | [0m[35m[0m
[30;1m11 | [0m[35minitialize_cold_start_tracing()[0m

[31m--[ [0m[34mMatch #[0m[33m70[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/__init__.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m2 | [0m[35mimport os[0m
[30;1m3 | [0m[35m[0m
[30;1m4 | [0m[35m[0m
[30;1m5 | [0m[35mif os.environ.get("DD_INSTRUMENTATION_TELEMETRY_ENABLED") is None:[0m
[30;1m6 | [0m[35m    os.environ["DD_INSTRUMENTATION_TELEMETRY_ENABLED"] = "false"[0m
[30;1m7 | [0m[35m[0m
[30;1m8 | [0m[35mif os.environ.get("DD_API_SECURITY_ENABLED") is None:[0m

[31m--[ [0m[34mMatch #[0m[33m71[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1337 | [0m[35m[0m
[30;1m1338 | [0m[35m    # Use more granular timestamp from upstream Step Function if possible[0m
[30;1m1339 | [0m[35m    try:[0m
[30;1m1340 | [0m[35m        if is_step_function_event(event.get("detail")):[0m
[30;1m1341 | [0m[35m            timestamp = event["detail"]["_datadog"]["State"]["EnteredTime"][0m
[30;1m1342 | [0m[35m            dt_format = "%Y-%m-%dT%H:%M:%S.%fZ"[0m
[30;1m1343 | [0m[35m    except (TypeError, KeyError, AttributeError):[0m

[31m--[ [0m[34mMatch #[0m[33m72[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1332 | [0m[35m        tag_source="self",[0m
[30;1m1333 | [0m[35m    )[0m
[30;1m1334 | [0m[35m[0m
[30;1m1335 | [0m[35m    timestamp = event.get("time")[0m
[30;1m1336 | [0m[35m    dt_format = "%Y-%m-%dT%H:%M:%SZ"[0m
[30;1m1337 | [0m[35m[0m
[30;1m1338 | [0m[35m    # Use more granular timestamp from upstream Step Function if possible[0m

[31m--[ [0m[34mMatch #[0m[33m73[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1324 | [0m[35m    tags = {[0m
[30;1m1325 | [0m[35m        "operation_name": "aws.eventbridge",[0m
[30;1m1326 | [0m[35m        "resource_names": source,[0m
[30;1m1327 | [0m[35m        "detail_type": event.get("detail-type"),[0m
[30;1m1328 | [0m[35m    }[0m
[30;1m1329 | [0m[35m    InferredSpanInfo.set_tags([0m
[30;1m1330 | [0m[35m        tags,[0m

[31m--[ [0m[34mMatch #[0m[33m74[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1317 | [0m[35m[0m
[30;1m1318 | [0m[35m[0m
[30;1m1319 | [0m[35mdef create_inferred_span_from_eventbridge_event(event, context):[0m
[30;1m1320 | [0m[35m    source = event.get("source")[0m
[30;1m1321 | [0m[35m    service_name = determine_service_name([0m
[30;1m1322 | [0m[35m        service_mapping, source, "lambda_eventbridge", "eventbridge"[0m
[30;1m1323 | [0m[35m    )[0m

[31m--[ [0m[34mMatch #[0m[33m75[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1303 | [0m[35m    }[0m
[30;1m1304 | [0m[35m    InferredSpanInfo.set_tags(tags, synchronicity="async", tag_source="self")[0m
[30;1m1305 | [0m[35m    dt_format = "%Y-%m-%dT%H:%M:%S.%fZ"[0m
[30;1m1306 | [0m[35m    timestamp = event_record.get("eventTime")[0m
[30;1m1307 | [0m[35m    dt = datetime.strptime(timestamp, dt_format)[0m
[30;1m1308 | [0m[35m[0m
[30;1m1309 | [0m[35m    tracer.set_tags(_dd_origin)[0m

[31m--[ [0m[34mMatch #[0m[33m76[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1299 | [0m[35m        "bucket_arn": bucket.get("arn"),[0m
[30;1m1300 | [0m[35m        "object_key": obj.get("key"),[0m
[30;1m1301 | [0m[35m        "object_size": str(obj.get("size")),[0m
[30;1m1302 | [0m[35m        "object_etag": obj.get("eTag"),[0m
[30;1m1303 | [0m[35m    }[0m
[30;1m1304 | [0m[35m    InferredSpanInfo.set_tags(tags, synchronicity="async", tag_source="self")[0m
[30;1m1305 | [0m[35m    dt_format = "%Y-%m-%dT%H:%M:%S.%fZ"[0m

[31m--[ [0m[34mMatch #[0m[33m77[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1298 | [0m[35m        "bucketname": bucket_name,[0m
[30;1m1299 | [0m[35m        "bucket_arn": bucket.get("arn"),[0m
[30;1m1300 | [0m[35m        "object_key": obj.get("key"),[0m
[30;1m1301 | [0m[35m        "object_size": str(obj.get("size")),[0m
[30;1m1302 | [0m[35m        "object_etag": obj.get("eTag"),[0m
[30;1m1303 | [0m[35m    }[0m
[30;1m1304 | [0m[35m    InferredSpanInfo.set_tags(tags, synchronicity="async", tag_source="self")[0m

[31m--[ [0m[34mMatch #[0m[33m78[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1297 | [0m[35m        "event_name": event_record.get("eventName"),[0m
[30;1m1298 | [0m[35m        "bucketname": bucket_name,[0m
[30;1m1299 | [0m[35m        "bucket_arn": bucket.get("arn"),[0m
[30;1m1300 | [0m[35m        "object_key": obj.get("key"),[0m
[30;1m1301 | [0m[35m        "object_size": str(obj.get("size")),[0m
[30;1m1302 | [0m[35m        "object_etag": obj.get("eTag"),[0m
[30;1m1303 | [0m[35m    }[0m

[31m--[ [0m[34mMatch #[0m[33m79[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1296 | [0m[35m        "resource_names": bucket_name,[0m
[30;1m1297 | [0m[35m        "event_name": event_record.get("eventName"),[0m
[30;1m1298 | [0m[35m        "bucketname": bucket_name,[0m
[30;1m1299 | [0m[35m        "bucket_arn": bucket.get("arn"),[0m
[30;1m1300 | [0m[35m        "object_key": obj.get("key"),[0m
[30;1m1301 | [0m[35m        "object_size": str(obj.get("size")),[0m
[30;1m1302 | [0m[35m        "object_etag": obj.get("eTag"),[0m

[31m--[ [0m[34mMatch #[0m[33m80[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1294 | [0m[35m    tags = {[0m
[30;1m1295 | [0m[35m        "operation_name": "aws.s3",[0m
[30;1m1296 | [0m[35m        "resource_names": bucket_name,[0m
[30;1m1297 | [0m[35m        "event_name": event_record.get("eventName"),[0m
[30;1m1298 | [0m[35m        "bucketname": bucket_name,[0m
[30;1m1299 | [0m[35m        "bucket_arn": bucket.get("arn"),[0m
[30;1m1300 | [0m[35m        "object_key": obj.get("key"),[0m

[31m--[ [0m[34mMatch #[0m[33m81[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1287 | [0m[35m    s3 = event_record.get("s3") or {}[0m
[30;1m1288 | [0m[35m    bucket = s3.get("bucket") or {}[0m
[30;1m1289 | [0m[35m    obj = s3.get("object") or {}[0m
[30;1m1290 | [0m[35m    bucket_name = bucket.get("name")[0m
[30;1m1291 | [0m[35m    service_name = determine_service_name([0m
[30;1m1292 | [0m[35m        service_mapping, bucket_name, "lambda_s3", "s3"[0m
[30;1m1293 | [0m[35m    )[0m

[31m--[ [0m[34mMatch #[0m[33m82[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1286 | [0m[35m    event_record = get_first_record(event)[0m
[30;1m1287 | [0m[35m    s3 = event_record.get("s3") or {}[0m
[30;1m1288 | [0m[35m    bucket = s3.get("bucket") or {}[0m
[30;1m1289 | [0m[35m    obj = s3.get("object") or {}[0m
[30;1m1290 | [0m[35m    bucket_name = bucket.get("name")[0m
[30;1m1291 | [0m[35m    service_name = determine_service_name([0m
[30;1m1292 | [0m[35m        service_mapping, bucket_name, "lambda_s3", "s3"[0m

[31m--[ [0m[34mMatch #[0m[33m83[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1285 | [0m[35mdef create_inferred_span_from_s3_event(event, context):[0m
[30;1m1286 | [0m[35m    event_record = get_first_record(event)[0m
[30;1m1287 | [0m[35m    s3 = event_record.get("s3") or {}[0m
[30;1m1288 | [0m[35m    bucket = s3.get("bucket") or {}[0m
[30;1m1289 | [0m[35m    obj = s3.get("object") or {}[0m
[30;1m1290 | [0m[35m    bucket_name = bucket.get("name")[0m
[30;1m1291 | [0m[35m    service_name = determine_service_name([0m

[31m--[ [0m[34mMatch #[0m[33m84[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1284 | [0m[35m[0m
[30;1m1285 | [0m[35mdef create_inferred_span_from_s3_event(event, context):[0m
[30;1m1286 | [0m[35m    event_record = get_first_record(event)[0m
[30;1m1287 | [0m[35m    s3 = event_record.get("s3") or {}[0m
[30;1m1288 | [0m[35m    bucket = s3.get("bucket") or {}[0m
[30;1m1289 | [0m[35m    obj = s3.get("object") or {}[0m
[30;1m1290 | [0m[35m    bucket_name = bucket.get("name")[0m

[31m--[ [0m[34mMatch #[0m[33m85[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1270 | [0m[35m        "size_bytes": str(dynamodb_message.get("SizeBytes")),[0m
[30;1m1271 | [0m[35m    }[0m
[30;1m1272 | [0m[35m    InferredSpanInfo.set_tags(tags, synchronicity="async", tag_source="self")[0m
[30;1m1273 | [0m[35m    request_time_epoch = dynamodb_message.get("ApproximateCreationDateTime")[0m
[30;1m1274 | [0m[35m    tracer.set_tags(_dd_origin)[0m
[30;1m1275 | [0m[35m    span = tracer.trace([0m
[30;1m1276 | [0m[35m        "aws.dynamodb", service=service_name, resource=table_name, span_type="web"[0m

[31m--[ [0m[34mMatch #[0m[33m86[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1267 | [0m[35m        "event_name": event_record.get("eventName"),[0m
[30;1m1268 | [0m[35m        "event_version": event_record.get("eventVersion"),[0m
[30;1m1269 | [0m[35m        "stream_view_type": dynamodb_message.get("StreamViewType"),[0m
[30;1m1270 | [0m[35m        "size_bytes": str(dynamodb_message.get("SizeBytes")),[0m
[30;1m1271 | [0m[35m    }[0m
[30;1m1272 | [0m[35m    InferredSpanInfo.set_tags(tags, synchronicity="async", tag_source="self")[0m
[30;1m1273 | [0m[35m    request_time_epoch = dynamodb_message.get("ApproximateCreationDateTime")[0m

[31m--[ [0m[34mMatch #[0m[33m87[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1266 | [0m[35m        "event_id": event_record.get("eventID"),[0m
[30;1m1267 | [0m[35m        "event_name": event_record.get("eventName"),[0m
[30;1m1268 | [0m[35m        "event_version": event_record.get("eventVersion"),[0m
[30;1m1269 | [0m[35m        "stream_view_type": dynamodb_message.get("StreamViewType"),[0m
[30;1m1270 | [0m[35m        "size_bytes": str(dynamodb_message.get("SizeBytes")),[0m
[30;1m1271 | [0m[35m    }[0m
[30;1m1272 | [0m[35m    InferredSpanInfo.set_tags(tags, synchronicity="async", tag_source="self")[0m

[31m--[ [0m[34mMatch #[0m[33m88[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1265 | [0m[35m        "event_source_arn": event_source_arn,[0m
[30;1m1266 | [0m[35m        "event_id": event_record.get("eventID"),[0m
[30;1m1267 | [0m[35m        "event_name": event_record.get("eventName"),[0m
[30;1m1268 | [0m[35m        "event_version": event_record.get("eventVersion"),[0m
[30;1m1269 | [0m[35m        "stream_view_type": dynamodb_message.get("StreamViewType"),[0m
[30;1m1270 | [0m[35m        "size_bytes": str(dynamodb_message.get("SizeBytes")),[0m
[30;1m1271 | [0m[35m    }[0m

[31m--[ [0m[34mMatch #[0m[33m89[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1264 | [0m[35m        "tablename": table_name,[0m
[30;1m1265 | [0m[35m        "event_source_arn": event_source_arn,[0m
[30;1m1266 | [0m[35m        "event_id": event_record.get("eventID"),[0m
[30;1m1267 | [0m[35m        "event_name": event_record.get("eventName"),[0m
[30;1m1268 | [0m[35m        "event_version": event_record.get("eventVersion"),[0m
[30;1m1269 | [0m[35m        "stream_view_type": dynamodb_message.get("StreamViewType"),[0m
[30;1m1270 | [0m[35m        "size_bytes": str(dynamodb_message.get("SizeBytes")),[0m

[31m--[ [0m[34mMatch #[0m[33m90[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1263 | [0m[35m        "resource_names": table_name,[0m
[30;1m1264 | [0m[35m        "tablename": table_name,[0m
[30;1m1265 | [0m[35m        "event_source_arn": event_source_arn,[0m
[30;1m1266 | [0m[35m        "event_id": event_record.get("eventID"),[0m
[30;1m1267 | [0m[35m        "event_name": event_record.get("eventName"),[0m
[30;1m1268 | [0m[35m        "event_version": event_record.get("eventVersion"),[0m
[30;1m1269 | [0m[35m        "stream_view_type": dynamodb_message.get("StreamViewType"),[0m

[31m--[ [0m[34mMatch #[0m[33m91[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1257 | [0m[35m    service_name = determine_service_name([0m
[30;1m1258 | [0m[35m        service_mapping, table_name, "lambda_dynamodb", "dynamodb"[0m
[30;1m1259 | [0m[35m    )[0m
[30;1m1260 | [0m[35m    dynamodb_message = event_record.get("dynamodb") or {}[0m
[30;1m1261 | [0m[35m    tags = {[0m
[30;1m1262 | [0m[35m        "operation_name": "aws.dynamodb",[0m
[30;1m1263 | [0m[35m        "resource_names": table_name,[0m

[31m--[ [0m[34mMatch #[0m[33m92[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1252 | [0m[35m[0m
[30;1m1253 | [0m[35mdef create_inferred_span_from_dynamodb_event(event, context):[0m
[30;1m1254 | [0m[35m    event_record = get_first_record(event)[0m
[30;1m1255 | [0m[35m    event_source_arn = event_record.get("eventSourceARN")[0m
[30;1m1256 | [0m[35m    table_name = event_source_arn.split("/")[1][0m
[30;1m1257 | [0m[35m    service_name = determine_service_name([0m
[30;1m1258 | [0m[35m        service_mapping, table_name, "lambda_dynamodb", "dynamodb"[0m

[31m--[ [0m[34mMatch #[0m[33m93[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1238 | [0m[35m        "partition_key": kinesis.get("partitionKey"),[0m
[30;1m1239 | [0m[35m    }[0m
[30;1m1240 | [0m[35m    InferredSpanInfo.set_tags(tags, tag_source="self", synchronicity="async")[0m
[30;1m1241 | [0m[35m    request_time_epoch = kinesis.get("approximateArrivalTimestamp")[0m
[30;1m1242 | [0m[35m[0m
[30;1m1243 | [0m[35m    tracer.set_tags(_dd_origin)[0m
[30;1m1244 | [0m[35m    span = tracer.trace([0m

[31m--[ [0m[34mMatch #[0m[33m94[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1235 | [0m[35m        "event_id": event_id,[0m
[30;1m1236 | [0m[35m        "event_name": event_record.get("eventName"),[0m
[30;1m1237 | [0m[35m        "event_version": event_record.get("eventVersion"),[0m
[30;1m1238 | [0m[35m        "partition_key": kinesis.get("partitionKey"),[0m
[30;1m1239 | [0m[35m    }[0m
[30;1m1240 | [0m[35m    InferredSpanInfo.set_tags(tags, tag_source="self", synchronicity="async")[0m
[30;1m1241 | [0m[35m    request_time_epoch = kinesis.get("approximateArrivalTimestamp")[0m

[31m--[ [0m[34mMatch #[0m[33m95[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1234 | [0m[35m        "event_source_arn": event_source_arn,[0m
[30;1m1235 | [0m[35m        "event_id": event_id,[0m
[30;1m1236 | [0m[35m        "event_name": event_record.get("eventName"),[0m
[30;1m1237 | [0m[35m        "event_version": event_record.get("eventVersion"),[0m
[30;1m1238 | [0m[35m        "partition_key": kinesis.get("partitionKey"),[0m
[30;1m1239 | [0m[35m    }[0m
[30;1m1240 | [0m[35m    InferredSpanInfo.set_tags(tags, tag_source="self", synchronicity="async")[0m

[31m--[ [0m[34mMatch #[0m[33m96[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1233 | [0m[35m        "shardid": shard_id,[0m
[30;1m1234 | [0m[35m        "event_source_arn": event_source_arn,[0m
[30;1m1235 | [0m[35m        "event_id": event_id,[0m
[30;1m1236 | [0m[35m        "event_name": event_record.get("eventName"),[0m
[30;1m1237 | [0m[35m        "event_version": event_record.get("eventVersion"),[0m
[30;1m1238 | [0m[35m        "partition_key": kinesis.get("partitionKey"),[0m
[30;1m1239 | [0m[35m    }[0m

[31m--[ [0m[34mMatch #[0m[33m97[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1225 | [0m[35m    service_name = determine_service_name([0m
[30;1m1226 | [0m[35m        service_mapping, stream_name, "lambda_kinesis", "kinesis"[0m
[30;1m1227 | [0m[35m    )[0m
[30;1m1228 | [0m[35m    kinesis = event_record.get("kinesis") or {}[0m
[30;1m1229 | [0m[35m    tags = {[0m
[30;1m1230 | [0m[35m        "operation_name": "aws.kinesis",[0m
[30;1m1231 | [0m[35m        "resource_names": stream_name,[0m

[31m--[ [0m[34mMatch #[0m[33m98[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1219 | [0m[35mdef create_inferred_span_from_kinesis_event(event, context):[0m
[30;1m1220 | [0m[35m    event_record = get_first_record(event)[0m
[30;1m1221 | [0m[35m    event_source_arn = event_record.get("eventSourceARN")[0m
[30;1m1222 | [0m[35m    event_id = event_record.get("eventID")[0m
[30;1m1223 | [0m[35m    stream_name = event_source_arn.split(":")[-1][0m
[30;1m1224 | [0m[35m    shard_id = event_id.split(":")[0][0m
[30;1m1225 | [0m[35m    service_name = determine_service_name([0m

[31m--[ [0m[34mMatch #[0m[33m99[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1218 | [0m[35m[0m
[30;1m1219 | [0m[35mdef create_inferred_span_from_kinesis_event(event, context):[0m
[30;1m1220 | [0m[35m    event_record = get_first_record(event)[0m
[30;1m1221 | [0m[35m    event_source_arn = event_record.get("eventSourceARN")[0m
[30;1m1222 | [0m[35m    event_id = event_record.get("eventID")[0m
[30;1m1223 | [0m[35m    stream_name = event_source_arn.split(":")[-1][0m
[30;1m1224 | [0m[35m    shard_id = event_id.split(":")[0][0m

[31m--[ [0m[34mMatch #[0m[33m100[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1203 | [0m[35m[0m
[30;1m1204 | [0m[35m    InferredSpanInfo.set_tags(tags, tag_source="self", synchronicity="async")[0m
[30;1m1205 | [0m[35m    sns_dt_format = "%Y-%m-%dT%H:%M:%S.%fZ"[0m
[30;1m1206 | [0m[35m    timestamp = sns_message.get("Timestamp")[0m
[30;1m1207 | [0m[35m    dt = datetime.strptime(timestamp, sns_dt_format)[0m
[30;1m1208 | [0m[35m[0m
[30;1m1209 | [0m[35m    tracer.set_tags(_dd_origin)[0m

[31m--[ [0m[34mMatch #[0m[33m101[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1197 | [0m[35m    }[0m
[30;1m1198 | [0m[35m[0m
[30;1m1199 | [0m[35m    # Subject not available in SNS => SQS scenario[0m
[30;1m1200 | [0m[35m    subject = sns_message.get("Subject")[0m
[30;1m1201 | [0m[35m    if subject:[0m
[30;1m1202 | [0m[35m        tags["subject"] = subject[0m
[30;1m1203 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m102[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1193 | [0m[35m        "topicname": topic_name,[0m
[30;1m1194 | [0m[35m        "topic_arn": topic_arn,[0m
[30;1m1195 | [0m[35m        "message_id": sns_message.get("MessageId"),[0m
[30;1m1196 | [0m[35m        "type": sns_message.get("Type"),[0m
[30;1m1197 | [0m[35m    }[0m
[30;1m1198 | [0m[35m[0m
[30;1m1199 | [0m[35m    # Subject not available in SNS => SQS scenario[0m

[31m--[ [0m[34mMatch #[0m[33m103[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1192 | [0m[35m        "resource_names": topic_name,[0m
[30;1m1193 | [0m[35m        "topicname": topic_name,[0m
[30;1m1194 | [0m[35m        "topic_arn": topic_arn,[0m
[30;1m1195 | [0m[35m        "message_id": sns_message.get("MessageId"),[0m
[30;1m1196 | [0m[35m        "type": sns_message.get("Type"),[0m
[30;1m1197 | [0m[35m    }[0m
[30;1m1198 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m104[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1182 | [0m[35mdef create_inferred_span_from_sns_event(event, context):[0m
[30;1m1183 | [0m[35m    event_record = get_first_record(event)[0m
[30;1m1184 | [0m[35m    sns_message = event_record.get("Sns") or {}[0m
[30;1m1185 | [0m[35m    topic_arn = sns_message.get("TopicArn")[0m
[30;1m1186 | [0m[35m    topic_name = topic_arn.split(":")[-1][0m
[30;1m1187 | [0m[35m    service_name = determine_service_name([0m
[30;1m1188 | [0m[35m        service_mapping, topic_name, "lambda_sns", "sns"[0m

[31m--[ [0m[34mMatch #[0m[33m105[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1181 | [0m[35m[0m
[30;1m1182 | [0m[35mdef create_inferred_span_from_sns_event(event, context):[0m
[30;1m1183 | [0m[35m    event_record = get_first_record(event)[0m
[30;1m1184 | [0m[35m    sns_message = event_record.get("Sns") or {}[0m
[30;1m1185 | [0m[35m    topic_arn = sns_message.get("TopicArn")[0m
[30;1m1186 | [0m[35m    topic_name = topic_arn.split(":")[-1][0m
[30;1m1187 | [0m[35m    service_name = determine_service_name([0m

[31m--[ [0m[34mMatch #[0m[33m106[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1150 | [0m[35m            # EventBridge => SQS[0m
[30;1m1151 | [0m[35m            elif body.get("detail"):[0m
[30;1m1152 | [0m[35m                detail = body.get("detail")[0m
[30;1m1153 | [0m[35m                if detail.get("_datadog"):[0m
[30;1m1154 | [0m[35m                    logger.debug("Found an EventBridge message inside SQS event")[0m
[30;1m1155 | [0m[35m                    upstream_span = create_inferred_span_from_eventbridge_event([0m
[30;1m1156 | [0m[35m                        body, context[0m

[31m--[ [0m[34mMatch #[0m[33m107[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1149 | [0m[35m[0m
[30;1m1150 | [0m[35m            # EventBridge => SQS[0m
[30;1m1151 | [0m[35m            elif body.get("detail"):[0m
[30;1m1152 | [0m[35m                detail = body.get("detail")[0m
[30;1m1153 | [0m[35m                if detail.get("_datadog"):[0m
[30;1m1154 | [0m[35m                    logger.debug("Found an EventBridge message inside SQS event")[0m
[30;1m1155 | [0m[35m                    upstream_span = create_inferred_span_from_eventbridge_event([0m

[31m--[ [0m[34mMatch #[0m[33m108[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1148 | [0m[35m                upstream_span.finish(finish_time=start_time)[0m
[30;1m1149 | [0m[35m[0m
[30;1m1150 | [0m[35m            # EventBridge => SQS[0m
[30;1m1151 | [0m[35m            elif body.get("detail"):[0m
[30;1m1152 | [0m[35m                detail = body.get("detail")[0m
[30;1m1153 | [0m[35m                if detail.get("_datadog"):[0m
[30;1m1154 | [0m[35m                    logger.debug("Found an EventBridge message inside SQS event")[0m

[31m--[ [0m[34mMatch #[0m[33m109[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1140 | [0m[35m            body = json.loads(body_str)[0m
[30;1m1141 | [0m[35m[0m
[30;1m1142 | [0m[35m            # logic to deal with SNS => SQS event[0m
[30;1m1143 | [0m[35m            if body.get("Type", "") == "Notification" and "TopicArn" in body:[0m
[30;1m1144 | [0m[35m                logger.debug("Found SNS message inside SQS event")[0m
[30;1m1145 | [0m[35m                upstream_span = create_inferred_span_from_sns_event([0m
[30;1m1146 | [0m[35m                    create_sns_event(body), context[0m

[31m--[ [0m[34mMatch #[0m[33m110[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1135 | [0m[35m[0m
[30;1m1136 | [0m[35m    upstream_span = None[0m
[30;1m1137 | [0m[35m    if "body" in event_record:[0m
[30;1m1138 | [0m[35m        body_str = event_record.get("body", {})[0m
[30;1m1139 | [0m[35m        try:[0m
[30;1m1140 | [0m[35m            body = json.loads(body_str)[0m
[30;1m1141 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m111[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1130 | [0m[35m        "sender_id": attrs.get("SenderId"),[0m
[30;1m1131 | [0m[35m    }[0m
[30;1m1132 | [0m[35m    InferredSpanInfo.set_tags(tags, tag_source="self", synchronicity="async")[0m
[30;1m1133 | [0m[35m    request_time_epoch = attrs.get("SentTimestamp")[0m
[30;1m1134 | [0m[35m    start_time = int(request_time_epoch) / 1000[0m
[30;1m1135 | [0m[35m[0m
[30;1m1136 | [0m[35m    upstream_span = None[0m

[31m--[ [0m[34mMatch #[0m[33m112[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1127 | [0m[35m        "queuename": queue_name,[0m
[30;1m1128 | [0m[35m        "event_source_arn": event_source_arn,[0m
[30;1m1129 | [0m[35m        "receipt_handle": event_record.get("receiptHandle"),[0m
[30;1m1130 | [0m[35m        "sender_id": attrs.get("SenderId"),[0m
[30;1m1131 | [0m[35m    }[0m
[30;1m1132 | [0m[35m    InferredSpanInfo.set_tags(tags, tag_source="self", synchronicity="async")[0m
[30;1m1133 | [0m[35m    request_time_epoch = attrs.get("SentTimestamp")[0m

[31m--[ [0m[34mMatch #[0m[33m113[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1126 | [0m[35m        "resource_names": queue_name,[0m
[30;1m1127 | [0m[35m        "queuename": queue_name,[0m
[30;1m1128 | [0m[35m        "event_source_arn": event_source_arn,[0m
[30;1m1129 | [0m[35m        "receipt_handle": event_record.get("receiptHandle"),[0m
[30;1m1130 | [0m[35m        "sender_id": attrs.get("SenderId"),[0m
[30;1m1131 | [0m[35m    }[0m
[30;1m1132 | [0m[35m    InferredSpanInfo.set_tags(tags, tag_source="self", synchronicity="async")[0m

[31m--[ [0m[34mMatch #[0m[33m114[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1120 | [0m[35m    service_name = determine_service_name([0m
[30;1m1121 | [0m[35m        service_mapping, queue_name, "lambda_sqs", "sqs"[0m
[30;1m1122 | [0m[35m    )[0m
[30;1m1123 | [0m[35m    attrs = event_record.get("attributes") or {}[0m
[30;1m1124 | [0m[35m    tags = {[0m
[30;1m1125 | [0m[35m        "operation_name": "aws.sqs",[0m
[30;1m1126 | [0m[35m        "resource_names": queue_name,[0m

[31m--[ [0m[34mMatch #[0m[33m115[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1115 | [0m[35m    trace_ctx = tracer.current_trace_context()[0m
[30;1m1116 | [0m[35m[0m
[30;1m1117 | [0m[35m    event_record = get_first_record(event)[0m
[30;1m1118 | [0m[35m    event_source_arn = event_record.get("eventSourceARN")[0m
[30;1m1119 | [0m[35m    queue_name = event_source_arn.split(":")[-1][0m
[30;1m1120 | [0m[35m    service_name = determine_service_name([0m
[30;1m1121 | [0m[35m        service_mapping, queue_name, "lambda_sqs", "sqs"[0m

[31m--[ [0m[34mMatch #[0m[33m116[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1099 | [0m[35m    if decode_authorizer_context:[0m
[30;1m1100 | [0m[35m        injected_authorizer_data = get_injected_authorizer_data(event, True)[0m
[30;1m1101 | [0m[35m        if injected_authorizer_data:[0m
[30;1m1102 | [0m[35m            inferred_span_start_ns = injected_authorizer_data.get([0m
[30;1m1103 | [0m[35m                Headers.Parent_Span_Finish_Time[0m
[30;1m1104 | [0m[35m            )[0m
[30;1m1105 | [0m[35m    span = tracer.trace([0m

[31m--[ [0m[34mMatch #[0m[33m117[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1089 | [0m[35m        "apiname": api_id,[0m
[30;1m1090 | [0m[35m        "stage": request_context.get("stage"),[0m
[30;1m1091 | [0m[35m    }[0m
[30;1m1092 | [0m[35m    request_time_epoch_ms = int(request_context.get("timeEpoch"))[0m
[30;1m1093 | [0m[35m    if is_api_gateway_invocation_async(event):[0m
[30;1m1094 | [0m[35m        InferredSpanInfo.set_tags(tags, tag_source="self", synchronicity="async")[0m
[30;1m1095 | [0m[35m    else:[0m

[31m--[ [0m[34mMatch #[0m[33m118[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1087 | [0m[35m        "request_id": context.aws_request_id,[0m
[30;1m1088 | [0m[35m        "apiid": api_id,[0m
[30;1m1089 | [0m[35m        "apiname": api_id,[0m
[30;1m1090 | [0m[35m        "stage": request_context.get("stage"),[0m
[30;1m1091 | [0m[35m    }[0m
[30;1m1092 | [0m[35m    request_time_epoch_ms = int(request_context.get("timeEpoch"))[0m
[30;1m1093 | [0m[35m    if is_api_gateway_invocation_async(event):[0m

[31m--[ [0m[34mMatch #[0m[33m119[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1082 | [0m[35m        "http.method": http.get("method"),[0m
[30;1m1083 | [0m[35m        "http.protocol": http.get("protocol"),[0m
[30;1m1084 | [0m[35m        "http.source_ip": http.get("sourceIp"),[0m
[30;1m1085 | [0m[35m        "http.user_agent": http.get("userAgent"),[0m
[30;1m1086 | [0m[35m        "resource_names": resource,[0m
[30;1m1087 | [0m[35m        "request_id": context.aws_request_id,[0m
[30;1m1088 | [0m[35m        "apiid": api_id,[0m

[31m--[ [0m[34mMatch #[0m[33m120[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1081 | [0m[35m        "http.url": domain + path,[0m
[30;1m1082 | [0m[35m        "http.method": http.get("method"),[0m
[30;1m1083 | [0m[35m        "http.protocol": http.get("protocol"),[0m
[30;1m1084 | [0m[35m        "http.source_ip": http.get("sourceIp"),[0m
[30;1m1085 | [0m[35m        "http.user_agent": http.get("userAgent"),[0m
[30;1m1086 | [0m[35m        "resource_names": resource,[0m
[30;1m1087 | [0m[35m        "request_id": context.aws_request_id,[0m

[31m--[ [0m[34mMatch #[0m[33m121[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1080 | [0m[35m        "endpoint": path,[0m
[30;1m1081 | [0m[35m        "http.url": domain + path,[0m
[30;1m1082 | [0m[35m        "http.method": http.get("method"),[0m
[30;1m1083 | [0m[35m        "http.protocol": http.get("protocol"),[0m
[30;1m1084 | [0m[35m        "http.source_ip": http.get("sourceIp"),[0m
[30;1m1085 | [0m[35m        "http.user_agent": http.get("userAgent"),[0m
[30;1m1086 | [0m[35m        "resource_names": resource,[0m

[31m--[ [0m[34mMatch #[0m[33m122[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1079 | [0m[35m        "operation_name": "aws.httpapi",[0m
[30;1m1080 | [0m[35m        "endpoint": path,[0m
[30;1m1081 | [0m[35m        "http.url": domain + path,[0m
[30;1m1082 | [0m[35m        "http.method": http.get("method"),[0m
[30;1m1083 | [0m[35m        "http.protocol": http.get("protocol"),[0m
[30;1m1084 | [0m[35m        "http.source_ip": http.get("sourceIp"),[0m
[30;1m1085 | [0m[35m        "http.user_agent": http.get("userAgent"),[0m

[31m--[ [0m[34mMatch #[0m[33m123[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1072 | [0m[35m    )[0m
[30;1m1073 | [0m[35m    http = request_context.get("http") or {}[0m
[30;1m1074 | [0m[35m    method = http.get("method")[0m
[30;1m1075 | [0m[35m    path = event.get("rawPath")[0m
[30;1m1076 | [0m[35m    resource_path = _get_resource_path(event, request_context)[0m
[30;1m1077 | [0m[35m    resource = f"{method} {resource_path}"[0m
[30;1m1078 | [0m[35m    tags = {[0m

[31m--[ [0m[34mMatch #[0m[33m124[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1071 | [0m[35m        service_mapping, api_id, "lambda_api_gateway", domain[0m
[30;1m1072 | [0m[35m    )[0m
[30;1m1073 | [0m[35m    http = request_context.get("http") or {}[0m
[30;1m1074 | [0m[35m    method = http.get("method")[0m
[30;1m1075 | [0m[35m    path = event.get("rawPath")[0m
[30;1m1076 | [0m[35m    resource_path = _get_resource_path(event, request_context)[0m
[30;1m1077 | [0m[35m    resource = f"{method} {resource_path}"[0m

[31m--[ [0m[34mMatch #[0m[33m125[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1070 | [0m[35m    service_name = determine_service_name([0m
[30;1m1071 | [0m[35m        service_mapping, api_id, "lambda_api_gateway", domain[0m
[30;1m1072 | [0m[35m    )[0m
[30;1m1073 | [0m[35m    http = request_context.get("http") or {}[0m
[30;1m1074 | [0m[35m    method = http.get("method")[0m
[30;1m1075 | [0m[35m    path = event.get("rawPath")[0m
[30;1m1076 | [0m[35m    resource_path = _get_resource_path(event, request_context)[0m

[31m--[ [0m[34mMatch #[0m[33m126[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1066 | [0m[35m):[0m
[30;1m1067 | [0m[35m    request_context = event.get("requestContext")[0m
[30;1m1068 | [0m[35m    domain = request_context.get("domainName")[0m
[30;1m1069 | [0m[35m    api_id = request_context.get("apiId")[0m
[30;1m1070 | [0m[35m    service_name = determine_service_name([0m
[30;1m1071 | [0m[35m        service_mapping, api_id, "lambda_api_gateway", domain[0m
[30;1m1072 | [0m[35m    )[0m

[31m--[ [0m[34mMatch #[0m[33m127[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1065 | [0m[35m    event, context, decode_authorizer_context: bool = True[0m
[30;1m1066 | [0m[35m):[0m
[30;1m1067 | [0m[35m    request_context = event.get("requestContext")[0m
[30;1m1068 | [0m[35m    domain = request_context.get("domainName")[0m
[30;1m1069 | [0m[35m    api_id = request_context.get("apiId")[0m
[30;1m1070 | [0m[35m    service_name = determine_service_name([0m
[30;1m1071 | [0m[35m        service_mapping, api_id, "lambda_api_gateway", domain[0m

[31m--[ [0m[34mMatch #[0m[33m128[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1064 | [0m[35mdef create_inferred_span_from_http_api_event([0m
[30;1m1065 | [0m[35m    event, context, decode_authorizer_context: bool = True[0m
[30;1m1066 | [0m[35m):[0m
[30;1m1067 | [0m[35m    request_context = event.get("requestContext")[0m
[30;1m1068 | [0m[35m    domain = request_context.get("domainName")[0m
[30;1m1069 | [0m[35m    api_id = request_context.get("apiId")[0m
[30;1m1070 | [0m[35m    service_name = determine_service_name([0m

[31m--[ [0m[34mMatch #[0m[33m129[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1058 | [0m[35m            return route_key.split(" ")[1][0m
[30;1m1059 | [0m[35m        except Exception as e:[0m
[30;1m1060 | [0m[35m            logger.debug("Error parsing routeKey: %s", e)[0m
[30;1m1061 | [0m[35m    return event.get("rawPath") or request_context.get("resourcePath") or route_key[0m
[30;1m1062 | [0m[35m[0m
[30;1m1063 | [0m[35m[0m
[30;1m1064 | [0m[35mdef create_inferred_span_from_http_api_event([0m

[31m--[ [0m[34mMatch #[0m[33m130[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1058 | [0m[35m            return route_key.split(" ")[1][0m
[30;1m1059 | [0m[35m        except Exception as e:[0m
[30;1m1060 | [0m[35m            logger.debug("Error parsing routeKey: %s", e)[0m
[30;1m1061 | [0m[35m    return event.get("rawPath") or request_context.get("resourcePath") or route_key[0m
[30;1m1062 | [0m[35m[0m
[30;1m1063 | [0m[35m[0m
[30;1m1064 | [0m[35mdef create_inferred_span_from_http_api_event([0m

[31m--[ [0m[34mMatch #[0m[33m131[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1052 | [0m[35m[0m
[30;1m1053 | [0m[35m[0m
[30;1m1054 | [0m[35mdef _get_resource_path(event, request_context):[0m
[30;1m1055 | [0m[35m    route_key = request_context.get("routeKey") or ""[0m
[30;1m1056 | [0m[35m    if "{" in route_key:[0m
[30;1m1057 | [0m[35m        try:[0m
[30;1m1058 | [0m[35m            return route_key.split(" ")[1][0m

[31m--[ [0m[34mMatch #[0m[33m132[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1020 | [0m[35m        "stage": request_context.get("stage"),[0m
[30;1m1021 | [0m[35m        "request_id": context.aws_request_id,[0m
[30;1m1022 | [0m[35m    }[0m
[30;1m1023 | [0m[35m    request_time_epoch_ms = int(request_context.get("requestTimeEpoch"))[0m
[30;1m1024 | [0m[35m    if is_api_gateway_invocation_async(event):[0m
[30;1m1025 | [0m[35m        InferredSpanInfo.set_tags(tags, tag_source="self", synchronicity="async")[0m
[30;1m1026 | [0m[35m    else:[0m

[31m--[ [0m[34mMatch #[0m[33m133[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1017 | [0m[35m        "resource_names": resource,[0m
[30;1m1018 | [0m[35m        "apiid": api_id,[0m
[30;1m1019 | [0m[35m        "apiname": api_id,[0m
[30;1m1020 | [0m[35m        "stage": request_context.get("stage"),[0m
[30;1m1021 | [0m[35m        "request_id": context.aws_request_id,[0m
[30;1m1022 | [0m[35m    }[0m
[30;1m1023 | [0m[35m    request_time_epoch_ms = int(request_context.get("requestTimeEpoch"))[0m

[31m--[ [0m[34mMatch #[0m[33m134[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1006 | [0m[35m        service_mapping, api_id, "lambda_api_gateway", domain[0m
[30;1m1007 | [0m[35m    )[0m
[30;1m1008 | [0m[35m    method = event.get("httpMethod")[0m
[30;1m1009 | [0m[35m    path = event.get("path")[0m
[30;1m1010 | [0m[35m    resource_path = _get_resource_path(event, request_context)[0m
[30;1m1011 | [0m[35m    resource = f"{method} {resource_path}"[0m
[30;1m1012 | [0m[35m    tags = {[0m

[31m--[ [0m[34mMatch #[0m[33m135[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1005 | [0m[35m    service_name = determine_service_name([0m
[30;1m1006 | [0m[35m        service_mapping, api_id, "lambda_api_gateway", domain[0m
[30;1m1007 | [0m[35m    )[0m
[30;1m1008 | [0m[35m    method = event.get("httpMethod")[0m
[30;1m1009 | [0m[35m    path = event.get("path")[0m
[30;1m1010 | [0m[35m    resource_path = _get_resource_path(event, request_context)[0m
[30;1m1011 | [0m[35m    resource = f"{method} {resource_path}"[0m

[31m--[ [0m[34mMatch #[0m[33m136[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1001 | [0m[35m):[0m
[30;1m1002 | [0m[35m    request_context = event.get("requestContext")[0m
[30;1m1003 | [0m[35m    domain = request_context.get("domainName", "")[0m
[30;1m1004 | [0m[35m    api_id = request_context.get("apiId")[0m
[30;1m1005 | [0m[35m    service_name = determine_service_name([0m
[30;1m1006 | [0m[35m        service_mapping, api_id, "lambda_api_gateway", domain[0m
[30;1m1007 | [0m[35m    )[0m

[31m--[ [0m[34mMatch #[0m[33m137[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m1000 | [0m[35m    event, context, decode_authorizer_context: bool = True[0m
[30;1m1001 | [0m[35m):[0m
[30;1m1002 | [0m[35m    request_context = event.get("requestContext")[0m
[30;1m1003 | [0m[35m    domain = request_context.get("domainName", "")[0m
[30;1m1004 | [0m[35m    api_id = request_context.get("apiId")[0m
[30;1m1005 | [0m[35m    service_name = determine_service_name([0m
[30;1m1006 | [0m[35m        service_mapping, api_id, "lambda_api_gateway", domain[0m

[31m--[ [0m[34mMatch #[0m[33m138[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m999 | [0m[35mdef create_inferred_span_from_api_gateway_event([0m
[30;1m1000 | [0m[35m    event, context, decode_authorizer_context: bool = True[0m
[30;1m1001 | [0m[35m):[0m
[30;1m1002 | [0m[35m    request_context = event.get("requestContext")[0m
[30;1m1003 | [0m[35m    domain = request_context.get("domainName", "")[0m
[30;1m1004 | [0m[35m    api_id = request_context.get("apiId")[0m
[30;1m1005 | [0m[35m    service_name = determine_service_name([0m

[31m--[ [0m[34mMatch #[0m[33m139[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m966 | [0m[35m        "event_type": request_context.get("eventType"),[0m
[30;1m967 | [0m[35m        "message_direction": request_context.get("messageDirection"),[0m
[30;1m968 | [0m[35m    }[0m
[30;1m969 | [0m[35m    request_time_epoch_ms = int(request_context.get("requestTimeEpoch"))[0m
[30;1m970 | [0m[35m    if is_api_gateway_invocation_async(event):[0m
[30;1m971 | [0m[35m        InferredSpanInfo.set_tags(tags, tag_source="self", synchronicity="async")[0m
[30;1m972 | [0m[35m    else:[0m

[31m--[ [0m[34mMatch #[0m[33m140[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m964 | [0m[35m        "request_id": context.aws_request_id,[0m
[30;1m965 | [0m[35m        "connection_id": request_context.get("connectionId"),[0m
[30;1m966 | [0m[35m        "event_type": request_context.get("eventType"),[0m
[30;1m967 | [0m[35m        "message_direction": request_context.get("messageDirection"),[0m
[30;1m968 | [0m[35m    }[0m
[30;1m969 | [0m[35m    request_time_epoch_ms = int(request_context.get("requestTimeEpoch"))[0m
[30;1m970 | [0m[35m    if is_api_gateway_invocation_async(event):[0m

[31m--[ [0m[34mMatch #[0m[33m141[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m963 | [0m[35m        "stage": request_context.get("stage"),[0m
[30;1m964 | [0m[35m        "request_id": context.aws_request_id,[0m
[30;1m965 | [0m[35m        "connection_id": request_context.get("connectionId"),[0m
[30;1m966 | [0m[35m        "event_type": request_context.get("eventType"),[0m
[30;1m967 | [0m[35m        "message_direction": request_context.get("messageDirection"),[0m
[30;1m968 | [0m[35m    }[0m
[30;1m969 | [0m[35m    request_time_epoch_ms = int(request_context.get("requestTimeEpoch"))[0m

[31m--[ [0m[34mMatch #[0m[33m142[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m962 | [0m[35m        "apiname": api_id,[0m
[30;1m963 | [0m[35m        "stage": request_context.get("stage"),[0m
[30;1m964 | [0m[35m        "request_id": context.aws_request_id,[0m
[30;1m965 | [0m[35m        "connection_id": request_context.get("connectionId"),[0m
[30;1m966 | [0m[35m        "event_type": request_context.get("eventType"),[0m
[30;1m967 | [0m[35m        "message_direction": request_context.get("messageDirection"),[0m
[30;1m968 | [0m[35m    }[0m

[31m--[ [0m[34mMatch #[0m[33m143[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m960 | [0m[35m        "resource_names": endpoint,[0m
[30;1m961 | [0m[35m        "apiid": api_id,[0m
[30;1m962 | [0m[35m        "apiname": api_id,[0m
[30;1m963 | [0m[35m        "stage": request_context.get("stage"),[0m
[30;1m964 | [0m[35m        "request_id": context.aws_request_id,[0m
[30;1m965 | [0m[35m        "connection_id": request_context.get("connectionId"),[0m
[30;1m966 | [0m[35m        "event_type": request_context.get("eventType"),[0m

[31m--[ [0m[34mMatch #[0m[33m144[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m948 | [0m[35m    request_context = event.get("requestContext")[0m
[30;1m949 | [0m[35m    domain = request_context.get("domainName")[0m
[30;1m950 | [0m[35m    endpoint = request_context.get("routeKey")[0m
[30;1m951 | [0m[35m    api_id = request_context.get("apiId")[0m
[30;1m952 | [0m[35m[0m
[30;1m953 | [0m[35m    service_name = determine_service_name([0m
[30;1m954 | [0m[35m        service_mapping, api_id, "lambda_api_gateway", domain[0m

[31m--[ [0m[34mMatch #[0m[33m145[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m947 | [0m[35m):[0m
[30;1m948 | [0m[35m    request_context = event.get("requestContext")[0m
[30;1m949 | [0m[35m    domain = request_context.get("domainName")[0m
[30;1m950 | [0m[35m    endpoint = request_context.get("routeKey")[0m
[30;1m951 | [0m[35m    api_id = request_context.get("apiId")[0m
[30;1m952 | [0m[35m[0m
[30;1m953 | [0m[35m    service_name = determine_service_name([0m

[31m--[ [0m[34mMatch #[0m[33m146[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m946 | [0m[35m    event, context, decode_authorizer_context: bool = True[0m
[30;1m947 | [0m[35m):[0m
[30;1m948 | [0m[35m    request_context = event.get("requestContext")[0m
[30;1m949 | [0m[35m    domain = request_context.get("domainName")[0m
[30;1m950 | [0m[35m    endpoint = request_context.get("routeKey")[0m
[30;1m951 | [0m[35m    api_id = request_context.get("apiId")[0m
[30;1m952 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m147[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m945 | [0m[35mdef create_inferred_span_from_api_gateway_websocket_event([0m
[30;1m946 | [0m[35m    event, context, decode_authorizer_context: bool = True[0m
[30;1m947 | [0m[35m):[0m
[30;1m948 | [0m[35m    request_context = event.get("requestContext")[0m
[30;1m949 | [0m[35m    domain = request_context.get("domainName")[0m
[30;1m950 | [0m[35m    endpoint = request_context.get("routeKey")[0m
[30;1m951 | [0m[35m    api_id = request_context.get("apiId")[0m

[31m--[ [0m[34mMatch #[0m[33m148[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m921 | [0m[35m                request_time_epoch_ms[0m
[30;1m922 | [0m[35m                + ([0m
[30;1m923 | [0m[35m                    int([0m
[30;1m924 | [0m[35m                        event["requestContext"]["authorizer"].get([0m
[30;1m925 | [0m[35m                            "integrationLatency", 0[0m
[30;1m926 | [0m[35m                        )[0m
[30;1m927 | [0m[35m                    )[0m

[31m--[ [0m[34mMatch #[0m[33m149[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m915 | [0m[35m    if injected_authorizer_data:[0m
[30;1m916 | [0m[35m        try:[0m
[30;1m917 | [0m[35m            start_time_ns = int([0m
[30;1m918 | [0m[35m                injected_authorizer_data.get(Headers.Parent_Span_Finish_Time)[0m
[30;1m919 | [0m[35m            )[0m
[30;1m920 | [0m[35m            finish_time_ns = ([0m
[30;1m921 | [0m[35m                request_time_epoch_ms[0m

[31m--[ [0m[34mMatch #[0m[33m150[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m876 | [0m[35m    hdrs = event.get("headers")[0m
[30;1m877 | [0m[35m    if not hdrs:[0m
[30;1m878 | [0m[35m        return False[0m
[30;1m879 | [0m[35m    return hdrs.get("X-Amz-Invocation-Type") == "Event"[0m
[30;1m880 | [0m[35m[0m
[30;1m881 | [0m[35m[0m
[30;1m882 | [0m[35mdef insert_upstream_authorizer_span([0m

[31m--[ [0m[34mMatch #[0m[33m151[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m873 | [0m[35m[0m
[30;1m874 | [0m[35m[0m
[30;1m875 | [0m[35mdef is_api_gateway_invocation_async(event):[0m
[30;1m876 | [0m[35m    hdrs = event.get("headers")[0m
[30;1m877 | [0m[35m    if not hdrs:[0m
[30;1m878 | [0m[35m        return False[0m
[30;1m879 | [0m[35m    return hdrs.get("X-Amz-Invocation-Type") == "Event"[0m

[31m--[ [0m[34mMatch #[0m[33m152[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m859 | [0m[35m        "resource_names": domain + path,[0m
[30;1m860 | [0m[35m        "request_id": context.aws_request_id,[0m
[30;1m861 | [0m[35m    }[0m
[30;1m862 | [0m[35m    request_time_epoch = request_context.get("timeEpoch")[0m
[30;1m863 | [0m[35m    tracer.set_tags(_dd_origin)  # function urls don't count as lambda_inferred,[0m
[30;1m864 | [0m[35m    # because they're in the same service as the inferring lambda function[0m
[30;1m865 | [0m[35m    span = tracer.trace([0m

[31m--[ [0m[34mMatch #[0m[33m153[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m849 | [0m[35m    service_name = determine_service_name(service_mapping, api_id, "lambda_url", domain)[0m
[30;1m850 | [0m[35m    http = request_context.get("http")[0m
[30;1m851 | [0m[35m    method = http.get("method") if http else None[0m
[30;1m852 | [0m[35m    path = http.get("path") if http else None[0m
[30;1m853 | [0m[35m    resource = f"{method} {path}"[0m
[30;1m854 | [0m[35m    tags = {[0m
[30;1m855 | [0m[35m        "operation_name": "aws.lambda.url",[0m

[31m--[ [0m[34mMatch #[0m[33m154[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m848 | [0m[35m    domain = request_context.get("domainName")[0m
[30;1m849 | [0m[35m    service_name = determine_service_name(service_mapping, api_id, "lambda_url", domain)[0m
[30;1m850 | [0m[35m    http = request_context.get("http")[0m
[30;1m851 | [0m[35m    method = http.get("method") if http else None[0m
[30;1m852 | [0m[35m    path = http.get("path") if http else None[0m
[30;1m853 | [0m[35m    resource = f"{method} {path}"[0m
[30;1m854 | [0m[35m    tags = {[0m

[31m--[ [0m[34mMatch #[0m[33m155[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m847 | [0m[35m    api_id = request_context.get("apiId")[0m
[30;1m848 | [0m[35m    domain = request_context.get("domainName")[0m
[30;1m849 | [0m[35m    service_name = determine_service_name(service_mapping, api_id, "lambda_url", domain)[0m
[30;1m850 | [0m[35m    http = request_context.get("http")[0m
[30;1m851 | [0m[35m    method = http.get("method") if http else None[0m
[30;1m852 | [0m[35m    path = http.get("path") if http else None[0m
[30;1m853 | [0m[35m    resource = f"{method} {path}"[0m

[31m--[ [0m[34mMatch #[0m[33m156[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m845 | [0m[35mdef create_inferred_span_from_lambda_function_url_event(event, context):[0m
[30;1m846 | [0m[35m    request_context = event.get("requestContext")[0m
[30;1m847 | [0m[35m    api_id = request_context.get("apiId")[0m
[30;1m848 | [0m[35m    domain = request_context.get("domainName")[0m
[30;1m849 | [0m[35m    service_name = determine_service_name(service_mapping, api_id, "lambda_url", domain)[0m
[30;1m850 | [0m[35m    http = request_context.get("http")[0m
[30;1m851 | [0m[35m    method = http.get("method") if http else None[0m

[31m--[ [0m[34mMatch #[0m[33m157[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m844 | [0m[35m[0m
[30;1m845 | [0m[35mdef create_inferred_span_from_lambda_function_url_event(event, context):[0m
[30;1m846 | [0m[35m    request_context = event.get("requestContext")[0m
[30;1m847 | [0m[35m    api_id = request_context.get("apiId")[0m
[30;1m848 | [0m[35m    domain = request_context.get("domainName")[0m
[30;1m849 | [0m[35m    service_name = determine_service_name(service_mapping, api_id, "lambda_url", domain)[0m
[30;1m850 | [0m[35m    http = request_context.get("http")[0m

[31m--[ [0m[34mMatch #[0m[33m158[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m843 | [0m[35m[0m
[30;1m844 | [0m[35m[0m
[30;1m845 | [0m[35mdef create_inferred_span_from_lambda_function_url_event(event, context):[0m
[30;1m846 | [0m[35m    request_context = event.get("requestContext")[0m
[30;1m847 | [0m[35m    api_id = request_context.get("apiId")[0m
[30;1m848 | [0m[35m    domain = request_context.get("domainName")[0m
[30;1m849 | [0m[35m    service_name = determine_service_name(service_mapping, api_id, "lambda_url", domain)[0m

[31m--[ [0m[34mMatch #[0m[33m159[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m831 | [0m[35mdef determine_service_name(service_mapping, specific_key, generic_key, default_value):[0m
[30;1m832 | [0m[35m    service_name = service_mapping.get(specific_key)[0m
[30;1m833 | [0m[35m    if service_name is None:[0m
[30;1m834 | [0m[35m        service_name = service_mapping.get(generic_key, default_value)[0m
[30;1m835 | [0m[35m    return service_name[0m
[30;1m836 | [0m[35m[0m
[30;1m837 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m160[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m829 | [0m[35m[0m
[30;1m830 | [0m[35m[0m
[30;1m831 | [0m[35mdef determine_service_name(service_mapping, specific_key, generic_key, default_value):[0m
[30;1m832 | [0m[35m    service_name = service_mapping.get(specific_key)[0m
[30;1m833 | [0m[35m    if service_name is None:[0m
[30;1m834 | [0m[35m        service_name = service_mapping.get(generic_key, default_value)[0m
[30;1m835 | [0m[35m    return service_name[0m

[31m--[ [0m[34mMatch #[0m[33m161[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m571 | [0m[35m        req_ctx = event.get("requestContext")[0m
[30;1m572 | [0m[35m        if not req_ctx:[0m
[30;1m573 | [0m[35m            return None[0m
[30;1m574 | [0m[35m        if req_ctx.get("requestId") == injected_data.get([0m
[30;1m575 | [0m[35m            Headers.Authorizing_Request_Id[0m
[30;1m576 | [0m[35m        ):[0m
[30;1m577 | [0m[35m            return injected_data[0m

[31m--[ [0m[34mMatch #[0m[33m162[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m571 | [0m[35m        req_ctx = event.get("requestContext")[0m
[30;1m572 | [0m[35m        if not req_ctx:[0m
[30;1m573 | [0m[35m            return None[0m
[30;1m574 | [0m[35m        if req_ctx.get("requestId") == injected_data.get([0m
[30;1m575 | [0m[35m            Headers.Authorizing_Request_Id[0m
[30;1m576 | [0m[35m        ):[0m
[30;1m577 | [0m[35m            return injected_data[0m

[31m--[ [0m[34mMatch #[0m[33m163[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m568 | [0m[35m        # cases neither. As a result, we combine both methods as shown below.[0m
[30;1m569 | [0m[35m        if authorizer_headers.get("integrationLatency", 0) > 0:[0m
[30;1m570 | [0m[35m            return injected_data[0m
[30;1m571 | [0m[35m        req_ctx = event.get("requestContext")[0m
[30;1m572 | [0m[35m        if not req_ctx:[0m
[30;1m573 | [0m[35m            return None[0m
[30;1m574 | [0m[35m        if req_ctx.get("requestId") == injected_data.get([0m

[31m--[ [0m[34mMatch #[0m[33m164[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m566 | [0m[35m        # that case, we use the injected Authorizing_Request_Id to tell if it's cached. But token[0m
[30;1m567 | [0m[35m        # authorizers don't pass on the requestId. The Authorizing_Request_Id can't work for all[0m
[30;1m568 | [0m[35m        # cases neither. As a result, we combine both methods as shown below.[0m
[30;1m569 | [0m[35m        if authorizer_headers.get("integrationLatency", 0) > 0:[0m
[30;1m570 | [0m[35m            return injected_data[0m
[30;1m571 | [0m[35m        req_ctx = event.get("requestContext")[0m
[30;1m572 | [0m[35m        if not req_ctx:[0m

[31m--[ [0m[34mMatch #[0m[33m165[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m550 | [0m[35m                return None[0m
[30;1m551 | [0m[35m            dd_data_raw = lambda_hdr.get("_datadog")[0m
[30;1m552 | [0m[35m        else:[0m
[30;1m553 | [0m[35m            dd_data_raw = authorizer_headers.get("_datadog")[0m
[30;1m554 | [0m[35m[0m
[30;1m555 | [0m[35m        if not dd_data_raw:[0m
[30;1m556 | [0m[35m            return None[0m

[31m--[ [0m[34mMatch #[0m[33m166[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m548 | [0m[35m            lambda_hdr = authorizer_headers.get("lambda")[0m
[30;1m549 | [0m[35m            if not lambda_hdr:[0m
[30;1m550 | [0m[35m                return None[0m
[30;1m551 | [0m[35m            dd_data_raw = lambda_hdr.get("_datadog")[0m
[30;1m552 | [0m[35m        else:[0m
[30;1m553 | [0m[35m            dd_data_raw = authorizer_headers.get("_datadog")[0m
[30;1m554 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m167[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m545 | [0m[35m            return None[0m
[30;1m546 | [0m[35m[0m
[30;1m547 | [0m[35m        if is_http_api:[0m
[30;1m548 | [0m[35m            lambda_hdr = authorizer_headers.get("lambda")[0m
[30;1m549 | [0m[35m            if not lambda_hdr:[0m
[30;1m550 | [0m[35m                return None[0m
[30;1m551 | [0m[35m            dd_data_raw = lambda_hdr.get("_datadog")[0m

[31m--[ [0m[34mMatch #[0m[33m168[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m540 | [0m[35m        req_ctx = event.get("requestContext")[0m
[30;1m541 | [0m[35m        if not req_ctx:[0m
[30;1m542 | [0m[35m            return None[0m
[30;1m543 | [0m[35m        authorizer_headers = req_ctx.get("authorizer")[0m
[30;1m544 | [0m[35m        if not authorizer_headers:[0m
[30;1m545 | [0m[35m            return None[0m
[30;1m546 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m169[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m537 | [0m[35m[0m
[30;1m538 | [0m[35mdef get_injected_authorizer_data(event, is_http_api) -> dict:[0m
[30;1m539 | [0m[35m    try:[0m
[30;1m540 | [0m[35m        req_ctx = event.get("requestContext")[0m
[30;1m541 | [0m[35m        if not req_ctx:[0m
[30;1m542 | [0m[35m            return None[0m
[30;1m543 | [0m[35m        authorizer_headers = req_ctx.get("authorizer")[0m

[31m--[ [0m[34mMatch #[0m[33m170[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m489 | [0m[35m[0m
[30;1m490 | [0m[35m            parent_id = _generate_sfn_parent_id(event)[0m
[30;1m491 | [0m[35m        else:[0m
[30;1m492 | [0m[35m            execution_id = event.get("Execution").get("Id")[0m
[30;1m493 | [0m[35m            trace_id = _generate_sfn_trace_id(execution_id, LOWER_64_BITS)[0m
[30;1m494 | [0m[35m            meta["_dd.p.tid"] = _generate_sfn_trace_id(execution_id, HIGHER_64_BITS)[0m
[30;1m495 | [0m[35m            parent_id = _generate_sfn_parent_id(event)[0m

[31m--[ [0m[34mMatch #[0m[33m171[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m489 | [0m[35m[0m
[30;1m490 | [0m[35m            parent_id = _generate_sfn_parent_id(event)[0m
[30;1m491 | [0m[35m        else:[0m
[30;1m492 | [0m[35m            execution_id = event.get("Execution").get("Id")[0m
[30;1m493 | [0m[35m            trace_id = _generate_sfn_trace_id(execution_id, LOWER_64_BITS)[0m
[30;1m494 | [0m[35m            meta["_dd.p.tid"] = _generate_sfn_trace_id(execution_id, HIGHER_64_BITS)[0m
[30;1m495 | [0m[35m            parent_id = _generate_sfn_parent_id(event)[0m

[31m--[ [0m[34mMatch #[0m[33m172[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m481 | [0m[35m                if high_64_bit_trace_id:[0m
[30;1m482 | [0m[35m                    meta["_dd.p.tid"] = high_64_bit_trace_id[0m
[30;1m483 | [0m[35m            else:  # sfn root[0m
[30;1m484 | [0m[35m                root_execution_id = event.get("RootExecutionId")[0m
[30;1m485 | [0m[35m                trace_id = _generate_sfn_trace_id(root_execution_id, LOWER_64_BITS)[0m
[30;1m486 | [0m[35m                meta["_dd.p.tid"] = _generate_sfn_trace_id([0m
[30;1m487 | [0m[35m                    root_execution_id, HIGHER_64_BITS[0m

[31m--[ [0m[34mMatch #[0m[33m173[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m477 | [0m[35m        if event.get("serverless-version") == "v1":[0m
[30;1m478 | [0m[35m            if "x-datadog-trace-id" in event:  # lambda root[0m
[30;1m479 | [0m[35m                trace_id = int(event.get("x-datadog-trace-id"))[0m
[30;1m480 | [0m[35m                high_64_bit_trace_id = _parse_high_64_bits(event.get("x-datadog-tags"))[0m
[30;1m481 | [0m[35m                if high_64_bit_trace_id:[0m
[30;1m482 | [0m[35m                    meta["_dd.p.tid"] = high_64_bit_trace_id[0m
[30;1m483 | [0m[35m            else:  # sfn root[0m

[31m--[ [0m[34mMatch #[0m[33m174[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m476 | [0m[35m[0m
[30;1m477 | [0m[35m        if event.get("serverless-version") == "v1":[0m
[30;1m478 | [0m[35m            if "x-datadog-trace-id" in event:  # lambda root[0m
[30;1m479 | [0m[35m                trace_id = int(event.get("x-datadog-trace-id"))[0m
[30;1m480 | [0m[35m                high_64_bit_trace_id = _parse_high_64_bits(event.get("x-datadog-tags"))[0m
[30;1m481 | [0m[35m                if high_64_bit_trace_id:[0m
[30;1m482 | [0m[35m                    meta["_dd.p.tid"] = high_64_bit_trace_id[0m

[31m--[ [0m[34mMatch #[0m[33m175[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m474 | [0m[35m[0m
[30;1m475 | [0m[35m        meta = {}[0m
[30;1m476 | [0m[35m[0m
[30;1m477 | [0m[35m        if event.get("serverless-version") == "v1":[0m
[30;1m478 | [0m[35m            if "x-datadog-trace-id" in event:  # lambda root[0m
[30;1m479 | [0m[35m                trace_id = int(event.get("x-datadog-trace-id"))[0m
[30;1m480 | [0m[35m                high_64_bit_trace_id = _parse_high_64_bits(event.get("x-datadog-tags"))[0m

[31m--[ [0m[34mMatch #[0m[33m176[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m470 | [0m[35m    """[0m
[30;1m471 | [0m[35m    try:[0m
[30;1m472 | [0m[35m        event = event.get("Payload", event)[0m
[30;1m473 | [0m[35m        event = event.get("_datadog", event)[0m
[30;1m474 | [0m[35m[0m
[30;1m475 | [0m[35m        meta = {}[0m
[30;1m476 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m177[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m469 | [0m[35m    object.[0m
[30;1m470 | [0m[35m    """[0m
[30;1m471 | [0m[35m    try:[0m
[30;1m472 | [0m[35m        event = event.get("Payload", event)[0m
[30;1m473 | [0m[35m        event = event.get("_datadog", event)[0m
[30;1m474 | [0m[35m[0m
[30;1m475 | [0m[35m        meta = {}[0m

[31m--[ [0m[34mMatch #[0m[33m178[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m430 | [0m[35m    redrive_count = context.get("Execution").get("RedriveCount", 0)[0m
[30;1m431 | [0m[35m    state_name = context.get("State").get("Name")[0m
[30;1m432 | [0m[35m    state_entered_time = context.get("State").get("EnteredTime")[0m
[30;1m433 | [0m[35m    retry_count = context.get("State").get("RetryCount", 0)[0m
[30;1m434 | [0m[35m[0m
[30;1m435 | [0m[35m    include_counts = not (retry_count == 0 and redrive_count == 0)[0m
[30;1m436 | [0m[35m    counts_suffix = f"#{retry_count}#{redrive_count}" if include_counts else ""[0m

[31m--[ [0m[34mMatch #[0m[33m179[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m430 | [0m[35m    redrive_count = context.get("Execution").get("RedriveCount", 0)[0m
[30;1m431 | [0m[35m    state_name = context.get("State").get("Name")[0m
[30;1m432 | [0m[35m    state_entered_time = context.get("State").get("EnteredTime")[0m
[30;1m433 | [0m[35m    retry_count = context.get("State").get("RetryCount", 0)[0m
[30;1m434 | [0m[35m[0m
[30;1m435 | [0m[35m    include_counts = not (retry_count == 0 and redrive_count == 0)[0m
[30;1m436 | [0m[35m    counts_suffix = f"#{retry_count}#{redrive_count}" if include_counts else ""[0m

[31m--[ [0m[34mMatch #[0m[33m180[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m429 | [0m[35m    execution_id = context.get("Execution").get("Id")[0m
[30;1m430 | [0m[35m    redrive_count = context.get("Execution").get("RedriveCount", 0)[0m
[30;1m431 | [0m[35m    state_name = context.get("State").get("Name")[0m
[30;1m432 | [0m[35m    state_entered_time = context.get("State").get("EnteredTime")[0m
[30;1m433 | [0m[35m    retry_count = context.get("State").get("RetryCount", 0)[0m
[30;1m434 | [0m[35m[0m
[30;1m435 | [0m[35m    include_counts = not (retry_count == 0 and redrive_count == 0)[0m

[31m--[ [0m[34mMatch #[0m[33m181[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m429 | [0m[35m    execution_id = context.get("Execution").get("Id")[0m
[30;1m430 | [0m[35m    redrive_count = context.get("Execution").get("RedriveCount", 0)[0m
[30;1m431 | [0m[35m    state_name = context.get("State").get("Name")[0m
[30;1m432 | [0m[35m    state_entered_time = context.get("State").get("EnteredTime")[0m
[30;1m433 | [0m[35m    retry_count = context.get("State").get("RetryCount", 0)[0m
[30;1m434 | [0m[35m[0m
[30;1m435 | [0m[35m    include_counts = not (retry_count == 0 and redrive_count == 0)[0m

[31m--[ [0m[34mMatch #[0m[33m182[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m428 | [0m[35m    """[0m
[30;1m429 | [0m[35m    execution_id = context.get("Execution").get("Id")[0m
[30;1m430 | [0m[35m    redrive_count = context.get("Execution").get("RedriveCount", 0)[0m
[30;1m431 | [0m[35m    state_name = context.get("State").get("Name")[0m
[30;1m432 | [0m[35m    state_entered_time = context.get("State").get("EnteredTime")[0m
[30;1m433 | [0m[35m    retry_count = context.get("State").get("RetryCount", 0)[0m
[30;1m434 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m183[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m428 | [0m[35m    """[0m
[30;1m429 | [0m[35m    execution_id = context.get("Execution").get("Id")[0m
[30;1m430 | [0m[35m    redrive_count = context.get("Execution").get("RedriveCount", 0)[0m
[30;1m431 | [0m[35m    state_name = context.get("State").get("Name")[0m
[30;1m432 | [0m[35m    state_entered_time = context.get("State").get("EnteredTime")[0m
[30;1m433 | [0m[35m    retry_count = context.get("State").get("RetryCount", 0)[0m
[30;1m434 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m184[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m427 | [0m[35m    compatibility with older Lambda layers that did not include these fields.[0m
[30;1m428 | [0m[35m    """[0m
[30;1m429 | [0m[35m    execution_id = context.get("Execution").get("Id")[0m
[30;1m430 | [0m[35m    redrive_count = context.get("Execution").get("RedriveCount", 0)[0m
[30;1m431 | [0m[35m    state_name = context.get("State").get("Name")[0m
[30;1m432 | [0m[35m    state_entered_time = context.get("State").get("EnteredTime")[0m
[30;1m433 | [0m[35m    retry_count = context.get("State").get("RetryCount", 0)[0m

[31m--[ [0m[34mMatch #[0m[33m185[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m427 | [0m[35m    compatibility with older Lambda layers that did not include these fields.[0m
[30;1m428 | [0m[35m    """[0m
[30;1m429 | [0m[35m    execution_id = context.get("Execution").get("Id")[0m
[30;1m430 | [0m[35m    redrive_count = context.get("Execution").get("RedriveCount", 0)[0m
[30;1m431 | [0m[35m    state_name = context.get("State").get("Name")[0m
[30;1m432 | [0m[35m    state_entered_time = context.get("State").get("EnteredTime")[0m
[30;1m433 | [0m[35m    retry_count = context.get("State").get("RetryCount", 0)[0m

[31m--[ [0m[34mMatch #[0m[33m186[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m426 | [0m[35m    `RetryCount` and `RedriveCount` are appended only when both are nonzero to maintain[0m
[30;1m427 | [0m[35m    compatibility with older Lambda layers that did not include these fields.[0m
[30;1m428 | [0m[35m    """[0m
[30;1m429 | [0m[35m    execution_id = context.get("Execution").get("Id")[0m
[30;1m430 | [0m[35m    redrive_count = context.get("Execution").get("RedriveCount", 0)[0m
[30;1m431 | [0m[35m    state_name = context.get("State").get("Name")[0m
[30;1m432 | [0m[35m    state_entered_time = context.get("State").get("EnteredTime")[0m

[31m--[ [0m[34mMatch #[0m[33m187[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m426 | [0m[35m    `RetryCount` and `RedriveCount` are appended only when both are nonzero to maintain[0m
[30;1m427 | [0m[35m    compatibility with older Lambda layers that did not include these fields.[0m
[30;1m428 | [0m[35m    """[0m
[30;1m429 | [0m[35m    execution_id = context.get("Execution").get("Id")[0m
[30;1m430 | [0m[35m    redrive_count = context.get("Execution").get("RedriveCount", 0)[0m
[30;1m431 | [0m[35m    state_name = context.get("State").get("Name")[0m
[30;1m432 | [0m[35m    state_entered_time = context.get("State").get("EnteredTime")[0m

[31m--[ [0m[34mMatch #[0m[33m188[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m379 | [0m[35m            str_bytes = base64.b64decode(b64_bytes)[0m
[30;1m380 | [0m[35m            data_str = str_bytes.decode("ascii")[0m
[30;1m381 | [0m[35m            data_obj = json.loads(data_str)[0m
[30;1m382 | [0m[35m            dd_ctx = data_obj.get("_datadog")[0m
[30;1m383 | [0m[35m            if dd_ctx:[0m
[30;1m384 | [0m[35m                return propagator.extract(dd_ctx)[0m
[30;1m385 | [0m[35m    except Exception as e:[0m

[31m--[ [0m[34mMatch #[0m[33m189[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m371 | [0m[35m        kinesis = record.get("kinesis")[0m
[30;1m372 | [0m[35m        if not kinesis:[0m
[30;1m373 | [0m[35m            return extract_context_from_lambda_context(lambda_context)[0m
[30;1m374 | [0m[35m        data = kinesis.get("data")[0m
[30;1m375 | [0m[35m        if data:[0m
[30;1m376 | [0m[35m            import base64[0m
[30;1m377 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m190[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m368 | [0m[35m    """[0m
[30;1m369 | [0m[35m    try:[0m
[30;1m370 | [0m[35m        record = get_first_record(event)[0m
[30;1m371 | [0m[35m        kinesis = record.get("kinesis")[0m
[30;1m372 | [0m[35m        if not kinesis:[0m
[30;1m373 | [0m[35m            return extract_context_from_lambda_context(lambda_context)[0m
[30;1m374 | [0m[35m        data = kinesis.get("data")[0m

[31m--[ [0m[34mMatch #[0m[33m191[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m345 | [0m[35m    """[0m
[30;1m346 | [0m[35m    try:[0m
[30;1m347 | [0m[35m        detail = event.get("detail")[0m
[30;1m348 | [0m[35m        dd_context = detail.get("_datadog")[0m
[30;1m349 | [0m[35m        if not dd_context:[0m
[30;1m350 | [0m[35m            return extract_context_from_lambda_context(lambda_context)[0m
[30;1m351 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m192[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m344 | [0m[35m    that header.[0m
[30;1m345 | [0m[35m    """[0m
[30;1m346 | [0m[35m    try:[0m
[30;1m347 | [0m[35m        detail = event.get("detail")[0m
[30;1m348 | [0m[35m        dd_context = detail.get("_datadog")[0m
[30;1m349 | [0m[35m        if not dd_context:[0m
[30;1m350 | [0m[35m            return extract_context_from_lambda_context(lambda_context)[0m

[31m--[ [0m[34mMatch #[0m[33m193[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m322 | [0m[35m    body_str = first_record.get("body")[0m
[30;1m323 | [0m[35m    body = json.loads(body_str)[0m
[30;1m324 | [0m[35m    detail = body.get("detail")[0m
[30;1m325 | [0m[35m    dd_context = detail.get("_datadog")[0m
[30;1m326 | [0m[35m[0m
[30;1m327 | [0m[35m    if is_step_function_event(dd_context):[0m
[30;1m328 | [0m[35m        try:[0m

[31m--[ [0m[34mMatch #[0m[33m194[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m321 | [0m[35m    first_record = event.get("Records")[0][0m
[30;1m322 | [0m[35m    body_str = first_record.get("body")[0m
[30;1m323 | [0m[35m    body = json.loads(body_str)[0m
[30;1m324 | [0m[35m    detail = body.get("detail")[0m
[30;1m325 | [0m[35m    dd_context = detail.get("_datadog")[0m
[30;1m326 | [0m[35m[0m
[30;1m327 | [0m[35m    if is_step_function_event(dd_context):[0m

[31m--[ [0m[34mMatch #[0m[33m195[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m319 | [0m[35m    `body` field which contains the EventBridge `detail` as a JSON string.[0m
[30;1m320 | [0m[35m    """[0m
[30;1m321 | [0m[35m    first_record = event.get("Records")[0][0m
[30;1m322 | [0m[35m    body_str = first_record.get("body")[0m
[30;1m323 | [0m[35m    body = json.loads(body_str)[0m
[30;1m324 | [0m[35m    detail = body.get("detail")[0m
[30;1m325 | [0m[35m    dd_context = detail.get("_datadog")[0m

[31m--[ [0m[34mMatch #[0m[33m196[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m318 | [0m[35m    This is only possible if first record in `Records` contains a[0m
[30;1m319 | [0m[35m    `body` field which contains the EventBridge `detail` as a JSON string.[0m
[30;1m320 | [0m[35m    """[0m
[30;1m321 | [0m[35m    first_record = event.get("Records")[0][0m
[30;1m322 | [0m[35m    body_str = first_record.get("body")[0m
[30;1m323 | [0m[35m    body = json.loads(body_str)[0m
[30;1m324 | [0m[35m    detail = body.get("detail")[0m

[31m--[ [0m[34mMatch #[0m[33m197[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m290 | [0m[35m                x_ray_header = attrs.get("AWSTraceHeader")[0m
[30;1m291 | [0m[35m                if x_ray_header:[0m
[30;1m292 | [0m[35m                    x_ray_context = parse_xray_header(x_ray_header)[0m
[30;1m293 | [0m[35m                    trace_id_parts = x_ray_context.get("trace_id", "").split("-")[0m
[30;1m294 | [0m[35m                    if len(trace_id_parts) > 2 and trace_id_parts[2].startswith([0m
[30;1m295 | [0m[35m                        DD_TRACE_JAVA_TRACE_ID_PADDING[0m
[30;1m296 | [0m[35m                    ):[0m

[31m--[ [0m[34mMatch #[0m[33m198[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m287 | [0m[35m            # example: Root=1-654321ab-000000001234567890abcdef;Parent=0123456789abcdef;Sampled=1[0m
[30;1m288 | [0m[35m            attrs = event.get("Records")[0].get("attributes")[0m
[30;1m289 | [0m[35m            if attrs:[0m
[30;1m290 | [0m[35m                x_ray_header = attrs.get("AWSTraceHeader")[0m
[30;1m291 | [0m[35m                if x_ray_header:[0m
[30;1m292 | [0m[35m                    x_ray_context = parse_xray_header(x_ray_header)[0m
[30;1m293 | [0m[35m                    trace_id_parts = x_ray_context.get("trace_id", "").split("-")[0m

[31m--[ [0m[34mMatch #[0m[33m199[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m285 | [0m[35m        else:[0m
[30;1m286 | [0m[35m            # Handle case where trace context is injected into attributes.AWSTraceHeader[0m
[30;1m287 | [0m[35m            # example: Root=1-654321ab-000000001234567890abcdef;Parent=0123456789abcdef;Sampled=1[0m
[30;1m288 | [0m[35m            attrs = event.get("Records")[0].get("attributes")[0m
[30;1m289 | [0m[35m            if attrs:[0m
[30;1m290 | [0m[35m                x_ray_header = attrs.get("AWSTraceHeader")[0m
[30;1m291 | [0m[35m                if x_ray_header:[0m

[31m--[ [0m[34mMatch #[0m[33m200[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m285 | [0m[35m        else:[0m
[30;1m286 | [0m[35m            # Handle case where trace context is injected into attributes.AWSTraceHeader[0m
[30;1m287 | [0m[35m            # example: Root=1-654321ab-000000001234567890abcdef;Parent=0123456789abcdef;Sampled=1[0m
[30;1m288 | [0m[35m            attrs = event.get("Records")[0].get("attributes")[0m
[30;1m289 | [0m[35m            if attrs:[0m
[30;1m290 | [0m[35m                x_ray_header = attrs.get("AWSTraceHeader")[0m
[30;1m291 | [0m[35m                if x_ray_header:[0m

[31m--[ [0m[34mMatch #[0m[33m201[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m263 | [0m[35m                if dd_json_data:[0m
[30;1m264 | [0m[35m                    dd_json_data = base64.b64decode(dd_json_data)[0m
[30;1m265 | [0m[35m            elif dd_json_data_type == "String":[0m
[30;1m266 | [0m[35m                dd_json_data = dd_payload.get("stringValue") or dd_payload.get("Value")[0m
[30;1m267 | [0m[35m            else:[0m
[30;1m268 | [0m[35m                logger.debug([0m
[30;1m269 | [0m[35m                    "Datadog Lambda Python only supports extracting trace"[0m

[31m--[ [0m[34mMatch #[0m[33m202[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m263 | [0m[35m                if dd_json_data:[0m
[30;1m264 | [0m[35m                    dd_json_data = base64.b64decode(dd_json_data)[0m
[30;1m265 | [0m[35m            elif dd_json_data_type == "String":[0m
[30;1m266 | [0m[35m                dd_json_data = dd_payload.get("stringValue") or dd_payload.get("Value")[0m
[30;1m267 | [0m[35m            else:[0m
[30;1m268 | [0m[35m                logger.debug([0m
[30;1m269 | [0m[35m                    "Datadog Lambda Python only supports extracting trace"[0m

[31m--[ [0m[34mMatch #[0m[33m203[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m259 | [0m[35m            if dd_json_data_type == "Binary":[0m
[30;1m260 | [0m[35m                import base64[0m
[30;1m261 | [0m[35m[0m
[30;1m262 | [0m[35m                dd_json_data = dd_payload.get("binaryValue") or dd_payload.get("Value")[0m
[30;1m263 | [0m[35m                if dd_json_data:[0m
[30;1m264 | [0m[35m                    dd_json_data = base64.b64decode(dd_json_data)[0m
[30;1m265 | [0m[35m            elif dd_json_data_type == "String":[0m

[31m--[ [0m[34mMatch #[0m[33m204[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m259 | [0m[35m            if dd_json_data_type == "Binary":[0m
[30;1m260 | [0m[35m                import base64[0m
[30;1m261 | [0m[35m[0m
[30;1m262 | [0m[35m                dd_json_data = dd_payload.get("binaryValue") or dd_payload.get("Value")[0m
[30;1m263 | [0m[35m                if dd_json_data:[0m
[30;1m264 | [0m[35m                    dd_json_data = base64.b64decode(dd_json_data)[0m
[30;1m265 | [0m[35m            elif dd_json_data_type == "String":[0m

[31m--[ [0m[34mMatch #[0m[33m205[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m255 | [0m[35m            # SQS uses dataType and binaryValue/stringValue[0m
[30;1m256 | [0m[35m            # SNS uses Type and Value[0m
[30;1m257 | [0m[35m            dd_json_data = None[0m
[30;1m258 | [0m[35m            dd_json_data_type = dd_payload.get("Type") or dd_payload.get("dataType")[0m
[30;1m259 | [0m[35m            if dd_json_data_type == "Binary":[0m
[30;1m260 | [0m[35m                import base64[0m
[30;1m261 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m206[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m255 | [0m[35m            # SQS uses dataType and binaryValue/stringValue[0m
[30;1m256 | [0m[35m            # SNS uses Type and Value[0m
[30;1m257 | [0m[35m            dd_json_data = None[0m
[30;1m258 | [0m[35m            dd_json_data_type = dd_payload.get("Type") or dd_payload.get("dataType")[0m
[30;1m259 | [0m[35m            if dd_json_data_type == "Binary":[0m
[30;1m260 | [0m[35m                import base64[0m
[30;1m261 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m207[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m250 | [0m[35m        if msg_attributes is None:[0m
[30;1m251 | [0m[35m            sns_record = first_record.get("Sns") or {}[0m
[30;1m252 | [0m[35m            msg_attributes = sns_record.get("MessageAttributes") or {}[0m
[30;1m253 | [0m[35m        dd_payload = msg_attributes.get("_datadog")[0m
[30;1m254 | [0m[35m        if dd_payload:[0m
[30;1m255 | [0m[35m            # SQS uses dataType and binaryValue/stringValue[0m
[30;1m256 | [0m[35m            # SNS uses Type and Value[0m

[31m--[ [0m[34mMatch #[0m[33m208[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m249 | [0m[35m        msg_attributes = first_record.get("messageAttributes")[0m
[30;1m250 | [0m[35m        if msg_attributes is None:[0m
[30;1m251 | [0m[35m            sns_record = first_record.get("Sns") or {}[0m
[30;1m252 | [0m[35m            msg_attributes = sns_record.get("MessageAttributes") or {}[0m
[30;1m253 | [0m[35m        dd_payload = msg_attributes.get("_datadog")[0m
[30;1m254 | [0m[35m        if dd_payload:[0m
[30;1m255 | [0m[35m            # SQS uses dataType and binaryValue/stringValue[0m

[31m--[ [0m[34mMatch #[0m[33m209[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m248 | [0m[35m[0m
[30;1m249 | [0m[35m        msg_attributes = first_record.get("messageAttributes")[0m
[30;1m250 | [0m[35m        if msg_attributes is None:[0m
[30;1m251 | [0m[35m            sns_record = first_record.get("Sns") or {}[0m
[30;1m252 | [0m[35m            msg_attributes = sns_record.get("MessageAttributes") or {}[0m
[30;1m253 | [0m[35m        dd_payload = msg_attributes.get("_datadog")[0m
[30;1m254 | [0m[35m        if dd_payload:[0m

[31m--[ [0m[34mMatch #[0m[33m210[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m246 | [0m[35m            except Exception:[0m
[30;1m247 | [0m[35m                pass[0m
[30;1m248 | [0m[35m[0m
[30;1m249 | [0m[35m        msg_attributes = first_record.get("messageAttributes")[0m
[30;1m250 | [0m[35m        if msg_attributes is None:[0m
[30;1m251 | [0m[35m            sns_record = first_record.get("Sns") or {}[0m
[30;1m252 | [0m[35m            msg_attributes = sns_record.get("MessageAttributes") or {}[0m

[31m--[ [0m[34mMatch #[0m[33m211[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m240 | [0m[35m            body_str = first_record.get("body")[0m
[30;1m241 | [0m[35m            try:[0m
[30;1m242 | [0m[35m                body = json.loads(body_str)[0m
[30;1m243 | [0m[35m                if body.get("Type", "") == "Notification" and "TopicArn" in body:[0m
[30;1m244 | [0m[35m                    logger.debug("Found SNS message inside SQS event")[0m
[30;1m245 | [0m[35m                    first_record = get_first_record(create_sns_event(body))[0m
[30;1m246 | [0m[35m            except Exception:[0m

[31m--[ [0m[34mMatch #[0m[33m212[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m237 | [0m[35m[0m
[30;1m238 | [0m[35m        # logic to deal with SNS => SQS event[0m
[30;1m239 | [0m[35m        if "body" in first_record:[0m
[30;1m240 | [0m[35m            body_str = first_record.get("body")[0m
[30;1m241 | [0m[35m            try:[0m
[30;1m242 | [0m[35m                body = json.loads(body_str)[0m
[30;1m243 | [0m[35m                if body.get("Type", "") == "Notification" and "TopicArn" in body:[0m

[31m--[ [0m[34mMatch #[0m[33m213[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m233 | [0m[35m        logger.debug("Failed extracting context as EventBridge to SQS.")[0m
[30;1m234 | [0m[35m[0m
[30;1m235 | [0m[35m    try:[0m
[30;1m236 | [0m[35m        first_record = event.get("Records")[0][0m
[30;1m237 | [0m[35m[0m
[30;1m238 | [0m[35m        # logic to deal with SNS => SQS event[0m
[30;1m239 | [0m[35m        if "body" in first_record:[0m

[31m--[ [0m[34mMatch #[0m[33m214[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m189 | [0m[35m        if _is_context_complete(context):[0m
[30;1m190 | [0m[35m            return context[0m
[30;1m191 | [0m[35m[0m
[30;1m192 | [0m[35m    headers = event.get("headers")[0m
[30;1m193 | [0m[35m    context = propagator.extract(headers)[0m
[30;1m194 | [0m[35m[0m
[30;1m195 | [0m[35m    if not _is_context_complete(context):[0m

[31m--[ [0m[34mMatch #[0m[33m215[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m164 | [0m[35m        dd_data = client_context.custom[0m
[30;1m165 | [0m[35m        if "_datadog" in client_context.custom:[0m
[30;1m166 | [0m[35m            # Legacy trace propagation dict[0m
[30;1m167 | [0m[35m            dd_data = client_context.custom.get("_datadog")[0m
[30;1m168 | [0m[35m    return propagator.extract(dd_data)[0m
[30;1m169 | [0m[35m[0m
[30;1m170 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m216[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m108 | [0m[35m    trace_context = Context([0m
[30;1m109 | [0m[35m        trace_id=_convert_xray_trace_id(xray_trace_entity.get("trace_id")),[0m
[30;1m110 | [0m[35m        span_id=_convert_xray_entity_id(xray_trace_entity.get("parent_id")),[0m
[30;1m111 | [0m[35m        sampling_priority=_convert_xray_sampling(xray_trace_entity.get("sampled")),[0m
[30;1m112 | [0m[35m    )[0m
[30;1m113 | [0m[35m    logger.debug([0m
[30;1m114 | [0m[35m        "Converted trace context %s from X-Ray segment %s",[0m

[31m--[ [0m[34mMatch #[0m[33m217[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m107 | [0m[35m        return None[0m
[30;1m108 | [0m[35m    trace_context = Context([0m
[30;1m109 | [0m[35m        trace_id=_convert_xray_trace_id(xray_trace_entity.get("trace_id")),[0m
[30;1m110 | [0m[35m        span_id=_convert_xray_entity_id(xray_trace_entity.get("parent_id")),[0m
[30;1m111 | [0m[35m        sampling_priority=_convert_xray_sampling(xray_trace_entity.get("sampled")),[0m
[30;1m112 | [0m[35m    )[0m
[30;1m113 | [0m[35m    logger.debug([0m

[31m--[ [0m[34mMatch #[0m[33m218[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m106 | [0m[35m    if xray_trace_entity is None:[0m
[30;1m107 | [0m[35m        return None[0m
[30;1m108 | [0m[35m    trace_context = Context([0m
[30;1m109 | [0m[35m        trace_id=_convert_xray_trace_id(xray_trace_entity.get("trace_id")),[0m
[30;1m110 | [0m[35m        span_id=_convert_xray_entity_id(xray_trace_entity.get("parent_id")),[0m
[30;1m111 | [0m[35m        sampling_priority=_convert_xray_sampling(xray_trace_entity.get("sampled")),[0m
[30;1m112 | [0m[35m    )[0m

[31m--[ [0m[34mMatch #[0m[33m219[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m101 | [0m[35m        return None[0m
[30;1m102 | [0m[35m[0m
[30;1m103 | [0m[35m    xray_trace_entity = parse_xray_header([0m
[30;1m104 | [0m[35m        os.environ.get(XrayDaemon.XRAY_TRACE_ID_HEADER_NAME, "")[0m
[30;1m105 | [0m[35m    )[0m
[30;1m106 | [0m[35m    if xray_trace_entity is None:[0m
[30;1m107 | [0m[35m        return None[0m

[31m--[ [0m[34mMatch #[0m[33m220[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m66 | [0m[35m[0m
[30;1m67 | [0m[35m        telemetry_writer.enable()[0m
[30;1m68 | [0m[35m[0m
[30;1m69 | [0m[35mis_lambda_context = os.environ.get(XrayDaemon.FUNCTION_NAME_HEADER_NAME) != ""[0m
[30;1m70 | [0m[35m[0m
[30;1m71 | [0m[35mpropagator = HTTPPropagator()[0m
[30;1m72 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m221[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m59 | [0m[35mif dd_tracing_enabled:[0m
[30;1m60 | [0m[35m    # Enable the telemetry client if the user has opted in[0m
[30;1m61 | [0m[35m    if ([0m
[30;1m62 | [0m[35m        os.environ.get("DD_INSTRUMENTATION_TELEMETRY_ENABLED", "false").lower()[0m
[30;1m63 | [0m[35m        == "true"[0m
[30;1m64 | [0m[35m    ):[0m
[30;1m65 | [0m[35m        from ddtrace.internal.telemetry import telemetry_writer[0m

[31m--[ [0m[34mMatch #[0m[33m222[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m55 | [0m[35mlogger = logging.getLogger(__name__)[0m
[30;1m56 | [0m[35m[0m
[30;1m57 | [0m[35mdd_trace_context = None[0m
[30;1m58 | [0m[35mdd_tracing_enabled = os.environ.get("DD_TRACE_ENABLED", "false").lower() == "true"[0m
[30;1m59 | [0m[35mif dd_tracing_enabled:[0m
[30;1m60 | [0m[35m    # Enable the telemetry client if the user has opted in[0m
[30;1m61 | [0m[35m    if ([0m

[31m--[ [0m[34mMatch #[0m[33m223[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m43 | [0m[35m)[0m
[30;1m44 | [0m[35m[0m
[30;1m45 | [0m[35mdd_trace_otel_enabled = ([0m
[30;1m46 | [0m[35m    os.environ.get("DD_TRACE_OTEL_ENABLED", "false").lower() == "true"[0m
[30;1m47 | [0m[35m)[0m
[30;1m48 | [0m[35mif dd_trace_otel_enabled:[0m
[30;1m49 | [0m[35m    from opentelemetry.trace import set_tracer_provider[0m

[31m--[ [0m[34mMatch #[0m[33m224[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000600[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Windows[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\s(advpack\.dll|appvlp|at|atbroker|bash|bginfo|bitsadmin|cdb|certutil|cl_invocation\.ps1|cl_mutexverifiers\.ps1|cmd|cmdkey|cmstp|comsvcs\.dll|control|csc|cscript|csi|devtoolslauncher|dfsvc|diskshadow|dnscmd|dnx|dotnet|dxcap|esentutl|eventvwr|excel|expand|extexport|extrac32|findstr|forfiles|ftp|gfxdownloadwrapper|gpscript|hh|ie4uinit|ieadvpack\.dll|ieaframe\.dll|ic|infdefaultinstall|installutil|jsc|makecab|manage-bde\.wsf|mavinject|mftrace|microsoft\.workflow\.compiler|mmc|msbuild|msconfig|msdeploy|msdt|mshta|mshtml\.dll|msc|msxsl|netsh|odbcconf|pcalua|pcwrun|pcwutl\.dll|pester\.bat|powerpnt|presentationhost|pubprn\.vbs|rcsi|reg|regasm|regedit|register-cimprovider|regsvcs|regsvr32|rpcping|rundll32|runonce|runscripthelper|sc|schtasks|scriptrunner|setupapi\.dll|shdocvw\.dll|shell32\.dll|slmgr\.vbs|sqldumper|sqlps|sqltoolsps|squirrel|syncappvpublishingserver|syncappvpublishingserver\.vbs|syssetup\.dll|te|tracker|tttracer|update|url\.dll|verclsid|vsjitdebugger|wab|winrm\.vbs|winword|wmic|wscript|wsl|wsreset|xwizard|zipfldr\.dll)\s[0m
[30;1m1 | [0m[35m# Unless explicitly stated otherwise all files in this repository are licensed[0m
[30;1m2 | [0m[35m# under the Apache License Version 2.0.[0m
[30;1m3 | [0m[35m# This product includes software developed at Datadog (https://www.datadoghq.com/).[0m
[30;1m4 | [0m[35m# Copyright 2019 Datadog, Inc.[0m
[30;1m5 | [0m[35mimport logging[0m
[30;1m6 | [0m[35mimport os[0m

[31m--[ [0m[34mMatch #[0m[33m225[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m1040 | [0m[35m    span = tracer.trace("aws.apigateway", **args)[0m
[30;1m1041 | [0m[35m    if span:[0m
[30;1m1042 | [0m[35m        span.set_tags(tags)[0m
[30;1m1043 | [0m[35m        # start time pushed by the inserted authorizer span[0m
[30;1m1044 | [0m[35m        span.start_ns = int([0m
[30;1m1045 | [0m[35m            finish_time_ns[0m
[30;1m1046 | [0m[35m            if finish_time_ns is not None[0m

[31m--[ [0m[34mMatch #[0m[33m226[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m890 | [0m[35m        kwargs_to_start_span (Dict): the same keyword arguments used for the inferred span[0m
[30;1m891 | [0m[35m        other_tags_for_span (Dict): the same tag keyword arguments used for the inferred span[0m
[30;1m892 | [0m[35m        start_time_ns (int): the start time of the span in nanoseconds[0m
[30;1m893 | [0m[35m        finish_time_ns (int): the finish time of the sapn in nanoseconds[0m
[30;1m894 | [0m[35m    """[0m
[30;1m895 | [0m[35m    trace_ctx = tracer.current_trace_context()[0m
[30;1m896 | [0m[35m    upstream_authorizer_span = tracer.trace([0m

[31m--[ [0m[34mMatch #[0m[33m227[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m889 | [0m[35m    Args:[0m
[30;1m890 | [0m[35m        kwargs_to_start_span (Dict): the same keyword arguments used for the inferred span[0m
[30;1m891 | [0m[35m        other_tags_for_span (Dict): the same tag keyword arguments used for the inferred span[0m
[30;1m892 | [0m[35m        start_time_ns (int): the start time of the span in nanoseconds[0m
[30;1m893 | [0m[35m        finish_time_ns (int): the finish time of the sapn in nanoseconds[0m
[30;1m894 | [0m[35m    """[0m
[30;1m895 | [0m[35m    trace_ctx = tracer.current_trace_context()[0m

[31m--[ [0m[34mMatch #[0m[33m228[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m861 | [0m[35m    }[0m
[30;1m862 | [0m[35m    request_time_epoch = request_context.get("timeEpoch")[0m
[30;1m863 | [0m[35m    tracer.set_tags(_dd_origin)  # function urls don't count as lambda_inferred,[0m
[30;1m864 | [0m[35m    # because they're in the same service as the inferring lambda function[0m
[30;1m865 | [0m[35m    span = tracer.trace([0m
[30;1m866 | [0m[35m        "aws.lambda.url", service=service_name, resource=resource, span_type="http"[0m
[30;1m867 | [0m[35m    )[0m

[31m--[ [0m[34mMatch #[0m[33m229[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m750 | [0m[35m[0m
[30;1m751 | [0m[35m        tracer.context_provider.activate(context)[0m
[30;1m752 | [0m[35m        logger.debug([0m
[30;1m753 | [0m[35m            "Set dd trace root context to: trace_id=%s span_id=%s",[0m
[30;1m754 | [0m[35m            context.trace_id,[0m
[30;1m755 | [0m[35m            context.span_id,[0m
[30;1m756 | [0m[35m        )[0m

[31m--[ [0m[34mMatch #[0m[33m230[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m623 | [0m[35m        dd_trace_context = _get_xray_trace_context()[0m
[30;1m624 | [0m[35m        if dd_trace_context:[0m
[30;1m625 | [0m[35m            trace_context_source = TraceContextSource.XRAY[0m
[30;1m626 | [0m[35m    logger.debug("extracted dd trace context %s", dd_trace_context)[0m
[30;1m627 | [0m[35m    return dd_trace_context, trace_context_source, event_source[0m
[30;1m628 | [0m[35m[0m
[30;1m629 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m231[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m555 | [0m[35m        if not dd_data_raw:[0m
[30;1m556 | [0m[35m            return None[0m
[30;1m557 | [0m[35m[0m
[30;1m558 | [0m[35m        import base64[0m
[30;1m559 | [0m[35m[0m
[30;1m560 | [0m[35m        injected_data = json.loads(base64.b64decode(dd_data_raw))[0m
[30;1m561 | [0m[35m[0m
[30;1m562 | [0m[35m        # Lambda authorizer's results can be cached. But the payload will still have the injected[0m

[31m--[ [0m[34mMatch #[0m[33m232[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m373 | [0m[35m            return extract_context_from_lambda_context(lambda_context)[0m
[30;1m374 | [0m[35m        data = kinesis.get("data")[0m
[30;1m375 | [0m[35m        if data:[0m
[30;1m376 | [0m[35m            import base64[0m
[30;1m377 | [0m[35m[0m
[30;1m378 | [0m[35m            b64_bytes = data.encode("ascii")[0m
[30;1m379 | [0m[35m            str_bytes = base64.b64decode(b64_bytes)[0m
[30;1m380 | [0m[35m            data_str = str_bytes.decode("ascii")[0m

[31m--[ [0m[34mMatch #[0m[33m233[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m364 | [0m[35m[0m
[30;1m365 | [0m[35mdef extract_context_from_kinesis_event(event, lambda_context):[0m
[30;1m366 | [0m[35m    """[0m
[30;1m367 | [0m[35m    Extract datadog trace context from a Kinesis Stream's base64 encoded data string[0m
[30;1m368 | [0m[35m    """[0m
[30;1m369 | [0m[35m    try:[0m
[30;1m370 | [0m[35m        record = get_first_record(event)[0m

[31m--[ [0m[34mMatch #[0m[33m234[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m340 | [0m[35m    Extract datadog trace context from an EventBridge message's Details.[0m
[30;1m341 | [0m[35m    This is only possible if Details is a JSON string.[0m
[30;1m342 | [0m[35m[0m
[30;1m343 | [0m[35m    If we find a Step Function context, try to extract the trace context from[0m
[30;1m344 | [0m[35m    that header.[0m
[30;1m345 | [0m[35m    """[0m
[30;1m346 | [0m[35m    try:[0m

[31m--[ [0m[34mMatch #[0m[33m235[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m257 | [0m[35m            dd_json_data = None[0m
[30;1m258 | [0m[35m            dd_json_data_type = dd_payload.get("Type") or dd_payload.get("dataType")[0m
[30;1m259 | [0m[35m            if dd_json_data_type == "Binary":[0m
[30;1m260 | [0m[35m                import base64[0m
[30;1m261 | [0m[35m[0m
[30;1m262 | [0m[35m                dd_json_data = dd_payload.get("binaryValue") or dd_payload.get("Value")[0m
[30;1m263 | [0m[35m                if dd_json_data:[0m
[30;1m264 | [0m[35m                    dd_json_data = base64.b64decode(dd_json_data)[0m

[31m--[ [0m[34mMatch #[0m[33m236[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tracing.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m124 | [0m[35m        return None[0m
[30;1m125 | [0m[35m[0m
[30;1m126 | [0m[35m    logger.debug([0m
[30;1m127 | [0m[35m        "found dd trace context: trace_id=%s span_id=%s",[0m
[30;1m128 | [0m[35m        span.context.trace_id,[0m
[30;1m129 | [0m[35m        span.context.span_id,[0m
[30;1m130 | [0m[35m    )[0m

[31m--[ [0m[34mMatch #[0m[33m237[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/handler.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m17 | [0m[35m    pass[0m
[30;1m18 | [0m[35m[0m
[30;1m19 | [0m[35m[0m
[30;1m20 | [0m[35mpath = os.environ.get("DD_LAMBDA_HANDLER", None)[0m
[30;1m21 | [0m[35mif path is None:[0m
[30;1m22 | [0m[35m    raise HandlerError([0m
[30;1m23 | [0m[35m        "DD_LAMBDA_HANDLER is not defined. Can't use prebuilt datadog handler"[0m

[31m--[ [0m[34mMatch #[0m[33m238[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000600[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Windows[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/handler.py[0m
   Pattern: [32m\s(advpack\.dll|appvlp|at|atbroker|bash|bginfo|bitsadmin|cdb|certutil|cl_invocation\.ps1|cl_mutexverifiers\.ps1|cmd|cmdkey|cmstp|comsvcs\.dll|control|csc|cscript|csi|devtoolslauncher|dfsvc|diskshadow|dnscmd|dnx|dotnet|dxcap|esentutl|eventvwr|excel|expand|extexport|extrac32|findstr|forfiles|ftp|gfxdownloadwrapper|gpscript|hh|ie4uinit|ieadvpack\.dll|ieaframe\.dll|ic|infdefaultinstall|installutil|jsc|makecab|manage-bde\.wsf|mavinject|mftrace|microsoft\.workflow\.compiler|mmc|msbuild|msconfig|msdeploy|msdt|mshta|mshtml\.dll|msc|msxsl|netsh|odbcconf|pcalua|pcwrun|pcwutl\.dll|pester\.bat|powerpnt|presentationhost|pubprn\.vbs|rcsi|reg|regasm|regedit|register-cimprovider|regsvcs|regsvr32|rpcping|rundll32|runonce|runscripthelper|sc|schtasks|scriptrunner|setupapi\.dll|shdocvw\.dll|shell32\.dll|slmgr\.vbs|sqldumper|sqlps|sqltoolsps|squirrel|syncappvpublishingserver|syncappvpublishingserver\.vbs|syssetup\.dll|te|tracker|tttracer|update|url\.dll|verclsid|vsjitdebugger|wab|winrm\.vbs|winword|wmic|wscript|wsl|wsreset|xwizard|zipfldr\.dll)\s[0m
[30;1m1 | [0m[35m# Unless explicitly stated otherwise all files in this repository are licensed[0m
[30;1m2 | [0m[35m# under the Apache License Version 2.0.[0m
[30;1m3 | [0m[35m# This product includes software developed at Datadog (https://www.datadoghq.com/).[0m
[30;1m4 | [0m[35m# Copyright 2020 Datadog, Inc.[0m
[30;1m5 | [0m[35m[0m
[30;1m6 | [0m[35mfrom importlib import import_module[0m

[31m--[ [0m[34mMatch #[0m[33m239[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/handler.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m6 | [0m[35mfrom importlib import import_module[0m
[30;1m7 | [0m[35m[0m
[30;1m8 | [0m[35mimport os[0m
[30;1m9 | [0m[35mfrom time import time_ns[0m
[30;1m10 | [0m[35m[0m
[30;1m11 | [0m[35mfrom datadog_lambda.tracing import emit_telemetry_on_exception_outside_of_handler[0m
[30;1m12 | [0m[35mfrom datadog_lambda.wrapper import datadog_lambda_wrapper[0m

[31m--[ [0m[34mMatch #[0m[33m240[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000600[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Windows[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/tag_object.py[0m
   Pattern: [32m\s(advpack\.dll|appvlp|at|atbroker|bash|bginfo|bitsadmin|cdb|certutil|cl_invocation\.ps1|cl_mutexverifiers\.ps1|cmd|cmdkey|cmstp|comsvcs\.dll|control|csc|cscript|csi|devtoolslauncher|dfsvc|diskshadow|dnscmd|dnx|dotnet|dxcap|esentutl|eventvwr|excel|expand|extexport|extrac32|findstr|forfiles|ftp|gfxdownloadwrapper|gpscript|hh|ie4uinit|ieadvpack\.dll|ieaframe\.dll|ic|infdefaultinstall|installutil|jsc|makecab|manage-bde\.wsf|mavinject|mftrace|microsoft\.workflow\.compiler|mmc|msbuild|msconfig|msdeploy|msdt|mshta|mshtml\.dll|msc|msxsl|netsh|odbcconf|pcalua|pcwrun|pcwutl\.dll|pester\.bat|powerpnt|presentationhost|pubprn\.vbs|rcsi|reg|regasm|regedit|register-cimprovider|regsvcs|regsvr32|rpcping|rundll32|runonce|runscripthelper|sc|schtasks|scriptrunner|setupapi\.dll|shdocvw\.dll|shell32\.dll|slmgr\.vbs|sqldumper|sqlps|sqltoolsps|squirrel|syncappvpublishingserver|syncappvpublishingserver\.vbs|syssetup\.dll|te|tracker|tttracer|update|url\.dll|verclsid|vsjitdebugger|wab|winrm\.vbs|winword|wmic|wscript|wsl|wsreset|xwizard|zipfldr\.dll)\s[0m
[30;1m1 | [0m[35m# Unless explicitly stated otherwise all files in this repository are licensed[0m
[30;1m2 | [0m[35m# under the Apache License Version 2.0.[0m
[30;1m3 | [0m[35m# This product includes software developed at Datadog (https://www.datadoghq.com/).[0m
[30;1m4 | [0m[35m# Copyright 2021 Datadog, Inc.[0m
[30;1m5 | [0m[35m[0m
[30;1m6 | [0m[35mfrom decimal import Decimal[0m

[31m--[ [0m[34mMatch #[0m[33m241[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/xray.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m112 | [0m[35m    if sock.host_port_tuple is None:[0m
[30;1m113 | [0m[35m        return None[0m
[30;1m114 | [0m[35m    context = parse_xray_header([0m
[30;1m115 | [0m[35m        os.environ.get(XrayDaemon.XRAY_TRACE_ID_HEADER_NAME, "")[0m
[30;1m116 | [0m[35m    )[0m
[30;1m117 | [0m[35m    if context is None:[0m
[30;1m118 | [0m[35m        logger.debug([0m

[31m--[ [0m[34mMatch #[0m[33m242[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/xray.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m18 | [0m[35m    def host_port_tuple(self):[0m
[30;1m19 | [0m[35m        if not hasattr(self, "_host_port_tuple"):[0m
[30;1m20 | [0m[35m            self._host_port_tuple = self._get_xray_host_port([0m
[30;1m21 | [0m[35m                os.environ.get(XrayDaemon.XRAY_DAEMON_ADDRESS, "")[0m
[30;1m22 | [0m[35m            )[0m
[30;1m23 | [0m[35m        return self._host_port_tuple[0m
[30;1m24 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m243[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/xray.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m60 | [0m[35mdef parse_xray_header(raw_trace_id):[0m
[30;1m61 | [0m[35m    # Example:[0m
[30;1m62 | [0m[35m    # Root=1-5e272390-8c398be037738dc042009320;Parent=94ae789b969f1cc5;Sampled=1;Lineage=c6c5b1b9:0[0m
[30;1m63 | [0m[35m    logger.debug("Reading trace context from env var %s", raw_trace_id)[0m
[30;1m64 | [0m[35m    if len(raw_trace_id) == 0:[0m
[30;1m65 | [0m[35m        return None[0m
[30;1m66 | [0m[35m    parts = raw_trace_id.split(";")[0m

[31m--[ [0m[34mMatch #[0m[33m244[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/xray.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m41 | [0m[35m            return None[0m
[30;1m42 | [0m[35m        parts = address.split(":")[0m
[30;1m43 | [0m[35m        if len(parts) <= 1:[0m
[30;1m44 | [0m[35m            logger.debug("X-Ray daemon env var not set, not sending sub-segment")[0m
[30;1m45 | [0m[35m            return None[0m
[30;1m46 | [0m[35m        port = int(parts[1])[0m
[30;1m47 | [0m[35m        host = parts[0][0m

[31m--[ [0m[34mMatch #[0m[33m245[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/xray.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m37 | [0m[35m[0m
[30;1m38 | [0m[35m    def _get_xray_host_port(self, address):[0m
[30;1m39 | [0m[35m        if address == "":[0m
[30;1m40 | [0m[35m            logger.debug("X-Ray daemon env var not set, not sending sub-segment")[0m
[30;1m41 | [0m[35m            return None[0m
[30;1m42 | [0m[35m        parts = address.split(":")[0m
[30;1m43 | [0m[35m        if len(parts) <= 1:[0m

[31m--[ [0m[34mMatch #[0m[33m246[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/xray.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m1 | [0m[35mimport os[0m
[30;1m2 | [0m[35mimport logging[0m
[30;1m3 | [0m[35mimport binascii[0m
[30;1m4 | [0m[35mimport time[0m
[30;1m5 | [0m[35mimport socket[0m
[30;1m6 | [0m[35mimport ujson as json[0m
[30;1m7 | [0m[35m[0m
[30;1m8 | [0m[35mfrom datadog_lambda.constants import XrayDaemon, XraySubsegment, TraceContextSource[0m

[31m--[ [0m[34mMatch #[0m[33m247[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m386 | [0m[35m        return True[0m
[30;1m387 | [0m[35m[0m
[30;1m388 | [0m[35m    # JSONata style[0m
[30;1m389 | [0m[35m    dd_context = event.get("_datadog")[0m
[30;1m390 | [0m[35m    return ([0m
[30;1m391 | [0m[35m        dd_context[0m
[30;1m392 | [0m[35m        and "Execution" in dd_context[0m

[31m--[ [0m[34mMatch #[0m[33m248[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m379 | [0m[35m[0m
[30;1m380 | [0m[35m    The actual event must contain "Execution", "StateMachine", and "State" fields.[0m
[30;1m381 | [0m[35m    """[0m
[30;1m382 | [0m[35m    event = event.get("Payload", event)[0m
[30;1m383 | [0m[35m[0m
[30;1m384 | [0m[35m    # JSONPath style[0m
[30;1m385 | [0m[35m    if "Execution" in event and "StateMachine" in event and "State" in event:[0m

[31m--[ [0m[34mMatch #[0m[33m249[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m363 | [0m[35m        # Return a 502 status if no response is found[0m
[30;1m364 | [0m[35m        status_code = "502"[0m
[30;1m365 | [0m[35m    elif hasattr(response, "get"):[0m
[30;1m366 | [0m[35m        status_code = response.get("statusCode")[0m
[30;1m367 | [0m[35m    elif hasattr(response, "status_code"):[0m
[30;1m368 | [0m[35m        status_code = response.status_code[0m
[30;1m369 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m250[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m352 | [0m[35m    """[0m
[30;1m353 | [0m[35m    if trigger_tags is None:[0m
[30;1m354 | [0m[35m        return[0m
[30;1m355 | [0m[35m    str_event_source = trigger_tags.get("function_trigger.event_source")[0m
[30;1m356 | [0m[35m    # it would be cleaner if each event type was a constant object that[0m
[30;1m357 | [0m[35m    # knew some properties about itself like this.[0m
[30;1m358 | [0m[35m    if str_event_source not in _str_http_triggers:[0m

[31m--[ [0m[34mMatch #[0m[33m251[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m308 | [0m[35m        http_tags["http.referer"] = headers.get("Referer")[0m
[30;1m309 | [0m[35m[0m
[30;1m310 | [0m[35m    # Try to get `routeKey` from API GW v2; otherwise try to get `resource` from API GW v1[0m
[30;1m311 | [0m[35m    route = event.get("routeKey") or event.get("resource")[0m
[30;1m312 | [0m[35m    if route:[0m
[30;1m313 | [0m[35m        # "GET /my/endpoint" = > "/my/endpoint"[0m
[30;1m314 | [0m[35m        http_tags["http.route"] = route.split(" ")[-1][0m

[31m--[ [0m[34mMatch #[0m[33m252[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m308 | [0m[35m        http_tags["http.referer"] = headers.get("Referer")[0m
[30;1m309 | [0m[35m[0m
[30;1m310 | [0m[35m    # Try to get `routeKey` from API GW v2; otherwise try to get `resource` from API GW v1[0m
[30;1m311 | [0m[35m    route = event.get("routeKey") or event.get("resource")[0m
[30;1m312 | [0m[35m    if route:[0m
[30;1m313 | [0m[35m        # "GET /my/endpoint" = > "/my/endpoint"[0m
[30;1m314 | [0m[35m        http_tags["http.route"] = route.split(" ")[-1][0m

[31m--[ [0m[34mMatch #[0m[33m253[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m305 | [0m[35m[0m
[30;1m306 | [0m[35m    headers = event.get("headers")[0m
[30;1m307 | [0m[35m    if headers and headers.get("Referer"):[0m
[30;1m308 | [0m[35m        http_tags["http.referer"] = headers.get("Referer")[0m
[30;1m309 | [0m[35m[0m
[30;1m310 | [0m[35m    # Try to get `routeKey` from API GW v2; otherwise try to get `resource` from API GW v1[0m
[30;1m311 | [0m[35m    route = event.get("routeKey") or event.get("resource")[0m

[31m--[ [0m[34mMatch #[0m[33m254[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m304 | [0m[35m        http_tags["http.method"] = method[0m
[30;1m305 | [0m[35m[0m
[30;1m306 | [0m[35m    headers = event.get("headers")[0m
[30;1m307 | [0m[35m    if headers and headers.get("Referer"):[0m
[30;1m308 | [0m[35m        http_tags["http.referer"] = headers.get("Referer")[0m
[30;1m309 | [0m[35m[0m
[30;1m310 | [0m[35m    # Try to get `routeKey` from API GW v2; otherwise try to get `resource` from API GW v1[0m

[31m--[ [0m[34mMatch #[0m[33m255[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m303 | [0m[35m    if method:[0m
[30;1m304 | [0m[35m        http_tags["http.method"] = method[0m
[30;1m305 | [0m[35m[0m
[30;1m306 | [0m[35m    headers = event.get("headers")[0m
[30;1m307 | [0m[35m    if headers and headers.get("Referer"):[0m
[30;1m308 | [0m[35m        http_tags["http.referer"] = headers.get("Referer")[0m
[30;1m309 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m256[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m296 | [0m[35m        apigateway_v2_http = request_context.get("http")[0m
[30;1m297 | [0m[35m        if event.get("version") == "2.0" and apigateway_v2_http:[0m
[30;1m298 | [0m[35m            path = apigateway_v2_http.get("path")[0m
[30;1m299 | [0m[35m            method = apigateway_v2_http.get("method")[0m
[30;1m300 | [0m[35m[0m
[30;1m301 | [0m[35m    if path:[0m
[30;1m302 | [0m[35m        http_tags["http.url_details.path"] = path[0m

[31m--[ [0m[34mMatch #[0m[33m257[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m295 | [0m[35m        # Version 2.0 HTTP API Gateway[0m
[30;1m296 | [0m[35m        apigateway_v2_http = request_context.get("http")[0m
[30;1m297 | [0m[35m        if event.get("version") == "2.0" and apigateway_v2_http:[0m
[30;1m298 | [0m[35m            path = apigateway_v2_http.get("path")[0m
[30;1m299 | [0m[35m            method = apigateway_v2_http.get("method")[0m
[30;1m300 | [0m[35m[0m
[30;1m301 | [0m[35m    if path:[0m

[31m--[ [0m[34mMatch #[0m[33m258[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m294 | [0m[35m        method = request_context.get("httpMethod")[0m
[30;1m295 | [0m[35m        # Version 2.0 HTTP API Gateway[0m
[30;1m296 | [0m[35m        apigateway_v2_http = request_context.get("http")[0m
[30;1m297 | [0m[35m        if event.get("version") == "2.0" and apigateway_v2_http:[0m
[30;1m298 | [0m[35m            path = apigateway_v2_http.get("path")[0m
[30;1m299 | [0m[35m            method = apigateway_v2_http.get("method")[0m
[30;1m300 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m259[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m293 | [0m[35m        path = request_context.get("path")[0m
[30;1m294 | [0m[35m        method = request_context.get("httpMethod")[0m
[30;1m295 | [0m[35m        # Version 2.0 HTTP API Gateway[0m
[30;1m296 | [0m[35m        apigateway_v2_http = request_context.get("http")[0m
[30;1m297 | [0m[35m        if event.get("version") == "2.0" and apigateway_v2_http:[0m
[30;1m298 | [0m[35m            path = apigateway_v2_http.get("path")[0m
[30;1m299 | [0m[35m            method = apigateway_v2_http.get("method")[0m

[31m--[ [0m[34mMatch #[0m[33m260[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m291 | [0m[35m            http_tags["http.url"] = request_context.get("domainName")[0m
[30;1m292 | [0m[35m[0m
[30;1m293 | [0m[35m        path = request_context.get("path")[0m
[30;1m294 | [0m[35m        method = request_context.get("httpMethod")[0m
[30;1m295 | [0m[35m        # Version 2.0 HTTP API Gateway[0m
[30;1m296 | [0m[35m        apigateway_v2_http = request_context.get("http")[0m
[30;1m297 | [0m[35m        if event.get("version") == "2.0" and apigateway_v2_http:[0m

[31m--[ [0m[34mMatch #[0m[33m261[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m290 | [0m[35m        if request_context.get("domainName"):[0m
[30;1m291 | [0m[35m            http_tags["http.url"] = request_context.get("domainName")[0m
[30;1m292 | [0m[35m[0m
[30;1m293 | [0m[35m        path = request_context.get("path")[0m
[30;1m294 | [0m[35m        method = request_context.get("httpMethod")[0m
[30;1m295 | [0m[35m        # Version 2.0 HTTP API Gateway[0m
[30;1m296 | [0m[35m        apigateway_v2_http = request_context.get("http")[0m

[31m--[ [0m[34mMatch #[0m[33m262[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m288 | [0m[35m    method = event.get("httpMethod")[0m
[30;1m289 | [0m[35m    if request_context and request_context.get("stage"):[0m
[30;1m290 | [0m[35m        if request_context.get("domainName"):[0m
[30;1m291 | [0m[35m            http_tags["http.url"] = request_context.get("domainName")[0m
[30;1m292 | [0m[35m[0m
[30;1m293 | [0m[35m        path = request_context.get("path")[0m
[30;1m294 | [0m[35m        method = request_context.get("httpMethod")[0m

[31m--[ [0m[34mMatch #[0m[33m263[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m287 | [0m[35m    path = event.get("path")[0m
[30;1m288 | [0m[35m    method = event.get("httpMethod")[0m
[30;1m289 | [0m[35m    if request_context and request_context.get("stage"):[0m
[30;1m290 | [0m[35m        if request_context.get("domainName"):[0m
[30;1m291 | [0m[35m            http_tags["http.url"] = request_context.get("domainName")[0m
[30;1m292 | [0m[35m[0m
[30;1m293 | [0m[35m        path = request_context.get("path")[0m

[31m--[ [0m[34mMatch #[0m[33m264[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m286 | [0m[35m    request_context = event.get("requestContext")[0m
[30;1m287 | [0m[35m    path = event.get("path")[0m
[30;1m288 | [0m[35m    method = event.get("httpMethod")[0m
[30;1m289 | [0m[35m    if request_context and request_context.get("stage"):[0m
[30;1m290 | [0m[35m        if request_context.get("domainName"):[0m
[30;1m291 | [0m[35m            http_tags["http.url"] = request_context.get("domainName")[0m
[30;1m292 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m265[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m285 | [0m[35m    http_tags = {}[0m
[30;1m286 | [0m[35m    request_context = event.get("requestContext")[0m
[30;1m287 | [0m[35m    path = event.get("path")[0m
[30;1m288 | [0m[35m    method = event.get("httpMethod")[0m
[30;1m289 | [0m[35m    if request_context and request_context.get("stage"):[0m
[30;1m290 | [0m[35m        if request_context.get("domainName"):[0m
[30;1m291 | [0m[35m            http_tags["http.url"] = request_context.get("domainName")[0m

[31m--[ [0m[34mMatch #[0m[33m266[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m284 | [0m[35m    """[0m
[30;1m285 | [0m[35m    http_tags = {}[0m
[30;1m286 | [0m[35m    request_context = event.get("requestContext")[0m
[30;1m287 | [0m[35m    path = event.get("path")[0m
[30;1m288 | [0m[35m    method = event.get("httpMethod")[0m
[30;1m289 | [0m[35m    if request_context and request_context.get("stage"):[0m
[30;1m290 | [0m[35m        if request_context.get("domainName"):[0m

[31m--[ [0m[34mMatch #[0m[33m267[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m283 | [0m[35m    Extracts HTTP facet tags from the triggering event[0m
[30;1m284 | [0m[35m    """[0m
[30;1m285 | [0m[35m    http_tags = {}[0m
[30;1m286 | [0m[35m    request_context = event.get("requestContext")[0m
[30;1m287 | [0m[35m    path = event.get("path")[0m
[30;1m288 | [0m[35m    method = event.get("httpMethod")[0m
[30;1m289 | [0m[35m    if request_context and request_context.get("stage"):[0m

[31m--[ [0m[34mMatch #[0m[33m268[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m268 | [0m[35m[0m
[30;1m269 | [0m[35m    event_record = get_first_record(event)[0m
[30;1m270 | [0m[35m    if event_record:[0m
[30;1m271 | [0m[35m        event_source_arn = event_record.get("eventSourceARN") or event_record.get([0m
[30;1m272 | [0m[35m            "eventSourceArn"[0m
[30;1m273 | [0m[35m        )[0m
[30;1m274 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m269[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m268 | [0m[35m[0m
[30;1m269 | [0m[35m    event_record = get_first_record(event)[0m
[30;1m270 | [0m[35m    if event_record:[0m
[30;1m271 | [0m[35m        event_source_arn = event_record.get("eventSourceARN") or event_record.get([0m
[30;1m272 | [0m[35m            "eventSourceArn"[0m
[30;1m273 | [0m[35m        )[0m
[30;1m274 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m270[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m264 | [0m[35m[0m
[30;1m265 | [0m[35m[0m
[30;1m266 | [0m[35mdef get_event_source_arn(source: _EventSource, event: dict, context: Any) -> str:[0m
[30;1m267 | [0m[35m    event_source_arn = event.get("eventSourceARN") or event.get("eventSourceArn")[0m
[30;1m268 | [0m[35m[0m
[30;1m269 | [0m[35m    event_record = get_first_record(event)[0m
[30;1m270 | [0m[35m    if event_record:[0m

[31m--[ [0m[34mMatch #[0m[33m271[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m264 | [0m[35m[0m
[30;1m265 | [0m[35m[0m
[30;1m266 | [0m[35mdef get_event_source_arn(source: _EventSource, event: dict, context: Any) -> str:[0m
[30;1m267 | [0m[35m    event_source_arn = event.get("eventSourceARN") or event.get("eventSourceArn")[0m
[30;1m268 | [0m[35m[0m
[30;1m269 | [0m[35m    event_record = get_first_record(event)[0m
[30;1m270 | [0m[35m    if event_record:[0m

[31m--[ [0m[34mMatch #[0m[33m272[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m260 | [0m[35m        context = event[0m
[30;1m261 | [0m[35m        if "_datadog" in event:[0m
[30;1m262 | [0m[35m            context = event.get("_datadog")[0m
[30;1m263 | [0m[35m        return context.get("StateMachine").get("Id")[0m
[30;1m264 | [0m[35m[0m
[30;1m265 | [0m[35m[0m
[30;1m266 | [0m[35mdef get_event_source_arn(source: _EventSource, event: dict, context: Any) -> str:[0m

[31m--[ [0m[34mMatch #[0m[33m273[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m260 | [0m[35m        context = event[0m
[30;1m261 | [0m[35m        if "_datadog" in event:[0m
[30;1m262 | [0m[35m            context = event.get("_datadog")[0m
[30;1m263 | [0m[35m        return context.get("StateMachine").get("Id")[0m
[30;1m264 | [0m[35m[0m
[30;1m265 | [0m[35m[0m
[30;1m266 | [0m[35mdef get_event_source_arn(source: _EventSource, event: dict, context: Any) -> str:[0m

[31m--[ [0m[34mMatch #[0m[33m274[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m259 | [0m[35m    if source.event_type == EventTypes.STEPFUNCTIONS:[0m
[30;1m260 | [0m[35m        context = event[0m
[30;1m261 | [0m[35m        if "_datadog" in event:[0m
[30;1m262 | [0m[35m            context = event.get("_datadog")[0m
[30;1m263 | [0m[35m        return context.get("StateMachine").get("Id")[0m
[30;1m264 | [0m[35m[0m
[30;1m265 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m275[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m253 | [0m[35m[0m
[30;1m254 | [0m[35m    # e.g. arn:aws:events:us-east-1:123456789012:rule/my-schedule[0m
[30;1m255 | [0m[35m    if source.event_type == EventTypes.CLOUDWATCH_EVENTS and event.get("resources"):[0m
[30;1m256 | [0m[35m        return event.get("resources")[0][0m
[30;1m257 | [0m[35m[0m
[30;1m258 | [0m[35m    # Returning state machine arn as event source arn.[0m
[30;1m259 | [0m[35m    if source.event_type == EventTypes.STEPFUNCTIONS:[0m

[31m--[ [0m[34mMatch #[0m[33m276[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m252 | [0m[35m        return f"arn:{aws_arn}:logs:{region}:{account_id}:log-group:{log_group}"[0m
[30;1m253 | [0m[35m[0m
[30;1m254 | [0m[35m    # e.g. arn:aws:events:us-east-1:123456789012:rule/my-schedule[0m
[30;1m255 | [0m[35m    if source.event_type == EventTypes.CLOUDWATCH_EVENTS and event.get("resources"):[0m
[30;1m256 | [0m[35m        return event.get("resources")[0][0m
[30;1m257 | [0m[35m[0m
[30;1m258 | [0m[35m    # Returning state machine arn as event source arn.[0m

[31m--[ [0m[34mMatch #[0m[33m277[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m248 | [0m[35m        ) as decompress_stream:[0m
[30;1m249 | [0m[35m            data = b"".join(BufferedReader(decompress_stream))[0m
[30;1m250 | [0m[35m        logs = json.loads(data)[0m
[30;1m251 | [0m[35m        log_group = logs.get("logGroup", "cloudwatch")[0m
[30;1m252 | [0m[35m        return f"arn:{aws_arn}:logs:{region}:{account_id}:log-group:{log_group}"[0m
[30;1m253 | [0m[35m[0m
[30;1m254 | [0m[35m    # e.g. arn:aws:events:us-east-1:123456789012:rule/my-schedule[0m

[31m--[ [0m[34mMatch #[0m[33m278[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m244 | [0m[35m        import base64[0m
[30;1m245 | [0m[35m[0m
[30;1m246 | [0m[35m        with gzip.GzipFile([0m
[30;1m247 | [0m[35m            fileobj=BytesIO(base64.b64decode(event.get("awslogs", {}).get("data")))[0m
[30;1m248 | [0m[35m        ) as decompress_stream:[0m
[30;1m249 | [0m[35m            data = b"".join(BufferedReader(decompress_stream))[0m
[30;1m250 | [0m[35m        logs = json.loads(data)[0m

[31m--[ [0m[34mMatch #[0m[33m279[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m244 | [0m[35m        import base64[0m
[30;1m245 | [0m[35m[0m
[30;1m246 | [0m[35m        with gzip.GzipFile([0m
[30;1m247 | [0m[35m            fileobj=BytesIO(base64.b64decode(event.get("awslogs", {}).get("data")))[0m
[30;1m248 | [0m[35m        ) as decompress_stream:[0m
[30;1m249 | [0m[35m            data = b"".join(BufferedReader(decompress_stream))[0m
[30;1m250 | [0m[35m        logs = json.loads(data)[0m

[31m--[ [0m[34mMatch #[0m[33m280[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m236 | [0m[35m        if request_context:[0m
[30;1m237 | [0m[35m            elb = request_context.get("elb")[0m
[30;1m238 | [0m[35m            if elb:[0m
[30;1m239 | [0m[35m                return elb.get("targetGroupArn")[0m
[30;1m240 | [0m[35m        return None[0m
[30;1m241 | [0m[35m[0m
[30;1m242 | [0m[35m    # e.g. arn:aws:logs:us-west-1:123456789012:log-group:/my-log-group-xyz[0m

[31m--[ [0m[34mMatch #[0m[33m281[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m234 | [0m[35m    if source.event_type == EventTypes.ALB:[0m
[30;1m235 | [0m[35m        request_context = event.get("requestContext")[0m
[30;1m236 | [0m[35m        if request_context:[0m
[30;1m237 | [0m[35m            elb = request_context.get("elb")[0m
[30;1m238 | [0m[35m            if elb:[0m
[30;1m239 | [0m[35m                return elb.get("targetGroupArn")[0m
[30;1m240 | [0m[35m        return None[0m

[31m--[ [0m[34mMatch #[0m[33m282[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m232 | [0m[35m[0m
[30;1m233 | [0m[35m    # e.g. arn:aws:elasticloadbalancing:us-east-1:123456789012:targetgroup/lambda-xyz/123[0m
[30;1m234 | [0m[35m    if source.event_type == EventTypes.ALB:[0m
[30;1m235 | [0m[35m        request_context = event.get("requestContext")[0m
[30;1m236 | [0m[35m        if request_context:[0m
[30;1m237 | [0m[35m            elb = request_context.get("elb")[0m
[30;1m238 | [0m[35m            if elb:[0m

[31m--[ [0m[34mMatch #[0m[33m283[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m227 | [0m[35m    if source.event_type == EventTypes.API_GATEWAY:[0m
[30;1m228 | [0m[35m        request_context = event.get("requestContext")[0m
[30;1m229 | [0m[35m        api_id = request_context.get("apiId")[0m
[30;1m230 | [0m[35m        stage = request_context.get("stage")[0m
[30;1m231 | [0m[35m        return f"arn:{aws_arn}:apigateway:{region}::/restapis/{api_id}/stages/{stage}"[0m
[30;1m232 | [0m[35m[0m
[30;1m233 | [0m[35m    # e.g. arn:aws:elasticloadbalancing:us-east-1:123456789012:targetgroup/lambda-xyz/123[0m

[31m--[ [0m[34mMatch #[0m[33m284[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m226 | [0m[35m    # e.g. arn:aws:apigateway:us-east-1::/restapis/xyz123/stages/default[0m
[30;1m227 | [0m[35m    if source.event_type == EventTypes.API_GATEWAY:[0m
[30;1m228 | [0m[35m        request_context = event.get("requestContext")[0m
[30;1m229 | [0m[35m        api_id = request_context.get("apiId")[0m
[30;1m230 | [0m[35m        stage = request_context.get("stage")[0m
[30;1m231 | [0m[35m        return f"arn:{aws_arn}:apigateway:{region}::/restapis/{api_id}/stages/{stage}"[0m
[30;1m232 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m285[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m225 | [0m[35m[0m
[30;1m226 | [0m[35m    # e.g. arn:aws:apigateway:us-east-1::/restapis/xyz123/stages/default[0m
[30;1m227 | [0m[35m    if source.event_type == EventTypes.API_GATEWAY:[0m
[30;1m228 | [0m[35m        request_context = event.get("requestContext")[0m
[30;1m229 | [0m[35m        api_id = request_context.get("apiId")[0m
[30;1m230 | [0m[35m        stage = request_context.get("stage")[0m
[30;1m231 | [0m[35m        return f"arn:{aws_arn}:apigateway:{region}::/restapis/{api_id}/stages/{stage}"[0m

[31m--[ [0m[34mMatch #[0m[33m286[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m207 | [0m[35m    # e.g. arn:aws:cloudfront::123456789012:distribution/ABC123XYZ[0m
[30;1m208 | [0m[35m    if source.event_type == EventTypes.CLOUDFRONT:[0m
[30;1m209 | [0m[35m        distribution_id = ([0m
[30;1m210 | [0m[35m            event_record.get("cf", {}).get("config", {}).get("distributionId")[0m
[30;1m211 | [0m[35m        )[0m
[30;1m212 | [0m[35m        return f"arn:{aws_arn}:cloudfront::{account_id}:distribution/{distribution_id}"[0m
[30;1m213 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m287[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m207 | [0m[35m    # e.g. arn:aws:cloudfront::123456789012:distribution/ABC123XYZ[0m
[30;1m208 | [0m[35m    if source.event_type == EventTypes.CLOUDFRONT:[0m
[30;1m209 | [0m[35m        distribution_id = ([0m
[30;1m210 | [0m[35m            event_record.get("cf", {}).get("config", {}).get("distributionId")[0m
[30;1m211 | [0m[35m        )[0m
[30;1m212 | [0m[35m        return f"arn:{aws_arn}:cloudfront::{account_id}:distribution/{distribution_id}"[0m
[30;1m213 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m288[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m207 | [0m[35m    # e.g. arn:aws:cloudfront::123456789012:distribution/ABC123XYZ[0m
[30;1m208 | [0m[35m    if source.event_type == EventTypes.CLOUDFRONT:[0m
[30;1m209 | [0m[35m        distribution_id = ([0m
[30;1m210 | [0m[35m            event_record.get("cf", {}).get("config", {}).get("distributionId")[0m
[30;1m211 | [0m[35m        )[0m
[30;1m212 | [0m[35m        return f"arn:{aws_arn}:cloudfront::{account_id}:distribution/{distribution_id}"[0m
[30;1m213 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m289[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m201 | [0m[35m    if source.to_string() == "sns":[0m
[30;1m202 | [0m[35m        sns = event_record.get("Sns")[0m
[30;1m203 | [0m[35m        if sns:[0m
[30;1m204 | [0m[35m            return sns.get("TopicArn")[0m
[30;1m205 | [0m[35m        return None[0m
[30;1m206 | [0m[35m[0m
[30;1m207 | [0m[35m    # e.g. arn:aws:cloudfront::123456789012:distribution/ABC123XYZ[0m

[31m--[ [0m[34mMatch #[0m[33m290[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m199 | [0m[35m[0m
[30;1m200 | [0m[35m    # e.g. arn:aws:sns:us-east-1:123456789012:sns-lambda[0m
[30;1m201 | [0m[35m    if source.to_string() == "sns":[0m
[30;1m202 | [0m[35m        sns = event_record.get("Sns")[0m
[30;1m203 | [0m[35m        if sns:[0m
[30;1m204 | [0m[35m            return sns.get("TopicArn")[0m
[30;1m205 | [0m[35m        return None[0m

[31m--[ [0m[34mMatch #[0m[33m291[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m194 | [0m[35m        if s3:[0m
[30;1m195 | [0m[35m            bucket = s3.get("bucket")[0m
[30;1m196 | [0m[35m            if bucket:[0m
[30;1m197 | [0m[35m                return bucket.get("arn")[0m
[30;1m198 | [0m[35m        return None[0m
[30;1m199 | [0m[35m[0m
[30;1m200 | [0m[35m    # e.g. arn:aws:sns:us-east-1:123456789012:sns-lambda[0m

[31m--[ [0m[34mMatch #[0m[33m292[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m192 | [0m[35m    if source.to_string() == "s3":[0m
[30;1m193 | [0m[35m        s3 = event_record.get("s3")[0m
[30;1m194 | [0m[35m        if s3:[0m
[30;1m195 | [0m[35m            bucket = s3.get("bucket")[0m
[30;1m196 | [0m[35m            if bucket:[0m
[30;1m197 | [0m[35m                return bucket.get("arn")[0m
[30;1m198 | [0m[35m        return None[0m

[31m--[ [0m[34mMatch #[0m[33m293[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m190 | [0m[35m    event_record = get_first_record(event)[0m
[30;1m191 | [0m[35m    # e.g. arn:aws:s3:::lambda-xyz123-abc890[0m
[30;1m192 | [0m[35m    if source.to_string() == "s3":[0m
[30;1m193 | [0m[35m        s3 = event_record.get("s3")[0m
[30;1m194 | [0m[35m        if s3:[0m
[30;1m195 | [0m[35m            bucket = s3.get("bucket")[0m
[30;1m196 | [0m[35m            if bucket:[0m

[31m--[ [0m[34mMatch #[0m[33m294[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m163 | [0m[35m            event_source = _EventSource(EventTypes.SNS)[0m
[30;1m164 | [0m[35m        if aws_event_source == "aws:sqs":[0m
[30;1m165 | [0m[35m            event_source = _EventSource(EventTypes.SQS)[0m
[30;1m166 | [0m[35m        if event_record.get("cf"):[0m
[30;1m167 | [0m[35m            event_source = _EventSource(EventTypes.CLOUDFRONT)[0m
[30;1m168 | [0m[35m[0m
[30;1m169 | [0m[35m    return event_source or _EventSource(EventTypes.UNKNOWN)[0m

[31m--[ [0m[34mMatch #[0m[33m295[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m150 | [0m[35m[0m
[30;1m151 | [0m[35m    event_record = get_first_record(event)[0m
[30;1m152 | [0m[35m    if event_record:[0m
[30;1m153 | [0m[35m        aws_event_source = event_record.get("eventSource") or event_record.get([0m
[30;1m154 | [0m[35m            "EventSource"[0m
[30;1m155 | [0m[35m        )[0m
[30;1m156 | [0m[35m        if aws_event_source == "aws:dynamodb":[0m

[31m--[ [0m[34mMatch #[0m[33m296[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m150 | [0m[35m[0m
[30;1m151 | [0m[35m    event_record = get_first_record(event)[0m
[30;1m152 | [0m[35m    if event_record:[0m
[30;1m153 | [0m[35m        aws_event_source = event_record.get("eventSource") or event_record.get([0m
[30;1m154 | [0m[35m            "EventSource"[0m
[30;1m155 | [0m[35m        )[0m
[30;1m156 | [0m[35m        if aws_event_source == "aws:dynamodb":[0m

[31m--[ [0m[34mMatch #[0m[33m297[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m142 | [0m[35m        isinstance(event_detail, dict)[0m
[30;1m143 | [0m[35m        and event_detail.get("EventCategories") is not None[0m
[30;1m144 | [0m[35m    )[0m
[30;1m145 | [0m[35m    if event.get("source") == "aws.events" or has_event_categories:[0m
[30;1m146 | [0m[35m        event_source = _EventSource(EventTypes.CLOUDWATCH_EVENTS)[0m
[30;1m147 | [0m[35m[0m
[30;1m148 | [0m[35m    if is_step_function_event(event):[0m

[31m--[ [0m[34mMatch #[0m[33m298[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m140 | [0m[35m    event_detail = event.get("detail")[0m
[30;1m141 | [0m[35m    has_event_categories = ([0m
[30;1m142 | [0m[35m        isinstance(event_detail, dict)[0m
[30;1m143 | [0m[35m        and event_detail.get("EventCategories") is not None[0m
[30;1m144 | [0m[35m    )[0m
[30;1m145 | [0m[35m    if event.get("source") == "aws.events" or has_event_categories:[0m
[30;1m146 | [0m[35m        event_source = _EventSource(EventTypes.CLOUDWATCH_EVENTS)[0m

[31m--[ [0m[34mMatch #[0m[33m299[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m137 | [0m[35m    if event.get("detail-type"):[0m
[30;1m138 | [0m[35m        event_source = _EventSource(EventTypes.EVENTBRIDGE)[0m
[30;1m139 | [0m[35m[0m
[30;1m140 | [0m[35m    event_detail = event.get("detail")[0m
[30;1m141 | [0m[35m    has_event_categories = ([0m
[30;1m142 | [0m[35m        isinstance(event_detail, dict)[0m
[30;1m143 | [0m[35m        and event_detail.get("EventCategories") is not None[0m

[31m--[ [0m[34mMatch #[0m[33m300[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m134 | [0m[35m    if event.get("awslogs"):[0m
[30;1m135 | [0m[35m        event_source = _EventSource(EventTypes.CLOUDWATCH_LOGS)[0m
[30;1m136 | [0m[35m[0m
[30;1m137 | [0m[35m    if event.get("detail-type"):[0m
[30;1m138 | [0m[35m        event_source = _EventSource(EventTypes.EVENTBRIDGE)[0m
[30;1m139 | [0m[35m[0m
[30;1m140 | [0m[35m    event_detail = event.get("detail")[0m

[31m--[ [0m[34mMatch #[0m[33m301[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m131 | [0m[35m    if request_context and request_context.get("elb"):[0m
[30;1m132 | [0m[35m        event_source = _EventSource(EventTypes.ALB)[0m
[30;1m133 | [0m[35m[0m
[30;1m134 | [0m[35m    if event.get("awslogs"):[0m
[30;1m135 | [0m[35m        event_source = _EventSource(EventTypes.CLOUDWATCH_LOGS)[0m
[30;1m136 | [0m[35m[0m
[30;1m137 | [0m[35m    if event.get("detail-type"):[0m

[31m--[ [0m[34mMatch #[0m[33m302[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m128 | [0m[35m        if request_context.get("messageDirection"):[0m
[30;1m129 | [0m[35m            event_source.subtype = EventSubtypes.WEBSOCKET[0m
[30;1m130 | [0m[35m[0m
[30;1m131 | [0m[35m    if request_context and request_context.get("elb"):[0m
[30;1m132 | [0m[35m        event_source = _EventSource(EventTypes.ALB)[0m
[30;1m133 | [0m[35m[0m
[30;1m134 | [0m[35m    if event.get("awslogs"):[0m

[31m--[ [0m[34mMatch #[0m[33m303[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m125 | [0m[35m            event_source.subtype = EventSubtypes.API_GATEWAY[0m
[30;1m126 | [0m[35m        if "routeKey" in event:[0m
[30;1m127 | [0m[35m            event_source.subtype = EventSubtypes.HTTP_API[0m
[30;1m128 | [0m[35m        if request_context.get("messageDirection"):[0m
[30;1m129 | [0m[35m            event_source.subtype = EventSubtypes.WEBSOCKET[0m
[30;1m130 | [0m[35m[0m
[30;1m131 | [0m[35m    if request_context and request_context.get("elb"):[0m

[31m--[ [0m[34mMatch #[0m[33m304[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m117 | [0m[35m    request_context = event.get("requestContext")[0m
[30;1m118 | [0m[35m    if request_context and request_context.get("stage"):[0m
[30;1m119 | [0m[35m        if "domainName" in request_context and detect_lambda_function_url_domain([0m
[30;1m120 | [0m[35m            request_context.get("domainName")[0m
[30;1m121 | [0m[35m        ):[0m
[30;1m122 | [0m[35m            return _EventSource(EventTypes.LAMBDA_FUNCTION_URL)[0m
[30;1m123 | [0m[35m        event_source = _EventSource(EventTypes.API_GATEWAY)[0m

[31m--[ [0m[34mMatch #[0m[33m305[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m115 | [0m[35m    event_source = None[0m
[30;1m116 | [0m[35m[0m
[30;1m117 | [0m[35m    request_context = event.get("requestContext")[0m
[30;1m118 | [0m[35m    if request_context and request_context.get("stage"):[0m
[30;1m119 | [0m[35m        if "domainName" in request_context and detect_lambda_function_url_domain([0m
[30;1m120 | [0m[35m            request_context.get("domainName")[0m
[30;1m121 | [0m[35m        ):[0m

[31m--[ [0m[34mMatch #[0m[33m306[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m114 | [0m[35m[0m
[30;1m115 | [0m[35m    event_source = None[0m
[30;1m116 | [0m[35m[0m
[30;1m117 | [0m[35m    request_context = event.get("requestContext")[0m
[30;1m118 | [0m[35m    if request_context and request_context.get("stage"):[0m
[30;1m119 | [0m[35m        if "domainName" in request_context and detect_lambda_function_url_domain([0m
[30;1m120 | [0m[35m            request_context.get("domainName")[0m

[31m--[ [0m[34mMatch #[0m[33m307[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m102 | [0m[35m[0m
[30;1m103 | [0m[35m[0m
[30;1m104 | [0m[35mdef get_first_record(event):[0m
[30;1m105 | [0m[35m    records = event.get("Records")[0m
[30;1m106 | [0m[35m    if records and len(records) > 0:[0m
[30;1m107 | [0m[35m        return records[0][0m
[30;1m108 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m308[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000600[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Windows[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\s(advpack\.dll|appvlp|at|atbroker|bash|bginfo|bitsadmin|cdb|certutil|cl_invocation\.ps1|cl_mutexverifiers\.ps1|cmd|cmdkey|cmstp|comsvcs\.dll|control|csc|cscript|csi|devtoolslauncher|dfsvc|diskshadow|dnscmd|dnx|dotnet|dxcap|esentutl|eventvwr|excel|expand|extexport|extrac32|findstr|forfiles|ftp|gfxdownloadwrapper|gpscript|hh|ie4uinit|ieadvpack\.dll|ieaframe\.dll|ic|infdefaultinstall|installutil|jsc|makecab|manage-bde\.wsf|mavinject|mftrace|microsoft\.workflow\.compiler|mmc|msbuild|msconfig|msdeploy|msdt|mshta|mshtml\.dll|msc|msxsl|netsh|odbcconf|pcalua|pcwrun|pcwutl\.dll|pester\.bat|powerpnt|presentationhost|pubprn\.vbs|rcsi|reg|regasm|regedit|register-cimprovider|regsvcs|regsvr32|rpcping|rundll32|runonce|runscripthelper|sc|schtasks|scriptrunner|setupapi\.dll|shdocvw\.dll|shell32\.dll|slmgr\.vbs|sqldumper|sqlps|sqltoolsps|squirrel|syncappvpublishingserver|syncappvpublishingserver\.vbs|syssetup\.dll|te|tracker|tttracer|update|url\.dll|verclsid|vsjitdebugger|wab|winrm\.vbs|winword|wmic|wscript|wsl|wsreset|xwizard|zipfldr\.dll)\s[0m
[30;1m1 | [0m[35m# Unless explicitly stated otherwise all files in this repository are licensed[0m
[30;1m2 | [0m[35m# under the Apache License Version 2.0.[0m
[30;1m3 | [0m[35m# This product includes software developed at Datadog (https://www.datadoghq.com/).[0m
[30;1m4 | [0m[35m# Copyright 2019 Datadog, Inc.[0m
[30;1m5 | [0m[35m[0m
[30;1m6 | [0m[35mimport gzip[0m

[31m--[ [0m[34mMatch #[0m[33m309[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/trigger.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m241 | [0m[35m[0m
[30;1m242 | [0m[35m    # e.g. arn:aws:logs:us-west-1:123456789012:log-group:/my-log-group-xyz[0m
[30;1m243 | [0m[35m    if source.event_type == EventTypes.CLOUDWATCH_LOGS:[0m
[30;1m244 | [0m[35m        import base64[0m
[30;1m245 | [0m[35m[0m
[30;1m246 | [0m[35m        with gzip.GzipFile([0m
[30;1m247 | [0m[35m            fileobj=BytesIO(base64.b64decode(event.get("awslogs", {}).get("data")))[0m
[30;1m248 | [0m[35m        ) as decompress_stream:[0m

[31m--[ [0m[34mMatch #[0m[33m310[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m125 | [0m[35m[0m
[30;1m126 | [0m[35m        # Set DATADOG_HOST, to send data to a non-default Datadog datacenter[0m
[30;1m127 | [0m[35m        api._api_host = os.environ.get([0m
[30;1m128 | [0m[35m            "DATADOG_HOST", "https://api." + os.environ.get("DD_SITE", "datadoghq.com")[0m
[30;1m129 | [0m[35m        )[0m
[30;1m130 | [0m[35m        logger.debug("Setting DATADOG_HOST to %s", api._api_host)[0m
[30;1m131 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m311[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m124 | [0m[35m        logger.debug("Setting DATADOG_API_KEY of length %d", len(api._api_key))[0m
[30;1m125 | [0m[35m[0m
[30;1m126 | [0m[35m        # Set DATADOG_HOST, to send data to a non-default Datadog datacenter[0m
[30;1m127 | [0m[35m        api._api_host = os.environ.get([0m
[30;1m128 | [0m[35m            "DATADOG_HOST", "https://api." + os.environ.get("DD_SITE", "datadoghq.com")[0m
[30;1m129 | [0m[35m        )[0m
[30;1m130 | [0m[35m        logger.debug("Setting DATADOG_HOST to %s", api._api_host)[0m

[31m--[ [0m[34mMatch #[0m[33m312[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m112 | [0m[35m[0m
[30;1m113 | [0m[35m[0m
[30;1m114 | [0m[35mdef init_api():[0m
[30;1m115 | [0m[35m    if not os.environ.get("DD_FLUSH_TO_LOG", "").lower() == "true":[0m
[30;1m116 | [0m[35m        # Make sure that this package would always be lazy-loaded/outside from the critical path[0m
[30;1m117 | [0m[35m        # since underlying packages are quite heavy to load[0m
[30;1m118 | [0m[35m        # and useless with the extension unless sending metrics with timestamps[0m

[31m--[ [0m[34mMatch #[0m[33m313[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m62 | [0m[35m    DD_KMS_API_KEY = os.environ.get("DD_KMS_API_KEY", "")[0m
[30;1m63 | [0m[35m    DD_API_KEY = os.environ.get("DD_API_KEY", os.environ.get("DATADOG_API_KEY", ""))[0m
[30;1m64 | [0m[35m[0m
[30;1m65 | [0m[35m    LAMBDA_REGION = os.environ.get("AWS_REGION", "")[0m
[30;1m66 | [0m[35m    is_gov_region = LAMBDA_REGION.startswith("us-gov-")[0m
[30;1m67 | [0m[35m    if is_gov_region:[0m
[30;1m68 | [0m[35m        logger.debug([0m

[31m--[ [0m[34mMatch #[0m[33m314[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m60 | [0m[35m    DD_API_KEY_SECRET_ARN = os.environ.get("DD_API_KEY_SECRET_ARN", "")[0m
[30;1m61 | [0m[35m    DD_API_KEY_SSM_NAME = os.environ.get("DD_API_KEY_SSM_NAME", "")[0m
[30;1m62 | [0m[35m    DD_KMS_API_KEY = os.environ.get("DD_KMS_API_KEY", "")[0m
[30;1m63 | [0m[35m    DD_API_KEY = os.environ.get("DD_API_KEY", os.environ.get("DATADOG_API_KEY", ""))[0m
[30;1m64 | [0m[35m[0m
[30;1m65 | [0m[35m    LAMBDA_REGION = os.environ.get("AWS_REGION", "")[0m
[30;1m66 | [0m[35m    is_gov_region = LAMBDA_REGION.startswith("us-gov-")[0m

[31m--[ [0m[34mMatch #[0m[33m315[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m60 | [0m[35m    DD_API_KEY_SECRET_ARN = os.environ.get("DD_API_KEY_SECRET_ARN", "")[0m
[30;1m61 | [0m[35m    DD_API_KEY_SSM_NAME = os.environ.get("DD_API_KEY_SSM_NAME", "")[0m
[30;1m62 | [0m[35m    DD_KMS_API_KEY = os.environ.get("DD_KMS_API_KEY", "")[0m
[30;1m63 | [0m[35m    DD_API_KEY = os.environ.get("DD_API_KEY", os.environ.get("DATADOG_API_KEY", ""))[0m
[30;1m64 | [0m[35m[0m
[30;1m65 | [0m[35m    LAMBDA_REGION = os.environ.get("AWS_REGION", "")[0m
[30;1m66 | [0m[35m    is_gov_region = LAMBDA_REGION.startswith("us-gov-")[0m

[31m--[ [0m[34mMatch #[0m[33m316[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m59 | [0m[35m[0m
[30;1m60 | [0m[35m    DD_API_KEY_SECRET_ARN = os.environ.get("DD_API_KEY_SECRET_ARN", "")[0m
[30;1m61 | [0m[35m    DD_API_KEY_SSM_NAME = os.environ.get("DD_API_KEY_SSM_NAME", "")[0m
[30;1m62 | [0m[35m    DD_KMS_API_KEY = os.environ.get("DD_KMS_API_KEY", "")[0m
[30;1m63 | [0m[35m    DD_API_KEY = os.environ.get("DD_API_KEY", os.environ.get("DATADOG_API_KEY", ""))[0m
[30;1m64 | [0m[35m[0m
[30;1m65 | [0m[35m    LAMBDA_REGION = os.environ.get("AWS_REGION", "")[0m

[31m--[ [0m[34mMatch #[0m[33m317[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m58 | [0m[35m        return api_key[0m
[30;1m59 | [0m[35m[0m
[30;1m60 | [0m[35m    DD_API_KEY_SECRET_ARN = os.environ.get("DD_API_KEY_SECRET_ARN", "")[0m
[30;1m61 | [0m[35m    DD_API_KEY_SSM_NAME = os.environ.get("DD_API_KEY_SSM_NAME", "")[0m
[30;1m62 | [0m[35m    DD_KMS_API_KEY = os.environ.get("DD_KMS_API_KEY", "")[0m
[30;1m63 | [0m[35m    DD_API_KEY = os.environ.get("DD_API_KEY", os.environ.get("DATADOG_API_KEY", ""))[0m
[30;1m64 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m318[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m57 | [0m[35m    if api_key:[0m
[30;1m58 | [0m[35m        return api_key[0m
[30;1m59 | [0m[35m[0m
[30;1m60 | [0m[35m    DD_API_KEY_SECRET_ARN = os.environ.get("DD_API_KEY_SECRET_ARN", "")[0m
[30;1m61 | [0m[35m    DD_API_KEY_SSM_NAME = os.environ.get("DD_API_KEY_SSM_NAME", "")[0m
[30;1m62 | [0m[35m    DD_KMS_API_KEY = os.environ.get("DD_KMS_API_KEY", "")[0m
[30;1m63 | [0m[35m    DD_API_KEY = os.environ.get("DD_API_KEY", os.environ.get("DATADOG_API_KEY", ""))[0m

[31m--[ [0m[34mMatch #[0m[33m319[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m26 | [0m[35m    is added. We need to try decrypting the API key both with and without the encryption context.[0m
[30;1m27 | [0m[35m    """[0m
[30;1m28 | [0m[35m    # Try without encryption context, in case API key was encrypted using the AWS CLI[0m
[30;1m29 | [0m[35m    function_name = os.environ.get("AWS_LAMBDA_FUNCTION_NAME")[0m
[30;1m30 | [0m[35m    try:[0m
[30;1m31 | [0m[35m        plaintext = kms_client.decrypt(CiphertextBlob=decoded_bytes)[[0m
[30;1m32 | [0m[35m            "Plaintext"[0m

[31m--[ [0m[34mMatch #[0m[33m320[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/api.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m8 | [0m[35m[0m
[30;1m9 | [0m[35mdef decrypt_kms_api_key(kms_client, ciphertext):[0m
[30;1m10 | [0m[35m    from botocore.exceptions import ClientError[0m
[30;1m11 | [0m[35m    import base64[0m
[30;1m12 | [0m[35m[0m
[30;1m13 | [0m[35m    """[0m
[30;1m14 | [0m[35m    Decodes and deciphers the base64-encoded ciphertext given as a parameter using KMS.[0m
[30;1m15 | [0m[35m    For this to work properly, the Lambda function must have the appropriate IAM permissions.[0m

[31m--[ [0m[34mMatch #[0m[33m321[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m403 | [0m[35m[0m
[30;1m404 | [0m[35m            if self.encode_authorizer_context and is_authorizer_response(self.response):[0m
[30;1m405 | [0m[35m                self._inject_authorizer_span_headers([0m
[30;1m406 | [0m[35m                    event.get("requestContext", {}).get("requestId")[0m
[30;1m407 | [0m[35m                )[0m
[30;1m408 | [0m[35m            logger.debug("datadog_lambda_wrapper _after() done")[0m
[30;1m409 | [0m[35m        except Exception as e:[0m

[31m--[ [0m[34mMatch #[0m[33m322[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m403 | [0m[35m[0m
[30;1m404 | [0m[35m            if self.encode_authorizer_context and is_authorizer_response(self.response):[0m
[30;1m405 | [0m[35m                self._inject_authorizer_span_headers([0m
[30;1m406 | [0m[35m                    event.get("requestContext", {}).get("requestId")[0m
[30;1m407 | [0m[35m                )[0m
[30;1m408 | [0m[35m            logger.debug("datadog_lambda_wrapper _after() done")[0m
[30;1m409 | [0m[35m        except Exception as e:[0m

[31m--[ [0m[34mMatch #[0m[33m323[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m218 | [0m[35m[0m
[30;1m219 | [0m[35m            # This prevents a breaking change in ddtrace v0.49 regarding the service name[0m
[30;1m220 | [0m[35m            # in requests-related spans[0m
[30;1m221 | [0m[35m            os.environ[DD_REQUESTS_SERVICE_NAME] = os.environ.get([0m
[30;1m222 | [0m[35m                DD_SERVICE, "aws.lambda"[0m
[30;1m223 | [0m[35m            )[0m
[30;1m224 | [0m[35m            # Patch third-party libraries for tracing[0m

[31m--[ [0m[34mMatch #[0m[33m324[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m187 | [0m[35m            self.min_cold_start_trace_duration = get_env_as_int([0m
[30;1m188 | [0m[35m                DD_MIN_COLD_START_DURATION, 3[0m
[30;1m189 | [0m[35m            )[0m
[30;1m190 | [0m[35m            self.local_testing_mode = os.environ.get([0m
[30;1m191 | [0m[35m                DD_LOCAL_TEST, "false"[0m
[30;1m192 | [0m[35m            ).lower() in ("true", "1")[0m
[30;1m193 | [0m[35m            self.cold_start_trace_skip_lib = [[0m

[31m--[ [0m[34mMatch #[0m[33m325[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m182 | [0m[35m                os.environ.get(DD_DECODE_AUTHORIZER_CONTEXT, "true").lower() == "true"[0m
[30;1m183 | [0m[35m            )[0m
[30;1m184 | [0m[35m            self.cold_start_tracing = depends_on_dd_tracing_enabled([0m
[30;1m185 | [0m[35m                os.environ.get(DD_COLD_START_TRACING, "true").lower() == "true"[0m
[30;1m186 | [0m[35m            )[0m
[30;1m187 | [0m[35m            self.min_cold_start_trace_duration = get_env_as_int([0m
[30;1m188 | [0m[35m                DD_MIN_COLD_START_DURATION, 3[0m

[31m--[ [0m[34mMatch #[0m[33m326[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m179 | [0m[35m                os.environ.get(DD_ENCODE_AUTHORIZER_CONTEXT, "true").lower() == "true"[0m
[30;1m180 | [0m[35m            )[0m
[30;1m181 | [0m[35m            self.decode_authorizer_context = depends_on_dd_tracing_enabled([0m
[30;1m182 | [0m[35m                os.environ.get(DD_DECODE_AUTHORIZER_CONTEXT, "true").lower() == "true"[0m
[30;1m183 | [0m[35m            )[0m
[30;1m184 | [0m[35m            self.cold_start_tracing = depends_on_dd_tracing_enabled([0m
[30;1m185 | [0m[35m                os.environ.get(DD_COLD_START_TRACING, "true").lower() == "true"[0m

[31m--[ [0m[34mMatch #[0m[33m327[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m176 | [0m[35m                os.environ.get(DD_TRACE_MANAGED_SERVICES, "true").lower() == "true"[0m
[30;1m177 | [0m[35m            )[0m
[30;1m178 | [0m[35m            self.encode_authorizer_context = depends_on_dd_tracing_enabled([0m
[30;1m179 | [0m[35m                os.environ.get(DD_ENCODE_AUTHORIZER_CONTEXT, "true").lower() == "true"[0m
[30;1m180 | [0m[35m            )[0m
[30;1m181 | [0m[35m            self.decode_authorizer_context = depends_on_dd_tracing_enabled([0m
[30;1m182 | [0m[35m                os.environ.get(DD_DECODE_AUTHORIZER_CONTEXT, "true").lower() == "true"[0m

[31m--[ [0m[34mMatch #[0m[33m328[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m173 | [0m[35m                lambda original_boolean: dd_tracing_enabled and original_boolean[0m
[30;1m174 | [0m[35m            )[0m
[30;1m175 | [0m[35m            self.make_inferred_span = depends_on_dd_tracing_enabled([0m
[30;1m176 | [0m[35m                os.environ.get(DD_TRACE_MANAGED_SERVICES, "true").lower() == "true"[0m
[30;1m177 | [0m[35m            )[0m
[30;1m178 | [0m[35m            self.encode_authorizer_context = depends_on_dd_tracing_enabled([0m
[30;1m179 | [0m[35m                os.environ.get(DD_ENCODE_AUTHORIZER_CONTEXT, "true").lower() == "true"[0m

[31m--[ [0m[34mMatch #[0m[33m329[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m165 | [0m[35m            )[0m
[30;1m166 | [0m[35m            self.function_name = os.environ.get(AWS_LAMBDA_FUNCTION_NAME, "function")[0m
[30;1m167 | [0m[35m            self.service = os.environ.get(DD_SERVICE, None)[0m
[30;1m168 | [0m[35m            self.extractor_env = os.environ.get(DD_TRACE_EXTRACTOR, None)[0m
[30;1m169 | [0m[35m            self.trace_extractor = None[0m
[30;1m170 | [0m[35m            self.span = None[0m
[30;1m171 | [0m[35m            self.inferred_span = None[0m

[31m--[ [0m[34mMatch #[0m[33m330[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m164 | [0m[35m                os.environ.get(DD_MERGE_XRAY_TRACES, "false").lower() == "true"[0m
[30;1m165 | [0m[35m            )[0m
[30;1m166 | [0m[35m            self.function_name = os.environ.get(AWS_LAMBDA_FUNCTION_NAME, "function")[0m
[30;1m167 | [0m[35m            self.service = os.environ.get(DD_SERVICE, None)[0m
[30;1m168 | [0m[35m            self.extractor_env = os.environ.get(DD_TRACE_EXTRACTOR, None)[0m
[30;1m169 | [0m[35m            self.trace_extractor = None[0m
[30;1m170 | [0m[35m            self.span = None[0m

[31m--[ [0m[34mMatch #[0m[33m331[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m163 | [0m[35m            self.merge_xray_traces = ([0m
[30;1m164 | [0m[35m                os.environ.get(DD_MERGE_XRAY_TRACES, "false").lower() == "true"[0m
[30;1m165 | [0m[35m            )[0m
[30;1m166 | [0m[35m            self.function_name = os.environ.get(AWS_LAMBDA_FUNCTION_NAME, "function")[0m
[30;1m167 | [0m[35m            self.service = os.environ.get(DD_SERVICE, None)[0m
[30;1m168 | [0m[35m            self.extractor_env = os.environ.get(DD_TRACE_EXTRACTOR, None)[0m
[30;1m169 | [0m[35m            self.trace_extractor = None[0m

[31m--[ [0m[34mMatch #[0m[33m332[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m161 | [0m[35m                os.environ.get(DD_LOGS_INJECTION, "true").lower() == "true"[0m
[30;1m162 | [0m[35m            )[0m
[30;1m163 | [0m[35m            self.merge_xray_traces = ([0m
[30;1m164 | [0m[35m                os.environ.get(DD_MERGE_XRAY_TRACES, "false").lower() == "true"[0m
[30;1m165 | [0m[35m            )[0m
[30;1m166 | [0m[35m            self.function_name = os.environ.get(AWS_LAMBDA_FUNCTION_NAME, "function")[0m
[30;1m167 | [0m[35m            self.service = os.environ.get(DD_SERVICE, None)[0m

[31m--[ [0m[34mMatch #[0m[33m333[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m158 | [0m[35m            self.func = func[0m
[30;1m159 | [0m[35m            self.flush_to_log = os.environ.get(DD_FLUSH_TO_LOG, "").lower() == "true"[0m
[30;1m160 | [0m[35m            self.logs_injection = ([0m
[30;1m161 | [0m[35m                os.environ.get(DD_LOGS_INJECTION, "true").lower() == "true"[0m
[30;1m162 | [0m[35m            )[0m
[30;1m163 | [0m[35m            self.merge_xray_traces = ([0m
[30;1m164 | [0m[35m                os.environ.get(DD_MERGE_XRAY_TRACES, "false").lower() == "true"[0m

[31m--[ [0m[34mMatch #[0m[33m334[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m156 | [0m[35m        """Executes when the wrapped function gets wrapped"""[0m
[30;1m157 | [0m[35m        try:[0m
[30;1m158 | [0m[35m            self.func = func[0m
[30;1m159 | [0m[35m            self.flush_to_log = os.environ.get(DD_FLUSH_TO_LOG, "").lower() == "true"[0m
[30;1m160 | [0m[35m            self.logs_injection = ([0m
[30;1m161 | [0m[35m                os.environ.get(DD_LOGS_INJECTION, "true").lower() == "true"[0m
[30;1m162 | [0m[35m            )[0m

[31m--[ [0m[34mMatch #[0m[33m335[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m113 | [0m[35m@datadog_lambda_wrapper[0m
[30;1m114 | [0m[35mdef my_lambda_handle(event, context):[0m
[30;1m115 | [0m[35m    lambda_metric("my_metric", 10)[0m
[30;1m116 | [0m[35m    requests.get("https://www.datadoghq.com")[0m
[30;1m117 | [0m[35m"""[0m
[30;1m118 | [0m[35m[0m
[30;1m119 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m336[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m99 | [0m[35m        DD_CAPTURE_LAMBDA_PAYLOAD_MAX_DEPTH, tag_object.max_depth[0m
[30;1m100 | [0m[35m    )[0m
[30;1m101 | [0m[35m[0m
[30;1m102 | [0m[35menv_env_var = os.environ.get(DD_ENV, None)[0m
[30;1m103 | [0m[35m[0m
[30;1m104 | [0m[35minit_timestamp_ns = time_ns()[0m
[30;1m105 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m337[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m89 | [0m[35m[0m
[30;1m90 | [0m[35m[0m
[30;1m91 | [0m[35mdd_capture_lambda_payload_enabled = ([0m
[30;1m92 | [0m[35m    os.environ.get(DD_CAPTURE_LAMBDA_PAYLOAD, "false").lower() == "true"[0m
[30;1m93 | [0m[35m)[0m
[30;1m94 | [0m[35m[0m
[30;1m95 | [0m[35mif dd_capture_lambda_payload_enabled:[0m

[31m--[ [0m[34mMatch #[0m[33m338[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m80 | [0m[35m[0m
[30;1m81 | [0m[35mdef get_env_as_int(env_key, default_value: int) -> int:[0m
[30;1m82 | [0m[35m    try:[0m
[30;1m83 | [0m[35m        return int(os.environ.get(env_key, default_value))[0m
[30;1m84 | [0m[35m    except Exception as e:[0m
[30;1m85 | [0m[35m        logger.warn([0m
[30;1m86 | [0m[35m            f"Failed to parse {env_key} as int. Using default value: {default_value}. Error: {e}"[0m

[31m--[ [0m[34mMatch #[0m[33m339[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m50 | [0m[35m    from ddtrace.profiling import profiler[0m
[30;1m51 | [0m[35m[0m
[30;1m52 | [0m[35mllmobs_api_key = None[0m
[30;1m53 | [0m[35mllmobs_env_var = os.environ.get("DD_LLMOBS_ENABLED", "false").lower() in ("true", "1")[0m
[30;1m54 | [0m[35mif llmobs_env_var:[0m
[30;1m55 | [0m[35m    from datadog_lambda.api import get_api_key[0m
[30;1m56 | [0m[35m    from ddtrace.llmobs import LLMObs[0m

[31m--[ [0m[34mMatch #[0m[33m340[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m45 | [0m[35m    extract_http_status_code_tag,[0m
[30;1m46 | [0m[35m)[0m
[30;1m47 | [0m[35m[0m
[30;1m48 | [0m[35mprofiling_env_var = os.environ.get("DD_PROFILING_ENABLED", "false").lower() == "true"[0m
[30;1m49 | [0m[35mif profiling_env_var:[0m
[30;1m50 | [0m[35m    from ddtrace.profiling import profiler[0m
[30;1m51 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m341[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000600[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Windows[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\s(advpack\.dll|appvlp|at|atbroker|bash|bginfo|bitsadmin|cdb|certutil|cl_invocation\.ps1|cl_mutexverifiers\.ps1|cmd|cmdkey|cmstp|comsvcs\.dll|control|csc|cscript|csi|devtoolslauncher|dfsvc|diskshadow|dnscmd|dnx|dotnet|dxcap|esentutl|eventvwr|excel|expand|extexport|extrac32|findstr|forfiles|ftp|gfxdownloadwrapper|gpscript|hh|ie4uinit|ieadvpack\.dll|ieaframe\.dll|ic|infdefaultinstall|installutil|jsc|makecab|manage-bde\.wsf|mavinject|mftrace|microsoft\.workflow\.compiler|mmc|msbuild|msconfig|msdeploy|msdt|mshta|mshtml\.dll|msc|msxsl|netsh|odbcconf|pcalua|pcwrun|pcwutl\.dll|pester\.bat|powerpnt|presentationhost|pubprn\.vbs|rcsi|reg|regasm|regedit|register-cimprovider|regsvcs|regsvr32|rpcping|rundll32|runonce|runscripthelper|sc|schtasks|scriptrunner|setupapi\.dll|shdocvw\.dll|shell32\.dll|slmgr\.vbs|sqldumper|sqlps|sqltoolsps|squirrel|syncappvpublishingserver|syncappvpublishingserver\.vbs|syssetup\.dll|te|tracker|tttracer|update|url\.dll|verclsid|vsjitdebugger|wab|winrm\.vbs|winword|wmic|wscript|wsl|wsreset|xwizard|zipfldr\.dll)\s[0m
[30;1m1 | [0m[35m# Unless explicitly stated otherwise all files in this repository are licensed[0m
[30;1m2 | [0m[35m# under the Apache License Version 2.0.[0m
[30;1m3 | [0m[35m# This product includes software developed at Datadog (https://www.datadoghq.com/).[0m
[30;1m4 | [0m[35m# Copyright 2019 Datadog, Inc.[0m
[30;1m5 | [0m[35mimport os[0m
[30;1m6 | [0m[35mimport logging[0m

[31m--[ [0m[34mMatch #[0m[33m342[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m273 | [0m[35m        if request_id is not None:[0m
[30;1m274 | [0m[35m            injected_headers[Headers.Authorizing_Request_Id] = request_id[0m
[30;1m275 | [0m[35m[0m
[30;1m276 | [0m[35m        import base64[0m
[30;1m277 | [0m[35m[0m
[30;1m278 | [0m[35m        datadog_data = base64.b64encode([0m
[30;1m279 | [0m[35m            json.dumps(injected_headers, escape_forward_slashes=False).encode()[0m
[30;1m280 | [0m[35m        ).decode()[0m

[31m--[ [0m[34mMatch #[0m[33m343[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m216 | [0m[35m            if self.logs_injection:[0m
[30;1m217 | [0m[35m                inject_correlation_ids()[0m
[30;1m218 | [0m[35m[0m
[30;1m219 | [0m[35m            # This prevents a breaking change in ddtrace v0.49 regarding the service name[0m
[30;1m220 | [0m[35m            # in requests-related spans[0m
[30;1m221 | [0m[35m            os.environ[DD_REQUESTS_SERVICE_NAME] = os.environ.get([0m
[30;1m222 | [0m[35m                DD_SERVICE, "aws.lambda"[0m

[31m--[ [0m[34mMatch #[0m[33m344[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m200 | [0m[35m                        DD_COLD_START_TRACE_SKIP_LIB[0m
[30;1m201 | [0m[35m                    ].split(",")[0m
[30;1m202 | [0m[35m                except Exception:[0m
[30;1m203 | [0m[35m                    logger.debug(f"Malformatted for env {DD_COLD_START_TRACE_SKIP_LIB}")[0m
[30;1m204 | [0m[35m            self.response = None[0m
[30;1m205 | [0m[35m            if profiling_env_var:[0m
[30;1m206 | [0m[35m                self.prof = profiler.Profiler(env=env_env_var, service=self.service)[0m

[31m--[ [0m[34mMatch #[0m[33m345[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/wrapper.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m7 | [0m[35mimport traceback[0m
[30;1m8 | [0m[35mimport ujson as json[0m
[30;1m9 | [0m[35mfrom importlib import import_module[0m
[30;1m10 | [0m[35mfrom time import time_ns[0m
[30;1m11 | [0m[35m[0m
[30;1m12 | [0m[35mfrom datadog_lambda.extension import should_use_extension, flush_extension[0m
[30;1m13 | [0m[35mfrom datadog_lambda.cold_start import ([0m

[31m--[ [0m[34mMatch #[0m[33m346[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/metric.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m192 | [0m[35m[0m
[30;1m193 | [0m[35mdef submit_dynamodb_stream_type_metric(event):[0m
[30;1m194 | [0m[35m    stream_view_type = ([0m
[30;1m195 | [0m[35m        event.get("Records", [{}])[0].get("dynamodb", {}).get("StreamViewType")[0m
[30;1m196 | [0m[35m    )[0m
[30;1m197 | [0m[35m    if stream_view_type:[0m
[30;1m198 | [0m[35m        lambda_metric([0m

[31m--[ [0m[34mMatch #[0m[33m347[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/metric.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m192 | [0m[35m[0m
[30;1m193 | [0m[35mdef submit_dynamodb_stream_type_metric(event):[0m
[30;1m194 | [0m[35m    stream_view_type = ([0m
[30;1m195 | [0m[35m        event.get("Records", [{}])[0].get("dynamodb", {}).get("StreamViewType")[0m
[30;1m196 | [0m[35m    )[0m
[30;1m197 | [0m[35m    if stream_view_type:[0m
[30;1m198 | [0m[35m        lambda_metric([0m

[31m--[ [0m[34mMatch #[0m[33m348[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/metric.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m192 | [0m[35m[0m
[30;1m193 | [0m[35mdef submit_dynamodb_stream_type_metric(event):[0m
[30;1m194 | [0m[35m    stream_view_type = ([0m
[30;1m195 | [0m[35m        event.get("Records", [{}])[0].get("dynamodb", {}).get("StreamViewType")[0m
[30;1m196 | [0m[35m    )[0m
[30;1m197 | [0m[35m    if stream_view_type:[0m
[30;1m198 | [0m[35m        lambda_metric([0m

[31m--[ [0m[34mMatch #[0m[33m349[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/metric.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m71 | [0m[35m        )[0m
[30;1m72 | [0m[35m        return[0m
[30;1m73 | [0m[35m[0m
[30;1m74 | [0m[35m    flush_to_logs = os.environ.get("DD_FLUSH_TO_LOG", "").lower() == "true"[0m
[30;1m75 | [0m[35m    tags = [] if tags is None else list(tags)[0m
[30;1m76 | [0m[35m    tags.append(dd_lambda_layer_tag)[0m
[30;1m77 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m350[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/metric.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m35 | [0m[35m    lambda_stats = ThreadStatsWriter(flush_in_thread)[0m
[30;1m36 | [0m[35m[0m
[30;1m37 | [0m[35menhanced_metrics_enabled = ([0m
[30;1m38 | [0m[35m    os.environ.get("DD_ENHANCED_METRICS", "true").lower() == "true"[0m
[30;1m39 | [0m[35m)[0m
[30;1m40 | [0m[35m[0m
[30;1m41 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m351[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/metric.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m17 | [0m[35mlambda_stats = None[0m
[30;1m18 | [0m[35mextension_thread_stats = None[0m
[30;1m19 | [0m[35m[0m
[30;1m20 | [0m[35mflush_in_thread = os.environ.get("DD_FLUSH_IN_THREAD", "").lower() == "true"[0m
[30;1m21 | [0m[35m[0m
[30;1m22 | [0m[35mif should_use_extension:[0m
[30;1m23 | [0m[35m    from datadog_lambda.statsd_writer import StatsDWriter[0m

[31m--[ [0m[34mMatch #[0m[33m352[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/metric.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m4 | [0m[35m# Copyright 2019 Datadog, Inc.[0m
[30;1m5 | [0m[35m[0m
[30;1m6 | [0m[35mimport os[0m
[30;1m7 | [0m[35mimport time[0m
[30;1m8 | [0m[35mimport logging[0m
[30;1m9 | [0m[35mimport ujson as json[0m
[30;1m10 | [0m[35mfrom datetime import datetime, timedelta[0m
[30;1m11 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m353[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000600[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Windows[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/metric.py[0m
   Pattern: [32m\s(advpack\.dll|appvlp|at|atbroker|bash|bginfo|bitsadmin|cdb|certutil|cl_invocation\.ps1|cl_mutexverifiers\.ps1|cmd|cmdkey|cmstp|comsvcs\.dll|control|csc|cscript|csi|devtoolslauncher|dfsvc|diskshadow|dnscmd|dnx|dotnet|dxcap|esentutl|eventvwr|excel|expand|extexport|extrac32|findstr|forfiles|ftp|gfxdownloadwrapper|gpscript|hh|ie4uinit|ieadvpack\.dll|ieaframe\.dll|ic|infdefaultinstall|installutil|jsc|makecab|manage-bde\.wsf|mavinject|mftrace|microsoft\.workflow\.compiler|mmc|msbuild|msconfig|msdeploy|msdt|mshta|mshtml\.dll|msc|msxsl|netsh|odbcconf|pcalua|pcwrun|pcwutl\.dll|pester\.bat|powerpnt|presentationhost|pubprn\.vbs|rcsi|reg|regasm|regedit|register-cimprovider|regsvcs|regsvr32|rpcping|rundll32|runonce|runscripthelper|sc|schtasks|scriptrunner|setupapi\.dll|shdocvw\.dll|shell32\.dll|slmgr\.vbs|sqldumper|sqlps|sqltoolsps|squirrel|syncappvpublishingserver|syncappvpublishingserver\.vbs|syssetup\.dll|te|tracker|tttracer|update|url\.dll|verclsid|vsjitdebugger|wab|winrm\.vbs|winword|wmic|wscript|wsl|wsreset|xwizard|zipfldr\.dll)\s[0m
[30;1m49 | [0m[35m    the metrics asynchronously.[0m
[30;1m50 | [0m[35m[0m
[30;1m51 | [0m[35m    Otherwise, the metrics will be submitted to the Datadog API[0m
[30;1m52 | [0m[35m    periodically and at the end of the function execution in a[0m
[30;1m53 | [0m[35m    background thread.[0m
[30;1m54 | [0m[35m[0m
[30;1m55 | [0m[35m    Note that if the extension is present, it will override the DD_FLUSH_TO_LOG value[0m

[31m--[ [0m[34mMatch #[0m[33m354[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000600[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Windows[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/metric.py[0m
   Pattern: [32m\s(advpack\.dll|appvlp|at|atbroker|bash|bginfo|bitsadmin|cdb|certutil|cl_invocation\.ps1|cl_mutexverifiers\.ps1|cmd|cmdkey|cmstp|comsvcs\.dll|control|csc|cscript|csi|devtoolslauncher|dfsvc|diskshadow|dnscmd|dnx|dotnet|dxcap|esentutl|eventvwr|excel|expand|extexport|extrac32|findstr|forfiles|ftp|gfxdownloadwrapper|gpscript|hh|ie4uinit|ieadvpack\.dll|ieaframe\.dll|ic|infdefaultinstall|installutil|jsc|makecab|manage-bde\.wsf|mavinject|mftrace|microsoft\.workflow\.compiler|mmc|msbuild|msconfig|msdeploy|msdt|mshta|mshtml\.dll|msc|msxsl|netsh|odbcconf|pcalua|pcwrun|pcwutl\.dll|pester\.bat|powerpnt|presentationhost|pubprn\.vbs|rcsi|reg|regasm|regedit|register-cimprovider|regsvcs|regsvr32|rpcping|rundll32|runonce|runscripthelper|sc|schtasks|scriptrunner|setupapi\.dll|shdocvw\.dll|shell32\.dll|slmgr\.vbs|sqldumper|sqlps|sqltoolsps|squirrel|syncappvpublishingserver|syncappvpublishingserver\.vbs|syssetup\.dll|te|tracker|tttracer|update|url\.dll|verclsid|vsjitdebugger|wab|winrm\.vbs|winword|wmic|wscript|wsl|wsreset|xwizard|zipfldr\.dll)\s[0m
[30;1m25 | [0m[35m    lambda_stats = StatsDWriter()[0m
[30;1m26 | [0m[35melse:[0m
[30;1m27 | [0m[35m    # Periodical flushing in a background thread is NOT guaranteed to succeed[0m
[30;1m28 | [0m[35m    # and leads to data loss. When disabled, metrics are only flushed at the[0m
[30;1m29 | [0m[35m    # end of invocation. To make metrics submitted from a long-running Lambda[0m
[30;1m30 | [0m[35m    # function available sooner, consider using the Datadog Lambda extension.[0m
[30;1m31 | [0m[35m    from datadog_lambda.thread_stats_writer import ThreadStatsWriter[0m

[31m--[ [0m[34mMatch #[0m[33m355[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000600[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Windows[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/metric.py[0m
   Pattern: [32m\s(advpack\.dll|appvlp|at|atbroker|bash|bginfo|bitsadmin|cdb|certutil|cl_invocation\.ps1|cl_mutexverifiers\.ps1|cmd|cmdkey|cmstp|comsvcs\.dll|control|csc|cscript|csi|devtoolslauncher|dfsvc|diskshadow|dnscmd|dnx|dotnet|dxcap|esentutl|eventvwr|excel|expand|extexport|extrac32|findstr|forfiles|ftp|gfxdownloadwrapper|gpscript|hh|ie4uinit|ieadvpack\.dll|ieaframe\.dll|ic|infdefaultinstall|installutil|jsc|makecab|manage-bde\.wsf|mavinject|mftrace|microsoft\.workflow\.compiler|mmc|msbuild|msconfig|msdeploy|msdt|mshta|mshtml\.dll|msc|msxsl|netsh|odbcconf|pcalua|pcwrun|pcwutl\.dll|pester\.bat|powerpnt|presentationhost|pubprn\.vbs|rcsi|reg|regasm|regedit|register-cimprovider|regsvcs|regsvr32|rpcping|rundll32|runonce|runscripthelper|sc|schtasks|scriptrunner|setupapi\.dll|shdocvw\.dll|shell32\.dll|slmgr\.vbs|sqldumper|sqlps|sqltoolsps|squirrel|syncappvpublishingserver|syncappvpublishingserver\.vbs|syssetup\.dll|te|tracker|tttracer|update|url\.dll|verclsid|vsjitdebugger|wab|winrm\.vbs|winword|wmic|wscript|wsl|wsreset|xwizard|zipfldr\.dll)\s[0m
[30;1m1 | [0m[35m# Unless explicitly stated otherwise all files in this repository are licensed[0m
[30;1m2 | [0m[35m# under the Apache License Version 2.0.[0m
[30;1m3 | [0m[35m# This product includes software developed at Datadog (https://www.datadoghq.com/).[0m
[30;1m4 | [0m[35m# Copyright 2019 Datadog, Inc.[0m
[30;1m5 | [0m[35m[0m
[30;1m6 | [0m[35mimport os[0m

[31m--[ [0m[34mMatch #[0m[33m356[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/logger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m19 | [0m[35mdef initialize_logging(name):[0m
[30;1m20 | [0m[35m    logger = logging.getLogger(name)[0m
[30;1m21 | [0m[35m    str_level = (os.environ.get("DD_LOG_LEVEL") or "INFO").upper()[0m
[30;1m22 | [0m[35m    level = _level_mappping.get(str_level)[0m
[30;1m23 | [0m[35m    if level is None:[0m
[30;1m24 | [0m[35m        logger.setLevel(logging.INFO)[0m
[30;1m25 | [0m[35m        logger.warning("Invalid log level: %s Defaulting to INFO", str_level)[0m

[31m--[ [0m[34mMatch #[0m[33m357[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/logger.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m18 | [0m[35m[0m
[30;1m19 | [0m[35mdef initialize_logging(name):[0m
[30;1m20 | [0m[35m    logger = logging.getLogger(name)[0m
[30;1m21 | [0m[35m    str_level = (os.environ.get("DD_LOG_LEVEL") or "INFO").upper()[0m
[30;1m22 | [0m[35m    level = _level_mappping.get(str_level)[0m
[30;1m23 | [0m[35m    if level is None:[0m
[30;1m24 | [0m[35m        logger.setLevel(logging.INFO)[0m

[31m--[ [0m[34mMatch #[0m[33m358[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000600[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Windows[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/thread_stats_writer.py[0m
   Pattern: [32m\s(advpack\.dll|appvlp|at|atbroker|bash|bginfo|bitsadmin|cdb|certutil|cl_invocation\.ps1|cl_mutexverifiers\.ps1|cmd|cmdkey|cmstp|comsvcs\.dll|control|csc|cscript|csi|devtoolslauncher|dfsvc|diskshadow|dnscmd|dnx|dotnet|dxcap|esentutl|eventvwr|excel|expand|extexport|extrac32|findstr|forfiles|ftp|gfxdownloadwrapper|gpscript|hh|ie4uinit|ieadvpack\.dll|ieaframe\.dll|ic|infdefaultinstall|installutil|jsc|makecab|manage-bde\.wsf|mavinject|mftrace|microsoft\.workflow\.compiler|mmc|msbuild|msconfig|msdeploy|msdt|mshta|mshtml\.dll|msc|msxsl|netsh|odbcconf|pcalua|pcwrun|pcwutl\.dll|pester\.bat|powerpnt|presentationhost|pubprn\.vbs|rcsi|reg|regasm|regedit|register-cimprovider|regsvcs|regsvr32|rpcping|rundll32|runonce|runscripthelper|sc|schtasks|scriptrunner|setupapi\.dll|shdocvw\.dll|shell32\.dll|slmgr\.vbs|sqldumper|sqlps|sqltoolsps|squirrel|syncappvpublishingserver|syncappvpublishingserver\.vbs|syssetup\.dll|te|tracker|tttracer|update|url\.dll|verclsid|vsjitdebugger|wab|winrm\.vbs|winword|wmic|wscript|wsl|wsreset|xwizard|zipfldr\.dll)\s[0m
[30;1m25 | [0m[35m    def flush(self, tags=None):[0m
[30;1m26 | [0m[35m        """ "Flush distributions from ThreadStats to Datadog.[0m
[30;1m27 | [0m[35m        Modified based on `datadog.threadstats.base.ThreadStats.flush()`,[0m
[30;1m28 | [0m[35m        to gain better control over exception handling.[0m
[30;1m29 | [0m[35m        """[0m
[30;1m30 | [0m[35m        original_constant_tags = self.thread_stats.constant_tags.copy()[0m
[30;1m31 | [0m[35m        if tags:[0m

[31m--[ [0m[34mMatch #[0m[33m359[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/cold_start.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m150 | [0m[35m    if ([0m
[30;1m151 | [0m[35m        is_new_sandbox()[0m
[30;1m152 | [0m[35m        and os.environ.get("DD_TRACE_ENABLED", "true").lower() == "true"[0m
[30;1m153 | [0m[35m        and os.environ.get("DD_COLD_START_TRACING", "true").lower() == "true"[0m
[30;1m154 | [0m[35m    ):[0m
[30;1m155 | [0m[35m        from sys import meta_path[0m
[30;1m156 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m360[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/cold_start.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m149 | [0m[35mdef initialize_cold_start_tracing():[0m
[30;1m150 | [0m[35m    if ([0m
[30;1m151 | [0m[35m        is_new_sandbox()[0m
[30;1m152 | [0m[35m        and os.environ.get("DD_TRACE_ENABLED", "true").lower() == "true"[0m
[30;1m153 | [0m[35m        and os.environ.get("DD_COLD_START_TRACING", "true").lower() == "true"[0m
[30;1m154 | [0m[35m    ):[0m
[30;1m155 | [0m[35m        from sys import meta_path[0m

[31m--[ [0m[34mMatch #[0m[33m361[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/cold_start.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m101 | [0m[35m        return[0m
[30;1m102 | [0m[35m    end_time_ns = time.time_ns()[0m
[30;1m103 | [0m[35m    node.end_time_ns = end_time_ns[0m
[30;1m104 | [0m[35m    if not import_stack:  # import_stack empty, a root node has been found[0m
[30;1m105 | [0m[35m        global root_nodes[0m
[30;1m106 | [0m[35m        root_nodes.append(node)[0m
[30;1m107 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m362[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/cold_start.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m96 | [0m[35m    global import_stack[0m
[30;1m97 | [0m[35m    if not import_stack:[0m
[30;1m98 | [0m[35m        return[0m
[30;1m99 | [0m[35m    node = import_stack.pop()[0m
[30;1m100 | [0m[35m    if node.module_name != module_name:[0m
[30;1m101 | [0m[35m        return[0m
[30;1m102 | [0m[35m    end_time_ns = time.time_ns()[0m

[31m--[ [0m[34mMatch #[0m[33m363[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/cold_start.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m85 | [0m[35m[0m
[30;1m86 | [0m[35m[0m
[30;1m87 | [0m[35mdef push_node(module_name, file_path):[0m
[30;1m88 | [0m[35m    node = ImportNode(module_name, file_path, time.time_ns())[0m
[30;1m89 | [0m[35m    global import_stack[0m
[30;1m90 | [0m[35m    if import_stack:[0m
[30;1m91 | [0m[35m        import_stack[-1].children.append(node)[0m

[31m--[ [0m[34mMatch #[0m[33m364[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/cold_start.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m1 | [0m[35mimport time[0m
[30;1m2 | [0m[35mimport os[0m
[30;1m3 | [0m[35mfrom typing import List, Hashable[0m
[30;1m4 | [0m[35mimport logging[0m
[30;1m5 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m365[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/span_pointers.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m129 | [0m[35m    return list([0m
[30;1m130 | [0m[35m        chain.from_iterable([0m
[30;1m131 | [0m[35m            _calculate_dynamodb_span_pointers_for_event_record(record)[0m
[30;1m132 | [0m[35m            for record in event.get("Records", [])[0m
[30;1m133 | [0m[35m        )[0m
[30;1m134 | [0m[35m    )[0m
[30;1m135 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m366[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/span_pointers.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m62 | [0m[35m    # https://docs.aws.amazon.com/AmazonS3/latest/userguide/notification-how-to-event-types-and-dest[0m
[30;1m63 | [0m[35m[0m
[30;1m64 | [0m[35m    if record.get("eventName").startswith("ObjectCreated:"):[0m
[30;1m65 | [0m[35m        s3_information = record.get("s3", None)[0m
[30;1m66 | [0m[35m        if s3_information is not None:[0m
[30;1m67 | [0m[35m            return _calculate_s3_span_pointers_for_object_created_s3_information([0m
[30;1m68 | [0m[35m                s3_information[0m

[31m--[ [0m[34mMatch #[0m[33m367[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/span_pointers.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m61 | [0m[35m    # Event types:[0m
[30;1m62 | [0m[35m    # https://docs.aws.amazon.com/AmazonS3/latest/userguide/notification-how-to-event-types-and-dest[0m
[30;1m63 | [0m[35m[0m
[30;1m64 | [0m[35m    if record.get("eventName").startswith("ObjectCreated:"):[0m
[30;1m65 | [0m[35m        s3_information = record.get("s3", None)[0m
[30;1m66 | [0m[35m        if s3_information is not None:[0m
[30;1m67 | [0m[35m            return _calculate_s3_span_pointers_for_object_created_s3_information([0m

[31m--[ [0m[34mMatch #[0m[33m368[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/span_pointers.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m50 | [0m[35m    return list([0m
[30;1m51 | [0m[35m        chain.from_iterable([0m
[30;1m52 | [0m[35m            _calculate_s3_span_pointers_for_event_record(record)[0m
[30;1m53 | [0m[35m            for record in event.get("Records", [])[0m
[30;1m54 | [0m[35m        )[0m
[30;1m55 | [0m[35m    )[0m
[30;1m56 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m369[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/span_pointers.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m14 | [0m[35mlogger = logging.getLogger(__name__)[0m
[30;1m15 | [0m[35m[0m
[30;1m16 | [0m[35m[0m
[30;1m17 | [0m[35mdd_botocore_add_span_pointers = os.environ.get([0m
[30;1m18 | [0m[35m    "DD_BOTOCORE_ADD_SPAN_POINTERS", "true"[0m
[30;1m19 | [0m[35m).lower() in ("true", "1")[0m
[30;1m20 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m370[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/extension.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m16 | [0m[35m    try:[0m
[30;1m17 | [0m[35m        import urllib.request[0m
[30;1m18 | [0m[35m[0m
[30;1m19 | [0m[35m        req = urllib.request.Request(AGENT_URL + FLUSH_PATH, "".encode("ascii"))[0m
[30;1m20 | [0m[35m        urllib.request.urlopen(req)[0m
[30;1m21 | [0m[35m    except Exception as e:[0m
[30;1m22 | [0m[35m        logger.debug("Failed to flush extension, returned with error %s", e)[0m

[31m--[ [0m[34mMatch #[0m[33m371[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/patch.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m143 | [0m[35m    if request.headers.get("Content-Encoding") == "deflate":[0m
[30;1m144 | [0m[35m        data = zlib.decompress(data)[0m
[30;1m145 | [0m[35m    data_dict = json.loads(data)[0m
[30;1m146 | [0m[35m    data_dict.get("series", []).sort(key=lambda series: series.get("metric"))[0m
[30;1m147 | [0m[35m    sorted_data = json.dumps(data_dict, escape_forward_slashes=False)[0m
[30;1m148 | [0m[35m[0m
[30;1m149 | [0m[35m    # Sort headers to prevent any differences in ordering[0m

[31m--[ [0m[34mMatch #[0m[33m372[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/patch.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m143 | [0m[35m    if request.headers.get("Content-Encoding") == "deflate":[0m
[30;1m144 | [0m[35m        data = zlib.decompress(data)[0m
[30;1m145 | [0m[35m    data_dict = json.loads(data)[0m
[30;1m146 | [0m[35m    data_dict.get("series", []).sort(key=lambda series: series.get("metric"))[0m
[30;1m147 | [0m[35m    sorted_data = json.dumps(data_dict, escape_forward_slashes=False)[0m
[30;1m148 | [0m[35m[0m
[30;1m149 | [0m[35m    # Sort headers to prevent any differences in ordering[0m

[31m--[ [0m[34mMatch #[0m[33m373[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/patch.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m140 | [0m[35m    # Sort the datapoints POSTed by their name so that snapshots always align[0m
[30;1m141 | [0m[35m    data = request.body or "{}"[0m
[30;1m142 | [0m[35m    # If payload is compressed, decompress it so we can parse it[0m
[30;1m143 | [0m[35m    if request.headers.get("Content-Encoding") == "deflate":[0m
[30;1m144 | [0m[35m        data = zlib.decompress(data)[0m
[30;1m145 | [0m[35m    data_dict = json.loads(data)[0m
[30;1m146 | [0m[35m    data_dict.get("series", []).sort(key=lambda series: series.get("metric"))[0m

[31m--[ [0m[34mMatch #[0m[33m374[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/patch.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m124 | [0m[35m[0m
[30;1m125 | [0m[35m[0m
[30;1m126 | [0m[35mdef _log_request(func, instance, args, kwargs):[0m
[30;1m127 | [0m[35m    request = kwargs.get("request") or args[0][0m
[30;1m128 | [0m[35m    _print_request_string(request)[0m
[30;1m129 | [0m[35m    return func(*args, **kwargs)[0m
[30;1m130 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m375[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/patch.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m44 | [0m[35m    Patch `requests` to log the outgoing requests for integration tests.[0m
[30;1m45 | [0m[35m    """[0m
[30;1m46 | [0m[35m    global _integration_tests_patched[0m
[30;1m47 | [0m[35m    is_in_tests = os.environ.get("DD_INTEGRATION_TEST", "false").lower() == "true"[0m
[30;1m48 | [0m[35m    if not _integration_tests_patched and is_in_tests:[0m
[30;1m49 | [0m[35m        wrap("requests", "Session.send", _log_request)[0m
[30;1m50 | [0m[35m        _integration_tests_patched = True[0m

[31m--[ [0m[34mMatch #[0m[33m376[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000600[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Windows[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/patch.py[0m
   Pattern: [32m\s(advpack\.dll|appvlp|at|atbroker|bash|bginfo|bitsadmin|cdb|certutil|cl_invocation\.ps1|cl_mutexverifiers\.ps1|cmd|cmdkey|cmstp|comsvcs\.dll|control|csc|cscript|csi|devtoolslauncher|dfsvc|diskshadow|dnscmd|dnx|dotnet|dxcap|esentutl|eventvwr|excel|expand|extexport|extrac32|findstr|forfiles|ftp|gfxdownloadwrapper|gpscript|hh|ie4uinit|ieadvpack\.dll|ieaframe\.dll|ic|infdefaultinstall|installutil|jsc|makecab|manage-bde\.wsf|mavinject|mftrace|microsoft\.workflow\.compiler|mmc|msbuild|msconfig|msdeploy|msdt|mshta|mshtml\.dll|msc|msxsl|netsh|odbcconf|pcalua|pcwrun|pcwutl\.dll|pester\.bat|powerpnt|presentationhost|pubprn\.vbs|rcsi|reg|regasm|regedit|register-cimprovider|regsvcs|regsvr32|rpcping|rundll32|runonce|runscripthelper|sc|schtasks|scriptrunner|setupapi\.dll|shdocvw\.dll|shell32\.dll|slmgr\.vbs|sqldumper|sqlps|sqltoolsps|squirrel|syncappvpublishingserver|syncappvpublishingserver\.vbs|syssetup\.dll|te|tracker|tttracer|update|url\.dll|verclsid|vsjitdebugger|wab|winrm\.vbs|winword|wmic|wscript|wsl|wsreset|xwizard|zipfldr\.dll)\s[0m
[30;1m1 | [0m[35m# Unless explicitly stated otherwise all files in this repository are licensed[0m
[30;1m2 | [0m[35m# under the Apache License Version 2.0.[0m
[30;1m3 | [0m[35m# This product includes software developed at Datadog (https://www.datadoghq.com/).[0m
[30;1m4 | [0m[35m# Copyright 2019 Datadog, Inc.[0m
[30;1m5 | [0m[35m[0m
[30;1m6 | [0m[35mimport os[0m

[31m--[ [0m[34mMatch #[0m[33m377[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/patch.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m146 | [0m[35m    data_dict.get("series", []).sort(key=lambda series: series.get("metric"))[0m
[30;1m147 | [0m[35m    sorted_data = json.dumps(data_dict, escape_forward_slashes=False)[0m
[30;1m148 | [0m[35m[0m
[30;1m149 | [0m[35m    # Sort headers to prevent any differences in ordering[0m
[30;1m150 | [0m[35m    headers = request.headers or {}[0m
[30;1m151 | [0m[35m    sorted_headers = sorted([0m
[30;1m152 | [0m[35m        "{}:{}".format(key, value) for key, value in headers.items()[0m

[31m--[ [0m[34mMatch #[0m[33m378[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/datadog_lambda/patch.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m137 | [0m[35m    method = request.method[0m
[30;1m138 | [0m[35m    url = request.url[0m
[30;1m139 | [0m[35m[0m
[30;1m140 | [0m[35m    # Sort the datapoints POSTed by their name so that snapshots always align[0m
[30;1m141 | [0m[35m    data = request.body or "{}"[0m
[30;1m142 | [0m[35m    # If payload is compressed, decompress it so we can parse it[0m
[30;1m143 | [0m[35m    if request.headers.get("Content-Encoding") == "deflate":[0m

[31m--[ [0m[34mMatch #[0m[33m379[0m[34m of [0m[33m379[0m[31m ]--[0m
   Rule Id: [34mBD000600[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Windows[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/datadog_lambda-6.107.0/NOTICE[0m
   Pattern: [32m\s(advpack\.dll|appvlp|at|atbroker|bash|bginfo|bitsadmin|cdb|certutil|cl_invocation\.ps1|cl_mutexverifiers\.ps1|cmd|cmdkey|cmstp|comsvcs\.dll|control|csc|cscript|csi|devtoolslauncher|dfsvc|diskshadow|dnscmd|dnx|dotnet|dxcap|esentutl|eventvwr|excel|expand|extexport|extrac32|findstr|forfiles|ftp|gfxdownloadwrapper|gpscript|hh|ie4uinit|ieadvpack\.dll|ieaframe\.dll|ic|infdefaultinstall|installutil|jsc|makecab|manage-bde\.wsf|mavinject|mftrace|microsoft\.workflow\.compiler|mmc|msbuild|msconfig|msdeploy|msdt|mshta|mshtml\.dll|msc|msxsl|netsh|odbcconf|pcalua|pcwrun|pcwutl\.dll|pester\.bat|powerpnt|presentationhost|pubprn\.vbs|rcsi|reg|regasm|regedit|register-cimprovider|regsvcs|regsvr32|rpcping|rundll32|runonce|runscripthelper|sc|schtasks|scriptrunner|setupapi\.dll|shdocvw\.dll|shell32\.dll|slmgr\.vbs|sqldumper|sqlps|sqltoolsps|squirrel|syncappvpublishingserver|syncappvpublishingserver\.vbs|syssetup\.dll|te|tracker|tttracer|update|url\.dll|verclsid|vsjitdebugger|wab|winrm\.vbs|winword|wmic|wscript|wsl|wsreset|xwizard|zipfldr\.dll)\s[0m
[30;1m1 | [0m[35mDatadog datadog-lambda-python[0m
[30;1m2 | [0m[35mCopyright 2019 Datadog, Inc.[0m
[30;1m3 | [0m[35m[0m

379 matches found.
