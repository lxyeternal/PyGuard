[
  {
    "pyfile": "setup.py",
    "code_snippet": "import os\nimport subprocess\n\n# Return the git revision as a string\ndef git_version():\n    def _minimal_ext_cmd(cmd):\n        # construct minimal environment\n        env = {}\n        for k in ['SYSTEMROOT', 'PATH']:\n            v = os.environ.get(k)\n            if v is not None:\n                env[k] = v\n        # LANGUAGE is used on win32\n        env['LANGUAGE'] = 'C'\n        env['LANG'] = 'C'\n        env['LC_ALL'] = 'C'\n        out = subprocess.Popen(cmd, stdout=subprocess.PIPE, env=env).communicate()[0]\n        return out\n\n    try:\n        out = _minimal_ext_cmd(['git', 'rev-parse', 'HEAD'])\n        git_revision = out.strip().decode('ascii')\n    except OSError:\n        git_revision = \"Unknown\"\n\n    try:\n        out = _minimal_ext_cmd(['git', 'rev-list', '--count', 'HEAD'])\n        git_count = out.strip().decode('ascii')\n    except OSError:\n        git_count = \"0\"\n\n    return git_revision, git_count",
    "pattern_analysis": {
      "api_sequence": [
        "os.environ.get",
        "subprocess.Popen",
        "subprocess.Popen.communicate",
        "subprocess.PIPE"
      ],
      "api_sequence_with_args": [
        "os.environ.get(k)",
        "subprocess.Popen(cmd, stdout=subprocess.PIPE, env=env)",
        "subprocess.Popen(cmd, stdout=subprocess.PIPE, env=env).communicate()",
        "subprocess.PIPE"
      ],
      "mapped_sequence": [
        {
          "api_name": "os.environ.get",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "subprocess.Popen",
          "id": "spawn_process_no_shell",
          "description": "Spawns new process to execute command without shell access",
          "first_id": "system_operations",
          "second_id": "process_management",
          "third_id": "process_creation"
        },
        {
          "api_name": "subprocess.Popen.communicate",
          "id": "read_process_stdout",
          "description": "Reads all bytes from process standard output",
          "first_id": "system_operations",
          "second_id": "process_management",
          "third_id": "process_information"
        },
        {
          "api_name": "subprocess.PIPE",
          "id": "read_process_stdout",
          "description": "Reads all bytes from process standard output",
          "first_id": "system_operations",
          "second_id": "process_management",
          "third_id": "process_information"
        }
      ],
      "contextual_code": "import os\nimport subprocess\n\ndef git_version():\n    def _minimal_ext_cmd(cmd):\n        env = {}\n        for k in ['SYSTEMROOT', 'PATH']:\n            v = os.environ.get(k)\n            if v is not None:\n                env[k] = v\n        env['LANGUAGE'] = 'C'\n        env['LANG'] = 'C'\n        env['LC_ALL'] = 'C'\n        out = subprocess.Popen(cmd, stdout=subprocess.PIPE, env=env).communicate()[0]\n        return out\n\n    try:\n        out = _minimal_ext_cmd(['git', 'rev-parse', 'HEAD'])\n        git_revision = out.strip().decode('ascii')\n    except OSError:\n        git_revision = \"Unknown\"\n\n    try:\n        out = _minimal_ext_cmd(['git', 'rev-list', '--count', 'HEAD'])\n        git_count = out.strip().decode('ascii')\n    except OSError:\n        git_count = \"0\"\n\n    return git_revision, git_count"
    }
  },
  {
    "metadata": {
      "package_name": "zipfile2-0.0.12",
      "total_matches": 1
    }
  }
]