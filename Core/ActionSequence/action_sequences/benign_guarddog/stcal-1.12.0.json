[
  {
    "pyfile": "astrometric_utils.py",
    "code_snippet": "import os\n\nimport requests\nfrom astropy import table\nfrom astropy import units as u\nfrom astropy.coordinates import SkyCoord\nfrom astropy.table import Table\n\nfrom stcal.alignment import compute_fiducial\n\nASTROMETRIC_CAT_ENVVAR = \"ASTROMETRIC_CATALOG_URL\"\nDEF_CAT_URL = \"http://gsss.stsci.edu/webservices\"\n\nSERVICELOCATION = os.environ.get(ASTROMETRIC_CAT_ENVVAR, DEF_CAT_URL)\n\nTIMEOUT = 30.0  # in seconds\n\ndef get_catalog(\n    right_ascension,\n    declination,\n    epoch=2016.0,\n    search_radius=0.1,\n    catalog=\"GAIADR3\",\n    timeout=TIMEOUT,\n):\n    \"\"\"Extract catalog from VO web service.\n\n    Parameters\n    ----------\n    right_ascension : float\n        Right Ascension (RA) of center of field-of-view (in decimal degrees)\n\n    declination : float\n        Declination (Dec) of center of field-of-view (in decimal degrees)\n\n    epoch : float, optional\n        Reference epoch used to update the coordinates for proper motion\n        (in decimal year). Default: 2016.0\n\n    search_radius : float, optional\n        Search radius (in decimal degrees) from field-of-view center to use\n        for sources from catalog.  Default: 0.1 degrees\n\n    catalog : str, optional\n        Name of catalog to query, as defined by web-service. Default: 'GAIADR3'\n\n    timeout : float, optional\n        Timeout in seconds to wait for the catalog web service to respond. Default: 30.0 s\n\n    Returns\n    -------\n    csv : `~astropy.table.Table`\n        CSV object of returned sources with all columns as provided by catalog\n\n    \"\"\"\n    service_type = \"vo/CatalogSearch.aspx\"\n    spec_str = \"RA={}&DEC={}&EPOCH={}&SR={}&FORMAT={}&CAT={}&MINDET=5\"\n    headers = {\"Content-Type\": \"text/csv\"}\n    fmt = \"CSV\"\n\n    spec = spec_str.format(\n        right_ascension,\n        declination,\n        epoch,\n        search_radius,\n        fmt,\n        catalog\n    )\n    service_url = f\"{SERVICELOCATION}/{service_type}?{spec}\"\n    try:\n        rawcat = requests.get(service_url, headers=headers, timeout=timeout)\n    except requests.exceptions.ConnectionError:\n        raise requests.exceptions.ConnectionError(\n            \"Could not connect to the VO API server. Try again later.\"\n        )\n    except requests.exceptions.Timeout:\n        raise requests.exceptions.Timeout(\"The request to the VO API server timed out.\")\n    except requests.exceptions.RequestException:\n        raise requests.exceptions.RequestException(\n            \"There was an unexpected error with the request.\"\n        )\n    r_contents = rawcat.content.decode()  # convert from bytes to a String\n    rstr = r_contents.split(\"\\r\\n\")\n    # remove initial line describing the number of sources returned\n    # CRITICAL to proper interpretation of CSV data\n    del rstr[0]\n\n    return Table.read(rstr, format=\"csv\")\n",
    "pattern_analysis": {
      "api_sequence": [
        "os.environ.get",
        "requests.get",
        "rawcat.content.decode",
        "Table.read"
      ],
      "api_sequence_with_args": [
        "os.environ.get(ASTROMETRIC_CAT_ENVVAR, DEF_CAT_URL)",
        "requests.get(service_url, headers=headers, timeout=timeout)",
        "rawcat.content.decode()",
        "Table.read(rstr, format=\"csv\")"
      ],
      "mapped_sequence": [
        {
          "api_name": "os.environ.get",
          "id": "get_env_vars",
          "description": "Retrieves environment variables mapping",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "requests.get",
          "id": "send_http_get",
          "description": "Sends HTTP GET request with parameters and timeout",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "rawcat.content.decode",
          "id": "decode_bytes_default",
          "description": "Decodes bytes using default codec",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "Table.read",
          "id": "basic_file_reading",
          "description": "Reading content from files (by lines or entire content)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_reading"
        }
      ],
      "contextual_code": "import os\nimport requests\nfrom astropy.table import Table\n\nASTROMETRIC_CAT_ENVVAR = \"ASTROMETRIC_CATALOG_URL\"\nDEF_CAT_URL = \"http://gsss.stsci.edu/webservices\"\nSERVICELOCATION = os.environ.get(ASTROMETRIC_CAT_ENVVAR, DEF_CAT_URL)\n\ndef get_catalog(\n    right_ascension,\n    declination,\n    epoch=2016.0,\n    search_radius=0.1,\n    catalog=\"GAIADR3\",\n    timeout=30.0,\n):\n    service_type = \"vo/CatalogSearch.aspx\"\n    spec_str = \"RA={}&DEC={}&EPOCH={}&SR={}&FORMAT={}&CAT={}&MINDET=5\"\n    headers = {\"Content-Type\": \"text/csv\"}\n    fmt = \"CSV\"\n\n    spec = spec_str.format(\n        right_ascension,\n        declination,\n        epoch,\n        search_radius,\n        fmt,\n        catalog\n    )\n    service_url = f\"{SERVICELOCATION}/{service_type}?{spec}\"\n    try:\n        rawcat = requests.get(service_url, headers=headers, timeout=timeout)\n    except requests.exceptions.ConnectionError:\n        raise requests.exceptions.ConnectionError(\n            \"Could not connect to the VO API server. Try again later.\"\n        )\n    except requests.exceptions.Timeout:\n        raise requests.exceptions.Timeout(\"The request to the VO API server timed out.\")\n    except requests.exceptions.RequestException:\n        raise requests.exceptions.RequestException(\n            \"There was an unexpected error with the request.\"\n        )\n    r_contents = rawcat.content.decode()  # convert from bytes to a String\n    rstr = r_contents.split(\"\\r\\n\")\n    del rstr[0]\n    return Table.read(rstr, format=\"csv\")"
    }
  },
  {
    "metadata": {
      "package_name": "stcal-1.12.0",
      "total_matches": 1
    }
  }
]