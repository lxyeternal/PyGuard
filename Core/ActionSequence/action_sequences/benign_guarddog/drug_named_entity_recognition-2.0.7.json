[
  {
    "pyfile": "06_optional_check_words_with_ai.py",
    "code_snippet": "import os\nimport re\nimport sys\nimport time\nimport traceback\nfrom tqdm import tqdm\nimport requests\n\nMODEL = 'gpt-3.5-turbo'\n\nwith open(\"words_to_check_with_ai.txt\", \"r\", encoding=\"utf-8\") as f:\n    words_to_check_with_ai = f.read().split(\"\\n\")\n\nheaders = {\n    'Content-Type': 'application/json',\n    'Authorization': 'Bearer ' + os.environ[\"OPENAI_API_KEY\"],\n}\n\nbot_responses = [\"\"] * len(words_to_check_with_ai)\n\nfor idx in tqdm(range(len(words_to_check_with_ai))):\n    q = words_to_check_with_ai[idx]\n    print(f\"Asking question: {idx+1}: {q}\")\n\n    starttime = time.time()\n\n    json_data = {\n        'model': MODEL,\n        'messages': [\n            {\"role\": \"user\", \"content\": f\"What is {q}?\\n\"},\n        ],\n    }\n    for attempt in range(3):\n        print(\"attempt calling GPT API:\", attempt)\n        try:\n            response = requests.post('https://api.openai.com/v1/chat/completions', headers=headers, json=json_data)\n            r = response.json()[\"choices\"][0][\"message\"][\"content\"]\n            break\n        except:\n            print(\"Try again\")\n            traceback.print_exc()\n            time.sleep(10)\n    bot_responses[idx] = re.sub(r'\\s+', ' ', r)\n\n    with open(\"ai_responses.txt\", \"w\", encoding=\"utf-8\") as f:\n        for j in range(idx):\n            f.write(words_to_check_with_ai[j] + \"\\t\" + bot_responses[j] + \"\\n\")\n\n    endtime = time.time()\n\n    print(\"\\tReceived response: \", r)\n",
    "pattern_analysis": {
      "api_sequence": [
        "open",
        "os.environ",
        "requests.post",
        "response.json",
        "re.sub",
        "open"
      ],
      "api_sequence_with_args": [
        "open(\"words_to_check_with_ai.txt\", \"r\", encoding=\"utf-8\")",
        "os.environ[\"OPENAI_API_KEY\"]",
        "requests.post('https://api.openai.com/v1/chat/completions', headers=headers, json=json_data)",
        "response.json()",
        "re.sub(r'\\s+', ' ', r)",
        "open(\"ai_responses.txt\", \"w\", encoding=\"utf-8\")"
      ],
      "mapped_sequence": [
        {
          "api_name": "open",
          "id": "basic_read_operations",
          "description": "ic file opening operations for reading (normal reading, binary reading)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "os.environ",
          "id": "get_env_vars",
          "description": "Retrieves environment variables mapping",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "requests.post",
          "id": "send_http_post",
          "description": "Sends HTTP POST request with data and parameters",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "response.json",
          "id": "deserialize_json_response",
          "description": "Deserializes JSON response body to Python object",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "re.sub",
          "id": "compile_regex",
          "description": "Compiles regular expression pattern",
          "first_id": "code_execution",
          "second_id": "code_evaluation_execution",
          "third_id": "code_compilation"
        },
        {
          "api_name": "open",
          "id": "basic_write_operations",
          "description": "Basic file opening operations for writing (normal writing, binary writing)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        }
      ],
      "contextual_code": "import os\nimport re\nimport requests\n\nwith open(\"words_to_check_with_ai.txt\", \"r\", encoding=\"utf-8\") as f:\n    words_to_check_with_ai = f.read().split(\"\\n\")\n\nheaders = {\n    'Content-Type': 'application/json',\n    'Authorization': 'Bearer ' + os.environ[\"OPENAI_API_KEY\"],\n}\n\nfor idx in range(len(words_to_check_with_ai)):\n    q = words_to_check_with_ai[idx]\n    json_data = {\n        'model': 'gpt-3.5-turbo',\n        'messages': [\n            {\"role\": \"user\", \"content\": f\"What is {q}?\\n\"},\n        ],\n    }\n    for attempt in range(3):\n        try:\n            response = requests.post('https://api.openai.com/v1/chat/completions', headers=headers, json=json_data)\n            r = response.json()[\"choices\"][0][\"message\"][\"content\"]\n            break\n        except:\n            pass\n    bot_responses[idx] = re.sub(r'\\s+', ' ', r)\n    with open(\"ai_responses.txt\", \"w\", encoding=\"utf-8\") as f:\n        for j in range(idx):\n            f.write(words_to_check_with_ai[j] + \"\\t\" + bot_responses[j] + \"\\n\")"
    }
  },
  {
    "metadata": {
      "package_name": "drug_named_entity_recognition-2.0.7",
      "total_matches": 1
    }
  }
]