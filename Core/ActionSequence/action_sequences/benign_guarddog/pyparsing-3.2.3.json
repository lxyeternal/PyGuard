[
  {
    "pyfile": "httpServerLogParser.py",
    "code_snippet": "import string\nfrom pyparsing import (\n    alphas,\n    nums,\n    dblQuotedString,\n    Combine,\n    Word,\n    Group,\n    delimitedList,\n    Suppress,\n    removeQuotes,\n)\n\ndef getCmdFields(s, l, t):\n    t[\"method\"], t[\"requestURI\"], t[\"protocolVersion\"] = t[0].strip('\"').split()\n\nlogLineBNF = None\n\ndef getLogLineBNF():\n    global logLineBNF\n\n    if logLineBNF is None:\n        integer = Word(nums)\n        ipAddress = delimitedList(integer, \".\", combine=True)\n\n        timeZoneOffset = Word(\"+-\", nums)\n        month = Word(string.ascii_uppercase, string.ascii_lowercase, exact=3)\n        serverDateTime = Group(\n            Suppress(\"[\")\n            + Combine(\n                integer\n                + \"/\"\n                + month\n                + \"/\"\n                + integer\n                + \":\"\n                + integer\n                + \":\"\n                + integer\n                + \":\"\n                + integer\n            )\n            + timeZoneOffset\n            + Suppress(\"]\")\n        )\n\n        logLineBNF = (\n            ipAddress.setResultsName(\"ipAddr\")\n            + Suppress(\"-\")\n            + (\"-\" | Word(alphas + nums + \"@._\")).setResultsName(\"auth\")\n            + serverDateTime.setResultsName(\"timestamp\")\n            + dblQuotedString.setResultsName(\"cmd\").setParseAction(getCmdFields)\n            + (integer | \"-\").setResultsName(\"statusCode\")\n            + (integer | \"-\").setResultsName(\"numBytesSent\")\n            + dblQuotedString.setResultsName(\"referrer\").setParseAction(removeQuotes)\n            + dblQuotedString.setResultsName(\"clientSfw\").setParseAction(removeQuotes)\n        )\n    return logLineBNF\n\ntestdata = \"\"\"\n195.146.134.15 - - [20/Jan/2003:08:55:36 -0800] \"GET /path/to/page.html HTTP/1.0\" 200 4649 \"http://www.somedomain.com/020602/page.html\" \"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)\"\n111.111.111.11 - - [16/Feb/2004:04:09:49 -0800] \"GET /ads/redirectads/336x280redirect.htm HTTP/1.1\" 304 - \"http://www.foobarp.org/theme_detail.php?type=vs&cat=0&mid=27512\" \"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)\"\n11.111.11.111 - - [16/Feb/2004:10:35:12 -0800] \"GET /ads/redirectads/468x60redirect.htm HTTP/1.1\" 200 541 \"http://11.11.111.11/adframe.php?n=ad1f311a&what=zone:56\" \"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1) Opera 7.20  [ru\\\"]\"\n127.0.0.1 - u.surname@domain.com [12/Sep/2006:14:13:53 +0300] \"GET /skins/monobook/external.png HTTP/1.0\" 304 - \"http://wiki.mysite.com/skins/monobook/main.css\" \"Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.0.6) Gecko/20060728 Firefox/1.5.0.6\"\n\"\"\"\nfor line in testdata.split(\"\\n\"):\n    if not line:\n        continue\n    fields = getLogLineBNF().parseString(line)\n    print(fields.dump())\n    # ~ print repr(fields)\n    # ~ for k in fields.keys():\n    # ~ print \"fields.\" + k + \" =\", fields[k]\n    print()\n",
    "pattern_analysis": {
      "api_sequence": [
        "str.split",
        "pyparsing.Word",
        "pyparsing.delimitedList",
        "pyparsing.Group",
        "pyparsing.Suppress",
        "pyparsing.Combine",
        "pyparsing.setResultsName",
        "pyparsing.setParseAction",
        "pyparsing.setResultsName",
        "pyparsing.setResultsName",
        "pyparsing.setParseAction",
        "pyparsing.setParseAction",
        "str.split",
        "pyparsing.ParseElementEnhance.parseString",
        "print"
      ],
      "api_sequence_with_args": [
        "str.split()",
        "pyparsing.Word(nums)",
        "pyparsing.delimitedList(integer, \".\", combine=True)",
        "pyparsing.Group(...)",
        "pyparsing.Suppress(\"[\")",
        "pyparsing.Combine(...)",
        "ipAddress.setResultsName(\"ipAddr\")",
        "dblQuotedString.setParseAction(getCmdFields)",
        "(\"-\" | Word(alphas + nums + \"@._\")).setResultsName(\"auth\")",
        "serverDateTime.setResultsName(\"timestamp\")",
        "dblQuotedString.setParseAction(removeQuotes)",
        "dblQuotedString.setParseAction(removeQuotes)",
        "str.split(\"\\n\")",
        "logLineBNF.parseString(line)",
        "print(fields.dump())"
      ],
      "mapped_sequence": [
        {
          "api_name": "str.split",
          "id": "path_string_operations",
          "description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "pyparsing.Word",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "pyparsing.delimitedList",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "pyparsing.Group",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "pyparsing.Suppress",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "pyparsing.Combine",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "pyparsing.setResultsName",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "pyparsing.setParseAction",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "pyparsing.setResultsName",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "pyparsing.setResultsName",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "pyparsing.setParseAction",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "pyparsing.setParseAction",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "str.split",
          "id": "path_string_operations",
          "description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "pyparsing.ParseElementEnhance.parseString",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "print",
          "id": "read_user_input",
          "description": "Reads user input from standard input",
          "first_id": "persistence_stealth",
          "second_id": "user_interaction",
          "third_id": "interface_control"
        }
      ],
      "contextual_code": "def getCmdFields(s, l, t):\n    t[\"method\"], t[\"requestURI\"], t[\"protocolVersion\"] = t[0].strip('\"').split()\n\nfor line in testdata.split(\"\\n\"):\n    if not line:\n        continue\n    fields = getLogLineBNF().parseString(line)\n    print(fields.dump())"
    }
  },
  {
    "metadata": {
      "package_name": "pyparsing-3.2.3",
      "total_matches": 1
    }
  }
]