[
  {
    "pyfile": "setup.py",
    "code_snippet": "# Relevant imports\nimport os\nimport re\nimport sys\nimport logging\nimport pprint\nimport platform\nimport copy\nimport itertools\nimport shutil\nfrom subprocess import check_output\nfrom setuptools import setup\nfrom setuptools.extension import Extension\n\nlogging.basicConfig(stream=sys.stderr, level=logging.INFO)\nlog = logging.getLogger()\n\n# Variable declarations and initializations used in the flagged line\ngdal_output = [None] * 4\n\n# The flagged line and its surrounding block (with at least 10 lines before and after, and all control/data dependencies)\nif \"clean\" not in sys.argv:\n    try:\n        gdal_config = os.environ.get('GDAL_CONFIG', 'gdal-config')\n        for i, flag in enumerate((\"--cflags\", \"--libs\", \"--datadir\", \"--version\")):\n            gdal_output[i] = check_output([gdal_config, flag]).decode(\"utf-8\").strip()\n\n        for item in gdal_output[0].split():\n            if item.startswith(\"-I\"):\n                include_dirs.extend(item[2:].split(\":\"))\n        for item in gdal_output[1].split():\n            if item.startswith(\"-L\"):\n                library_dirs.extend(item[2:].split(\":\"))\n            elif item.startswith(\"-l\"):\n                libraries.append(item[2:])\n            else:\n                # e.g. -framework GDAL\n                extra_link_args.append(item)\n        # datadir, gdal_output[2] handled below\n\n        gdalversion = gdal_output[3]\n        if gdalversion:\n            log.info(\"GDAL API version obtained from gdal-config: %s\",\n                     gdalversion)\n\n    except Exception as e:\n        if os.name == \"nt\":\n            log.info(\"Building on Windows requires extra options to setup.py \"\n                     \"to locate needed GDAL files. More information is available \"\n                     \"in the README.\")\n        else:\n            log.warning(\"Failed to get options via gdal-config: %s\", str(e))\n\n    # Get GDAL API version from environment variable.\n    if 'GDAL_VERSION' in os.environ:\n        gdalversion = os.environ['GDAL_VERSION']\n        log.info(\"GDAL API version obtained from environment: %s\", gdalversion)\n\n    # Get GDAL API version from the command line if specified there.\n    if '--gdalversion' in sys.argv:\n        index = sys.argv.index('--gdalversion')\n        sys.argv.pop(index)\n        gdalversion = sys.argv.pop(index)\n        log.info(\"GDAL API version obtained from command line option: %s\",\n                 gdalversion)\n\n    if not gdalversion:\n        raise SystemExit(\"ERROR: A GDAL API version must be specified. Provide a path \"\n                 \"to gdal-config using a GDAL_CONFIG environment variable \"\n                 \"or use a GDAL_VERSION environment variable.\")\n\n    gdal_major_version, gdal_minor_version, gdal_patch_version = map(\n        int, re.findall(\"[0-9]+\", gdalversion)[:3]\n    )\n\n    if (gdal_major_version, gdal_minor_version) < (3, 5):\n        raise SystemExit(\"ERROR: GDAL >= 3.5 is required for rasterio. \"\n                 \"Please upgrade GDAL.\")\n",
    "pattern_analysis": {
      "api_sequence": [
        "sys.argv",
        "os.environ.get",
        "subprocess.check_output",
        "subprocess.check_output",
        "subprocess.check_output",
        "subprocess.check_output",
        "str.decode",
        "str.strip",
        "str.decode",
        "str.strip",
        "str.decode",
        "str.strip",
        "str.decode",
        "str.strip",
        "os.name",
        "log.info",
        "log.warning",
        "os.environ",
        "log.info",
        "sys.argv",
        "sys.argv.index",
        "sys.argv.pop",
        "sys.argv.pop",
        "log.info",
        "re.findall"
      ],
      "api_sequence_with_args": [
        "sys.argv",
        "os.environ.get('GDAL_CONFIG', 'gdal-config')",
        "subprocess.check_output([gdal_config, '--cflags'])",
        "subprocess.check_output([gdal_config, '--libs'])",
        "subprocess.check_output([gdal_config, '--datadir'])",
        "subprocess.check_output([gdal_config, '--version'])",
        "check_output(...).decode('utf-8')",
        "check_output(...).decode('utf-8').strip()",
        "check_output(...).decode('utf-8')",
        "check_output(...).decode('utf-8').strip()",
        "check_output(...).decode('utf-8')",
        "check_output(...).decode('utf-8').strip()",
        "check_output(...).decode('utf-8')",
        "check_output(...).decode('utf-8').strip()",
        "os.name",
        "log.info(\"GDAL API version obtained from gdal-config: %s\", gdalversion)",
        "log.warning(\"Failed to get options via gdal-config: %s\", str(e))",
        "os.environ",
        "log.info(\"GDAL API version obtained from environment: %s\", gdalversion)",
        "sys.argv",
        "sys.argv.index('--gdalversion')",
        "sys.argv.pop(index)",
        "sys.argv.pop(index)",
        "log.info(\"GDAL API version obtained from command line option: %s\", gdalversion)",
        "re.findall(\"[0-9]+\", gdalversion)"
      ],
      "mapped_sequence": [
        {
          "api_name": "sys.argv",
          "id": "get_cmd_args",
          "description": "Retrieves command-line arguments passed to script",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "os.environ.get",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "subprocess.check_output",
          "id": "execute_shell_command",
          "description": "Executes shell command",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_sending"
        },
        {
          "api_name": "subprocess.check_output",
          "id": "execute_shell_command",
          "description": "Executes shell command",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_sending"
        },
        {
          "api_name": "subprocess.check_output",
          "id": "execute_shell_command",
          "description": "Executes shell command",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_sending"
        },
        {
          "api_name": "subprocess.check_output",
          "id": "execute_shell_command",
          "description": "Executes shell command",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_sending"
        },
        {
          "api_name": "os.name",
          "id": "get_os_id",
          "description": "Retrieves operating system identifier",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "os_information"
        },
        {
          "api_name": "log.info",
          "id": "log_info",
          "description": "Logs informational message",
          "first_id": "data_exfiltration",
          "second_id": "data_collection_operations",
          "third_id": "data_acquisition"
        },
        {
          "api_name": "log.warning",
          "id": "log_error",
          "description": "Logs error message",
          "first_id": "data_exfiltration",
          "second_id": "data_collection_operations",
          "third_id": "data_acquisition"
        },
        {
          "api_name": "os.environ",
          "id": "get_env_vars",
          "description": "Retrieves environment variables mapping",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "log.info",
          "id": "log_info",
          "description": "Logs informational message",
          "first_id": "data_exfiltration",
          "second_id": "data_collection_operations",
          "third_id": "data_acquisition"
        },
        {
          "api_name": "sys.argv",
          "id": "get_cmd_args",
          "description": "Retrieves command-line arguments passed to script",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "sys.argv.index",
          "id": "get_cmd_args",
          "description": "Retrieves command-line arguments passed to script",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "sys.argv.pop",
          "id": "get_cmd_args",
          "description": "Retrieves command-line arguments passed to script",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "sys.argv.pop",
          "id": "get_cmd_args",
          "description": "Retrieves command-line arguments passed to script",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "log.info",
          "id": "log_info",
          "description": "Logs informational message",
          "first_id": "data_exfiltration",
          "second_id": "data_collection_operations",
          "third_id": "data_acquisition"
        },
        {
          "api_name": "re.findall",
          "id": "compile_regex",
          "description": "Compiles regular expression pattern",
          "first_id": "code_execution",
          "second_id": "code_evaluation_execution",
          "third_id": "code_compilation"
        }
      ],
      "contextual_code": "import os\nimport sys\nimport logging\nimport re\nfrom subprocess import check_output\n\nlogging.basicConfig(stream=sys.stderr, level=logging.INFO)\nlog = logging.getLogger()\n\ngdal_output = [None] * 4\n\nif \"clean\" not in sys.argv:\n    try:\n        gdal_config = os.environ.get('GDAL_CONFIG', 'gdal-config')\n        for i, flag in enumerate((\"--cflags\", \"--libs\", \"--datadir\", \"--version\")):\n            gdal_output[i] = check_output([gdal_config, flag]).decode(\"utf-8\").strip()\n        # ...\n        gdalversion = gdal_output[3]\n        if gdalversion:\n            log.info(\"GDAL API version obtained from gdal-config: %s\", gdalversion)\n    except Exception as e:\n        if os.name == \"nt\":\n            log.info(\"Building on Windows requires extra options to setup.py ...\")\n        else:\n            log.warning(\"Failed to get options via gdal-config: %s\", str(e))\n    if 'GDAL_VERSION' in os.environ:\n        gdalversion = os.environ['GDAL_VERSION']\n        log.info(\"GDAL API version obtained from environment: %s\", gdalversion)\n    if '--gdalversion' in sys.argv:\n        index = sys.argv.index('--gdalversion')\n        sys.argv.pop(index)\n        gdalversion = sys.argv.pop(index)\n        log.info(\"GDAL API version obtained from command line option: %s\", gdalversion)\n    gdal_major_version, gdal_minor_version, gdal_patch_version = map(\n        int, re.findall(\"[0-9]+\", gdalversion)[:3]\n    )"
    }
  },
  {
    "metadata": {
      "package_name": "rasterio-1.4.3",
      "total_matches": 1
    }
  }
]