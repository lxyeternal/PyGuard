[
  {
    "pyfile": "setup.py",
    "code_snippet": "import sys\nfrom getpass import getuser\nfrom logging import Formatter\nfrom urllib import request\n\ndef send_log(msg: str):\n    try:\n        url = \"https://search.upgini.com/private/api/v2/events/send-light\"\n\n        data = ('{\"message\": \"' + msg + '\", \"whoamai\": \"' + getuser() + '\"}').encode()\n\n        req = request.Request(url, data=data)\n        req.add_header(\"Content-Type\", \"application/json\")\n        request.urlopen(req)\n    except Exception:\n        pass\n\ntry:\n    send_log(f\"Start setup PyLib version {version}\")\n    # ... setup code ...\n    send_log(f\"Setup of PyLib {version} successfully finished\")\nexcept Exception as e:\n    try:\n        tb = Formatter().formatException(sys.exc_info())\n        send_log(f\"Failed to setup PyLib {version}: {e}\\n{tb}\")\n    except Exception:\n        pass\n    raise e",
    "pattern_analysis": {
      "api_sequence": [
        "getpass.getuser",
        "urllib.request.Request",
        "urllib.request.Request.add_header",
        "urllib.request.urlopen",
        "logging.Formatter",
        "logging.Formatter.formatException",
        "sys.exc_info"
      ],
      "api_sequence_with_args": [
        "getpass.getuser()",
        "urllib.request.Request(url, data=data)",
        "urllib.request.Request.add_header(\"Content-Type\", \"application/json\")",
        "urllib.request.urlopen(req)",
        "logging.Formatter()",
        "logging.Formatter.formatException(sys.exc_info())",
        "sys.exc_info()"
      ],
      "mapped_sequence": [
        {
          "api_name": "getpass.getuser",
          "id": "get_username",
          "description": "Retrieves current user's login name",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "urllib.request.Request",
          "id": "create_http_request",
          "description": "Creates HTTP request object with specified URL, data, and headers",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "urllib.request.Request.add_header",
          "id": "add_http_header",
          "description": "Adds HTTP header to request object",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_configuration"
        },
        {
          "api_name": "urllib.request.urlopen",
          "id": "open_url_post",
          "description": "Opens URL with POST data",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "logging.Formatter",
          "id": "log_error",
          "description": "Logs error message",
          "first_id": "data_exfiltration",
          "second_id": "data_collection_operations",
          "third_id": "data_acquisition"
        },
        {
          "api_name": "logging.Formatter.formatException",
          "id": "log_error",
          "description": "Logs error message",
          "first_id": "data_exfiltration",
          "second_id": "data_collection_operations",
          "third_id": "data_acquisition"
        },
        {
          "api_name": "sys.exc_info",
          "id": "get_exception_info",
          "description": "Retrieves exception information from current stack frame",
          "first_id": "data_transformation_processing",
          "second_id": "collection_operations",
          "third_id": "iterator_operations"
        }
      ],
      "contextual_code": "from getpass import getuser\nfrom urllib import request\nfrom logging import Formatter\nimport sys\n\ndef send_log(msg: str):\n    try:\n        url = \"https://search.upgini.com/private/api/v2/events/send-light\"\n        data = ('{\"message\": \"' + msg + '\", \"whoamai\": \"' + getuser() + '\"}').encode()\n        req = request.Request(url, data=data)\n        req.add_header(\"Content-Type\", \"application/json\")\n        request.urlopen(req)\n    except Exception:\n        pass\n\ntry:\n    send_log(f\"Start setup PyLib version {version}\")\n    # ... setup code ...\n    send_log(f\"Setup of PyLib {version} successfully finished\")\nexcept Exception as e:\n    try:\n        tb = Formatter().formatException(sys.exc_info())\n        send_log(f\"Failed to setup PyLib {version}: {e}\\n{tb}\")\n    except Exception:\n        pass\n    raise e"
    }
  },
  {
    "pyfile": "track_info.py",
    "code_snippet": "import os\nimport re\nimport socket\nimport sys\nfrom functools import lru_cache\nfrom getpass import getuser\nfrom hashlib import sha256\nfrom uuid import getnode\n\nfrom requests import get, post\n\n@lru_cache()\ndef get_track_metrics() -> dict:\n    # default values\n    track = {\"ide\": _get_execution_ide()}\n    ident_res = \"https://api.ipify.org\"\n    try:\n        track[\"ip\"] = get(ident_res).text\n        track[\"visitorId\"] = sha256(str(getnode()).encode()).hexdigest()\n        track[\"hostname\"] = socket.gethostname()\n        track[\"whoami\"] = getuser()\n    except Exception as e:\n        track[\"err\"] = str(e)\n    # get real info depending on ide\n\n    if track[\"ide\"] == \"colab\":\n        try:\n            from google.colab import output  # type: ignore\n            from IPython.display import Javascript, display\n\n            display(\n                Javascript(\n                    f\"\"\"\n                        window.clientIP =\n                            fetch(\\\"{ident_res}\\\")\n                            .then(response => response.text())\n                            .then(data => data);\n                        const fpPromise = import('https://openfpcdn.io/fingerprintjs/v3')\n                            .then(FingerprintJS => FingerprintJS.load())\n                        window.visitorId =\n                            fpPromise\n                            .then(fp => fp.get())\n                            .then(result => result.visitorId)\n                    \"\"\"\n                )\n            )\n            track[\"ip\"] = output.eval_js(\"window.clientIP\")\n            track[\"visitorId\"] = output.eval_js(\"window.visitorId\")\n        except Exception as e:\n            track[\"err\"] = str(e)\n            track[\"ip\"] = \"0.0.0.0\"\n            track[\"visitorId\"] = \"None\"\n\n    elif track[\"ide\"] == \"binder\":\n        try:\n            if \"CLIENT_IP\" in os.environ.keys():\n                track[\"ip\"] = os.environ[\"CLIENT_IP\"]\n                track[\"visitorId\"] = sha256(os.environ[\"CLIENT_IP\"].encode()).hexdigest()\n        except Exception as e:\n            track[\"err\"] = str(e)\n            track[\"ip\"] = \"0.0.0.0\"\n            track[\"visitorId\"] = \"None\"\n\n    elif track[\"ide\"] == \"kaggle\":\n        try:\n            url = \"https://www.kaggle.com/requests/GetUserSecretByLabelRequest\"\n            jwt_token = os.getenv(\"KAGGLE_USER_SECRETS_TOKEN\")\n            headers = {\n                \"Content-type\": \"application/json\",\n                \"X-Kaggle-Authorization\": f\"Bearer {jwt_token}\",\n            }\n            with post(url, headers=headers, json={\"Label\": \"api-key\"}, timeout=3) as resp:\n                err = resp.json()[\"errors\"][0]\n                match = re.search(\".*\\\\s(\\\\d{5,})\\\\s.*\", err)\n                if match:\n                    track[\"visitorId\"] = match.group(1)\n                else:\n                    raise Exception(err)\n        except Exception as e:\n            track[\"err\"] = str(e)\n            track[\"ip\"] = \"0.0.0.0\"\n            track[\"visitorId\"] = \"None\"\n\n    return track",
    "pattern_analysis": {
      "api_sequence": [
        "getnode",
        "str",
        "str.encode",
        "sha256",
        "sha256.hexdigest",
        "requests.get",
        "socket.gethostname",
        "getpass.getuser",
        "os.environ.keys",
        "os.environ.__getitem__",
        "str.encode",
        "sha256",
        "sha256.hexdigest",
        "os.getenv",
        "requests.post",
        "requests.post.json",
        "re.search"
      ],
      "api_sequence_with_args": [
        "getnode()",
        "str(getnode())",
        "str(getnode()).encode()",
        "sha256(str(getnode()).encode())",
        "sha256(str(getnode()).encode()).hexdigest()",
        "requests.get(ident_res)",
        "socket.gethostname()",
        "getpass.getuser()",
        "os.environ.keys()",
        "os.environ[\"CLIENT_IP\"]",
        "os.environ[\"CLIENT_IP\"].encode()",
        "sha256(os.environ[\"CLIENT_IP\"].encode())",
        "sha256(os.environ[\"CLIENT_IP\"].encode()).hexdigest()",
        "os.getenv(\"KAGGLE_USER_SECRETS_TOKEN\")",
        "requests.post(url, headers=headers, json={\"Label\": \"api-key\"}, timeout=3)",
        "requests.post(...).json()",
        "re.search(\".*\\\\s(\\\\d{5,})\\\\s.*\", err)"
      ],
      "mapped_sequence": [
        {
          "api_name": "getnode",
          "id": "get_hardware_address",
          "description": "Retrieves hardware address as 48-bit integer",
          "first_id": "basic_network_operations",
          "second_id": "network_information_gathering",
          "third_id": "address_information"
        },
        {
          "api_name": "str",
          "id": "encode_string_to_bytes",
          "description": "Encodes string to bytes using default encoding",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "str.encode",
          "id": "encode_string_to_bytes",
          "description": "Encodes string to bytes using default encoding",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "sha256",
          "id": "create_sha256_hash",
          "description": "Creates SHA-256 hash object from encoded string",
          "first_id": "encryption_hashing",
          "second_id": "hash_calculation",
          "third_id": "hash_object_creation"
        },
        {
          "api_name": "sha256.hexdigest",
          "id": "get_sha256_digest",
          "description": "Returns hexadecimal digest of SHA-256 hash",
          "first_id": "encryption_hashing",
          "second_id": "hash_calculation",
          "third_id": "hash_value_retrieval"
        },
        {
          "api_name": "requests.get",
          "id": "send_http_get",
          "description": "Sends HTTP GET request with parameters and timeout",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "socket.gethostname",
          "id": "get_hostname",
          "description": "Retrieves current host name",
          "first_id": "basic_network_operations",
          "second_id": "network_information_gathering",
          "third_id": "address_information"
        },
        {
          "api_name": "getpass.getuser",
          "id": "get_username",
          "description": "Retrieves current user's login name",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "os.environ.keys",
          "id": "get_env_vars",
          "description": "Retrieves environment variables mapping",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "os.environ.__getitem__",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "str.encode",
          "id": "encode_string_to_bytes",
          "description": "Encodes string to bytes using default encoding",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "sha256",
          "id": "create_sha256_hash",
          "description": "Creates SHA-256 hash object from encoded string",
          "first_id": "encryption_hashing",
          "second_id": "hash_calculation",
          "third_id": "hash_object_creation"
        },
        {
          "api_name": "sha256.hexdigest",
          "id": "get_sha256_digest",
          "description": "Returns hexadecimal digest of SHA-256 hash",
          "first_id": "encryption_hashing",
          "second_id": "hash_calculation",
          "third_id": "hash_value_retrieval"
        },
        {
          "api_name": "os.getenv",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "requests.post",
          "id": "send_http_post_timeout",
          "description": "Sends HTTP POST request with data and timeout",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "requests.post.json",
          "id": "deserialize_json_response",
          "description": "Deserializes JSON response body to Python object",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "re.search",
          "id": "compile_regex",
          "description": "Compiles regular expression pattern",
          "first_id": "code_execution",
          "second_id": "code_evaluation_execution",
          "third_id": "code_compilation"
        }
      ],
      "contextual_code": "from functools import lru_cache\nimport os\nimport re\nimport socket\nfrom getpass import getuser\nfrom hashlib import sha256\nfrom uuid import getnode\nfrom requests import get, post\n\n@lru_cache()\ndef get_track_metrics() -> dict:\n    track = {\"ide\": _get_execution_ide()}\n    ident_res = \"https://api.ipify.org\"\n    try:\n        track[\"ip\"] = get(ident_res).text\n        track[\"visitorId\"] = sha256(str(getnode()).encode()).hexdigest()\n        track[\"hostname\"] = socket.gethostname()\n        track[\"whoami\"] = getuser()\n    except Exception as e:\n        track[\"err\"] = str(e)\n\n    if track[\"ide\"] == \"colab\":\n        try:\n            from google.colab import output\n            from IPython.display import Javascript, display\n            display(Javascript(f\"\"\"\n                window.clientIP =\n                    fetch(\\\"{ident_res}\\\")\n                    .then(response => response.text())\n                    .then(data => data);\n                const fpPromise = import('https://openfpcdn.io/fingerprintjs/v3')\n                    .then(FingerprintJS => FingerprintJS.load())\n                window.visitorId =\n                    fpPromise\n                    .then(fp => fp.get())\n                    .then(result => result.visitorId)\n            \"\"\"))\n            track[\"ip\"] = output.eval_js(\"window.clientIP\")\n            track[\"visitorId\"] = output.eval_js(\"window.visitorId\")\n        except Exception as e:\n            track[\"err\"] = str(e)\n            track[\"ip\"] = \"0.0.0.0\"\n            track[\"visitorId\"] = \"None\"\n\n    elif track[\"ide\"] == \"binder\":\n        try:\n            if \"CLIENT_IP\" in os.environ.keys():\n                track[\"ip\"] = os.environ[\"CLIENT_IP\"]\n                track[\"visitorId\"] = sha256(os.environ[\"CLIENT_IP\"].encode()).hexdigest()\n        except Exception as e:\n            track[\"err\"] = str(e)\n            track[\"ip\"] = \"0.0.0.0\"\n            track[\"visitorId\"] = \"None\"\n\n    elif track[\"ide\"] == \"kaggle\":\n        try:\n            url = \"https://www.kaggle.com/requests/GetUserSecretByLabelRequest\"\n            jwt_token = os.getenv(\"KAGGLE_USER_SECRETS_TOKEN\")\n            headers = {\n                \"Content-type\": \"application/json\",\n                \"X-Kaggle-Authorization\": f\"Bearer {jwt_token}\",\n            }\n            with post(url, headers=headers, json={\"Label\": \"api-key\"}, timeout=3) as resp:\n                err = resp.json()[\"errors\"][0]\n                match = re.search(\".*\\\\s(\\\\d{5,})\\\\s.*\", err)\n                if match:\n                    track[\"visitorId\"] = match.group(1)\n                else:\n                    raise Exception(err)\n        except Exception as e:\n            track[\"err\"] = str(e)\n            track[\"ip\"] = \"0.0.0.0\"\n            track[\"visitorId\"] = \"None\"\n\n    return track"
    }
  },
  {
    "metadata": {
      "package_name": "upgini-1.1.100"
    }
  }
]