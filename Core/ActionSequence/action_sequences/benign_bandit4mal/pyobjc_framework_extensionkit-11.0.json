[
  {
    "metadata": {
      "package_name": "pyobjc_framework_extensionkit-11.0",
      "total_matches": 1,
      "processing_date": "2025-05-18 01:49:39"
    }
  },
  {
    "pyfile": "pyobjc_setup.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/pyobjc_framework_extensionkit-11.0/pyobjc_framework_extensionkit-11.0/pyobjc_setup.py",
    "line_number": "87",
    "type_description": "B815:write",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "86\t            fp.write(middle)\n87\t            fp.write(last)\n88",
    "code_snippet": "class oc_egg_info(egg_info.egg_info):\n    def run(self):\n        egg_info.egg_info.run(self)\n        self.write_build_info()\n\n        path = os.path.join(self.egg_info, \"PKG-INFO\")\n        with open(path) as fp:\n            contents = fp.read()\n\n        first, middle, last = contents.partition(\"\\n\\n\")\n\n        with open(path, \"w\") as fp:\n            fp.write(first)\n            fp.write(\n                \"\\nProject-URL: Documentation, \"\n                \"https://%s.readthedocs.io/en/latest/\\n\" % (REPO_NAME,)\n            )\n            fp.write(\n                \"Project-URL: Issue tracker, \"\n                \"https://github.com/ronaldoussoren/%s/issues\\n\" % (REPO_NAME,)\n            )\n            fp.write(\n                \"Project-URL: Repository, \"\n                \"https://github.com/ronaldoussoren/%s\" % (REPO_NAME,)\n            )\n            fp.write(middle)\n            fp.write(last)\n\n    def write_build_info(self):\n        macos_version = subprocess.check_output(\n            [\"sw_vers\", \"-productversion\"], text=True\n        ).strip()\n        macos_build = subprocess.check_output(\n            [\"sw_vers\", \"-buildversion\"], text=True\n        ).strip()\n        clang_version = (\n            subprocess.check_output([\"clang\", \"--version\"], text=True)\n            .splitlines()[0]\n            .strip()\n        )\n\n        sdk_root = get_sdk()\n        if sdk_root is None:\n            sdk_root = subprocess.check_output(\n                [\"xcrun\", \"-sdk\", \"macosx\", \"--show-sdk-path\"], text=True\n            ).strip()\n        sdk_info = os.path.join(sdk_root, \"SDKSettings.plist\")\n        if os.path.exists(sdk_info):\n            pl = plistlib.load(open(sdk_info, \"rb\"))\n            sdk_version = pl[\"DisplayName\"]\n        else:\n            sdk_version = os.path.basename(sdk_root)\n\n        build_info = textwrap.dedent(\n            f\"\"\"\\\n            macOS {macos_version} ({macos_build})\n            {clang_version}\n            SDK: {sdk_version}\n            \"\"\"\n        )\n\n        self.write_file(\n            \"pyobjc-build-info.txt\",\n            os.path.join(self.egg_info, \"pyobjc-build-info.txt\"),\n            build_info,\n        )",
    "pattern_analysis": {
      "api_sequence": [
        "egg_info.egg_info.run",
        "os.path.join",
        "open",
        "fp.read",
        "open",
        "fp.write",
        "fp.write",
        "fp.write",
        "fp.write",
        "fp.write",
        "subprocess.check_output",
        "subprocess.check_output",
        "subprocess.check_output",
        "get_sdk",
        "os.path.join",
        "os.path.exists",
        "open",
        "plistlib.load",
        "os.path.basename",
        "textwrap.dedent",
        "self.write_file"
      ],
      "api_sequence_with_args": [
        "egg_info.egg_info.run(self)",
        "os.path.join(self.egg_info, \"PKG-INFO\")",
        "open(path)",
        "fp.read()",
        "open(path, \"w\")",
        "fp.write(first)",
        "fp.write(\"\\nProject-URL: Documentation, https://%s.readthedocs.io/en/latest/\\n\" % (REPO_NAME,))",
        "fp.write(\"Project-URL: Issue tracker, https://github.com/ronaldoussoren/%s/issues\\n\" % (REPO_NAME,))",
        "fp.write(\"Project-URL: Repository, https://github.com/ronaldoussoren/%s\" % (REPO_NAME,))",
        "fp.write(middle)",
        "fp.write(last)",
        "subprocess.check_output([\"sw_vers\", \"-productversion\"], text=True)",
        "subprocess.check_output([\"sw_vers\", \"-buildversion\"], text=True)",
        "subprocess.check_output([\"clang\", \"--version\"], text=True)",
        "get_sdk()",
        "os.path.join(sdk_root, \"SDKSettings.plist\")",
        "os.path.exists(sdk_info)",
        "open(sdk_info, \"rb\")",
        "plistlib.load(open(sdk_info, \"rb\"))",
        "os.path.basename(sdk_root)",
        "textwrap.dedent(f\"\"\"\\\n            macOS {macos_version} ({macos_build})\n            {clang_version}\n            SDK: {sdk_version}\n            \"\"\")",
        "self.write_file(\"pyobjc-build-info.txt\", os.path.join(self.egg_info, \"pyobjc-build-info.txt\"), build_info)"
      ],
      "mapped_sequence": [
        {
          "api_name": "egg_info.egg_info.run",
          "id": "exec_setuptools_dev",
          "description": "Executes setuptools development procedure",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "package_configuration"
        },
        {
          "api_name": "os.path.join",
          "id": "path_string_operations",
          "description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "open",
          "id": "basic_read_operations",
          "description": "ic file opening operations for reading (normal reading, binary reading)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "fp.read",
          "id": "basic_file_reading",
          "description": "Reading content from files (by lines or entire content)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_reading"
        },
        {
          "api_name": "open",
          "id": "basic_write_operations",
          "description": "Basic file opening operations for writing (normal writing, binary writing)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "fp.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "fp.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "fp.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "fp.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "fp.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "subprocess.check_output",
          "id": "execute_shell_command",
          "description": "Executes shell command",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_sending"
        },
        {
          "api_name": "subprocess.check_output",
          "id": "execute_shell_command",
          "description": "Executes shell command",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_sending"
        },
        {
          "api_name": "subprocess.check_output",
          "id": "execute_shell_command",
          "description": "Executes shell command",
          "first_id": "command_control_communications",
          "second_id": "command_execution",
          "third_id": "command_sending"
        },
        {
          "api_name": "get_sdk",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "os.path.join",
          "id": "path_string_operations",
          "description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "os.path.exists",
          "id": "check_path_exists",
          "description": "Checks if specified path exists in filesystem",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_checking"
        },
        {
          "api_name": "open",
          "id": "basic_read_operations",
          "description": "ic file opening operations for reading (normal reading, binary reading)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "plistlib.load",
          "id": "deserialize_from_bytes",
          "description": "Deserializes Python object from bytes",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "specific_format_encoding"
        },
        {
          "api_name": "os.path.basename",
          "id": "path_string_operations",
          "description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "textwrap.dedent",
          "id": "path_string_operations",
          "description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "self.write_file",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        }
      ],
      "contextual_code": "class oc_egg_info(egg_info.egg_info):\n    def run(self):\n        egg_info.egg_info.run(self)\n        self.write_build_info()\n\n        path = os.path.join(self.egg_info, \"PKG-INFO\")\n        with open(path) as fp:\n            contents = fp.read()\n\n        first, middle, last = contents.partition(\"\\n\\n\")\n\n        with open(path, \"w\") as fp:\n            fp.write(first)\n            fp.write(\n                \"\\nProject-URL: Documentation, \"\n                \"https://%s.readthedocs.io/en/latest/\\n\" % (REPO_NAME,)\n            )\n            fp.write(\n                \"Project-URL: Issue tracker, \"\n                \"https://github.com/ronaldoussoren/%s/issues\\n\" % (REPO_NAME,)\n            )\n            fp.write(\n                \"Project-URL: Repository, \"\n                \"https://github.com/ronaldoussoren/%s\" % (REPO_NAME,)\n            )\n            fp.write(middle)\n            fp.write(last)\n\n    def write_build_info(self):\n        macos_version = subprocess.check_output(\n            [\"sw_vers\", \"-productversion\"], text=True\n        ).strip()\n        macos_build = subprocess.check_output(\n            [\"sw_vers\", \"-buildversion\"], text=True\n        ).strip()\n        clang_version = (\n            subprocess.check_output([\"clang\", \"--version\"], text=True)\n            .splitlines()[0]\n            .strip()\n        )\n\n        sdk_root = get_sdk()\n        if sdk_root is None:\n            sdk_root = subprocess.check_output(\n                [\"xcrun\", \"-sdk\", \"macosx\", \"--show-sdk-path\"], text=True\n            ).strip()\n        sdk_info = os.path.join(sdk_root, \"SDKSettings.plist\")\n        if os.path.exists(sdk_info):\n            pl = plistlib.load(open(sdk_info, \"rb\"))\n            sdk_version = pl[\"DisplayName\"]\n        else:\n            sdk_version = os.path.basename(sdk_root)\n\n        build_info = textwrap.dedent(\n            f\"\"\"\\\n            macOS {macos_version} ({macos_build})\n            {clang_version}\n            SDK: {sdk_version}\n            \"\"\"\n        )\n\n        self.write_file(\n            \"pyobjc-build-info.txt\",\n            os.path.join(self.egg_info, \"pyobjc-build-info.txt\"),\n            build_info,\n        )"
    }
  }
]