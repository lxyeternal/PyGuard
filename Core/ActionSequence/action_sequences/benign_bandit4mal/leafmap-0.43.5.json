[
  {
    "metadata": {
      "package_name": "leafmap-0.43.5",
      "total_matches": 1,
      "processing_date": "2025-05-18 01:49:40"
    }
  },
  {
    "pyfile": "common.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/leafmap-0.43.5/leafmap-0.43.5/leafmap/common.py",
    "line_number": "13662",
    "type_description": "B834:open",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "13661\n13662\t            with open(filename, \"wb\") as file:\n13663\t                for data in r.iter_content(block_size):",
    "code_snippet": "def gedi_download_file(\n    url: str, filename: str = None, username: str = None, password: str = None\n) -> None:\n    \"\"\"\n    Downloads a file from the given URL and saves it to the specified filename.\n    If no filename is provided, the name of the file from the URL will be used.\n\n    Args:\n        url (str): The URL of the file to download.\n            e.g., https://daac.ornl.gov/daacdata/gedi/GEDI_L4A_AGB_Density_V2_1/data/GEDI04_A_2019298202754_O04921_01_T02899_02_002_02_V002.h5\n        filename (str, optional): The name of the file to save the downloaded content to. Defaults to None.\n        username (str, optional): Username for authentication. Can also be set using the EARTHDATA_USERNAME environment variable. Defaults to None.\n            Create an account at https://urs.earthdata.nasa.gov\n        password (str, optional): Password for authentication. Can also be set using the EARTHDATA_PASSWORD environment variable. Defaults to None.\n\n    Returns:\n        None\n    \"\"\"\n    import requests\n    from tqdm import tqdm\n    from urllib.parse import urlparse\n\n    if username is None:\n        username = os.environ.get(\"EARTHDATA_USERNAME\", None)\n    if password is None:\n        password = os.environ.get(\"EARTHDATA_PASSWORD\", None)\n\n    if username is None or password is None:\n        raise ValueError(\n            \"Username and password must be provided. Create an account at https://urs.earthdata.nasa.gov.\"\n        )\n\n    with requests.Session() as session:\n        r1 = session.request(\"get\", url, stream=True)\n        r = session.get(r1.url, auth=(username, password), stream=True)\n        print(r.status_code)\n\n        if r.status_code == 200:\n            total_size = int(r.headers.get(\"content-length\", 0))\n            block_size = 1024  # 1 KB\n\n            # Use the filename from the URL if not provided\n            if not filename:\n                parsed_url = urlparse(url)\n                filename = parsed_url.path.split(\"/\")[-1]\n\n            progress_bar = tqdm(total=total_size, unit=\"B\", unit_scale=True)\n\n            with open(filename, \"wb\") as file:\n                for data in r.iter_content(block_size):\n                    progress_bar.update(len(data))\n                    file.write(data)\n\n            progress_bar.close()\n",
    "pattern_analysis": {
      "api_sequence": [
        "os.environ.get",
        "os.environ.get",
        "requests.Session",
        "requests.Session.request",
        "requests.Session.get",
        "tqdm.tqdm",
        "open",
        "requests.Response.iter_content",
        "tqdm.tqdm.update",
        "io.IOBase.write",
        "tqdm.tqdm.close"
      ],
      "api_sequence_with_args": [
        "os.environ.get(\"EARTHDATA_USERNAME\", None)",
        "os.environ.get(\"EARTHDATA_PASSWORD\", None)",
        "requests.Session()",
        "requests.Session.request(\"get\", url, stream=True)",
        "requests.Session.get(r1.url, auth=(username, password), stream=True)",
        "tqdm.tqdm(total=total_size, unit=\"B\", unit_scale=True)",
        "open(filename, \"wb\")",
        "requests.Response.iter_content(block_size)",
        "tqdm.tqdm.update(len(data))",
        "file.write(data)",
        "tqdm.tqdm.close()"
      ],
      "mapped_sequence": [
        {
          "api_name": "os.environ.get",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "os.environ.get",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "requests.Session",
          "id": "create_http_session",
          "description": "Creates HTTP session for making asynchronous requests",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "requests.Session.request",
          "id": "create_http_request",
          "description": "Creates HTTP request object with specified URL, data, and headers",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "requests.Session.get",
          "id": "send_http_get",
          "description": "Sends HTTP GET request with parameters and timeout",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "tqdm.tqdm",
          "id": "log_info",
          "description": "Logs informational message",
          "first_id": "data_exfiltration",
          "second_id": "data_collection_operations",
          "third_id": "data_acquisition"
        },
        {
          "api_name": "open",
          "id": "basic_write_operations",
          "description": "Basic file opening operations for writing (normal writing, binary writing)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "requests.Response.iter_content",
          "id": "read_response_bytes",
          "description": "Reads response body as bytes",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "tqdm.tqdm.update",
          "id": "log_info",
          "description": "Logs informational message",
          "first_id": "data_exfiltration",
          "second_id": "data_collection_operations",
          "third_id": "data_acquisition"
        },
        {
          "api_name": "io.IOBase.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "tqdm.tqdm.close",
          "id": "log_info",
          "description": "Logs informational message",
          "first_id": "data_exfiltration",
          "second_id": "data_collection_operations",
          "third_id": "data_acquisition"
        }
      ],
      "contextual_code": "if username is None:\n    username = os.environ.get(\"EARTHDATA_USERNAME\", None)\nif password is None:\n    password = os.environ.get(\"EARTHDATA_PASSWORD\", None)\n\nwith requests.Session() as session:\n    r1 = session.request(\"get\", url, stream=True)\n    r = session.get(r1.url, auth=(username, password), stream=True)\n    if r.status_code == 200:\n        total_size = int(r.headers.get(\"content-length\", 0))\n        block_size = 1024\n        if not filename:\n            from urllib.parse import urlparse\n            parsed_url = urlparse(url)\n            filename = parsed_url.path.split(\"/\")[-1]\n        progress_bar = tqdm(total=total_size, unit=\"B\", unit_scale=True)\n        with open(filename, \"wb\") as file:\n            for data in r.iter_content(block_size):\n                progress_bar.update(len(data))\n                file.write(data)\n        progress_bar.close()"
    }
  }
]