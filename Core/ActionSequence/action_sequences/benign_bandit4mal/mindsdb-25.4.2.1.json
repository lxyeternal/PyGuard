[
  {
    "metadata": {
      "package_name": "mindsdb-25.4.2.1",
      "total_matches": 3,
      "processing_date": "2025-05-18 01:49:39"
    }
  },
  {
    "pyfile": "initialize.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/mindsdb-25.4.2.1/mindsdb-25.4.2.1/mindsdb/api/http/initialize.py",
    "line_number": "312",
    "type_description": "B820:get",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "311\t        try:\n312\t            email_confirmed = int(request.headers.get('email-confirmed', 1))\n313\t        except Exception:",
    "code_snippet": "@app.before_request\n    def before_request():\n        logger.debug(f\"HTTP {request.method}: {request.path}\")\n        ctx.set_default()\n        config = Config()\n\n        # region routes where auth is required\n        if (\n            config['auth']['http_auth_enabled'] is True\n            and any(request.path.startswith(f'/api{ns.path}') for ns in protected_namespaces)\n            and check_auth() is False\n        ):\n            return http_error(\n                HTTPStatus.UNAUTHORIZED, 'Unauthorized',\n                'Authorization is required to complete the request'\n            )\n        # endregion\n\n        company_id = request.headers.get('company-id')\n        user_class = request.headers.get('user-class')\n\n        try:\n            email_confirmed = int(request.headers.get('email-confirmed', 1))\n        except Exception:\n            email_confirmed = 1\n\n        try:\n            user_id = int(request.headers.get('user-id', 0))\n        except Exception:\n            user_id = 0\n\n        try:\n            session_id = request.cookies.get('session')\n        except Exception:\n            session_id = \"unknown\"\n\n        if company_id is not None:\n            try:\n                company_id = int(company_id)\n            except Exception as e:\n                logger.error(\n                    f\"Cloud not parse company id: {company_id} | exception: {e}\"\n                )\n                company_id = None\n\n        if user_class is not None:\n            try:\n                user_class = int(user_class)\n            except Exception as e:\n                logger.error(\n                    f\"Cloud not parse user_class: {user_class} | exception: {e}\"\n                )\n                user_class = 0\n        else:\n            user_class = 0\n\n        ctx.user_id = user_id\n        ctx.session_id = session_id\n        ctx.company_id = company_id\n        ctx.user_class = user_class\n        ctx.email_confirmed = email_confirmed",
    "pattern_analysis": {
      "api_sequence": [
        "logger.debug",
        "ctx.set_default",
        "Config",
        "request.method",
        "request.path",
        "request.headers.get",
        "request.headers.get",
        "request.headers.get",
        "int",
        "request.headers.get",
        "int",
        "request.cookies.get",
        "int",
        "logger.error",
        "int",
        "logger.error",
        "int"
      ],
      "api_sequence_with_args": [
        "logger.debug(f\"HTTP {request.method}: {request.path}\")",
        "ctx.set_default()",
        "Config()",
        "request.method",
        "request.path",
        "request.headers.get('company-id')",
        "request.headers.get('user-class')",
        "request.headers.get('email-confirmed', 1)",
        "int(request.headers.get('email-confirmed', 1))",
        "request.headers.get('user-id', 0)",
        "int(request.headers.get('user-id', 0))",
        "request.cookies.get('session')",
        "int(company_id)",
        "logger.error(f\"Cloud not parse company id: {company_id} | exception: {e}\")",
        "int(user_class)",
        "logger.error(f\"Cloud not parse user_class: {user_class} | exception: {e}\")",
        "int(user_class)"
      ],
      "mapped_sequence": [
        {
          "api_name": "logger.debug",
          "id": "log_info",
          "description": "Logs informational message",
          "first_id": "data_exfiltration",
          "second_id": "data_collection_operations",
          "third_id": "data_acquisition"
        },
        {
          "api_name": "ctx.set_default",
          "id": "set_builtin_attr",
          "description": "Sets attribute on builtins object",
          "first_id": "persistence_stealth",
          "second_id": "stealth_techniques",
          "third_id": "warning_disabling"
        },
        {
          "api_name": "Config",
          "id": "init_config_class",
          "description": "Initializes Config class with provided arguments",
          "first_id": "code_execution",
          "second_id": "object_initialization",
          "third_id": "class_initialization"
        },
        {
          "api_name": "request.method",
          "id": "read_user_input",
          "description": "Reads user input from standard input",
          "first_id": "persistence_stealth",
          "second_id": "user_interaction",
          "third_id": "interface_control"
        },
        {
          "api_name": "request.path",
          "id": "read_user_input",
          "description": "Reads user input from standard input",
          "first_id": "persistence_stealth",
          "second_id": "user_interaction",
          "third_id": "interface_control"
        },
        {
          "api_name": "request.headers.get",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "request.headers.get",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "request.headers.get",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "int",
          "id": "convert_int_to_bytes",
          "description": "Converts integer to bytes with specified length and byte order",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "request.headers.get",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "int",
          "id": "convert_int_to_bytes",
          "description": "Converts integer to bytes with specified length and byte order",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "request.cookies.get",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "int",
          "id": "convert_int_to_bytes",
          "description": "Converts integer to bytes with specified length and byte order",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "logger.error",
          "id": "log_error",
          "description": "Logs error message",
          "first_id": "data_exfiltration",
          "second_id": "data_collection_operations",
          "third_id": "data_acquisition"
        },
        {
          "api_name": "int",
          "id": "convert_int_to_bytes",
          "description": "Converts integer to bytes with specified length and byte order",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "logger.error",
          "id": "log_error",
          "description": "Logs error message",
          "first_id": "data_exfiltration",
          "second_id": "data_collection_operations",
          "third_id": "data_acquisition"
        },
        {
          "api_name": "int",
          "id": "convert_int_to_bytes",
          "description": "Converts integer to bytes with specified length and byte order",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        }
      ],
      "contextual_code": "@app.before_request\n    def before_request():\n        logger.debug(f\"HTTP {request.method}: {request.path}\")\n        ctx.set_default()\n        config = Config()\n\n        company_id = request.headers.get('company-id')\n        user_class = request.headers.get('user-class')\n\n        try:\n            email_confirmed = int(request.headers.get('email-confirmed', 1))\n        except Exception:\n            email_confirmed = 1\n\n        try:\n            user_id = int(request.headers.get('user-id', 0))\n        except Exception:\n            user_id = 0\n\n        try:\n            session_id = request.cookies.get('session')\n        except Exception:\n            session_id = \"unknown\"\n\n        if company_id is not None:\n            try:\n                company_id = int(company_id)\n            except Exception as e:\n                logger.error(\n                    f\"Cloud not parse company id: {company_id} | exception: {e}\"\n                )\n                company_id = None\n\n        if user_class is not None:\n            try:\n                user_class = int(user_class)\n            except Exception as e:\n                logger.error(\n                    f\"Cloud not parse user_class: {user_class} | exception: {e}\"\n                )\n                user_class = 0\n        else:\n            user_class = 0"
    }
  },
  {
    "pyfile": "google_user_oauth_utilities.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/mindsdb-25.4.2.1/mindsdb-25.4.2.1/mindsdb/integrations/utilities/handlers/auth_utilities/google/google_user_oauth_utilities.py",
    "line_number": "57",
    "type_description": "B820:get",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "56\t        if self.credentials_url:\n57\t            response = requests.get(self.credentials_url)\n58\t            if response.status_code == 200:",
    "code_snippet": "import requests\nfrom pathlib import Path\nimport json\nfrom mindsdb.utilities import log\nlogger = log.getLogger(__name__)\n\nclass GoogleUserOAuth2Manager:\n    def _download_oauth_user_info(self):\n        # if credentials_url is set, attempt to download the contents of the files\n        # this will be given preference over credentials_file\n        if self.credentials_url:\n            response = requests.get(self.credentials_url)\n            if response.status_code == 200:\n                return response.json()\n            else:\n                logger.error(\"Failed to get credentials from URL\", response.status_code)\n\n        # if credentials_file is set, attempt to read the contents of the file\n        if self.credentials_file:\n            path = Path(self.credentials_file).expanduser()\n            if path.exists():\n                with open(path, 'r') as f:\n                    return json.load(f)\n            else:\n                logger.error(\"Credentials file does not exist\")\n\n        raise ValueError('OAuth2 credentials could not be found')",
    "pattern_analysis": {
      "api_sequence": [
        "requests.get",
        "requests.models.Response.status_code",
        "requests.models.Response.json",
        "logger.error",
        "pathlib.Path.expanduser",
        "pathlib.Path.exists",
        "builtins.open",
        "json.load",
        "logger.error"
      ],
      "api_sequence_with_args": [
        "requests.get(self.credentials_url)",
        "response.status_code",
        "response.json()",
        "logger.error(\"Failed to get credentials from URL\", response.status_code)",
        "Path(self.credentials_file).expanduser()",
        "path.exists()",
        "open(path, 'r')",
        "json.load(f)",
        "logger.error(\"Credentials file does not exist\")"
      ],
      "mapped_sequence": [
        {
          "api_name": "requests.get",
          "id": "send_http_get",
          "description": "Sends HTTP GET request with parameters and timeout",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "requests.models.Response.status_code",
          "id": "get_http_status",
          "description": "Retrieves HTTP response status code",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "requests.models.Response.json",
          "id": "deserialize_json_response",
          "description": "Deserializes JSON response body to Python object",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "logger.error",
          "id": "log_error",
          "description": "Logs error message",
          "first_id": "data_exfiltration",
          "second_id": "data_collection_operations",
          "third_id": "data_acquisition"
        },
        {
          "api_name": "pathlib.Path.expanduser",
          "id": "path_special_operations",
          "description": "Special path operations (home directory expansion, temporary directory path, executable path, directory tree generation)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "pathlib.Path.exists",
          "id": "check_path_exists",
          "description": "Checks if specified path exists in filesystem",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_checking"
        },
        {
          "api_name": "builtins.open",
          "id": "basic_read_operations",
          "description": "ic file opening operations for reading (normal reading, binary reading)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "json.load",
          "id": "deserialize_from_json",
          "description": "Deserializes JSON string to Python object",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "specific_format_encoding"
        },
        {
          "api_name": "logger.error",
          "id": "log_error",
          "description": "Logs error message",
          "first_id": "data_exfiltration",
          "second_id": "data_collection_operations",
          "third_id": "data_acquisition"
        }
      ],
      "contextual_code": "class GoogleUserOAuth2Manager:\n    def _download_oauth_user_info(self):\n        if self.credentials_url:\n            response = requests.get(self.credentials_url)\n            if response.status_code == 200:\n                return response.json()\n            else:\n                logger.error(\"Failed to get credentials from URL\", response.status_code)\n\n        if self.credentials_file:\n            path = Path(self.credentials_file).expanduser()\n            if path.exists():\n                with open(path, 'r') as f:\n                    return json.load(f)\n            else:\n                logger.error(\"Credentials file does not exist\")"
    }
  },
  {
    "pyfile": "dockerhub.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/mindsdb-25.4.2.1/mindsdb-25.4.2.1/mindsdb/integrations/handlers/dockerhub_handler/dockerhub.py",
    "line_number": "47",
    "type_description": "B822:request",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "46\t        url = f'{self.docker_hub_base_endpoint}namespaces/{namespace}/repositories/{repo}/tags/{tag}'\n47\t        return self.make_request(url)\n48",
    "code_snippet": "import json\nimport requests\n\n\nclass DockerHubClient:\n    def __init__(self):\n        self.auth_token = None\n        self.docker_hub_base_endpoint = \"https://hub.docker.com/v2/\"\n\n    def make_request(self, url, method='GET', data=None):\n        if method not in ['GET', 'POST']:\n            raise ValueError('Invalid HTTP request method')\n        headers = {'Content-type': 'application/json'}\n        if self.auth_token:\n            headers['Authorization'] = 'JWT ' + self.auth_token\n        request_method = getattr(requests, method.lower())\n        if data and len(data) > 0:\n            data = json.dumps(data)\n            resp = request_method(url, data, headers=headers)\n        else:\n            resp = request_method(url, headers=headers)\n        content = {}\n        if resp.status_code == 200:\n            content = {'content': json.loads(resp.content.decode()), 'code': 200}\n        else:\n            content = {'content': {}, 'code': resp.status_code, 'error': resp.text}\n        return content\n\n    def get_repo_tag(self, namespace, repo, tag):\n        url = f'{self.docker_hub_base_endpoint}namespaces/{namespace}/repositories/{repo}/tags/{tag}'\n        return self.make_request(url)\n",
    "pattern_analysis": {
      "api_sequence": [
        "requests.get",
        "requests.post",
        "json.dumps",
        "requests.get",
        "requests.post",
        "json.loads",
        "resp.content.decode"
      ],
      "api_sequence_with_args": [
        "requests.get(url, headers=headers)",
        "requests.post(url, data, headers=headers)",
        "json.dumps(data)",
        "requests.get(url, headers=headers)",
        "requests.post(url, data, headers=headers)",
        "json.loads(resp.content.decode())",
        "resp.content.decode()"
      ],
      "mapped_sequence": [
        {
          "api_name": "requests.get",
          "id": "send_http_get",
          "description": "Sends HTTP GET request with parameters and timeout",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "requests.post",
          "id": "send_http_post",
          "description": "Sends HTTP POST request with data and parameters",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "json.dumps",
          "id": "serialize_to_json",
          "description": "Serializes Python object to JSON string",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "specific_format_encoding"
        },
        {
          "api_name": "requests.get",
          "id": "send_http_get",
          "description": "Sends HTTP GET request with parameters and timeout",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "requests.post",
          "id": "send_http_post",
          "description": "Sends HTTP POST request with data and parameters",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "json.loads",
          "id": "deserialize_from_json",
          "description": "Deserializes JSON string to Python object",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "specific_format_encoding"
        },
        {
          "api_name": "resp.content.decode",
          "id": "decode_bytes_default",
          "description": "Decodes bytes using default codec",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        }
      ],
      "contextual_code": "import json\nimport requests\n\nclass DockerHubClient:\n    def __init__(self):\n        self.auth_token = None\n        self.docker_hub_base_endpoint = \"https://hub.docker.com/v2/\"\n\n    def make_request(self, url, method='GET', data=None):\n        if method not in ['GET', 'POST']:\n            raise ValueError('Invalid HTTP request method')\n        headers = {'Content-type': 'application/json'}\n        if self.auth_token:\n            headers['Authorization'] = 'JWT ' + self.auth_token\n        request_method = getattr(requests, method.lower())\n        if data and len(data) > 0:\n            data = json.dumps(data)\n            resp = request_method(url, data, headers=headers)\n        else:\n            resp = request_method(url, headers=headers)\n        content = {}\n        if resp.status_code == 200:\n            content = {'content': json.loads(resp.content.decode()), 'code': 200}\n        else:\n            content = {'content': {}, 'code': resp.status_code, 'error': resp.text}\n        return content\n\n    def get_repo_tag(self, namespace, repo, tag):\n        url = f'{self.docker_hub_base_endpoint}namespaces/{namespace}/repositories/{repo}/tags/{tag}'\n        return self.make_request(url)\n"
    }
  }
]