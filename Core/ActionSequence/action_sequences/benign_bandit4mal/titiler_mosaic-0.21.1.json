[
  {
    "metadata": {
      "package_name": "titiler_mosaic-0.21.1",
      "total_matches": 1,
      "processing_date": "2025-05-18 01:49:39"
    }
  },
  {
    "pyfile": "factory.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/titiler_mosaic-0.21.1/titiler_mosaic-0.21.1/titiler/mosaic/factory.py",
    "line_number": "720",
    "type_description": "B820:get",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "719\n720\t        @self.router.get(\"/{tileMatrixSetId}/map\", response_class=HTMLResponse)\n721\t        def map_viewer(",
    "code_snippet": "def map_viewer(self):  # noqa: C901\n    \"\"\"Register /map endpoint.\"\"\"\n\n    @self.router.get(\"/{tileMatrixSetId}/map\", response_class=HTMLResponse)\n    def map_viewer(\n        request: Request,\n        tileMatrixSetId: Annotated[\n            Literal[tuple(self.supported_tms.list())],\n            Path(\n                description=\"Identifier selecting one of the TileMatrixSetId supported.\"\n            ),\n        ],\n        tile_format: Annotated[\n            Optional[ImageType],\n            Query(\n                description=\"Default will be automatically defined if the output image needs a mask (png) or not (jpeg).\",\n            ),\n        ] = None,\n        tile_scale: Annotated[\n            int,\n            Query(\n                gt=0, lt=4, description=\"Tile size scale. 1=256x256, 2=512x512...\"\n            ),\n        ] = 1,\n        minzoom: Annotated[\n            Optional[int],\n            Query(description=\"Overwrite default minzoom.\"),\n        ] = None,\n        maxzoom: Annotated[\n            Optional[int],\n            Query(description=\"Overwrite default maxzoom.\"),\n        ] = None,\n        src_path=Depends(self.path_dependency),\n        backend_params=Depends(self.backend_dependency),\n        reader_params=Depends(self.reader_dependency),\n        layer_params=Depends(self.layer_dependency),\n        dataset_params=Depends(self.dataset_dependency),\n        pixel_selection=Depends(self.pixel_selection_dependency),\n        tile_params=Depends(self.tile_dependency),\n        post_process=Depends(self.process_dependency),\n        colormap=Depends(self.colormap_dependency),\n        render_params=Depends(self.render_dependency),\n        env=Depends(self.environment_dependency),\n    ):\n        \"\"\"Return TileJSON document for a dataset.\"\"\"\n        tilejson_url = self.url_for(\n            request,\n            \"tilejson\",\n            tileMatrixSetId=tileMatrixSetId,\n        )\n        if request.query_params._list:\n            tilejson_url += f\"?{urlencode(request.query_params._list, doseq=True)}\"\n\n        tms = self.supported_tms.get(tileMatrixSetId)\n        return self.templates.TemplateResponse(\n            request,\n            name=\"map.html\",\n            context={\n                \"tilejson_endpoint\": tilejson_url,\n                \"tms\": tms,\n                \"resolutions\": [matrix.cellSize for matrix in tms],\n            },\n            media_type=\"text/html\",\n        )",
    "pattern_analysis": {
      "api_sequence": [
        "self.url_for",
        "urlencode",
        "self.supported_tms.get",
        "self.templates.TemplateResponse"
      ],
      "api_sequence_with_args": [
        "self.url_for(request, \"tilejson\", tileMatrixSetId=tileMatrixSetId)",
        "urlencode(request.query_params._list, doseq=True)",
        "self.supported_tms.get(tileMatrixSetId)",
        "self.templates.TemplateResponse(request, name=\"map.html\", context={...}, media_type=\"text/html\")"
      ],
      "mapped_sequence": [
        {
          "api_name": "urlencode",
          "id": "encode_url_query",
          "description": "Encodes mapping object to URL query string",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_configuration"
        }
      ],
      "contextual_code": "def map_viewer(self):\n    @self.router.get(\"/{tileMatrixSetId}/map\", response_class=HTMLResponse)\n    def map_viewer(\n        request: Request,\n        tileMatrixSetId: Annotated[\n            Literal[tuple(self.supported_tms.list())],\n            Path(description=\"Identifier selecting one of the TileMatrixSetId supported.\"),\n        ],\n        tile_format: Annotated[\n            Optional[ImageType],\n            Query(description=\"Default will be automatically defined if the output image needs a mask (png) or not (jpeg).\"),\n        ] = None,\n        tile_scale: Annotated[\n            int,\n            Query(gt=0, lt=4, description=\"Tile size scale. 1=256x256, 2=512x512...\"),\n        ] = 1,\n        minzoom: Annotated[\n            Optional[int],\n            Query(description=\"Overwrite default minzoom.\"),\n        ] = None,\n        maxzoom: Annotated[\n            Optional[int],\n            Query(description=\"Overwrite default maxzoom.\"),\n        ] = None,\n        src_path=Depends(self.path_dependency),\n        backend_params=Depends(self.backend_dependency),\n        reader_params=Depends(self.reader_dependency),\n        layer_params=Depends(self.layer_dependency),\n        dataset_params=Depends(self.dataset_dependency),\n        pixel_selection=Depends(self.pixel_selection_dependency),\n        tile_params=Depends(self.tile_dependency),\n        post_process=Depends(self.process_dependency),\n        colormap=Depends(self.colormap_dependency),\n        render_params=Depends(self.render_dependency),\n        env=Depends(self.environment_dependency),\n    ):\n        tilejson_url = self.url_for(\n            request,\n            \"tilejson\",\n            tileMatrixSetId=tileMatrixSetId,\n        )\n        if request.query_params._list:\n            tilejson_url += f\"?{urlencode(request.query_params._list, doseq=True)}\"\n\n        tms = self.supported_tms.get(tileMatrixSetId)\n        return self.templates.TemplateResponse(\n            request,\n            name=\"map.html\",\n            context={\n                \"tilejson_endpoint\": tilejson_url,\n                \"tms\": tms,\n                \"resolutions\": [matrix.cellSize for matrix in tms],\n            },\n            media_type=\"text/html\",\n        )"
    }
  }
]