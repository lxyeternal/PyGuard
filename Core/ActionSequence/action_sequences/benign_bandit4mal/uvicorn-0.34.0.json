[
  {
    "metadata": {
      "package_name": "uvicorn-0.34.0",
      "total_matches": 3,
      "processing_date": "2025-05-18 01:49:40"
    }
  },
  {
    "pyfile": "test_websocket.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/uvicorn-0.34.0/uvicorn-0.34.0/tests/protocols/test_websocket.py",
    "line_number": "454",
    "type_description": "B805:send",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "453\t    async def app(scope: Scope, receive: ASGIReceiveCallable, send: ASGISendCallable):\n454\t        await send({\"type\": \"websocket.accept\"})\n455\t        return 123",
    "code_snippet": "async def test_asgi_return_value(ws_protocol_cls: WSProtocol, http_protocol_cls: HTTPProtocol, unused_tcp_port: int):\n    \"\"\"\n    The ASGI callable should return 'None'. If it doesn't, make sure that\n    the connection is closed with an error condition.\n    \"\"\"\n\n    async def app(scope: Scope, receive: ASGIReceiveCallable, send: ASGISendCallable):\n        await send({\"type\": \"websocket.accept\"})\n        return 123\n\n    config = Config(app=app, ws=ws_protocol_cls, http=http_protocol_cls, lifespan=\"off\", port=unused_tcp_port)\n    async with run_server(config):\n        async with websockets.client.connect(f\"ws://127.0.0.1:{unused_tcp_port}\") as websocket:\n            with pytest.raises(websockets.exceptions.ConnectionClosed):\n                _ = await websocket.recv()\n        assert websocket.close_code == 1006",
    "pattern_analysis": {
      "api_sequence": [
        "websockets.client.connect",
        "websocket.recv"
      ],
      "api_sequence_with_args": [
        "websockets.client.connect(f\"ws://127.0.0.1:{unused_tcp_port}\")",
        "websocket.recv()"
      ],
      "mapped_sequence": [
        {
          "api_name": "websockets.client.connect",
          "id": "establish_tcp_connection",
          "description": "Establishes TCP connection to specified address",
          "first_id": "basic_network_operations",
          "second_id": "socket_communication",
          "third_id": "connection_management"
        },
        {
          "api_name": "websocket.recv",
          "id": "receive_socket_data",
          "description": "Receives data from socket connection",
          "first_id": "basic_network_operations",
          "second_id": "socket_communication",
          "third_id": "data_transmission"
        }
      ],
      "contextual_code": "async with websockets.client.connect(f\"ws://127.0.0.1:{unused_tcp_port}\") as websocket:\n    with pytest.raises(websockets.exceptions.ConnectionClosed):\n        _ = await websocket.recv()"
    }
  },
  {
    "pyfile": "test_websocket.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/uvicorn-0.34.0/uvicorn-0.34.0/tests/protocols/test_websocket.py",
    "line_number": "1164",
    "type_description": "B805:send",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "1163\t        assert message[\"type\"] == \"lifespan.shutdown\"\n1164\t        await send({\"type\": \"lifespan.shutdown.complete\"})\n1165",
    "code_snippet": "async def lifespan_app(scope: Scope, receive: ASGIReceiveCallable, send: ASGISendCallable):\n    message = await receive()\n    assert message[\"type\"] == \"lifespan.startup\" and \"state\" in scope\n    scope[\"state\"][\"a\"] = 123\n    scope[\"state\"][\"b\"] = [1]\n    await send({\"type\": \"lifespan.startup.complete\"})\n    message = await receive()\n    assert message[\"type\"] == \"lifespan.shutdown\"\n    await send({\"type\": \"lifespan.shutdown.complete\"})",
    "pattern_analysis": {
      "api_sequence": [],
      "api_sequence_with_args": [],
      "mapped_sequence": [],
      "contextual_code": "async def lifespan_app(scope: Scope, receive: ASGIReceiveCallable, send: ASGISendCallable):\n    message = await receive()\n    assert message[\"type\"] == \"lifespan.startup\" and \"state\" in scope\n    scope[\"state\"][\"a\"] = 123\n    scope[\"state\"][\"b\"] = [1]\n    await send({\"type\": \"lifespan.startup.complete\"})\n    message = await receive()\n    assert message[\"type\"] == \"lifespan.shutdown\"\n    await send({\"type\": \"lifespan.shutdown.complete\"})"
    }
  },
  {
    "pyfile": "h11_impl.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/uvicorn-0.34.0/uvicorn-0.34.0/uvicorn/protocols/http/h11_impl.py",
    "line_number": "298",
    "type_description": "B831:send",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "297\t        event = h11.Response(status_code=400, headers=headers, reason=reason)\n298\t        output = self.conn.send(event)\n299\t        self.transport.write(output)",
    "code_snippet": "def send_400_response(self, msg: str) -> None:\n    reason = STATUS_PHRASES[400]\n    headers: list[tuple[bytes, bytes]] = [\n        (b\"content-type\", b\"text/plain; charset=utf-8\"),\n        (b\"connection\", b\"close\"),\n    ]\n    event = h11.Response(status_code=400, headers=headers, reason=reason)\n    output = self.conn.send(event)\n    self.transport.write(output)\n\n    output = self.conn.send(event=h11.Data(data=msg.encode(\"ascii\")))\n    self.transport.write(output)\n\n    output = self.conn.send(event=h11.EndOfMessage())\n    self.transport.write(output)\n\n    self.transport.close()",
    "pattern_analysis": {
      "api_sequence": [
        "h11.Response",
        "self.conn.send",
        "self.transport.write",
        "h11.Data",
        "self.conn.send",
        "self.transport.write",
        "h11.EndOfMessage",
        "self.conn.send",
        "self.transport.write",
        "self.transport.close"
      ],
      "api_sequence_with_args": [
        "h11.Response(status_code=400, headers=headers, reason=reason)",
        "self.conn.send(event)",
        "self.transport.write(output)",
        "h11.Data(data=msg.encode(\"ascii\"))",
        "self.conn.send(event=h11.Data(data=msg.encode(\"ascii\")))",
        "self.transport.write(output)",
        "h11.EndOfMessage()",
        "self.conn.send(event=h11.EndOfMessage())",
        "self.transport.write(output)",
        "self.transport.close()"
      ],
      "mapped_sequence": [
        {
          "api_name": "h11.Response",
          "id": "create_http_response_object",
          "description": "Creates HTTP response object (no direct match in taxonomy, closest is HTTP response handling)",
          "first_id": "",
          "second_id": "",
          "third_id": ""
        },
        {
          "api_name": "self.conn.send",
          "id": "send_http_custom",
          "description": "Sends HTTP request with specified method and parameters",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "self.transport.write",
          "id": "send_socket_data",
          "description": "Sends data over socket connection",
          "first_id": "basic_network_operations",
          "second_id": "socket_communication",
          "third_id": "data_transmission"
        },
        {
          "api_name": "h11.Data",
          "id": "create_http_response_object",
          "description": "Creates HTTP response object (no direct match in taxonomy, closest is HTTP response handling)",
          "first_id": "",
          "second_id": "",
          "third_id": ""
        },
        {
          "api_name": "self.conn.send",
          "id": "send_http_custom",
          "description": "Sends HTTP request with specified method and parameters",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "self.transport.write",
          "id": "send_socket_data",
          "description": "Sends data over socket connection",
          "first_id": "basic_network_operations",
          "second_id": "socket_communication",
          "third_id": "data_transmission"
        },
        {
          "api_name": "h11.EndOfMessage",
          "id": "create_http_response_object",
          "description": "Creates HTTP response object (no direct match in taxonomy, closest is HTTP response handling)",
          "first_id": "",
          "second_id": "",
          "third_id": ""
        },
        {
          "api_name": "self.conn.send",
          "id": "send_http_custom",
          "description": "Sends HTTP request with specified method and parameters",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "self.transport.write",
          "id": "send_socket_data",
          "description": "Sends data over socket connection",
          "first_id": "basic_network_operations",
          "second_id": "socket_communication",
          "third_id": "data_transmission"
        },
        {
          "api_name": "self.transport.close",
          "id": "close_socket",
          "description": "Closes the socket connection",
          "first_id": "basic_network_operations",
          "second_id": "socket_communication",
          "third_id": "connection_management"
        }
      ],
      "contextual_code": "def send_400_response(self, msg: str) -> None:\n    reason = STATUS_PHRASES[400]\n    headers: list[tuple[bytes, bytes]] = [\n        (b\"content-type\", b\"text/plain; charset=utf-8\"),\n        (b\"connection\", b\"close\"),\n    ]\n    event = h11.Response(status_code=400, headers=headers, reason=reason)\n    output = self.conn.send(event)\n    self.transport.write(output)\n\n    output = self.conn.send(event=h11.Data(data=msg.encode(\"ascii\")))\n    self.transport.write(output)\n\n    output = self.conn.send(event=h11.EndOfMessage())\n    self.transport.write(output)\n\n    self.transport.close()"
    }
  }
]