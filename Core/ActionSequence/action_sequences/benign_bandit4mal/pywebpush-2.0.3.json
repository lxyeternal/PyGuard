[
  {
    "metadata": {
      "package_name": "pywebpush-2.0.3",
      "total_matches": 1,
      "processing_date": "2025-05-18 01:49:39"
    }
  },
  {
    "pyfile": "test_webpush.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/pywebpush-2.0.3/pywebpush-2.0.3/pywebpush/tests/test_webpush.py",
    "line_number": "384",
    "type_description": "B820:get",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "383\t        await WebPusher(subscription_info).send_async(\"\", headers)\n384\t        assert subscription_info.get(\"endpoint\") == mock_post.call_args[0][0]\n385\t        pheaders = mock_post.call_args[1].get(\"headers\")",
    "code_snippet": "@patch(\"aiohttp.ClientSession.post\", new_callable=AsyncMock)\nasync def test_send_empty(self, mock_post):\n    subscription_info = self._gen_subscription_info()\n    headers = {\"Crypto-Key\": \"pre-existing\", \"Authentication\": \"bear vapid\"}\n    await WebPusher(subscription_info).send_async(\"\", headers)\n    assert subscription_info.get(\"endpoint\") == mock_post.call_args[0][0]\n    pheaders = mock_post.call_args[1].get(\"headers\")\n    assert pheaders.get(\"ttl\") == \"0\"\n    assert \"encryption\" not in pheaders\n    assert pheaders.get(\"AUTHENTICATION\") == headers.get(\"Authentication\")\n    ckey = pheaders.get(\"crypto-key\")\n    assert \"pre-existing\" in ckey\n",
    "pattern_analysis": {
      "api_sequence": [
        "self._gen_subscription_info",
        "WebPusher.send_async",
        "subscription_info.get",
        "mock_post.call_args",
        "mock_post.call_args",
        "mock_post.call_args",
        "pheaders.get",
        "pheaders.get",
        "pheaders.get"
      ],
      "api_sequence_with_args": [
        "self._gen_subscription_info()",
        "WebPusher(subscription_info).send_async(\"\", headers)",
        "subscription_info.get(\"endpoint\")",
        "mock_post.call_args[0][0]",
        "mock_post.call_args[1].get(\"headers\")",
        "pheaders.get(\"ttl\")",
        "pheaders.get(\"encryption\")",
        "pheaders.get(\"AUTHENTICATION\")",
        "pheaders.get(\"crypto-key\")"
      ],
      "mapped_sequence": [
        {
          "api_name": "self._gen_subscription_info",
          "id": "init_parent_class",
          "description": "Initializes parent class with provided arguments",
          "first_id": "code_execution",
          "second_id": "object_initialization",
          "third_id": "class_initialization"
        },
        {
          "api_name": "WebPusher.send_async",
          "id": "send_http_post",
          "description": "Sends HTTP POST request with data and parameters",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "subscription_info.get",
          "id": "deserialize_from_json",
          "description": "Deserializes JSON string to Python object",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "specific_format_encoding"
        },
        {
          "api_name": "mock_post.call_args",
          "id": "send_http_post",
          "description": "Sends HTTP POST request with data and parameters",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "mock_post.call_args",
          "id": "send_http_post",
          "description": "Sends HTTP POST request with data and parameters",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "mock_post.call_args",
          "id": "send_http_post",
          "description": "Sends HTTP POST request with data and parameters",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "pheaders.get",
          "id": "deserialize_from_json",
          "description": "Deserializes JSON string to Python object",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "specific_format_encoding"
        },
        {
          "api_name": "pheaders.get",
          "id": "deserialize_from_json",
          "description": "Deserializes JSON string to Python object",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "specific_format_encoding"
        },
        {
          "api_name": "pheaders.get",
          "id": "deserialize_from_json",
          "description": "Deserializes JSON string to Python object",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "specific_format_encoding"
        }
      ],
      "contextual_code": "@patch(\"aiohttp.ClientSession.post\", new_callable=AsyncMock)\nasync def test_send_empty(self, mock_post):\n    subscription_info = self._gen_subscription_info()\n    headers = {\"Crypto-Key\": \"pre-existing\", \"Authentication\": \"bear vapid\"}\n    await WebPusher(subscription_info).send_async(\"\", headers)\n    assert subscription_info.get(\"endpoint\") == mock_post.call_args[0][0]\n    pheaders = mock_post.call_args[1].get(\"headers\")\n    assert pheaders.get(\"ttl\") == \"0\"\n    assert \"encryption\" not in pheaders\n    assert pheaders.get(\"AUTHENTICATION\") == headers.get(\"Authentication\")\n    ckey = pheaders.get(\"crypto-key\")\n    assert \"pre-existing\" in ckey"
    }
  }
]