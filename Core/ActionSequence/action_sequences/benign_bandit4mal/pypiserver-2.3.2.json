[
  {
    "metadata": {
      "package_name": "pypiserver-2.3.2",
      "total_matches": 1,
      "processing_date": "2025-05-18 01:49:39"
    }
  },
  {
    "pyfile": "bottle.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/pypiserver-2.3.2/pypiserver-2.3.2/pypiserver/bottle.py",
    "line_number": "1211",
    "type_description": "B801:b64decode",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "1210\t                if _lscmp(sig, base64.b64encode(hash)):\n1211\t                    dst = pickle.loads(base64.b64decode(msg))\n1212\t                    if dst and dst[0] == key:",
    "code_snippet": "def get_cookie(self, key, default=None, secret=None, digestmod=hashlib.sha256):\n    \"\"\" Return the content of a cookie. To read a `Signed Cookie`, the\n        `secret` must match the one used to create the cookie (see\n        :meth:`Response.set_cookie <BaseResponse.set_cookie>`). If anything goes wrong (missing\n        cookie or wrong signature), return a default value. \"\"\"\n    value = self.cookies.get(key)\n    if secret:\n        # See BaseResponse.set_cookie for details on signed cookies.\n        if value and value.startswith('!') and '?' in value:\n            sig, msg = map(tob, value[1:].split('?', 1))\n            hash = hmac.new(tob(secret), msg, digestmod=digestmod).digest()\n            if _lscmp(sig, base64.b64encode(hash)):\n                dst = pickle.loads(base64.b64decode(msg))\n                if dst and dst[0] == key:\n                    return dst[1]\n        return default\n    return value or default",
    "pattern_analysis": {
      "api_sequence": [
        "self.cookies.get",
        "value.startswith",
        "tob",
        "value.split",
        "tob",
        "hmac.new",
        "hmac.new.digest",
        "base64.b64encode",
        "_lscmp",
        "base64.b64decode",
        "pickle.loads"
      ],
      "api_sequence_with_args": [
        "self.cookies.get(key)",
        "value.startswith('!')",
        "tob(secret)",
        "value[1:].split('?', 1)",
        "tob(secret)",
        "hmac.new(tob(secret), msg, digestmod=digestmod)",
        "hmac.new(tob(secret), msg, digestmod=digestmod).digest()",
        "base64.b64encode(hash)",
        "_lscmp(sig, base64.b64encode(hash))",
        "base64.b64decode(msg)",
        "pickle.loads(base64.b64decode(msg))"
      ],
      "mapped_sequence": [
        {
          "api_name": "self.cookies.get",
          "id": "get_registry_value",
          "description": "Retrieves value and data type for specified registry value",
          "first_id": "system_operations",
          "second_id": "registry_operations",
          "third_id": "registry_modification"
        },
        {
          "api_name": "value.startswith",
          "id": "path_string_operations",
          "description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "tob",
          "id": "encode_string_to_bytes",
          "description": "Encodes string to bytes using default encoding",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "value.split",
          "id": "path_string_operations",
          "description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "tob",
          "id": "encode_string_to_bytes",
          "description": "Encodes string to bytes using default encoding",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "hmac.new",
          "id": "create_sha256_hash",
          "description": "Creates SHA-256 hash object from encoded string",
          "first_id": "encryption_hashing",
          "second_id": "hash_calculation",
          "third_id": "hash_object_creation"
        },
        {
          "api_name": "hmac.new.digest",
          "id": "get_sha256_digest",
          "description": "Returns hexadecimal digest of SHA-256 hash",
          "first_id": "encryption_hashing",
          "second_id": "hash_calculation",
          "third_id": "hash_value_retrieval"
        },
        {
          "api_name": "base64.b64encode",
          "id": "encode_bytes_to_base64",
          "description": "Encodes bytes to base64-encoded bytes",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "base_encoding"
        },
        {
          "api_name": "_lscmp",
          "id": "check_instance_type",
          "description": "Checks if object is instance of specified type",
          "first_id": "utility_functions",
          "second_id": "logging_exception_handling",
          "third_id": "exception_checking"
        },
        {
          "api_name": "base64.b64decode",
          "id": "decode_base64_to_bytes",
          "description": "Decodes base64-encoded string to bytes",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "base_encoding"
        },
        {
          "api_name": "pickle.loads",
          "id": "deserialize_from_bytes",
          "description": "Deserializes Python object from bytes",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "specific_format_encoding"
        }
      ],
      "contextual_code": "def get_cookie(self, key, default=None, secret=None, digestmod=hashlib.sha256):\n    value = self.cookies.get(key)\n    if secret:\n        if value and value.startswith('!') and '?' in value:\n            sig, msg = map(tob, value[1:].split('?', 1))\n            hash = hmac.new(tob(secret), msg, digestmod=digestmod).digest()\n            if _lscmp(sig, base64.b64encode(hash)):\n                dst = pickle.loads(base64.b64decode(msg))\n                if dst and dst[0] == key:\n                    return dst[1]\n        return default\n    return value or default"
    }
  }
]