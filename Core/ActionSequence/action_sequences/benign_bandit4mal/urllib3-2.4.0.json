[
  {
    "metadata": {
      "package_name": "urllib3-2.4.0",
      "total_matches": 5,
      "processing_date": "2025-05-18 01:49:40"
    }
  },
  {
    "pyfile": "test_response.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/urllib3-2.4.0/urllib3-2.4.0/test/test_response.py",
    "line_number": "1197",
    "type_description": "B830:read",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "1196\t        resp = HTTPResponse(fp, headers=headers, preload_content=False)\n1197\t        resp.read()\n1198\t        assert resp.length_remaining == 0",
    "code_snippet": "def test_length_after_read(self) -> None:\n    headers = {\"content-length\": \"5\"}\n\n    # Test no defined length\n    fp = BytesIO(b\"12345\")\n    resp = HTTPResponse(fp, preload_content=False)\n    resp.read()\n    assert resp.length_remaining is None\n\n    # Test our update from content-length\n    fp = BytesIO(b\"12345\")\n    resp = HTTPResponse(fp, headers=headers, preload_content=False)\n    resp.read()\n    assert resp.length_remaining == 0\n\n    # Test partial read\n    fp = BytesIO(b\"12345\")\n    resp = HTTPResponse(fp, headers=headers, preload_content=False)\n    data = resp.stream(2)\n    next(data)\n    assert resp.length_remaining == 3",
    "pattern_analysis": {
      "api_sequence": [
        "io.BytesIO",
        "HTTPResponse",
        "HTTPResponse.read",
        "io.BytesIO",
        "HTTPResponse",
        "HTTPResponse.read",
        "io.BytesIO",
        "HTTPResponse",
        "HTTPResponse.stream",
        "next"
      ],
      "api_sequence_with_args": [
        "io.BytesIO(b\"12345\")",
        "HTTPResponse(fp, preload_content=False)",
        "HTTPResponse.read()",
        "io.BytesIO(b\"12345\")",
        "HTTPResponse(fp, headers=headers, preload_content=False)",
        "HTTPResponse.read()",
        "io.BytesIO(b\"12345\")",
        "HTTPResponse(fp, headers=headers, preload_content=False)",
        "HTTPResponse.stream(2)",
        "next(data)"
      ],
      "mapped_sequence": [
        {
          "api_name": "io.BytesIO",
          "id": "create_memory_bytes",
          "description": "Creates in-memory bytes buffer from encoded string",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "HTTPResponse",
          "id": "init_parent_class",
          "description": "Initializes parent class with provided arguments",
          "first_id": "code_execution",
          "second_id": "object_initialization",
          "third_id": "class_initialization"
        },
        {
          "api_name": "HTTPResponse.read",
          "id": "read_response_body",
          "description": "Reads response body from HTTP response",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "io.BytesIO",
          "id": "create_memory_bytes",
          "description": "Creates in-memory bytes buffer from encoded string",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "HTTPResponse",
          "id": "init_parent_class",
          "description": "Initializes parent class with provided arguments",
          "first_id": "code_execution",
          "second_id": "object_initialization",
          "third_id": "class_initialization"
        },
        {
          "api_name": "HTTPResponse.read",
          "id": "read_response_body",
          "description": "Reads response body from HTTP response",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "io.BytesIO",
          "id": "create_memory_bytes",
          "description": "Creates in-memory bytes buffer from encoded string",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "HTTPResponse",
          "id": "init_parent_class",
          "description": "Initializes parent class with provided arguments",
          "first_id": "code_execution",
          "second_id": "object_initialization",
          "third_id": "class_initialization"
        },
        {
          "api_name": "HTTPResponse.stream",
          "id": "iterate_response_chunks",
          "description": "Iterates over response content in chunks",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "next",
          "id": "iterate_response_chunks",
          "description": "Iterates over response content in chunks",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        }
      ],
      "contextual_code": "from io import BytesIO\nfrom urllib3.response import HTTPResponse\n\ndef test_length_after_read(self) -> None:\n    headers = {\"content-length\": \"5\"}\n\n    # Test no defined length\n    fp = BytesIO(b\"12345\")\n    resp = HTTPResponse(fp, preload_content=False)\n    resp.read()\n    assert resp.length_remaining is None\n\n    # Test our update from content-length\n    fp = BytesIO(b\"12345\")\n    resp = HTTPResponse(fp, headers=headers, preload_content=False)\n    resp.read()\n    assert resp.length_remaining == 0\n\n    # Test partial read\n    fp = BytesIO(b\"12345\")\n    resp = HTTPResponse(fp, headers=headers, preload_content=False)\n    data = resp.stream(2)\n    next(data)\n    assert resp.length_remaining == 3"
    }
  },
  {
    "pyfile": "conftest.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/urllib3-2.4.0/urllib3-2.4.0/test/conftest.py",
    "line_number": "216",
    "type_description": "B830:read",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "215\n216\t    with run_server_and_proxy_in_thread(\n217\t        \"https\", \"127.0.0.1\", tmpdir, ca, proxy_cert, server_cert\n218\t    ) as cfg:",
    "code_snippet": "@pytest.fixture\ndef ipv4_san_proxy_with_server(\n    tmp_path_factory: pytest.TempPathFactory,\n) -> typing.Generator[tuple[ServerConfig, ServerConfig]]:\n    tmpdir = tmp_path_factory.mktemp(\"certs\")\n    ca = trustme.CA()\n    # IP address in Subject Alternative Name\n    proxy_cert = ca.issue_cert(\"127.0.0.1\")\n\n    server_cert = ca.issue_cert(\"localhost\")\n\n    with run_server_and_proxy_in_thread(\n        \"https\", \"127.0.0.1\", tmpdir, ca, proxy_cert, server_cert\n    ) as cfg:\n        yield cfg",
    "pattern_analysis": {
      "api_sequence": [
        "pytest.TempPathFactory.mktemp",
        "trustme.CA",
        "trustme.CA.issue_cert",
        "trustme.CA.issue_cert",
        "run_server_and_proxy_in_thread"
      ],
      "api_sequence_with_args": [
        "pytest.TempPathFactory.mktemp(\"certs\")",
        "trustme.CA()",
        "trustme.CA.issue_cert(\"127.0.0.1\")",
        "trustme.CA.issue_cert(\"localhost\")",
        "run_server_and_proxy_in_thread(\"https\", \"127.0.0.1\", tmpdir, ca, proxy_cert, server_cert)"
      ],
      "mapped_sequence": [
        {
          "api_name": "pytest.TempPathFactory.mktemp",
          "id": "create_temp_dir",
          "description": "Creates temporary directory and returns its path",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "directory_operations"
        }
      ],
      "contextual_code": "@pytest.fixture\ndef ipv4_san_proxy_with_server(\n    tmp_path_factory: pytest.TempPathFactory,\n) -> typing.Generator[tuple[ServerConfig, ServerConfig]]:\n    tmpdir = tmp_path_factory.mktemp(\"certs\")\n    ca = trustme.CA()\n    # IP address in Subject Alternative Name\n    proxy_cert = ca.issue_cert(\"127.0.0.1\")\n\n    server_cert = ca.issue_cert(\"localhost\")\n\n    with run_server_and_proxy_in_thread(\n        \"https\", \"127.0.0.1\", tmpdir, ca, proxy_cert, server_cert\n    ) as cfg:\n        yield cfg"
    }
  },
  {
    "pyfile": "test_socketlevel.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/urllib3-2.4.0/urllib3-2.4.0/test/with_dummyserver/test_socketlevel.py",
    "line_number": "711",
    "type_description": "B807:close",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "710\n711\t            sock.close()  # Close the socket.\n712",
    "code_snippet": "def socket_handler(listener: socket.socket) -> None:\n    sock = listener.accept()[0]\n    # First request.\n    # Pause before responding so the first request times out.\n    buf = b\"\"\n    while not buf.endswith(b\"\\r\\n\\r\\n\"):\n        buf += sock.recv(65536)\n\n    # send unknown http protocol\n    body = \"bad http 0.5 response\"\n    sock.send(\n        (\n            \"HTTP/0.5 200 OK\\r\\n\"\n            \"Content-Type: text/plain\\r\\n\"\n            \"Content-Length: %d\\r\\n\"\n            \"\\r\\n\"\n            \"%s\" % (len(body), body)\n        ).encode(\"utf-8\")\n    )\n    sock.close()\n\n    # Second request.\n    sock = listener.accept()[0]\n    buf = b\"\"\n    while not buf.endswith(b\"\\r\\n\\r\\n\"):\n        buf += sock.recv(65536)\n\n    # Now respond immediately.\n    sock.send(\n        (\n            \"HTTP/1.1 200 OK\\r\\n\"\n            \"Content-Type: text/plain\\r\\n\"\n            \"Content-Length: %d\\r\\n\"\n            \"\\r\\n\"\n            \"foo\" % (len(\"foo\"))\n        ).encode(\"utf-8\")\n    )\n\n    sock.close()  # Close the socket.",
    "pattern_analysis": {
      "api_sequence": [
        "socket.socket.accept",
        "socket.socket.recv",
        "socket.socket.send",
        "socket.socket.close",
        "socket.socket.accept",
        "socket.socket.recv",
        "socket.socket.send",
        "socket.socket.close"
      ],
      "api_sequence_with_args": [
        "socket.socket.accept()",
        "socket.socket.recv(65536)",
        "socket.socket.send((\"HTTP/0.5 200 OK\\r\\nContent-Type: text/plain\\r\\nContent-Length: %d\\r\\n\\r\\n%s\" % (len(body), body)).encode(\"utf-8\"))",
        "socket.socket.close()",
        "socket.socket.accept()",
        "socket.socket.recv(65536)",
        "socket.socket.send((\"HTTP/1.1 200 OK\\r\\nContent-Type: text/plain\\r\\nContent-Length: %d\\r\\n\\r\\nfoo\" % (len(\"foo\"))).encode(\"utf-8\"))",
        "socket.socket.close()"
      ],
      "mapped_sequence": [
        {
          "api_name": "socket.socket.accept",
          "id": "establish_tcp_connection",
          "description": "Establishes TCP connection to specified address",
          "first_id": "basic_network_operations",
          "second_id": "socket_communication",
          "third_id": "connection_management"
        },
        {
          "api_name": "socket.socket.recv",
          "id": "receive_socket_data",
          "description": "Receives data from socket connection",
          "first_id": "basic_network_operations",
          "second_id": "socket_communication",
          "third_id": "data_transmission"
        },
        {
          "api_name": "socket.socket.send",
          "id": "send_socket_data",
          "description": "Sends data over socket connection",
          "first_id": "basic_network_operations",
          "second_id": "socket_communication",
          "third_id": "data_transmission"
        },
        {
          "api_name": "socket.socket.close",
          "id": "close_socket",
          "description": "Closes the socket connection",
          "first_id": "basic_network_operations",
          "second_id": "socket_communication",
          "third_id": "connection_management"
        },
        {
          "api_name": "socket.socket.accept",
          "id": "establish_tcp_connection",
          "description": "Establishes TCP connection to specified address",
          "first_id": "basic_network_operations",
          "second_id": "socket_communication",
          "third_id": "connection_management"
        },
        {
          "api_name": "socket.socket.recv",
          "id": "receive_socket_data",
          "description": "Receives data from socket connection",
          "first_id": "basic_network_operations",
          "second_id": "socket_communication",
          "third_id": "data_transmission"
        },
        {
          "api_name": "socket.socket.send",
          "id": "send_socket_data",
          "description": "Sends data over socket connection",
          "first_id": "basic_network_operations",
          "second_id": "socket_communication",
          "third_id": "data_transmission"
        },
        {
          "api_name": "socket.socket.close",
          "id": "close_socket",
          "description": "Closes the socket connection",
          "first_id": "basic_network_operations",
          "second_id": "socket_communication",
          "third_id": "connection_management"
        }
      ],
      "contextual_code": "def socket_handler(listener: socket.socket) -> None:\n    sock = listener.accept()[0]\n    buf = b\"\"\n    while not buf.endswith(b\"\\r\\n\\r\\n\"):\n        buf += sock.recv(65536)\n    body = \"bad http 0.5 response\"\n    sock.send((\n        \"HTTP/0.5 200 OK\\r\\n\"\n        \"Content-Type: text/plain\\r\\n\"\n        \"Content-Length: %d\\r\\n\"\n        \"\\r\\n\"\n        \"%s\" % (len(body), body)\n    ).encode(\"utf-8\"))\n    sock.close()\n    sock = listener.accept()[0]\n    buf = b\"\"\n    while not buf.endswith(b\"\\r\\n\\r\\n\"):\n        buf += sock.recv(65536)\n    sock.send((\n        \"HTTP/1.1 200 OK\\r\\n\"\n        \"Content-Type: text/plain\\r\\n\"\n        \"Content-Length: %d\\r\\n\"\n        \"\\r\\n\"\n        \"foo\" % (len(\"foo\"))\n    ).encode(\"utf-8\"))\n    sock.close()"
    }
  },
  {
    "pyfile": "test_emscripten.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/urllib3-2.4.0/urllib3-2.4.0/test/contrib/emscripten/test_emscripten.py",
    "line_number": "1015",
    "type_description": "B825:request",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "1014\t        with pytest.raises(TimeoutError):\n1015\t            conn.request(\"GET\", \"/slow\")\n1016\t            conn.getresponse()",
    "code_snippet": "@pytest.mark.with_jspi\ndef test_timeout_jspi(\n    selenium_coverage: typing.Any,\n    testserver_http: PyodideServerInfo,\n    run_from_server: ServerRunnerInfo,\n) -> None:\n    @run_in_pyodide\n    def pyodide_test(selenium, host, port):  # type: ignore[no-untyped-def]\n        import pytest\n\n        import urllib3.contrib.emscripten.fetch\n        from urllib3.connection import HTTPConnection\n        from urllib3.exceptions import TimeoutError\n\n        conn = HTTPConnection(host, port, timeout=0.1)\n        assert urllib3.contrib.emscripten.fetch.has_jspi() is True\n        with pytest.raises(TimeoutError):\n            conn.request(\"GET\", \"/slow\")\n            conn.getresponse()\n\n    pyodide_test(\n        selenium_coverage, testserver_http.http_host, testserver_http.http_port\n    )",
    "pattern_analysis": {
      "api_sequence": [
        "urllib3.connection.HTTPConnection",
        "urllib3.contrib.emscripten.fetch.has_jspi",
        "urllib3.connection.HTTPConnection.request",
        "urllib3.connection.HTTPConnection.getresponse"
      ],
      "api_sequence_with_args": [
        "urllib3.connection.HTTPConnection(host, port, timeout=0.1)",
        "urllib3.contrib.emscripten.fetch.has_jspi()",
        "urllib3.connection.HTTPConnection.request(\"GET\", \"/slow\")",
        "urllib3.connection.HTTPConnection.getresponse()"
      ],
      "mapped_sequence": [
        {
          "api_name": "urllib3.connection.HTTPConnection",
          "id": "create_http_connection",
          "description": "Creates HTTP connection to specified host",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "urllib3.contrib.emscripten.fetch.has_jspi",
          "id": "get_global_symbols",
          "description": "Retrieves global symbol table as dictionary",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "urllib3.connection.HTTPConnection.request",
          "id": "create_http_request",
          "description": "Creates HTTP request object with specified URL, data, and headers",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "urllib3.connection.HTTPConnection.getresponse",
          "id": "read_response_body",
          "description": "Reads response body from HTTP response",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        }
      ],
      "contextual_code": "def pyodide_test(selenium, host, port):\n    import pytest\n    import urllib3.contrib.emscripten.fetch\n    from urllib3.connection import HTTPConnection\n    from urllib3.exceptions import TimeoutError\n\n    conn = HTTPConnection(host, port, timeout=0.1)\n    assert urllib3.contrib.emscripten.fetch.has_jspi() is True\n    with pytest.raises(TimeoutError):\n        conn.request(\"GET\", \"/slow\")\n        conn.getresponse()"
    }
  },
  {
    "pyfile": "test_emscripten.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/urllib3-2.4.0/urllib3-2.4.0/test/contrib/emscripten/test_emscripten.py",
    "line_number": "206",
    "type_description": "B826:getresponse",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "205\t        conn.request(\"GET\", f\"http://{host}:{port}/status?status=404 NOT FOUND\")\n206\t        response = conn.getresponse()\n207\t        assert isinstance(response, BaseHTTPResponse)",
    "code_snippet": "def test_404(\n    selenium_coverage: typing.Any, testserver_http: PyodideServerInfo, has_jspi: bool\n) -> None:\n    @run_in_pyodide  # type: ignore[misc]\n    def pyodide_test(selenium_coverage, host: str, port: int) -> None:  # type: ignore[no-untyped-def]\n        from urllib3.connection import HTTPConnection\n        from urllib3.response import BaseHTTPResponse\n\n        conn = HTTPConnection(host, port)\n        conn.request(\"GET\", f\"http://{host}:{port}/status?status=404 NOT FOUND\")\n        response = conn.getresponse()\n        assert isinstance(response, BaseHTTPResponse)\n        assert response.status == 404\n\n    pyodide_test(\n        selenium_coverage, testserver_http.http_host, testserver_http.http_port\n    )",
    "pattern_analysis": {
      "api_sequence": [
        "urllib3.connection.HTTPConnection",
        "urllib3.connection.HTTPConnection.request",
        "urllib3.connection.HTTPConnection.getresponse"
      ],
      "api_sequence_with_args": [
        "urllib3.connection.HTTPConnection(host, port)",
        "urllib3.connection.HTTPConnection.request(\"GET\", f\"http://{host}:{port}/status?status=404 NOT FOUND\")",
        "urllib3.connection.HTTPConnection.getresponse()"
      ],
      "mapped_sequence": [
        {
          "api_name": "urllib3.connection.HTTPConnection",
          "id": "create_http_connection",
          "description": "Creates HTTP connection to specified host",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "urllib3.connection.HTTPConnection.request",
          "id": "create_http_request",
          "description": "Creates HTTP request object with specified URL, data, and headers",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "urllib3.connection.HTTPConnection.getresponse",
          "id": "read_response_body",
          "description": "Reads response body from HTTP response",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        }
      ],
      "contextual_code": "from urllib3.connection import HTTPConnection\nfrom urllib3.response import BaseHTTPResponse\n\ndef pyodide_test(selenium_coverage, host: str, port: int) -> None:\n    conn = HTTPConnection(host, port)\n    conn.request(\"GET\", f\"http://{host}:{port}/status?status=404 NOT FOUND\")\n    response = conn.getresponse()\n    assert isinstance(response, BaseHTTPResponse)\n    assert response.status == 404"
    }
  }
]