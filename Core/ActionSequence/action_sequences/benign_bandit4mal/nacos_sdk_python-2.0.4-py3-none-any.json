[
  {
    "metadata": {
      "package_name": "nacos_sdk_python-2.0.4-py3-none-any",
      "total_matches": 1,
      "processing_date": "2025-05-18 01:49:39"
    }
  },
  {
    "pyfile": "client.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/nacos_sdk_python-2.0.4-py3-none-any/nacos/client.py",
    "line_number": "865",
    "type_description": "B814:read",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "864\t            resp = self._do_sync_req(\"/nacos/v1/auth/login\", None, params, None, self.default_timeout, \"POST\", \"login\")\n865\t            c = resp.read()\n866\t            response_data = json.loads(c.decode(\"UTF-8\"))",
    "code_snippet": "def get_access_token(self, force_refresh=False):\n    current_time = time.time()\n    if self.token and not force_refresh and self.token_expire_time > current_time:\n        return self.token\n\n    params = {\n        \"username\": self.username,\n        \"password\": self.password\n    }\n    try:\n        resp = self._do_sync_req(\"/nacos/v1/auth/login\", None, params, None, self.default_timeout, \"POST\", \"login\")\n        c = resp.read()\n        response_data = json.loads(c.decode(\"UTF-8\"))\n        self.token = response_data.get('accessToken')\n        self.token_ttl = response_data.get('tokenTtl', 18000)  # 默认使用返回值，无返回则使用18000秒\n        self.token_expire_time = current_time + self.token_ttl - 10  # 更新 Token 的过期时间\n        logger.info(\n            f\"[get_access_token] AccessToken: {self.token}, TTL: {self.token_ttl}，force_refresh：{force_refresh}\")\n    except Exception as e:\n        logger.exception(\"[get-access-token] exception %s occur\" % str(e))\n        raise",
    "pattern_analysis": {
      "api_sequence": [
        "time.time",
        "self._do_sync_req",
        "resp.read",
        "json.loads",
        "c.decode",
        "logger.info",
        "logger.exception"
      ],
      "api_sequence_with_args": [
        "time.time()",
        "self._do_sync_req(\"/nacos/v1/auth/login\", None, params, None, self.default_timeout, \"POST\", \"login\")",
        "resp.read()",
        "json.loads(c.decode(\"UTF-8\"))",
        "c.decode(\"UTF-8\")",
        "logger.info(f\"[get_access_token] AccessToken: {self.token}, TTL: {self.token_ttl}，force_refresh：{force_refresh}\")",
        "logger.exception(\"[get-access-token] exception %s occur\" % str(e))"
      ],
      "mapped_sequence": [
        {
          "api_name": "time.time",
          "id": "get_current_time",
          "description": "Returns current time in seconds since epoch",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "time_operations"
        },
        {
          "api_name": "self._do_sync_req",
          "id": "send_http_post",
          "description": "Sends HTTP POST request with data and parameters",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "resp.read",
          "id": "read_response_body",
          "description": "Reads response body from HTTP response",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "json.loads",
          "id": "deserialize_from_json",
          "description": "Deserializes JSON string to Python object",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "specific_format_encoding"
        },
        {
          "api_name": "c.decode",
          "id": "decode_bytes_codec",
          "description": "Decodes bytes using specified codec",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "logger.info",
          "id": "log_info",
          "description": "Logs informational message",
          "first_id": "data_exfiltration",
          "second_id": "data_collection_operations",
          "third_id": "data_acquisition"
        },
        {
          "api_name": "logger.exception",
          "id": "log_error",
          "description": "Logs error message",
          "first_id": "data_exfiltration",
          "second_id": "data_collection_operations",
          "third_id": "data_acquisition"
        }
      ],
      "contextual_code": "def get_access_token(self, force_refresh=False):\n    current_time = time.time()\n    if self.token and not force_refresh and self.token_expire_time > current_time:\n        return self.token\n\n    params = {\n        \"username\": self.username,\n        \"password\": self.password\n    }\n    try:\n        resp = self._do_sync_req(\"/nacos/v1/auth/login\", None, params, None, self.default_timeout, \"POST\", \"login\")\n        c = resp.read()\n        response_data = json.loads(c.decode(\"UTF-8\"))\n        self.token = response_data.get('accessToken')\n        self.token_ttl = response_data.get('tokenTtl', 18000)\n        self.token_expire_time = current_time + self.token_ttl - 10\n        logger.info(f\"[get_access_token] AccessToken: {self.token}, TTL: {self.token_ttl}，force_refresh：{force_refresh}\")\n    except Exception as e:\n        logger.exception(\"[get-access-token] exception %s occur\" % str(e))\n        raise"
    }
  }
]