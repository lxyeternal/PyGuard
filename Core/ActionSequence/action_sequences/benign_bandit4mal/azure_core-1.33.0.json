[
  {
    "metadata": {
      "package_name": "azure_core-1.33.0",
      "total_matches": 3,
      "processing_date": "2025-05-18 01:49:39"
    }
  },
  {
    "pyfile": "test_tracing_policy.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/azure_core-1.33.0/azure_core-1.33.0/tests/test_tracing_policy.py",
    "line_number": "513",
    "type_description": "B820:get",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "512\t        assert finished_spans[0].attributes.get(policy._SERVER_ADDRESS) == \"localhost\"\n513\t        assert finished_spans[0].attributes.get(policy._USER_AGENT_ORIGINAL) is not None\n514\t        assert finished_spans[0].attributes.get(policy._USER_AGENT_ORIGINAL).endswith(\"test-user-agent\")",
    "code_snippet": "@pytest.mark.parametrize(\"http_request,http_response\", request_and_responses_product(HTTP_RESPONSES))\ndef test_distributed_tracing_policy_with_user_agent_policy(self, tracing_helper, http_request, http_response):\n    \"\"\"Test policy when used with the UserAgentPolicy.\"\"\"\n    with mock.patch.dict(\"os.environ\", {\"AZURE_HTTP_USER_AGENT\": \"test-user-agent\"}):\n        with tracing_helper.tracer.start_as_current_span(\"Root\") as root_span:\n            policy = DistributedTracingPolicy()\n            user_agent_policy = UserAgentPolicy()\n\n            request = http_request(\"GET\", \"http://localhost/temp?query=query\")\n            pipeline_request = PipelineRequest(request, PipelineContext(None))\n            user_agent_policy.on_request(pipeline_request)\n            policy.on_request(pipeline_request)\n\n            response = create_http_response(http_response, request, None)\n            response.headers = request.headers\n            response.status_code = 202\n\n            traceparent = request.headers.get(\"traceparent\")\n            assert traceparent is not None\n            assert traceparent.startswith(\"00-\")\n\n            pipeline_response = PipelineResponse(request, response, PipelineContext(None))\n\n            policy.on_response(pipeline_request, pipeline_response)\n            user_agent_policy.on_response(pipeline_request, pipeline_response)\n\n    finished_spans = tracing_helper.exporter.get_finished_spans()\n    assert len(finished_spans) == 2\n    assert finished_spans[0].name == \"GET\"\n    assert finished_spans[0].parent is root_span.get_span_context()\n\n    span_context = finished_spans[0].get_span_context()\n    assert traceparent.split(\"-\")[1] == format_trace_id(span_context.trace_id)\n    assert traceparent.split(\"-\")[2] == format_span_id(span_context.span_id)\n\n    assert finished_spans[0].attributes.get(policy._HTTP_REQUEST_METHOD) == \"GET\"\n    assert finished_spans[0].attributes.get(policy._URL_FULL) == \"http://localhost/temp?query=query\"\n    assert finished_spans[0].attributes.get(policy._SERVER_ADDRESS) == \"localhost\"\n    assert finished_spans[0].attributes.get(policy._USER_AGENT_ORIGINAL) is not None\n    assert finished_spans[0].attributes.get(policy._USER_AGENT_ORIGINAL).endswith(\"test-user-agent\")\n    assert finished_spans[0].attributes.get(policy._HTTP_RESPONSE_STATUS_CODE) == 202\n    assert finished_spans[1].name == \"Root\"",
    "pattern_analysis": {
      "api_sequence": [
        "os.environ"
      ],
      "api_sequence_with_args": [
        "os.environ"
      ],
      "mapped_sequence": [
        {
          "api_name": "os.environ",
          "id": "get_env_vars",
          "description": "Retrieves environment variables mapping",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        }
      ],
      "contextual_code": "with mock.patch.dict(\"os.environ\", {\"AZURE_HTTP_USER_AGENT\": \"test-user-agent\"}):\n    # ...\n    pass"
    }
  },
  {
    "pyfile": "test_basic_transport.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/azure_core-1.33.0/azure_core-1.33.0/tests/test_basic_transport.py",
    "line_number": "517",
    "type_description": "B825:request",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "516\t        http_request(\"DELETE\", \"/container1/blob1\"),\n517\t        http_request(\"DELETE\", \"/container2/blob2\"),\n518\t        policies=[header_policy],",
    "code_snippet": "@pytest.mark.parametrize(\"http_request\", HTTP_REQUESTS)\ndef test_multipart_send_with_combination_changeset_middle(http_request):\n\n    transport = mock.MagicMock(spec=HttpTransport)\n\n    header_policy = HeadersPolicy({\"x-ms-date\": \"Thu, 14 Jun 2018 16:46:54 GMT\"})\n\n    changeset = http_request(\"\", \"\")\n    changeset.set_multipart_mixed(\n        http_request(\"DELETE\", \"/container1/blob1\"),\n        policies=[header_policy],\n        boundary=\"changeset_357de4f7-6d0b-4e02-8cd2-6361411a9525\",\n    )\n    request = http_request(\"POST\", \"http://account.blob.core.windows.net/?comp=batch\")\n    request.set_multipart_mixed(\n        http_request(\"DELETE\", \"/container0/blob0\"),\n        changeset,\n        http_request(\"DELETE\", \"/container2/blob2\"),\n        policies=[header_policy],\n        boundary=\"batch_357de4f7-6d0b-4e02-8cd2-6361411a9525\",\n    )\n\n    with Pipeline(transport) as pipeline:\n        pipeline.run(request)\n\n    assert request.body == (\n        b\"--batch_357de4f7-6d0b-4e02-8cd2-6361411a9525\\r\\n\"\n        b\"Content-Type: application/http\\r\\n\"\n        b\"Content-Transfer-Encoding: binary\\r\\n\"\n        b\"Content-ID: 0\\r\\n\"\n        b\"\\r\\n\"\n        b\"DELETE /container0/blob0 HTTP/1.1\\r\\n\"\n        b\"x-ms-date: Thu, 14 Jun 2018 16:46:54 GMT\\r\\n\"\n        b\"\\r\\n\"\n        b\"\\r\\n\"\n        b\"--batch_357de4f7-6d0b-4e02-8cd2-6361411a9525\\r\\n\"\n        b\"Content-Type: multipart/mixed; boundary=changeset_357de4f7-6d0b-4e02-8cd2-6361411a9525\\r\\n\"\n        b\"\\r\\n\"\n        b\"--changeset_357de4f7-6d0b-4e02-8cd2-6361411a9525\\r\\n\"\n        b\"Content-Type: application/http\\r\\n\"\n        b\"Content-Transfer-Encoding: binary\\r\\n\"\n        b\"Content-ID: 1\\r\\n\"\n        b\"\\r\\n\"\n        b\"DELETE /container1/blob1 HTTP/1.1\\r\\n\"\n        b\"x-ms-date: Thu, 14 Jun 2018 16:46:54 GMT\\r\\n\"\n        b\"\\r\\n\"\n        b\"\\r\\n\"\n        b\"--changeset_357de4f7-6d0b-4e02-8cd2-6361411a9525--\\r\\n\"\n        b\"\\r\\n\"\n        b\"--batch_357de4f7-6d0b-4e02-8cd2-6361411a9525\\r\\n\"\n        b\"Content-Type: application/http\\r\\n\"\n        b\"Content-Transfer-Encoding: binary\\r\\n\"\n        b\"Content-ID: 2\\r\\n\"\n        b\"\\r\\n\"\n        b\"DELETE /container2/blob2 HTTP/1.1\\r\\n\"\n        b\"x-ms-date: Thu, 14 Jun 2018 16:46:54 GMT\\r\\n\"\n        b\"\\r\\n\"\n        b\"\\r\\n\"\n        b\"--batch_357de4f7-6d0b-4e02-8cd2-6361411a9525--\\r\\n\"\n    )",
    "pattern_analysis": {
      "api_sequence": [
        "http_request",
        "http_request",
        "http_request",
        "http_request",
        "http_request",
        "Pipeline",
        "Pipeline.run"
      ],
      "api_sequence_with_args": [
        "http_request(\"\", \"\")",
        "http_request(\"DELETE\", \"/container1/blob1\")",
        "http_request(\"POST\", \"http://account.blob.core.windows.net/?comp=batch\")",
        "http_request(\"DELETE\", \"/container0/blob0\")",
        "http_request(\"DELETE\", \"/container2/blob2\")",
        "Pipeline(transport)",
        "Pipeline.run(request)"
      ],
      "mapped_sequence": [
        {
          "api_name": "http_request",
          "id": "create_http_request",
          "description": "Creates HTTP request object with specified URL, data, and headers",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "http_request",
          "id": "create_http_request",
          "description": "Creates HTTP request object with specified URL, data, and headers",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "http_request",
          "id": "create_http_request",
          "description": "Creates HTTP request object with specified URL, data, and headers",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "http_request",
          "id": "create_http_request",
          "description": "Creates HTTP request object with specified URL, data, and headers",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "http_request",
          "id": "create_http_request",
          "description": "Creates HTTP request object with specified URL, data, and headers",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "Pipeline",
          "id": "create_http_session",
          "description": "Creates HTTP session for making asynchronous requests",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "Pipeline.run",
          "id": "send_http_post",
          "description": "Sends HTTP POST request with data and parameters",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        }
      ],
      "contextual_code": "@pytest.mark.parametrize(\"http_request\", HTTP_REQUESTS)\ndef test_multipart_send_with_combination_changeset_middle(http_request):\n    transport = mock.MagicMock(spec=HttpTransport)\n    header_policy = HeadersPolicy({\"x-ms-date\": \"Thu, 14 Jun 2018 16:46:54 GMT\"})\n    changeset = http_request(\"\", \"\")\n    changeset.set_multipart_mixed(\n        http_request(\"DELETE\", \"/container1/blob1\"),\n        policies=[header_policy],\n        boundary=\"changeset_357de4f7-6d0b-4e02-8cd2-6361411a9525\",\n    )\n    request = http_request(\"POST\", \"http://account.blob.core.windows.net/?comp=batch\")\n    request.set_multipart_mixed(\n        http_request(\"DELETE\", \"/container0/blob0\"),\n        changeset,\n        http_request(\"DELETE\", \"/container2/blob2\"),\n        policies=[header_policy],\n        boundary=\"batch_357de4f7-6d0b-4e02-8cd2-6361411a9525\",\n    )\n    with Pipeline(transport) as pipeline:\n        pipeline.run(request)"
    }
  },
  {
    "pyfile": "test_basic_transport.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/azure_core-1.33.0/azure_core-1.33.0/tests/test_basic_transport.py",
    "line_number": "1102",
    "type_description": "B825:request",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "1101\n1102\t    request = http_request(\"POST\", \"http://account.blob.core.windows.net/?comp=batch\")\n1103\t    request.set_multipart_mixed(http_request(\"DELETE\", \"/container0/blob0\"), changeset)",
    "code_snippet": "@pytest.mark.parametrize(\"http_request\", HTTP_REQUESTS)\ndef test_multipart_send_with_combination_changeset_last(http_request):\n\n    transport = mock.MagicMock(spec=HttpTransport)\n\n    header_policy = HeadersPolicy({\"x-ms-date\": \"Thu, 14 Jun 2018 16:46:54 GMT\"})\n\n    changeset = http_request(\"\", \"\")\n    changeset.set_multipart_mixed(\n        http_request(\"DELETE\", \"/container1/blob1\"),\n        http_request(\"DELETE\", \"/container2/blob2\"),\n        policies=[header_policy],\n        boundary=\"changeset_357de4f7-6d0b-4e02-8cd2-6361411a9525\",\n    )\n    request = http_request(\"POST\", \"http://account.blob.core.windows.net/?comp=batch\")\n    request.set_multipart_mixed(\n        http_request(\"DELETE\", \"/container0/blob0\"),\n        changeset,\n        policies=[header_policy],\n        boundary=\"batch_357de4f7-6d0b-4e02-8cd2-6361411a9525\",\n    )\n\n    with Pipeline(transport) as pipeline:\n        pipeline.run(request)\n\n    assert request.body == (\n        b\"--batch_357de4f7-6d0b-4e02-8cd2-6361411a9525\\r\\n\"\n        b\"Content-Type: application/http\\r\\n\"\n        b\"Content-Transfer-Encoding: binary\\r\\n\"\n        b\"Content-ID: 0\\r\\n\"\n        b\"\\r\\n\"\n        b\"DELETE /container0/blob0 HTTP/1.1\\r\\n\"\n        b\"x-ms-date: Thu, 14 Jun 2018 16:46:54 GMT\\r\\n\"\n        b\"\\r\\n\"\n        b\"\\r\\n\"\n        b\"--batch_357de4f7-6d0b-4e02-8cd2-6361411a9525\\r\\n\"\n        b\"Content-Type: multipart/mixed; boundary=changeset_357de4f7-6d0b-4e02-8cd2-6361411a9525\\r\\n\"\n        b\"\\r\\n\"\n        b\"--changeset_357de4f7-6d0b-4e02-8cd2-6361411a9525\\r\\n\"\n        b\"Content-Type: application/http\\r\\n\"\n        b\"Content-Transfer-Encoding: binary\\r\\n\"\n        b\"Content-ID: 1\\r\\n\"\n        b\"\\r\\n\"\n        b\"DELETE /container1/blob1 HTTP/1.1\\r\\n\"\n        b\"x-ms-date: Thu, 14 Jun 2018 16:46:54 GMT\\r\\n\"\n        b\"\\r\\n\"\n        b\"\\r\\n\"\n        b\"--changeset_357de4f7-6d0b-4e02-8cd2-6361411a9525\\r\\n\"\n        b\"Content-Type: application/http\\r\\n\"\n        b\"Content-Transfer-Encoding: binary\\r\\n\"\n        b\"Content-ID: 2\\r\\n\"\n        b\"\\r\\n\"\n        b\"DELETE /container2/blob2 HTTP/1.1\\r\\n\"\n        b\"x-ms-date: Thu, 14 Jun 2018 16:46:54 GMT\\r\\n\"\n        b\"\\r\\n\"\n        b\"\\r\\n\"\n        b\"--changeset_357de4f7-6d0b-4e02-8cd2-6361411a9525--\\r\\n\"\n        b\"\\r\\n\"\n        b\"--batch_357de4f7-6d0b-4e02-8cd2-6361411a9525--\\r\\n\"\n    )",
    "pattern_analysis": {
      "api_sequence": [
        "http_request",
        "http_request",
        "http_request.set_multipart_mixed",
        "http_request",
        "http_request.set_multipart_mixed",
        "Pipeline",
        "Pipeline.run"
      ],
      "api_sequence_with_args": [
        "http_request(\"\", \"\")",
        "http_request(\"DELETE\", \"/container1/blob1\")",
        "http_request.set_multipart_mixed(http_request(\"DELETE\", \"/container1/blob1\"), http_request(\"DELETE\", \"/container2/blob2\"), policies=[header_policy], boundary=\"changeset_357de4f7-6d0b-4e02-8cd2-6361411a9525\")",
        "http_request(\"POST\", \"http://account.blob.core.windows.net/?comp=batch\")",
        "http_request.set_multipart_mixed(http_request(\"DELETE\", \"/container0/blob0\"), changeset, policies=[header_policy], boundary=\"batch_357de4f7-6d0b-4e02-8cd2-6361411a9525\")",
        "Pipeline(transport)",
        "Pipeline.run(request)"
      ],
      "mapped_sequence": [
        {
          "api_name": "http_request",
          "id": "create_http_request",
          "description": "Creates HTTP request object with specified URL, data, and headers",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "http_request",
          "id": "create_http_request",
          "description": "Creates HTTP request object with specified URL, data, and headers",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "http_request.set_multipart_mixed",
          "id": "create_multipart_writer",
          "description": "Creates multipart writer for HTTP requests",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "http_request",
          "id": "create_http_request",
          "description": "Creates HTTP request object with specified URL, data, and headers",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "http_request.set_multipart_mixed",
          "id": "create_multipart_writer",
          "description": "Creates multipart writer for HTTP requests",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "Pipeline",
          "id": "create_http_session",
          "description": "Creates HTTP session for making asynchronous requests",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "Pipeline.run",
          "id": "send_http_post",
          "description": "Sends HTTP POST request with data and parameters",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        }
      ],
      "contextual_code": "@pytest.mark.parametrize(\"http_request\", HTTP_REQUESTS)\ndef test_multipart_send_with_combination_changeset_last(http_request):\n    transport = mock.MagicMock(spec=HttpTransport)\n    header_policy = HeadersPolicy({\"x-ms-date\": \"Thu, 14 Jun 2018 16:46:54 GMT\"})\n    changeset = http_request(\"\", \"\")\n    changeset.set_multipart_mixed(\n        http_request(\"DELETE\", \"/container1/blob1\"),\n        http_request(\"DELETE\", \"/container2/blob2\"),\n        policies=[header_policy],\n        boundary=\"changeset_357de4f7-6d0b-4e02-8cd2-6361411a9525\",\n    )\n    request = http_request(\"POST\", \"http://account.blob.core.windows.net/?comp=batch\")\n    request.set_multipart_mixed(\n        http_request(\"DELETE\", \"/container0/blob0\"),\n        changeset,\n        policies=[header_policy],\n        boundary=\"batch_357de4f7-6d0b-4e02-8cd2-6361411a9525\",\n    )\n    with Pipeline(transport) as pipeline:\n        pipeline.run(request)"
    }
  }
]