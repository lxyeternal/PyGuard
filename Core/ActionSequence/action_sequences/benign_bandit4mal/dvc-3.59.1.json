[
  {
    "metadata": {
      "package_name": "dvc-3.59.1",
      "total_matches": 2,
      "processing_date": "2025-05-18 01:49:39"
    }
  },
  {
    "pyfile": "test_data.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/dvc-3.59.1/dvc-3.59.1/tests/func/api/test_data.py",
    "line_number": "88",
    "type_description": "B814:read",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "87\n88\t    assert api.read(\"version\", repo=repo_url, rev=\"branch\") == \"branchver\"\n89",
    "code_snippet": "def test_open_external(tmp_dir, erepo_dir, cloud):\n    erepo_dir.add_remote(config=cloud.config)\n\n    with erepo_dir.chdir():\n        erepo_dir.dvc_gen(\"version\", \"master\", commit=\"add version\")\n\n        with erepo_dir.branch(\"branch\", new=\"True\"):\n            # NOTE: need file to be other size for Mac\n            erepo_dir.dvc_gen(\"version\", \"branchver\", commit=\"add version\")\n\n    assert erepo_dir.dvc.push(all_branches=True) == 2\n\n    # Remove cache to force download\n    remove(erepo_dir.dvc.cache.local.path)\n\n    # Using file url to force clone to tmp repo\n    repo_url = f\"file://{erepo_dir.as_posix()}\"\n    with api.open(\"version\", repo=repo_url) as fd:\n        assert fd.read() == \"master\"\n\n    assert api.read(\"version\", repo=repo_url, rev=\"branch\") == \"branchver\"",
    "pattern_analysis": {
      "api_sequence": [
        "erepo_dir.add_remote",
        "erepo_dir.chdir",
        "erepo_dir.dvc_gen",
        "erepo_dir.branch",
        "erepo_dir.dvc_gen",
        "erepo_dir.dvc.push",
        "remove",
        "erepo_dir.as_posix",
        "api.open",
        "fd.read",
        "api.read"
      ],
      "api_sequence_with_args": [
        "erepo_dir.add_remote(config=cloud.config)",
        "erepo_dir.chdir()",
        "erepo_dir.dvc_gen(\"version\", \"master\", commit=\"add version\")",
        "erepo_dir.branch(\"branch\", new=\"True\")",
        "erepo_dir.dvc_gen(\"version\", \"branchver\", commit=\"add version\")",
        "erepo_dir.dvc.push(all_branches=True)",
        "remove(erepo_dir.dvc.cache.local.path)",
        "erepo_dir.as_posix()",
        "api.open(\"version\", repo=repo_url)",
        "fd.read()",
        "api.read(\"version\", repo=repo_url, rev=\"branch\")"
      ],
      "mapped_sequence": [
        {
          "api_name": "erepo_dir.add_remote",
          "id": "configure_package_install",
          "description": "Configures and initiates Python package installation",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "package_configuration"
        },
        {
          "api_name": "erepo_dir.chdir",
          "id": "change_working_dir",
          "description": "Changes current working directory",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "erepo_dir.dvc_gen",
          "id": "basic_write_operations",
          "description": "Basic file opening operations for writing (normal writing, binary writing)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "erepo_dir.branch",
          "id": "create_git_head",
          "description": "Retrieves current HEAD reference of repository",
          "first_id": "",
          "second_id": "",
          "third_id": ""
        },
        {
          "api_name": "erepo_dir.dvc_gen",
          "id": "basic_write_operations",
          "description": "Basic file opening operations for writing (normal writing, binary writing)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "erepo_dir.dvc.push",
          "id": "send_http_post",
          "description": "Sends HTTP POST request with data and parameters",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "remove",
          "id": "delete_file",
          "description": "Deletes specified file from filesystem",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_transfer"
        },
        {
          "api_name": "erepo_dir.as_posix",
          "id": "path_string_operations",
          "description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "api.open",
          "id": "basic_read_operations",
          "description": "ic file opening operations for reading (normal reading, binary reading)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "fd.read",
          "id": "basic_file_reading",
          "description": "Reading content from files (by lines or entire content)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_reading"
        },
        {
          "api_name": "api.read",
          "id": "basic_file_reading",
          "description": "Reading content from files (by lines or entire content)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_reading"
        }
      ],
      "contextual_code": "def test_open_external(tmp_dir, erepo_dir, cloud):\n    erepo_dir.add_remote(config=cloud.config)\n\n    with erepo_dir.chdir():\n        erepo_dir.dvc_gen(\"version\", \"master\", commit=\"add version\")\n\n        with erepo_dir.branch(\"branch\", new=\"True\"):\n            erepo_dir.dvc_gen(\"version\", \"branchver\", commit=\"add version\")\n\n    assert erepo_dir.dvc.push(all_branches=True) == 2\n\n    remove(erepo_dir.dvc.cache.local.path)\n\n    repo_url = f\"file://{erepo_dir.as_posix()}\"\n    with api.open(\"version\", repo=repo_url) as fd:\n        assert fd.read() == \"master\"\n\n    assert api.read(\"version\", repo=repo_url, rev=\"branch\") == \"branchver\""
    }
  },
  {
    "pyfile": "test_checkout.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/dvc-3.59.1/dvc-3.59.1/tests/func/test_checkout.py",
    "line_number": "411",
    "type_description": "B815:write",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "410\t    with open(cache, \"a\", encoding=\"utf-8\") as fd:\n411\t        fd.write(\"destroy cache\")\n412",
    "code_snippet": "@pytest.mark.xfail(reason=\"values relpath\")\ndef test_checkout_stats_on_failure(tmp_dir, dvc, scm):\n    tmp_dir.dvc_gen(\n        {\"foo\": \"foo\", \"dir\": {\"subdir\": {\"file\": \"file\"}}, \"other\": \"other\"},\n        commit=\"initial\",\n    )\n    stage = load_file(dvc, \"foo.dvc\").stage\n    tmp_dir.dvc_gen({\"foo\": \"foobar\", \"other\": \"other other\"}, commit=\"second\")\n\n    # corrupt cache\n    cache = stage.outs[0].cache_path\n    os.chmod(cache, 0o644)\n    with open(cache, \"a\", encoding=\"utf-8\") as fd:\n        fd.write(\"destroy cache\")\n\n    scm.checkout(\"HEAD~\")\n    with pytest.raises(CheckoutError) as exc:\n        dvc.checkout(force=True)\n\n    assert exc.value.stats == {\n        **empty_checkout,\n        \"failed\": [\"foo\"],\n        \"modified\": [\"other\"],\n    }\n",
    "pattern_analysis": {
      "api_sequence": [
        "open",
        "os.chmod"
      ],
      "api_sequence_with_args": [
        "open(cache, \"a\", encoding=\"utf-8\")",
        "os.chmod(cache, 0o644)"
      ],
      "mapped_sequence": [
        {
          "api_name": "open",
          "id": "basic_write_operations",
          "description": "Basic file opening operations for writing (normal writing, binary writing)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "os.chmod",
          "id": "set_file_attributes",
          "description": "Sets file attributes for specified file",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_attribute_management"
        }
      ],
      "contextual_code": "    # corrupt cache\n    cache = stage.outs[0].cache_path\n    os.chmod(cache, 0o644)\n    with open(cache, \"a\", encoding=\"utf-8\") as fd:\n        fd.write(\"destroy cache\")"
    }
  }
]