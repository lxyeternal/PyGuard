[
  {
    "metadata": {
      "package_name": "mdanalysis-2.9.0",
      "total_matches": 1,
      "processing_date": "2025-05-18 01:49:39"
    }
  },
  {
    "pyfile": "setup.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/mdanalysis-2.9.0/mdanalysis-2.9.0/setup.py",
    "line_number": "204",
    "type_description": "B815:write",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "203\t                    f.write(\"#include {0!s}\\n\".format(include))\n204\t                f.write(\"int main(void) {\\n\")\n205\t                f.write(\"    {0!s};\\n\".format(funcname))",
    "code_snippet": "def hasfunction(cc, funcname, include=None, extra_postargs=None):\n    # From http://stackoverflow.com/questions/\n    #            7018879/disabling-output-when-compiling-with-distutils\n    tmpdir = tempfile.mkdtemp(prefix=\"hasfunction-\")\n    devnull = oldstderr = None\n    try:\n        try:\n            fname = os.path.join(tmpdir, \"funcname.c\")\n            with open(fname, \"w\") as f:\n                if include is not None:\n                    f.write(\"#include {0!s}\\n\".format(include))\n                f.write(\"int main(void) {\\n\")\n                f.write(\"    {0!s};\\n\".format(funcname))\n                f.write(\"}\\n\")\n            # Redirect stderr to /dev/null to hide any error messages\n            # from the compiler.\n            # This will have to be changed if we ever have to check\n            # for a function on Windows.\n            devnull = open(\"/dev/null\", \"w\")\n            oldstderr = os.dup(sys.stderr.fileno())\n            os.dup2(devnull.fileno(), sys.stderr.fileno())\n            objects = cc.compile(\n                [fname], output_dir=tmpdir, extra_postargs=extra_postargs\n            )\n            cc.link_executable(objects, os.path.join(tmpdir, \"a.out\"))\n        except Exception:\n            return False\n        return True\n    finally:\n        if oldstderr is not None:\n            os.dup2(oldstderr, sys.stderr.fileno())\n        if devnull is not None:\n            devnull.close()\n        shutil.rmtree(tmpdir)",
    "pattern_analysis": {
      "api_sequence": [
        "tempfile.mkdtemp",
        "os.path.join",
        "open",
        "open",
        "os.dup",
        "sys.stderr.fileno",
        "os.dup2",
        "open.fileno",
        "sys.stderr.fileno",
        "os.dup2",
        "cc.compile",
        "cc.link_executable",
        "os.dup2",
        "sys.stderr.fileno",
        "open.close",
        "shutil.rmtree"
      ],
      "api_sequence_with_args": [
        "tempfile.mkdtemp(prefix=\"hasfunction-\")",
        "os.path.join(tmpdir, \"funcname.c\")",
        "open(fname, \"w\")",
        "open(\"/dev/null\", \"w\")",
        "os.dup(sys.stderr.fileno())",
        "sys.stderr.fileno()",
        "os.dup2(devnull.fileno(), sys.stderr.fileno())",
        "devnull.fileno()",
        "sys.stderr.fileno()",
        "os.dup2(oldstderr, sys.stderr.fileno())",
        "cc.compile([fname], output_dir=tmpdir, extra_postargs=extra_postargs)",
        "cc.link_executable(objects, os.path.join(tmpdir, \"a.out\"))",
        "os.dup2(oldstderr, sys.stderr.fileno())",
        "sys.stderr.fileno()",
        "devnull.close()",
        "shutil.rmtree(tmpdir)"
      ],
      "mapped_sequence": [
        {
          "api_name": "tempfile.mkdtemp",
          "id": "create_temp_dir",
          "description": "Creates temporary directory and returns its path",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "directory_operations"
        },
        {
          "api_name": "os.path.join",
          "id": "path_string_operations",
          "description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "open",
          "id": "basic_write_operations",
          "description": "Basic file opening operations for writing (normal writing, binary writing)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "open",
          "id": "open_null_device",
          "description": "Opens null device for writing",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "os.dup",
          "id": "copy_memory",
          "description": "Copies memory from source to destination buffer",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "sys.stderr.fileno",
          "id": "get_stdout_stream",
          "description": "Retrieves standard output stream object",
          "first_id": "persistence_stealth",
          "second_id": "user_interaction",
          "third_id": "interface_control"
        },
        {
          "api_name": "os.dup2",
          "id": "copy_memory",
          "description": "Copies memory from source to destination buffer",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "open.fileno",
          "id": "get_stdout_stream",
          "description": "Retrieves standard output stream object",
          "first_id": "persistence_stealth",
          "second_id": "user_interaction",
          "third_id": "interface_control"
        },
        {
          "api_name": "sys.stderr.fileno",
          "id": "get_stdout_stream",
          "description": "Retrieves standard output stream object",
          "first_id": "persistence_stealth",
          "second_id": "user_interaction",
          "third_id": "interface_control"
        },
        {
          "api_name": "os.dup2",
          "id": "copy_memory",
          "description": "Copies memory from source to destination buffer",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "cc.compile",
          "id": "exec_setuptools_dev",
          "description": "Executes setuptools development procedure",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "package_configuration"
        },
        {
          "api_name": "cc.link_executable",
          "id": "exec_setuptools_dev",
          "description": "Executes setuptools development procedure",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "package_configuration"
        },
        {
          "api_name": "os.dup2",
          "id": "copy_memory",
          "description": "Copies memory from source to destination buffer",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "sys.stderr.fileno",
          "id": "get_stdout_stream",
          "description": "Retrieves standard output stream object",
          "first_id": "persistence_stealth",
          "second_id": "user_interaction",
          "third_id": "interface_control"
        },
        {
          "api_name": "open.close",
          "id": "close_file",
          "description": "Closes the opened file",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_closing"
        },
        {
          "api_name": "shutil.rmtree",
          "id": "delete_directory",
          "description": "Recursively deletes directory and its contents",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "directory_operations"
        }
      ],
      "contextual_code": "def hasfunction(cc, funcname, include=None, extra_postargs=None):\n    tmpdir = tempfile.mkdtemp(prefix=\"hasfunction-\")\n    devnull = oldstderr = None\n    try:\n        try:\n            fname = os.path.join(tmpdir, \"funcname.c\")\n            with open(fname, \"w\") as f:\n                if include is not None:\n                    f.write(\"#include {0!s}\\n\".format(include))\n                f.write(\"int main(void) {\\n\")\n                f.write(\"    {0!s};\\n\".format(funcname))\n                f.write(\"}\\n\")\n            devnull = open(\"/dev/null\", \"w\")\n            oldstderr = os.dup(sys.stderr.fileno())\n            os.dup2(devnull.fileno(), sys.stderr.fileno())\n            objects = cc.compile(\n                [fname], output_dir=tmpdir, extra_postargs=extra_postargs\n            )\n            cc.link_executable(objects, os.path.join(tmpdir, \"a.out\"))\n        except Exception:\n            return False\n        return True\n    finally:\n        if oldstderr is not None:\n            os.dup2(oldstderr, sys.stderr.fileno())\n        if devnull is not None:\n            devnull.close()\n        shutil.rmtree(tmpdir)"
    }
  }
]