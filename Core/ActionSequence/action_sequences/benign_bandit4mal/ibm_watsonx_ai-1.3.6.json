[
  {
    "metadata": {
      "package_name": "ibm_watsonx_ai-1.3.6",
      "total_matches": 1,
      "processing_date": "2025-05-18 01:49:39"
    }
  },
  {
    "pyfile": "hybrid_artifact_loader.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/ibm_watsonx_ai-1.3.6/ibm_watsonx_ai-1.3.6/ibm_watsonx_ai/libs/repo/mlrepositoryartifact/hybrid_artifact_loader.py",
    "line_number": "43",
    "type_description": "B814:read",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "42\t            if queryparam_val is None:\n43\t                input_stream = self.reader().read()\n44\t            if queryparam_val is not None and queryparam_val == 'full':",
    "code_snippet": "def extract_content(self, queryparam_val, callback):\n    directory_name = 'artifact'\n    try:\n        shutil.rmtree(directory_name)\n    except:\n        pass\n\n    try:\n        id_length = 20\n        dir_id = uid_generate(id_length)\n        model_dir_name = directory_name + dir_id\n\n        gz_file_name = '{}/artifact_content.tar.gz'.format(model_dir_name)\n\n        input_stream = None\n        os.makedirs(model_dir_name)\n        if queryparam_val is None:\n            input_stream = self.reader().read()\n        if queryparam_val is not None and queryparam_val == 'full':\n            input_stream = self._content_reader_gzip()\n        file_content = input_stream.read()\n        gz_f = open(gz_file_name, 'wb+')\n        gz_f.write(file_content)\n        gz_f.close()\n        if queryparam_val is None:\n            self.reader().close()\n\n        with zipfile.ZipFile(gz_file_name) as zip_ref:\n            zip_ref.extractall(model_dir_name)\n        artifact_instance = callback(model_dir_name)\n\n        shutil.rmtree(model_dir_name)\n        return artifact_instance\n    except Exception as ex:\n        shutil.rmtree(model_dir_name)\n        raise ex",
    "pattern_analysis": {
      "api_sequence": [
        "shutil.rmtree",
        "uid_generate",
        "os.makedirs",
        "self.reader",
        "self.reader.read",
        "self._content_reader_gzip",
        "input_stream.read",
        "open",
        "gz_f.write",
        "gz_f.close",
        "self.reader.close",
        "zipfile.ZipFile",
        "zipfile.ZipFile.extractall",
        "callback",
        "shutil.rmtree",
        "shutil.rmtree"
      ],
      "api_sequence_with_args": [
        "shutil.rmtree(directory_name)",
        "uid_generate(id_length)",
        "os.makedirs(model_dir_name)",
        "self.reader()",
        "self.reader().read()",
        "self._content_reader_gzip()",
        "input_stream.read()",
        "open(gz_file_name, 'wb+')",
        "gz_f.write(file_content)",
        "gz_f.close()",
        "self.reader().close()",
        "zipfile.ZipFile(gz_file_name)",
        "zip_ref.extractall(model_dir_name)",
        "callback(model_dir_name)",
        "shutil.rmtree(model_dir_name)",
        "shutil.rmtree(model_dir_name)"
      ],
      "mapped_sequence": [
        {
          "api_name": "shutil.rmtree",
          "id": "delete_directory",
          "description": "Recursively deletes directory and its contents",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "directory_operations"
        },
        {
          "api_name": "uid_generate",
          "id": "init_parent_class",
          "description": "Initializes parent class with provided arguments",
          "first_id": "code_execution",
          "second_id": "object_initialization",
          "third_id": "class_initialization"
        },
        {
          "api_name": "os.makedirs",
          "id": "create_directory",
          "description": "Creates directory, ignoring if it already exists",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "directory_operations"
        },
        {
          "api_name": "self.reader",
          "id": "basic_read_operations",
          "description": "ic file opening operations for reading (normal reading, binary reading)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "self.reader.read",
          "id": "basic_file_reading",
          "description": "Reading content from files (by lines or entire content)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_reading"
        },
        {
          "api_name": "self._content_reader_gzip",
          "id": "basic_read_operations",
          "description": "ic file opening operations for reading (normal reading, binary reading)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "input_stream.read",
          "id": "basic_file_reading",
          "description": "Reading content from files (by lines or entire content)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_reading"
        },
        {
          "api_name": "open",
          "id": "basic_write_operations",
          "description": "Basic file opening operations for writing (normal writing, binary writing)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "gz_f.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "gz_f.close",
          "id": "close_file",
          "description": "Closes the opened file",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_closing"
        },
        {
          "api_name": "self.reader.close",
          "id": "close_file",
          "description": "Closes the opened file",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_closing"
        },
        {
          "api_name": "zipfile.ZipFile",
          "id": "open_zip_read",
          "description": "Opens ZIP archive for reading",
          "first_id": "file_operations",
          "second_id": "compression_archiving",
          "third_id": "zip_operations"
        },
        {
          "api_name": "zipfile.ZipFile.extractall",
          "id": "extract_zip_files",
          "description": "Extracts all files from ZIP archive to specified directory",
          "first_id": "file_operations",
          "second_id": "compression_archiving",
          "third_id": "zip_operations"
        },
        {
          "api_name": "callback",
          "id": "init_parent_class",
          "description": "Initializes parent class with provided arguments",
          "first_id": "code_execution",
          "second_id": "object_initialization",
          "third_id": "class_initialization"
        },
        {
          "api_name": "shutil.rmtree",
          "id": "delete_directory",
          "description": "Recursively deletes directory and its contents",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "directory_operations"
        },
        {
          "api_name": "shutil.rmtree",
          "id": "delete_directory",
          "description": "Recursively deletes directory and its contents",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "directory_operations"
        }
      ],
      "contextual_code": "def extract_content(self, queryparam_val, callback):\n    directory_name = 'artifact'\n    try:\n        shutil.rmtree(directory_name)\n    except:\n        pass\n\n    try:\n        id_length = 20\n        dir_id = uid_generate(id_length)\n        model_dir_name = directory_name + dir_id\n        gz_file_name = '{}/artifact_content.tar.gz'.format(model_dir_name)\n        input_stream = None\n        os.makedirs(model_dir_name)\n        if queryparam_val is None:\n            input_stream = self.reader().read()\n        if queryparam_val is not None and queryparam_val == 'full':\n            input_stream = self._content_reader_gzip()\n        file_content = input_stream.read()\n        gz_f = open(gz_file_name, 'wb+')\n        gz_f.write(file_content)\n        gz_f.close()\n        if queryparam_val is None:\n            self.reader().close()\n        with zipfile.ZipFile(gz_file_name) as zip_ref:\n            zip_ref.extractall(model_dir_name)\n        artifact_instance = callback(model_dir_name)\n        shutil.rmtree(model_dir_name)\n        return artifact_instance\n    except Exception as ex:\n        shutil.rmtree(model_dir_name)\n        raise ex"
    }
  }
]