[
  {
    "metadata": {
      "package_name": "pyshacl-0.30.1",
      "total_matches": 1,
      "processing_date": "2025-05-18 01:49:39"
    }
  },
  {
    "pyfile": "cli.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/pyshacl-0.30.1/pyshacl-0.30.1/pyshacl/cli.py",
    "line_number": "337",
    "type_description": "B815:write",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "336\t        sys.stderr.write(\"Validator encountered a Shape Load Error:\\n\")\n337\t        sys.stderr.write(str(sle))\n338\t        exit_code = 2",
    "code_snippet": "def main(prog: Union[str, None] = None) -> None:\n    if prog is not None and len(prog) > 0:\n        parser.prog = prog\n    do_server = os.getenv(\"PYSHACL_HTTP\", \"\")\n    do_server = os.getenv(\"PYSHACL_SERVER\", do_server)\n    if do_server:\n        args = argparse.Namespace()\n    else:\n        args = parser.parse_args()\n    if str_is_true(do_server) or args.server:\n        from pyshacl.sh_http import main as http_main\n\n        # http_main calls sys.exit(0) and never returns\n        http_main()\n    if args.do_rules:\n        from pyshacl.cli_rules import main as rules_main\n\n        # rules_main calls sys.exit(0) and never returns\n        rules_main()\n    if not args.data:\n        # No datafile give, and not starting in server mode.\n        sys.stderr.write('Input Error. No DataGraph file or endpoint supplied.\\n')\n        parser.print_usage(sys.stderr)\n        sys.exit(1)\n    validator_kwargs = {'debug': args.debug}\n    data_file = None\n    data_graph: Union[BufferedReader, str]\n    if args.sparql_mode is not None and args.sparql_mode is True:\n        endpoint = str(args.data).strip()\n        if not endpoint.lower().startswith(\"http:\") and not endpoint.lower().startswith(\"https:\"):\n            sys.stderr.write(\"Input Error. SPARQL Endpoint must start with http:// or https://.\\n\")\n            sys.exit(1)\n        data_graph = endpoint\n        validator_kwargs['sparql_mode'] = True\n    else:\n        try:\n            data_file = open(args.data, 'rb')\n        except FileNotFoundError:\n            sys.stderr.write('Input Error. DataGraph file not found.\\n')\n            sys.exit(1)\n        except PermissionError:\n            sys.stderr.write('Input Error. DataGraph file not readable.\\n')\n            sys.exit(1)\n        else:\n            # NOTE: This cast is not necessary in Python >= 3.10.\n            data_graph = cast(BufferedReader, data_file)\n    if args.shacl is not None:\n        validator_kwargs['shacl_graph'] = args.shacl\n    if args.ont is not None:\n        validator_kwargs['ont_graph'] = args.ont\n    if args.format not in ['human', 'table']:\n        validator_kwargs['serialize_report_graph'] = args.format\n    if args.inference != 'none':\n        validator_kwargs['inference'] = args.inference\n    if args.imports:\n        validator_kwargs['do_owl_imports'] = True\n    if args.metashacl:\n        validator_kwargs['meta_shacl'] = True\n    if args.advanced:\n        validator_kwargs['advanced'] = True\n    if args.js:\n        validator_kwargs['js'] = True\n    if args.focus:\n        validator_kwargs['focus_nodes'] = [_f.strip() for _f in args.focus.split(',')]\n    if args.shape:\n        validator_kwargs['use_shapes'] = [_s.strip() for _s in args.shape.split(',')]\n    if args.iterate_rules:\n        if not args.advanced:\n            sys.stderr.write(\"Iterate-Rules option only works when you enable Advanced Mode.\\n\")\n        else:\n            validator_kwargs['iterate_rules'] = True\n    if args.abort:\n        validator_kwargs['abort_on_first'] = True\n    if args.allow_infos:\n        validator_kwargs['allow_infos'] = True\n    if args.allow_warnings:\n        validator_kwargs['allow_warnings'] = True\n    if args.shacl_file_format:\n        _f: str = args.shacl_file_format\n        if _f != \"auto\":\n            validator_kwargs['shacl_graph_format'] = _f\n    if args.ont_file_format:\n        _f = args.ont_file_format\n        if _f != \"auto\":\n            validator_kwargs['ont_graph_format'] = _f\n    if args.data_file_format:\n        _f = args.data_file_format\n        if _f != \"auto\":\n            validator_kwargs['data_graph_format'] = _f\n    exit_code: Union[int, None] = None\n    try:\n        is_conform, v_graph, v_text = validate(data_graph, **validator_kwargs)\n        if isinstance(v_graph, BaseException):\n            raise v_graph\n    except ValidationFailure as vf:\n        args.output.write(\"Validator generated a Validation Failure result:\\n\")\n        args.output.write(str(vf.message))\n        args.output.write(\"\\n\")\n        exit_code = 1\n    except ShapeLoadError as sle:\n        sys.stderr.write(\"Validator encountered a Shape Load Error:\\n\")\n        sys.stderr.write(str(sle))\n        exit_code = 2\n    except ConstraintLoadError as cle:\n        sys.stderr.write(\"Validator encountered a Constraint Load Error:\\n\")\n        sys.stderr.write(str(cle))\n        exit_code = 2\n    except RuleLoadError as rle:\n        sys.stderr.write(\"Validator encountered a Rule Load Error:\\n\")\n        sys.stderr.write(str(rle))\n        exit_code = 2\n    except ReportableRuntimeError as rre:\n        sys.stderr.write(\"Validator encountered a Runtime Error:\\n\")\n        sys.stderr.write(str(rre.message))\n        sys.stderr.write(\"\\nIf you believe this is a bug in pyshacl, open an Issue on the pyshacl github page.\\n\")\n        exit_code = 2\n    except NotImplementedError as nie:\n        sys.stderr.write(\"Validator feature is not implemented:\\n\")\n        if len(nie.args) > 0:\n            sys.stderr.write(str(nie.args[0]))\n        else:\n            sys.stderr.write(\"No message provided.\")\n        sys.stderr.write(\"\\nIf your use-case requires this feature, open an Issue on the pyshacl github page.\\n\")\n        exit_code = 3\n    except RuntimeError as re:\n        import traceback\n\n        traceback.print_tb(re.__traceback__)\n        sys.stderr.write(\n            \"\\n\\nValidator encountered a Runtime Error. Please report this to the PySHACL issue tracker.\\n\"\n        )\n        exit_code = 2\n    finally:\n        if data_file is not None:\n            try:\n                data_file.close()\n            except Exception as e:\n                sys.stderr.write(\"Error closing data file:\\n\")\n                sys.stderr.write(str(e))\n        if exit_code is not None:\n            sys.exit(exit_code)\n    if args.format == 'human':\n        args.output.write(v_text)\n    elif args.format == 'table':\n        t1 = PrettyTable()\n        t1.field_names = [\"Conforms\"]\n        t1.align = \"c\"\n        t1.add_row([is_conform])\n        args.output.write(str(t1))\n        args.output.write('\\n\\n')\n\n        def col_widther(s, w):\n            \"\"\"Split strings to a given width for table\"\"\"\n            s2 = []\n            i = 0\n            while i < len(s):\n                s2.append(s[i : i + w])\n                i += w\n            return '\\n'.join(s2)\n\n        if not is_conform:\n            from rdflib import Graph\n            from rdflib.namespace import SH\n\n            t2 = PrettyTable()\n            t2.field_names = ['No.', 'Severity', 'Focus Node', 'Result Path', 'Message', 'Component', 'Shape', 'Value']\n            t2.align = \"l\"\n\n            assert isinstance(v_graph, Graph)\n            for i, o in enumerate(v_graph.objects(None, SH.result)):\n                r = {}\n                for o2 in v_graph.predicate_objects(o):\n                    r[o2[0]] = str(col_widther(str(o2[1]).replace(f'{SH}', ''), 25))  # max col width 30 chars\n                t2.add_row(\n                    [\n                        i + 1,\n                        r[SH.resultSeverity],\n                        r[SH.focusNode],\n                        r[SH.resultPath] if r.get(SH.resultPath) is not None else '-',\n                        r[SH.resultMessage] if r.get(SH.resultMessage) is not None else '-',\n                        r[SH.sourceConstraintComponent],\n                        r[SH.sourceShape],\n                        r[SH.value] if r.get(SH.value) is not None else '-',\n                    ]\n                )\n                t2.add_row(['', '', '', '', '', '', '', ''])\n            args.output.write(str(t2))\n    else:\n        if isinstance(v_graph, bytes):\n            v_graph = v_graph.decode('utf-8')\n        args.output.write(v_graph)\n    args.output.close()\n    sys.exit(0 if is_conform else 1)",
    "pattern_analysis": {
      "api_sequence": [
        "os.getenv",
        "os.getenv",
        "open",
        "BufferedReader.close",
        "sys.exit",
        "sys.stderr.write",
        "parser.print_usage",
        "sys.exit",
        "sys.stderr.write",
        "sys.exit",
        "sys.stderr.write",
        "sys.exit",
        "sys.stderr.write",
        "sys.exit",
        "sys.stderr.write",
        "sys.stderr.write",
        "sys.stderr.write",
        "sys.exit",
        "traceback.print_tb",
        "sys.stderr.write",
        "BufferedReader.close",
        "sys.stderr.write",
        "sys.stderr.write",
        "sys.exit",
        "isinstance"
      ],
      "api_sequence_with_args": [
        "os.getenv(\"PYSHACL_HTTP\", \"\")",
        "os.getenv(\"PYSHACL_SERVER\", do_server)",
        "open(args.data, 'rb')",
        "data_file.close()",
        "sys.exit(1)",
        "sys.stderr.write('Input Error. No DataGraph file or endpoint supplied.\\n')",
        "parser.print_usage(sys.stderr)",
        "sys.exit(1)",
        "sys.stderr.write('Input Error. DataGraph file not found.\\n')",
        "sys.exit(1)",
        "sys.stderr.write('Input Error. DataGraph file not readable.\\n')",
        "sys.exit(1)",
        "sys.stderr.write(\"Input Error. SPARQL Endpoint must start with http:// or https://.\\n\")",
        "sys.exit(1)",
        "sys.stderr.write(\"Error closing data file:\\n\")",
        "sys.stderr.write(str(e))",
        "sys.exit(exit_code)",
        "traceback.print_tb(re.__traceback__)",
        "sys.stderr.write(\"\\n\\nValidator encountered a Runtime Error. Please report this to the PySHACL issue tracker.\\n\")",
        "data_file.close()",
        "sys.stderr.write(\"Error closing data file:\\n\")",
        "sys.stderr.write(str(e))",
        "sys.exit(0 if is_conform else 1)",
        "isinstance(v_graph, bytes)"
      ],
      "mapped_sequence": [
        {
          "api_name": "os.getenv",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "os.getenv",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "open",
          "id": "basic_read_operations",
          "description": "ic file opening operations for reading (normal reading, binary reading)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "BufferedReader.close",
          "id": "close_file",
          "description": "Closes the opened file",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_closing"
        },
        {
          "api_name": "sys.exit",
          "id": "exit_program",
          "description": "Exits program with specified status code",
          "first_id": "system_operations",
          "second_id": "process_management",
          "third_id": "process_control"
        },
        {
          "api_name": "sys.stderr.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "parser.print_usage",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "sys.exit",
          "id": "exit_program",
          "description": "Exits program with specified status code",
          "first_id": "system_operations",
          "second_id": "process_management",
          "third_id": "process_control"
        },
        {
          "api_name": "sys.stderr.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "sys.exit",
          "id": "exit_program",
          "description": "Exits program with specified status code",
          "first_id": "system_operations",
          "second_id": "process_management",
          "third_id": "process_control"
        },
        {
          "api_name": "sys.stderr.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "sys.exit",
          "id": "exit_program",
          "description": "Exits program with specified status code",
          "first_id": "system_operations",
          "second_id": "process_management",
          "third_id": "process_control"
        },
        {
          "api_name": "sys.stderr.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "sys.exit",
          "id": "exit_program",
          "description": "Exits program with specified status code",
          "first_id": "system_operations",
          "second_id": "process_management",
          "third_id": "process_control"
        },
        {
          "api_name": "sys.stderr.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "sys.stderr.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "sys.stderr.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "sys.exit",
          "id": "exit_program",
          "description": "Exits program with specified status code",
          "first_id": "system_operations",
          "second_id": "process_management",
          "third_id": "process_control"
        },
        {
          "api_name": "traceback.print_tb",
          "id": "log_error",
          "description": "Logs error message",
          "first_id": "data_exfiltration",
          "second_id": "data_collection_operations",
          "third_id": "data_acquisition"
        },
        {
          "api_name": "sys.stderr.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "BufferedReader.close",
          "id": "close_file",
          "description": "Closes the opened file",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_closing"
        },
        {
          "api_name": "sys.stderr.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "sys.stderr.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "sys.exit",
          "id": "exit_program",
          "description": "Exits program with specified status code",
          "first_id": "system_operations",
          "second_id": "process_management",
          "third_id": "process_control"
        },
        {
          "api_name": "isinstance",
          "id": "check_instance_type",
          "description": "Checks if object is instance of specified type",
          "first_id": "utility_functions",
          "second_id": "logging_exception_handling",
          "third_id": "exception_checking"
        }
      ],
      "contextual_code": "def main(prog: Union[str, None] = None) -> None:\n    do_server = os.getenv(\"PYSHACL_HTTP\", \"\")\n    do_server = os.getenv(\"PYSHACL_SERVER\", do_server)\n    if not args.data:\n        sys.stderr.write('Input Error. No DataGraph file or endpoint supplied.\\n')\n        parser.print_usage(sys.stderr)\n        sys.exit(1)\n    data_file = None\n    if args.sparql_mode is not None and args.sparql_mode is True:\n        endpoint = str(args.data).strip()\n        if not endpoint.lower().startswith(\"http:\") and not endpoint.lower().startswith(\"https:\"):\n            sys.stderr.write(\"Input Error. SPARQL Endpoint must start with http:// or https://.\\n\")\n            sys.exit(1)\n        data_graph = endpoint\n    else:\n        try:\n            data_file = open(args.data, 'rb')\n        except FileNotFoundError:\n            sys.stderr.write('Input Error. DataGraph file not found.\\n')\n            sys.exit(1)\n        except PermissionError:\n            sys.stderr.write('Input Error. DataGraph file not readable.\\n')\n            sys.exit(1)\n        else:\n            data_graph = cast(BufferedReader, data_file)\n    exit_code: Union[int, None] = None\n    try:\n        is_conform, v_graph, v_text = validate(data_graph, **validator_kwargs)\n        if isinstance(v_graph, BaseException):\n            raise v_graph\n    except ValidationFailure as vf:\n        args.output.write(\"Validator generated a Validation Failure result:\\n\")\n        args.output.write(str(vf.message))\n        args.output.write(\"\\n\")\n        exit_code = 1\n    except ShapeLoadError as sle:\n        sys.stderr.write(\"Validator encountered a Shape Load Error:\\n\")\n        sys.stderr.write(str(sle))\n        exit_code = 2\n    except ConstraintLoadError as cle:\n        sys.stderr.write(\"Validator encountered a Constraint Load Error:\\n\")\n        sys.stderr.write(str(cle))\n        exit_code = 2\n    except RuleLoadError as rle:\n        sys.stderr.write(\"Validator encountered a Rule Load Error:\\n\")\n        sys.stderr.write(str(rle))\n        exit_code = 2\n    except ReportableRuntimeError as rre:\n        sys.stderr.write(\"Validator encountered a Runtime Error:\\n\")\n        sys.stderr.write(str(rre.message))\n        sys.stderr.write(\"\\nIf you believe this is a bug in pyshacl, open an Issue on the pyshacl github page.\\n\")\n        exit_code = 2\n    except NotImplementedError as nie:\n        sys.stderr.write(\"Validator feature is not implemented:\\n\")\n        if len(nie.args) > 0:\n            sys.stderr.write(str(nie.args[0]))\n        else:\n            sys.stderr.write(\"No message provided.\")\n        sys.stderr.write(\"\\nIf your use-case requires this feature, open an Issue on the pyshacl github page.\\n\")\n        exit_code = 3\n    except RuntimeError as re:\n        import traceback\n        traceback.print_tb(re.__traceback__)\n        sys.stderr.write(\n            \"\\n\\nValidator encountered a Runtime Error. Please report this to the PySHACL issue tracker.\\n\"\n        )\n        exit_code = 2\n    finally:\n        if data_file is not None:\n            try:\n                data_file.close()\n            except Exception as e:\n                sys.stderr.write(\"Error closing data file:\\n\")\n                sys.stderr.write(str(e))\n        if exit_code is not None:\n            sys.exit(exit_code)\n    if isinstance(v_graph, bytes):\n        v_graph = v_graph.decode('utf-8')\n    args.output.close()\n    sys.exit(0 if is_conform else 1)"
    }
  }
]