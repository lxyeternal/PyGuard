[
  {
    "metadata": {
      "package_name": "pipenv-2024.4.1",
      "total_matches": 3,
      "processing_date": "2025-05-18 01:49:39"
    }
  },
  {
    "pyfile": "project.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/pipenv-2024.4.1/pipenv-2024.4.1/pipenv/project.py",
    "line_number": "988",
    "type_description": "B820:get",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "987\t            sources = [self.default_source]\n988\t            if os.environ.get(\"PIPENV_PYPI_MIRROR\"):\n989\t                sources[0][\"url\"] = os.environ[\"PIPENV_PYPI_MIRROR\"]",
    "code_snippet": "def pipfile_sources(self, expand_vars=True):\n    if self.pipfile_is_empty or \"source\" not in self.parsed_pipfile:\n        sources = [self.default_source]\n        if os.environ.get(\"PIPENV_PYPI_MIRROR\"):\n            sources[0][\"url\"] = os.environ[\"PIPENV_PYPI_MIRROR\"]\n        return sources\n    # We need to make copies of the source info so we don't\n    # accidentally modify the cache. See #2100 where values are\n    # written after the os.path.expandvars() call.\n    sources = [\n        {k: safe_expandvars(v) if expand_vars else v for k, v in source.items()}\n        for source in self.parsed_pipfile[\"source\"]\n    ]\n    for source in sources:\n        if os.environ.get(\"PIPENV_PYPI_MIRROR\") and is_pypi_url(source.get(\"url\")):\n            source[\"url\"] = os.environ[\"PIPENV_PYPI_MIRROR\"]\n    return sources",
    "pattern_analysis": {
      "api_sequence": [
        "os.environ.get",
        "os.environ.__getitem__",
        "os.path.expandvars",
        "os.environ.get",
        "is_pypi_url",
        "os.environ.__getitem__"
      ],
      "api_sequence_with_args": [
        "os.environ.get(\"PIPENV_PYPI_MIRROR\")",
        "os.environ[\"PIPENV_PYPI_MIRROR\"]",
        "os.path.expandvars(v)",
        "os.environ.get(\"PIPENV_PYPI_MIRROR\")",
        "is_pypi_url(source.get(\"url\"))",
        "os.environ[\"PIPENV_PYPI_MIRROR\"]"
      ],
      "mapped_sequence": [
        {
          "api_name": "os.environ.get",
          "id": "get_env_vars",
          "description": "Retrieves environment variables mapping",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "os.environ.__getitem__",
          "id": "get_env_vars",
          "description": "Retrieves environment variables mapping",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "os.path.expandvars",
          "id": "path_special_operations",
          "description": "Special path operations (home directory expansion, temporary directory path, executable path, directory tree generation)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "os.environ.get",
          "id": "get_env_vars",
          "description": "Retrieves environment variables mapping",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "is_pypi_url",
          "id": "check_instance_type",
          "description": "Checks if object is instance of specified type",
          "first_id": "utility_functions",
          "second_id": "logging_exception_handling",
          "third_id": "exception_checking"
        },
        {
          "api_name": "os.environ.__getitem__",
          "id": "get_env_vars",
          "description": "Retrieves environment variables mapping",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        }
      ],
      "contextual_code": "if os.environ.get(\"PIPENV_PYPI_MIRROR\"):\n    sources[0][\"url\"] = os.environ[\"PIPENV_PYPI_MIRROR\"]\n\nsources = [\n    {k: safe_expandvars(v) if expand_vars else v for k, v in source.items()}\n    for source in self.parsed_pipfile[\"source\"]\n]\n\nfor source in sources:\n    if os.environ.get(\"PIPENV_PYPI_MIRROR\") and is_pypi_url(source.get(\"url\")):\n        source[\"url\"] = os.environ[\"PIPENV_PYPI_MIRROR\"]"
    }
  },
  {
    "pyfile": "cache.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/pipenv-2024.4.1/pipenv-2024.4.1/pipenv/patched/pip/_internal/network/cache.py",
    "line_number": "78",
    "type_description": "B815:write",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "77\t            with adjacent_tmp_file(path) as f:\n78\t                f.write(data)\n79",
    "code_snippet": "def _write(self, path: str, data: bytes) -> None:\n    with suppressed_cache_errors():\n        ensure_dir(os.path.dirname(path))\n\n        with adjacent_tmp_file(path) as f:\n            f.write(data)\n\n        replace(f.name, path)",
    "pattern_analysis": {
      "api_sequence": [
        "os.path.dirname",
        "ensure_dir",
        "adjacent_tmp_file",
        "adjacent_tmp_file.write",
        "replace"
      ],
      "api_sequence_with_args": [
        "os.path.dirname(path)",
        "ensure_dir(os.path.dirname(path))",
        "adjacent_tmp_file(path)",
        "adjacent_tmp_file.write(data)",
        "replace(f.name, path)"
      ],
      "mapped_sequence": [
        {
          "api_name": "os.path.dirname",
          "id": "path_string_operations",
          "description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "ensure_dir",
          "id": "create_directory",
          "description": "Creates directory, ignoring if it already exists",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "directory_operations"
        },
        {
          "api_name": "adjacent_tmp_file",
          "id": "create_temp_file",
          "description": "Creates temporary file that is not deleted on close",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "directory_operations"
        },
        {
          "api_name": "adjacent_tmp_file.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "replace",
          "id": "move_file",
          "description": "Moves file to destination, preserving metadata",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_transfer"
        }
      ],
      "contextual_code": "def _write(self, path: str, data: bytes) -> None:\n    with suppressed_cache_errors():\n        ensure_dir(os.path.dirname(path))\n\n        with adjacent_tmp_file(path) as f:\n            f.write(data)\n\n        replace(f.name, path)"
    }
  },
  {
    "pyfile": "markers.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/pipenv-2024.4.1/pipenv-2024.4.1/pipenv/patched/pip/_vendor/packaging/markers.py",
    "line_number": "251",
    "type_description": "B817:system",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "250\t        \"platform_release\": platform.release(),\n251\t        \"platform_system\": platform.system(),\n252\t        \"platform_version\": platform.version(),",
    "code_snippet": "def default_environment() -> Environment:\n    iver = format_full_version(sys.implementation.version)\n    implementation_name = sys.implementation.name\n    return {\n        \"implementation_name\": implementation_name,\n        \"implementation_version\": iver,\n        \"os_name\": os.name,\n        \"platform_machine\": platform.machine(),\n        \"platform_release\": platform.release(),\n        \"platform_system\": platform.system(),\n        \"platform_version\": platform.version(),\n        \"python_full_version\": platform.python_version(),\n        \"platform_python_implementation\": platform.python_implementation(),\n        \"python_version\": \".\".join(platform.python_version_tuple()[:2]),\n        \"sys_platform\": sys.platform,\n    }",
    "pattern_analysis": {
      "api_sequence": [
        "sys.implementation.version",
        "format_full_version",
        "sys.implementation.name",
        "os.name",
        "platform.machine",
        "platform.release",
        "platform.system",
        "platform.version",
        "platform.python_version",
        "platform.python_implementation",
        "platform.python_version_tuple",
        "sys.platform"
      ],
      "api_sequence_with_args": [
        "sys.implementation.version",
        "format_full_version(sys.implementation.version)",
        "sys.implementation.name",
        "os.name",
        "platform.machine()",
        "platform.release()",
        "platform.system()",
        "platform.version()",
        "platform.python_version()",
        "platform.python_implementation()",
        "platform.python_version_tuple()",
        "sys.platform"
      ],
      "mapped_sequence": [
        {
          "api_name": "sys.implementation.version",
          "id": "get_python_version",
          "description": "Retrieves Python interpreter version",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "format_full_version",
          "id": "get_python_version",
          "description": "Retrieves Python interpreter version",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "sys.implementation.name",
          "id": "get_python_version",
          "description": "Retrieves Python interpreter version",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "os.name",
          "id": "get_os_id",
          "description": "Retrieves operating system identifier",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "os_information"
        },
        {
          "api_name": "platform.machine",
          "id": "get_machine_type",
          "description": "Retrieves machine type, e.g., 'x86_64'",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "hardware_information"
        },
        {
          "api_name": "platform.release",
          "id": "get_os_release",
          "description": "Retrieves operating system release version",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "os_information"
        },
        {
          "api_name": "platform.system",
          "id": "get_os_info",
          "description": "Retrieves operating system information",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "os_information"
        },
        {
          "api_name": "platform.version",
          "id": "get_os_version",
          "description": "Retrieves operating system version",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "os_information"
        },
        {
          "api_name": "platform.python_version",
          "id": "get_python_version",
          "description": "Retrieves Python interpreter version",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "platform.python_implementation",
          "id": "get_python_version",
          "description": "Retrieves Python interpreter version",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "platform.python_version_tuple",
          "id": "get_python_version",
          "description": "Retrieves Python interpreter version",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "user_information"
        },
        {
          "api_name": "sys.platform",
          "id": "get_os_id",
          "description": "Retrieves operating system identifier",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "os_information"
        }
      ],
      "contextual_code": "def default_environment() -> Environment:\n    iver = format_full_version(sys.implementation.version)\n    implementation_name = sys.implementation.name\n    return {\n        \"implementation_name\": implementation_name,\n        \"implementation_version\": iver,\n        \"os_name\": os.name,\n        \"platform_machine\": platform.machine(),\n        \"platform_release\": platform.release(),\n        \"platform_system\": platform.system(),\n        \"platform_version\": platform.version(),\n        \"python_full_version\": platform.python_version(),\n        \"platform_python_implementation\": platform.python_implementation(),\n        \"python_version\": \".\".join(platform.python_version_tuple()[:2]),\n        \"sys_platform\": sys.platform,\n    }"
    }
  }
]