[
  {
    "metadata": {
      "package_name": "bigdl_nano-2.5.0b20240324-py3-none-win_amd64",
      "total_matches": 1,
      "processing_date": "2025-05-18 01:49:39"
    }
  },
  {
    "pyfile": "__init__.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/bigdl_nano-2.5.0b20240324-py3-none-win_amd64/bigdl/nano/tf/__init__.py",
    "line_number": "36",
    "type_description": "B812:system",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "35\n36\tif platform.system() != \"Darwin\":\n37\t    # set tf settings",
    "code_snippet": "import platform\nimport os\nimport warnings\nfrom bigdl.nano.utils.common import register_suggestion\nfrom bigdl.nano.utils.common import get_affinity_core_num\n\n\n# reset the num of threads\nif platform.system() == \"Linux\":\n    # only UNIX-like system applied\n    preset_thread_nums = int(os.environ.get(\"OMP_NUM_THREADS\", \"0\"))\n    affinity_core_num = get_affinity_core_num()\n\n    if affinity_core_num is not None and preset_thread_nums > affinity_core_num:\n        register_suggestion(f\"CPU Affinity is set to this program and {affinity_core_num} \"\n                            f\"cores are binded. While Tensorflow OpenMP code block will use \"\n                            f\"{preset_thread_nums} cores, which may cause severe performance \"\n                            f\"downgrade. Please set `OMP_NUM_THREADS` to {affinity_core_num}.\")\n\n\nif platform.system() != \"Darwin\":\n    # set tf settings\n    import tensorflow as tf\n    tf.config.set_soft_device_placement(enabled=True)\n\nfrom .dispatcher import patch_tensorflow, unpatch_tensorflow",
    "pattern_analysis": {
      "api_sequence": [
        "platform.system",
        "os.environ.get",
        "bigdl.nano.utils.common.get_affinity_core_num",
        "bigdl.nano.utils.common.register_suggestion",
        "platform.system",
        "tensorflow.config.set_soft_device_placement"
      ],
      "api_sequence_with_args": [
        "platform.system()",
        "os.environ.get(\"OMP_NUM_THREADS\", \"0\")",
        "bigdl.nano.utils.common.get_affinity_core_num()",
        "bigdl.nano.utils.common.register_suggestion(f\"CPU Affinity is set to this program and {affinity_core_num} cores are binded. While Tensorflow OpenMP code block will use {preset_thread_nums} cores, which may cause severe performance downgrade. Please set `OMP_NUM_THREADS` to {affinity_core_num}.\")",
        "platform.system()",
        "tensorflow.config.set_soft_device_placement(enabled=True)"
      ],
      "mapped_sequence": [
        {
          "api_name": "platform.system",
          "id": "get_platform_info",
          "description": "Retrieves platform information as string",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "os_information"
        },
        {
          "api_name": "os.environ.get",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "bigdl.nano.utils.common.get_affinity_core_num",
          "id": "get_processor_name",
          "description": "Retrieves processor name as string",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "hardware_information"
        },
        {
          "api_name": "bigdl.nano.utils.common.register_suggestion",
          "id": "log_info",
          "description": "Logs informational message",
          "first_id": "data_exfiltration",
          "second_id": "data_collection_operations",
          "third_id": "data_acquisition"
        },
        {
          "api_name": "platform.system",
          "id": "get_platform_info",
          "description": "Retrieves platform information as string",
          "first_id": "information_gathering",
          "second_id": "system_information_collection",
          "third_id": "os_information"
        },
        {
          "api_name": "tensorflow.config.set_soft_device_placement",
          "id": "set_builtin_attr",
          "description": "Sets attribute on builtins object",
          "first_id": "persistence_stealth",
          "second_id": "stealth_techniques",
          "third_id": "warning_disabling"
        }
      ],
      "contextual_code": "import platform\nimport os\nfrom bigdl.nano.utils.common import register_suggestion\nfrom bigdl.nano.utils.common import get_affinity_core_num\n\n# reset the num of threads\nif platform.system() == \"Linux\":\n    preset_thread_nums = int(os.environ.get(\"OMP_NUM_THREADS\", \"0\"))\n    affinity_core_num = get_affinity_core_num()\n\n    if affinity_core_num is not None and preset_thread_nums > affinity_core_num:\n        register_suggestion(f\"CPU Affinity is set to this program and {affinity_core_num} \"\n                            f\"cores are binded. While Tensorflow OpenMP code block will use \"\n                            f\"{preset_thread_nums} cores, which may cause severe performance \"\n                            f\"downgrade. Please set `OMP_NUM_THREADS` to {affinity_core_num}.\")\n\nif platform.system() != \"Darwin\":\n    import tensorflow as tf\n    tf.config.set_soft_device_placement(enabled=True)"
    }
  }
]