[
  {
    "metadata": {
      "package_name": "gcsfs-2025.3.2",
      "total_matches": 1,
      "processing_date": "2025-05-18 01:49:39"
    }
  },
  {
    "pyfile": "test_core.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/gcsfs-2025.3.2/gcsfs-2025.3.2/gcsfs/tests/test_core.py",
    "line_number": "1544",
    "type_description": "B815:write",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "1543\t    with gcs.open(file, \"wb\") as f:\n1544\t        f.write(b\"This is a test string\")\n1545\t    assert gcs.cat(file) == b\"This is a test string\"",
    "code_snippet": "def test_sign(gcs, monkeypatch):\n    file = TEST_BUCKET + \"/test.jpg\"\n    with gcs.open(file, \"wb\") as f:\n        f.write(b\"This is a test string\")\n    assert gcs.cat(file) == b\"This is a test string\"\n\n    # `sign` is creating a google Client on its own, it needs a realistically\n    # looking credentials file.\n    if not gcs.on_google:\n        monkeypatch.setenv(\n            \"GOOGLE_APPLICATION_CREDENTIALS\",\n            os.path.dirname(__file__) + \"/fake-service-account-credentials.json\",\n        )\n\n    current_ts_utc = int(datetime.now(tz=timezone.utc).timestamp())\n    result = gcs.sign(file)\n\n    # Check it here since emulator doesn't really validate those values\n    params = parse_qs(urlparse(result).query)\n    assert int(params[\"Expires\"][0]) >= current_ts_utc + 100\n\n    response = requests.get(result)\n    assert response.text == \"This is a test string\"",
    "pattern_analysis": {
      "api_sequence": [
        "gcs.open",
        "gcs.open.write",
        "gcs.cat",
        "gcs.on_google",
        "monkeypatch.setenv",
        "os.path.dirname",
        "datetime.now",
        "datetime.now.timestamp",
        "gcs.sign",
        "parse_qs",
        "urlparse",
        "requests.get",
        "requests.get.text"
      ],
      "api_sequence_with_args": [
        "gcs.open(file, \"wb\")",
        "gcs.open(file, \"wb\").write(b\"This is a test string\")",
        "gcs.cat(file)",
        "gcs.on_google",
        "monkeypatch.setenv(\"GOOGLE_APPLICATION_CREDENTIALS\", os.path.dirname(__file__) + \"/fake-service-account-credentials.json\")",
        "os.path.dirname(__file__)",
        "datetime.now(tz=timezone.utc)",
        "datetime.now(tz=timezone.utc).timestamp()",
        "gcs.sign(file)",
        "parse_qs(urlparse(result).query)",
        "urlparse(result)",
        "requests.get(result)",
        "requests.get(result).text"
      ],
      "mapped_sequence": [
        {
          "api_name": "gcs.open",
          "id": "basic_write_operations",
          "description": "Basic file opening operations for writing (normal writing, binary writing)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_opening"
        },
        {
          "api_name": "gcs.open.write",
          "id": "basic_file_writing",
          "description": "Writing data to files (strings or bytes)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_writing"
        },
        {
          "api_name": "gcs.cat",
          "id": "basic_file_reading",
          "description": "Reading content from files (by lines or entire content)",
          "first_id": "file_operations",
          "second_id": "file_reading_writing",
          "third_id": "file_reading"
        },
        {
          "api_name": "gcs.on_google",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "monkeypatch.setenv",
          "id": "get_env_var",
          "description": "Retrieves value of environment variable",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "environment_information"
        },
        {
          "api_name": "os.path.dirname",
          "id": "path_string_operations",
          "description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
          "first_id": "file_operations",
          "second_id": "file_management",
          "third_id": "file_path_operations"
        },
        {
          "api_name": "datetime.now",
          "id": "get_current_time",
          "description": "Returns current time in seconds since epoch",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "time_operations"
        },
        {
          "api_name": "datetime.now.timestamp",
          "id": "get_current_time",
          "description": "Returns current time in seconds since epoch",
          "first_id": "system_operations",
          "second_id": "system_environment_operations",
          "third_id": "time_operations"
        },
        {
          "api_name": "gcs.sign",
          "id": "create_http_request",
          "description": "Creates HTTP request object with specified URL, data, and headers",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_creation"
        },
        {
          "api_name": "parse_qs",
          "id": "decode_bytes_default",
          "description": "Decodes bytes using default codec",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "urlparse",
          "id": "decode_bytes_default",
          "description": "Decodes bytes using default codec",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "requests.get",
          "id": "send_http_get",
          "description": "Sends HTTP GET request with parameters and timeout",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "request_sending"
        },
        {
          "api_name": "requests.get.text",
          "id": "get_response_body",
          "description": "Retrieves response body from HTTP response",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        }
      ],
      "contextual_code": "def test_sign(gcs, monkeypatch):\n    file = TEST_BUCKET + \"/test.jpg\"\n    with gcs.open(file, \"wb\") as f:\n        f.write(b\"This is a test string\")\n    assert gcs.cat(file) == b\"This is a test string\"\n\n    if not gcs.on_google:\n        monkeypatch.setenv(\n            \"GOOGLE_APPLICATION_CREDENTIALS\",\n            os.path.dirname(__file__) + \"/fake-service-account-credentials.json\",\n        )\n\n    current_ts_utc = int(datetime.now(tz=timezone.utc).timestamp())\n    result = gcs.sign(file)\n\n    params = parse_qs(urlparse(result).query)\n    assert int(params[\"Expires\"][0]) >= current_ts_utc + 100\n\n    response = requests.get(result)\n    assert response.text == \"This is a test string\""
    }
  }
]