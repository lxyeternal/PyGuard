[
  {
    "metadata": {
      "package_name": "kodexa-7.4.414330611518",
      "total_matches": 1,
      "processing_date": "2025-05-18 01:49:39"
    }
  },
  {
    "pyfile": "client.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/kodexa-7.4.414330611518/kodexa-7.4.414330611518/kodexa/platform/client.py",
    "line_number": "6418",
    "type_description": "B820:get",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "6417\t    if response.status_code == 400:\n6418\t        if response.json() and response.json().get(\"errors\"):\n6419\t            messages = []",
    "code_snippet": "def process_response(response) -> requests.Response:\n    \"\"\"\n    This function processes the server response. It checks the status code of the response and raises an exception with\n    a specific message depending on the status code. If the status code is 401, it raises an \"Unauthorized\" exception.\n    If the status code is 404, it raises a \"Not found\" exception.\n    If the status code is 405, it raises a \"Method not allowed\" exception.\n    If the status code is 500, it raises an \"Internal server error\" exception.\n    If the status code is 400, it checks if the response has a JSON body with an \"errors\" field.\n    If so, it raises an exception with a message containing all the errors.\n    If not, it raises a \"Bad request\" exception.\n    If the status code is anything other than 200, it raises an \"Unexpected response\" exception.\n    If the status code is 200, it returns the response as is.\n\n    Args:\n        response (requests.Response): The server response to process.\n\n    Returns:\n        requests.Response: The original server response if the status code is 200.\n\n    Raises:\n        Exception: If the status code is not 200, an exception is raised with a message specific to the status code.\n    \"\"\"\n    if response.status_code == 401:\n        raise Exception(f\"Unauthorized ({response.text})\")\n    if response.status_code == 404:\n        raise Exception(f\"Not found ({response.text})\")\n    if response.status_code in [301, 302]:\n        raise Exception(f\"Redirected ({response.text})\")\n    if response.status_code == 405:\n        raise Exception(\"Method not allowed\")\n    if response.status_code == 500:\n        raise Exception(\"Internal server error: \\n\" + response.text)\n    if response.status_code == 400:\n        if response.json() and response.json().get(\"errors\"):\n            messages = []\n            for key, value in response.json()[\"errors\"].items():\n                messages.append(f\"{key}: {value}\")\n            raise Exception(\", \".join(messages))\n\n        raise Exception(\"Bad request \" + response.text)\n\n    return response",
    "pattern_analysis": {
      "api_sequence": [
        "response.status_code",
        "response.text",
        "response.status_code",
        "response.text",
        "response.status_code",
        "response.text",
        "response.status_code",
        "response.status_code",
        "response.text",
        "response.status_code",
        "response.json",
        "response.json",
        "response.json",
        "response.json",
        "response.text"
      ],
      "api_sequence_with_args": [
        "response.status_code",
        "response.text",
        "response.status_code",
        "response.text",
        "response.status_code",
        "response.text",
        "response.status_code",
        "response.status_code",
        "response.text",
        "response.status_code",
        "response.json()",
        "response.json()",
        "response.json().get(\"errors\")",
        "response.json()[\"errors\"].items()",
        "response.text"
      ],
      "mapped_sequence": [
        {
          "api_name": "response.status_code",
          "id": "get_http_status",
          "description": "Retrieves HTTP response status code",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "response.text",
          "id": "get_response_body",
          "description": "Retrieves response body from HTTP response",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "response.status_code",
          "id": "get_http_status",
          "description": "Retrieves HTTP response status code",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "response.text",
          "id": "get_response_body",
          "description": "Retrieves response body from HTTP response",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "response.status_code",
          "id": "get_http_status",
          "description": "Retrieves HTTP response status code",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "response.text",
          "id": "get_response_body",
          "description": "Retrieves response body from HTTP response",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "response.status_code",
          "id": "get_http_status",
          "description": "Retrieves HTTP response status code",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "response.status_code",
          "id": "get_http_status",
          "description": "Retrieves HTTP response status code",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "response.text",
          "id": "get_response_body",
          "description": "Retrieves response body from HTTP response",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "response.status_code",
          "id": "get_http_status",
          "description": "Retrieves HTTP response status code",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "response.json",
          "id": "deserialize_json_response",
          "description": "Deserializes JSON response body to Python object",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "response.json",
          "id": "deserialize_json_response",
          "description": "Deserializes JSON response body to Python object",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "response.json().get",
          "id": "deserialize_json_response",
          "description": "Deserializes JSON response body to Python object",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "response.json()[\"errors\"].items",
          "id": "deserialize_json_response",
          "description": "Deserializes JSON response body to Python object",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        },
        {
          "api_name": "response.text",
          "id": "get_response_body",
          "description": "Retrieves response body from HTTP response",
          "first_id": "basic_network_operations",
          "second_id": "http_requests",
          "third_id": "response_processing"
        }
      ],
      "contextual_code": "def process_response(response) -> requests.Response:\n    if response.status_code == 401:\n        raise Exception(f\"Unauthorized ({response.text})\")\n    if response.status_code == 404:\n        raise Exception(f\"Not found ({response.text})\")\n    if response.status_code in [301, 302]:\n        raise Exception(f\"Redirected ({response.text})\")\n    if response.status_code == 405:\n        raise Exception(\"Method not allowed\")\n    if response.status_code == 500:\n        raise Exception(\"Internal server error: \\n\" + response.text)\n    if response.status_code == 400:\n        if response.json() and response.json().get(\"errors\"):\n            messages = []\n            for key, value in response.json()[\"errors\"].items():\n                messages.append(f\"{key}: {value}\")\n            raise Exception(\", \".join(messages))\n        raise Exception(\"Bad request \" + response.text)\n    return response"
    }
  }
]