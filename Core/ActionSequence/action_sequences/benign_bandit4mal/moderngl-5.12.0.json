[
  {
    "metadata": {
      "package_name": "moderngl-5.12.0",
      "total_matches": 1,
      "processing_date": "2025-05-18 01:49:40"
    }
  },
  {
    "pyfile": "_moderngl.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/moderngl-5.12.0/moderngl-5.12.0/_moderngl.py",
    "line_number": "214",
    "type_description": "B841:cdll",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "213\t            try:\n214\t                lib = ctypes.CDLL(\"libEGL.so\")\n215\t                proc = ctypes.cast(lib.eglGetProcAddress, ctypes.CFUNCTYPE(ctypes.c_ulonglong, ctypes.c_char_p))",
    "code_snippet": "class DefaultLoader:\n    def __init__(self):\n        import ctypes\n        import sys\n\n        def funcptr(lib, name):\n            return ctypes.cast(getattr(lib, name, 0), ctypes.c_void_p).value or 0\n\n        if sys.platform.startswith(\"win\"):\n            lib = ctypes.WinDLL(\"opengl32.dll\")\n            proc = ctypes.cast(lib.wglGetProcAddress, ctypes.WINFUNCTYPE(ctypes.c_ulonglong, ctypes.c_char_p))\n            if not lib.wglGetCurrentContext():\n                raise RuntimeError(\"Cannot detect window with OpenGL support\")\n\n            def loader(name):\n                return proc(name.encode()) or funcptr(lib, name)\n\n        elif sys.platform.startswith(\"linux\"):\n            try:\n                lib = ctypes.CDLL(\"libEGL.so\")\n                proc = ctypes.cast(lib.eglGetProcAddress, ctypes.CFUNCTYPE(ctypes.c_ulonglong, ctypes.c_char_p))\n                if not lib.eglGetCurrentContext():\n                    raise RuntimeError(\"Cannot detect window with OpenGL support\")\n\n                def loader(name):\n                    return proc(name.encode())\n\n            except:\n                lib = ctypes.CDLL(\"libGL.so\")\n                proc = ctypes.cast(lib.glXGetProcAddress, ctypes.CFUNCTYPE(ctypes.c_ulonglong, ctypes.c_char_p))\n                if not lib.glXGetCurrentContext():\n                    raise RuntimeError(\"Cannot detect window with OpenGL support\")\n\n                def loader(name):\n                    return proc(name.encode()) or funcptr(lib, name)\n\n        elif sys.platform.startswith(\"darwin\"):\n            lib = ctypes.CDLL(\"/System/Library/Frameworks/OpenGL.framework/OpenGL\")\n\n            def loader(name):\n                return funcptr(lib, name)\n\n        elif sys.platform.startswith(\"emscripten\"):\n            lib = ctypes.CDLL(None)\n\n            def loader(name):\n                return funcptr(lib, name)\n\n        elif sys.platform.startswith(\"wasi\"):\n            lib = ctypes.CDLL(None)\n\n            def loader(name):\n                return funcptr(lib, name)\n\n        self.load_opengl_function = loader\n\n    def __enter__(self):\n        pass\n\n    def __exit__(self, *args):\n        pass\n\n    def release(self):\n        pass",
    "pattern_analysis": {
      "api_sequence": [
        "ctypes.WinDLL",
        "ctypes.cast",
        "getattr",
        "ctypes.WINFUNCTYPE",
        "ctypes.c_ulonglong",
        "ctypes.c_char_p",
        "lib.wglGetProcAddress",
        "lib.wglGetCurrentContext",
        "proc",
        "name.encode",
        "ctypes.cast",
        "getattr",
        "ctypes.c_void_p",
        "ctypes.CDLL",
        "ctypes.cast",
        "ctypes.CFUNCTYPE",
        "lib.eglGetProcAddress",
        "lib.eglGetCurrentContext",
        "proc",
        "name.encode",
        "ctypes.CDLL",
        "ctypes.cast",
        "ctypes.CFUNCTYPE",
        "lib.glXGetProcAddress",
        "lib.glXGetCurrentContext",
        "proc",
        "name.encode",
        "ctypes.CDLL",
        "ctypes.CDLL",
        "funcptr"
      ],
      "api_sequence_with_args": [
        "ctypes.WinDLL(\"opengl32.dll\")",
        "ctypes.cast(lib.wglGetProcAddress, ctypes.WINFUNCTYPE(ctypes.c_ulonglong, ctypes.c_char_p))",
        "getattr(lib, name, 0)",
        "ctypes.WINFUNCTYPE(ctypes.c_ulonglong, ctypes.c_char_p)",
        "ctypes.c_ulonglong",
        "ctypes.c_char_p",
        "lib.wglGetProcAddress",
        "lib.wglGetCurrentContext()",
        "proc(name.encode())",
        "name.encode()",
        "ctypes.cast(getattr(lib, name, 0), ctypes.c_void_p)",
        "getattr(lib, name, 0)",
        "ctypes.c_void_p",
        "ctypes.CDLL(\"libEGL.so\")",
        "ctypes.cast(lib.eglGetProcAddress, ctypes.CFUNCTYPE(ctypes.c_ulonglong, ctypes.c_char_p))",
        "ctypes.CFUNCTYPE(ctypes.c_ulonglong, ctypes.c_char_p)",
        "lib.eglGetProcAddress",
        "lib.eglGetCurrentContext()",
        "proc(name.encode())",
        "name.encode()",
        "ctypes.CDLL(\"libGL.so\")",
        "ctypes.cast(lib.glXGetProcAddress, ctypes.CFUNCTYPE(ctypes.c_ulonglong, ctypes.c_char_p))",
        "ctypes.CFUNCTYPE(ctypes.c_ulonglong, ctypes.c_char_p)",
        "lib.glXGetProcAddress",
        "lib.glXGetCurrentContext()",
        "proc(name.encode())",
        "name.encode()",
        "ctypes.CDLL(\"/System/Library/Frameworks/OpenGL.framework/OpenGL\")",
        "ctypes.CDLL(None)",
        "funcptr(lib, name)"
      ],
      "mapped_sequence": [
        {
          "api_name": "ctypes.WinDLL",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "ctypes.cast",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "getattr",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "ctypes.WINFUNCTYPE",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "ctypes.c_ulonglong",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "ctypes.c_char_p",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "lib.wglGetProcAddress",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "lib.wglGetCurrentContext",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "proc",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "name.encode",
          "id": "encode_string_to_bytes",
          "description": "Encodes string to bytes using default encoding",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "ctypes.cast",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "getattr",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "ctypes.c_void_p",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "ctypes.CDLL",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "ctypes.cast",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "ctypes.CFUNCTYPE",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "lib.eglGetProcAddress",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "lib.eglGetCurrentContext",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "proc",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "name.encode",
          "id": "encode_string_to_bytes",
          "description": "Encodes string to bytes using default encoding",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "ctypes.CDLL",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "ctypes.cast",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "ctypes.CFUNCTYPE",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "lib.glXGetProcAddress",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "lib.glXGetCurrentContext",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "proc",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "name.encode",
          "id": "encode_string_to_bytes",
          "description": "Encodes string to bytes using default encoding",
          "first_id": "data_transformation_processing",
          "second_id": "data_encoding",
          "third_id": "byte_encoding"
        },
        {
          "api_name": "ctypes.CDLL",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "ctypes.CDLL",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        },
        {
          "api_name": "funcptr",
          "id": "import_dynamic",
          "description": "Dynamically imports specified module",
          "first_id": "code_execution",
          "second_id": "module_management",
          "third_id": "module_importing"
        }
      ],
      "contextual_code": "import ctypes\nimport sys\n\ndef funcptr(lib, name):\n    return ctypes.cast(getattr(lib, name, 0), ctypes.c_void_p).value or 0\n\nif sys.platform.startswith(\"win\"):\n    lib = ctypes.WinDLL(\"opengl32.dll\")\n    proc = ctypes.cast(lib.wglGetProcAddress, ctypes.WINFUNCTYPE(ctypes.c_ulonglong, ctypes.c_char_p))\n    if not lib.wglGetCurrentContext():\n        raise RuntimeError(\"Cannot detect window with OpenGL support\")\n    def loader(name):\n        return proc(name.encode()) or funcptr(lib, name)\n\nelif sys.platform.startswith(\"linux\"):\n    try:\n        lib = ctypes.CDLL(\"libEGL.so\")\n        proc = ctypes.cast(lib.eglGetProcAddress, ctypes.CFUNCTYPE(ctypes.c_ulonglong, ctypes.c_char_p))\n        if not lib.eglGetCurrentContext():\n            raise RuntimeError(\"Cannot detect window with OpenGL support\")\n        def loader(name):\n            return proc(name.encode())\n    except:\n        lib = ctypes.CDLL(\"libGL.so\")\n        proc = ctypes.cast(lib.glXGetProcAddress, ctypes.CFUNCTYPE(ctypes.c_ulonglong, ctypes.c_char_p))\n        if not lib.glXGetCurrentContext():\n            raise RuntimeError(\"Cannot detect window with OpenGL support\")\n        def loader(name):\n            return proc(name.encode()) or funcptr(lib, name)\n\nelif sys.platform.startswith(\"darwin\"):\n    lib = ctypes.CDLL(\"/System/Library/Frameworks/OpenGL.framework/OpenGL\")\n    def loader(name):\n        return funcptr(lib, name)\n\nelif sys.platform.startswith(\"emscripten\"):\n    lib = ctypes.CDLL(None)\n    def loader(name):\n        return funcptr(lib, name)\n\nelif sys.platform.startswith(\"wasi\"):\n    lib = ctypes.CDLL(None)\n    def loader(name):\n        return funcptr(lib, name)\n"
    }
  }
]