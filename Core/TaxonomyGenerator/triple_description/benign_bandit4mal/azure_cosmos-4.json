{
  "metadata": {
    "package_name": "azure_cosmos-4",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/benign_bandit4mal/azure_cosmos-4.10.0b4.json",
    "dataset_type": "benign_bandit4mal"
  },
  "code_files": [
    {
      "pyfile": "test_full_text_policy.py",
      "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/azure_cosmos-4.10.0b4/azure_cosmos-4.10.0b4/tests/test_full_text_policy.py",
      "line_number": "81",
      "type_description": "B814:read",
      "context_snippet": "@pytest.mark.cosmosSearchQuery\nclass TestFullTextPolicy(unittest.TestCase):\n    client: CosmosClient = None\n    host = test_config.TestConfig.host\n    masterKey = test_config.TestConfig.masterKey\n    connectionPolicy = test_config.TestConfig.connectionPolicy\n\n    @classmethod\n    def setUpClass(cls):\n        if (cls.masterKey == '[YOUR_KEY_HERE]' or\n                cls.host == '[YOUR_ENDPOINT_HERE]'):\n            raise Exception(\n                \"You must specify your Azure Cosmos account values for \"\n                \"'masterKey' and 'host' at the top of this class to run the \"\n                \"tests.\")\n\n        cls.client = CosmosClient(cls.host, cls.masterKey)\n        cls.created_database = cls.client.get_database_client(test_config.TestConfig.TEST_DATABASE_ID)\n        cls.test_db = cls.client.create_database(str(uuid.uuid4()))\n\n    def test_replace_full_text_container(self):\n        # Replace a container without a full text policy and full text indexing policy\n\n        created_container = self.test_db.create_container(\n            id='full_text_container' + str(uuid.uuid4()),\n            partition_key=PartitionKey(path=\"/id\")\n        )\n        created_container_properties = created_container.read()\n        full_text_policy = {\n            \"defaultLanguage\": \"en-US\",\n            \"fullTextPaths\": [\n                {\n                    \"path\": \"/abstract\",\n                    \"language\": \"en-US\"\n                }\n            ]\n        }\n        indexing_policy = {\n            \"fullTextIndexes\": [\n                {\"path\": \"/abstract\"}\n            ]\n        }\n\n        # Replace the container with new policies\n        replaced_container = self.test_db.replace_container(\n            container=created_container.id,\n            partition_key=PartitionKey(path=\"/id\"),\n            full_text_policy=full_text_policy,\n            indexing_policy=indexing_policy\n        )\n        properties = replaced_container.read()\n        assert properties[\"fullTextPolicy\"] == full_text_policy\n        assert properties[\"indexingPolicy\"]['fullTextIndexes'] == indexing_policy['fullTextIndexes']\n        assert created_container_properties['indexingPolicy'] != properties['indexingPolicy']\n        self.test_db.delete_container(created_container.id)\n\n        # Replace a container with a valid full text policy and full text indexing policy\n        created_container = self.test_db.create_container(\n            id='full_text_container' + str(uuid.uuid4()),\n            partition_key=PartitionKey(path=\"/id\"),\n            full_text_policy=full_text_policy,\n            indexing_policy=indexing_policy\n        )\n        created_container_properties = created_container.read()\n        assert properties[\"fullTextPolicy\"] == full_text_policy\n        assert properties[\"indexingPolicy\"]['fullTextIndexes'] == indexing_policy['fullTextIndexes']\n\n        # Replace the container with new policies\n        full_text_policy['fullTextPaths'][0]['path'] = \"/new_path\"\n        indexing_policy['fullTextIndexes'][0]['path'] = \"/new_path\"\n        replaced_container = self.test_db.replace_container(\n            container=created_container.id,\n            partition_key=PartitionKey(path=\"/id\"),\n            full_text_policy=full_text_policy,\n            indexing_policy=indexing_policy\n        )\n        properties = replaced_container.read()\n        assert properties[\"fullTextPolicy\"] == full_text_policy\n        assert properties[\"indexingPolicy\"]['fullTextIndexes'] == indexing_policy['fullTextIndexes']\n        assert created_container_properties['fullTextPolicy'] != properties['fullTextPolicy']\n        assert created_container_properties[\"indexingPolicy\"] != properties[\"indexingPolicy\"]\n        self.test_db.delete_container(created_container.id)\n",
      "hash_value": "0b5d188083e1bb04fc2f533d5e21b649",
      "severity": "High",
      "confidence": "Medium",
      "code_snippets": [
        {
          "snippet": "@pytest.mark.cosmosSearchQuery\nclass TestFullTextPolicy(unittest.TestCase):\n    client: CosmosClient = None\n    host = test_config.TestConfig.host\n    masterKey = test_config.TestConfig.masterKey\n    connectionPolicy = test_config.TestConfig.connectionPolicy\n\n    @classmethod\n    def setUpClass(cls):\n        if (cls.masterKey == '[YOUR_KEY_HERE]' or\n                cls.host == '[YOUR_ENDPOINT_HERE]'):\n            raise Exception(\n                \"You must specify your Azure Cosmos account values for \"\n                \"'masterKey' and 'host' at the top of this class to run the \"\n                \"tests.\")\n\n        cls.client = CosmosClient(cls.host, cls.masterKey)\n        cls.created_database = cls.client.get_database_client(test_config.TestConfig.TEST_DATABASE_ID)\n        cls.test_db = cls.client.create_database(str(uuid.uuid4()))\n\n    def test_replace_full_text_container(self):\n        # Replace a container without a full text policy and full text indexing policy\n\n        created_container = self.test_db.create_container(\n            id='full_text_container' + str(uuid.uuid4()),\n            partition_key=PartitionKey(path=\"/id\")\n        )\n        created_container_properties = created_container.read()\n        full_text_policy = {\n            \"defaultLanguage\": \"en-US\",\n            \"fullTextPaths\": [\n                {\n                    \"path\": \"/abstract\",\n                    \"language\": \"en-US\"\n                }\n            ]\n        }\n        indexing_policy = {\n            \"fullTextIndexes\": [\n                {\"path\": \"/abstract\"}\n            ]\n        }\n\n        # Replace the container with new policies\n        replaced_container = self.test_db.replace_container(\n            container=created_container.id,\n            partition_key=PartitionKey(path=\"/id\"),\n            full_text_policy=full_text_policy,\n            indexing_policy=indexing_policy\n        )\n        properties = replaced_container.read()\n        assert properties[\"fullTextPolicy\"] == full_text_policy\n        assert properties[\"indexingPolicy\"]['fullTextIndexes'] == indexing_policy['fullTextIndexes']\n        assert created_container_properties['indexingPolicy'] != properties['indexingPolicy']\n        self.test_db.delete_container(created_container.id)\n\n        # Replace a container with a valid full text policy and full text indexing policy\n        created_container = self.test_db.create_container(\n            id='full_text_container' + str(uuid.uuid4()),\n            partition_key=PartitionKey(path=\"/id\"),\n            full_text_policy=full_text_policy,\n            indexing_policy=indexing_policy\n        )\n        created_container_properties = created_container.read()\n        assert properties[\"fullTextPolicy\"] == full_text_policy\n        assert properties[\"indexingPolicy\"]['fullTextIndexes'] == indexing_policy['fullTextIndexes']\n\n        # Replace the container with new policies\n        full_text_policy['fullTextPaths'][0]['path'] = \"/new_path\"\n        indexing_policy['fullTextIndexes'][0]['path'] = \"/new_path\"\n        replaced_container = self.test_db.replace_container(\n            container=created_container.id,\n            partition_key=PartitionKey(path=\"/id\"),\n            full_text_policy=full_text_policy,\n            indexing_policy=indexing_policy\n        )\n        properties = replaced_container.read()\n        assert properties[\"fullTextPolicy\"] == full_text_policy\n        assert properties[\"indexingPolicy\"]['fullTextIndexes'] == indexing_policy['fullTextIndexes']\n        assert created_container_properties['fullTextPolicy'] != properties['fullTextPolicy']\n        assert created_container_properties[\"indexingPolicy\"] != properties[\"indexingPolicy\"]\n        self.test_db.delete_container(created_container.id)\n",
          "triple_sequences": [
            {
              "action_api": "CosmosClient()",
              "action_description": "Instantiates CosmosClient class",
              "action_id": "init_grabber_class",
              "object": "cls.host, cls.masterKey",
              "object_description": "API endpoint",
              "object_id": "api_endpoint",
              "intention_description": "Establish connection",
              "intention_id": "establish_connection"
            },
            {
              "action_api": "CosmosClient.get_database_client()",
              "action_description": "Retrieves database client object",
              "action_id": "get_process_info",
              "object": "test_config.TestConfig.TEST_DATABASE_ID",
              "object_description": "API key or token",
              "object_id": "api_key",
              "intention_description": "Access attribute value",
              "intention_id": "access_attribute_value"
            },
            {
              "action_api": "CosmosClient.create_database()",
              "action_description": "Creates database, ignoring if it already exists",
              "action_id": "create_directory",
              "object": "str(uuid.uuid4())",
              "object_description": "Random string",
              "object_id": "random_string",
              "intention_description": "Create temporary directory",
              "intention_id": "create_temporary_directory"
            },
            {
              "action_api": "Database.create_container()",
              "action_description": "Creates directory, ignoring if it already exists",
              "action_id": "create_directory",
              "object": "id='full_text_container' + str(uuid.uuid4()), partition_key=PartitionKey(path=\"/id\")",
              "object_description": "Random string",
              "object_id": "random_string",
              "intention_description": "Create temporary directory",
              "intention_id": "create_temporary_directory"
            },
            {
              "action_api": "Container.read()",
              "action_description": "Reads all bytes from process standard output",
              "action_id": "read_process_stdout",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Access attribute value",
              "intention_id": "access_attribute_value"
            },
            {
              "action_api": "Database.replace_container()",
              "action_description": "Moves file to destination",
              "action_id": "move_file",
              "object": "container=created_container.id, partition_key=PartitionKey(path=\"/id\"), full_text_policy=full_text_policy, indexing_policy=indexing_policy",
              "object_description": "Random string",
              "object_id": "random_string",
              "intention_description": "Move file to destination",
              "intention_id": "move_file_destination"
            },
            {
              "action_api": "Container.read()",
              "action_description": "Reads all bytes from process standard output",
              "action_id": "read_process_stdout",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Access attribute value",
              "intention_id": "access_attribute_value"
            },
            {
              "action_api": "Database.delete_container()",
              "action_description": "Deletes specified file from filesystem",
              "action_id": "delete_file",
              "object": "created_container.id",
              "object_description": "Random string",
              "object_id": "random_string",
              "intention_description": "Delete file",
              "intention_id": "delete_file"
            },
            {
              "action_api": "Database.create_container()",
              "action_description": "Creates directory, ignoring if it already exists",
              "action_id": "create_directory",
              "object": "id='full_text_container' + str(uuid.uuid4()), partition_key=PartitionKey(path=\"/id\"), full_text_policy=full_text_policy, indexing_policy=indexing_policy",
              "object_description": "Random string",
              "object_id": "random_string",
              "intention_description": "Create temporary directory",
              "intention_id": "create_temporary_directory"
            },
            {
              "action_api": "Container.read()",
              "action_description": "Reads all bytes from process standard output",
              "action_id": "read_process_stdout",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Access attribute value",
              "intention_id": "access_attribute_value"
            },
            {
              "action_api": "Database.replace_container()",
              "action_description": "Moves file to destination",
              "action_id": "move_file",
              "object": "container=created_container.id, partition_key=PartitionKey(path=\"/id\"), full_text_policy=full_text_policy, indexing_policy=indexing_policy",
              "object_description": "Random string",
              "object_id": "random_string",
              "intention_description": "Move file to destination",
              "intention_id": "move_file_destination"
            },
            {
              "action_api": "Container.read()",
              "action_description": "Reads all bytes from process standard output",
              "action_id": "read_process_stdout",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Access attribute value",
              "intention_id": "access_attribute_value"
            },
            {
              "action_api": "Database.delete_container()",
              "action_description": "Deletes specified file from filesystem",
              "action_id": "delete_file",
              "object": "created_container.id",
              "object_description": "Random string",
              "object_id": "random_string",
              "intention_description": "Delete file",
              "intention_id": "delete_file"
            }
          ]
        }
      ]
    }
  ]
}