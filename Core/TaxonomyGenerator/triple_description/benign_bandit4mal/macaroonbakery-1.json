{
  "metadata": {
    "package_name": "macaroonbakery-1",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/benign_bandit4mal/macaroonbakery-1.3.4.json",
    "dataset_type": "benign_bandit4mal"
  },
  "code_files": [
    {
      "pyfile": "test_client.py",
      "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/macaroonbakery-1.3.4/macaroonbakery-1.3.4/macaroonbakery/tests/test_client.py",
      "line_number": "305",
      "type_description": "B827:httpserver",
      "context_snippet": "def test_single_service_first_party(self):\n    b = new_bakery('loc', None, None)\n\n    def handler(*args):\n        GetHandler(b, None, None, None, None, AGES, *args)\n    try:\n        httpd = HTTPServer(('', 0), handler)\n        thread = threading.Thread(target=httpd.serve_forever)\n        thread.start()\n        srv_macaroon = b.oven.macaroon(\n            version=bakery.LATEST_VERSION, expiry=AGES,\n            caveats=None, ops=[TEST_OP])\n        self.assertEqual(srv_macaroon.macaroon.location, 'loc')\n        client = httpbakery.Client()\n        client.cookies.set_cookie(requests.cookies.create_cookie(\n            'macaroon-test', base64.b64encode(json.dumps([\n                srv_macaroon.to_dict().get('m')\n            ]).encode('utf-8')).decode('utf-8')\n        ))\n        resp = requests.get(\n            url='http://' + httpd.server_address[0] + ':' +\n                str(httpd.server_address[1]),\n            cookies=client.cookies, auth=client.auth())\n        resp.raise_for_status()\n        self.assertEqual(resp.text, 'done')\n    finally:\n        httpd.shutdown()",
      "hash_value": "0df7012032cbb97213792cdd9f638afe",
      "severity": "High",
      "confidence": "Medium",
      "code_snippets": [
        {
          "snippet": "def test_single_service_first_party(self):\n    b = new_bakery('loc', None, None)\n\n    def handler(*args):\n        GetHandler(b, None, None, None, None, AGES, *args)\n    try:\n        httpd = HTTPServer(('', 0), handler)\n        thread = threading.Thread(target=httpd.serve_forever)\n        thread.start()\n        srv_macaroon = b.oven.macaroon(\n            version=bakery.LATEST_VERSION, expiry=AGES,\n            caveats=None, ops=[TEST_OP])\n        self.assertEqual(srv_macaroon.macaroon.location, 'loc')\n        client = httpbakery.Client()\n        client.cookies.set_cookie(requests.cookies.create_cookie(\n            'macaroon-test', base64.b64encode(json.dumps([\n                srv_macaroon.to_dict().get('m')\n            ]).encode('utf-8')).decode('utf-8')\n        ))\n        resp = requests.get(\n            url='http://' + httpd.server_address[0] + ':' +\n                str(httpd.server_address[1]),\n            cookies=client.cookies, auth=client.auth())\n        resp.raise_for_status()\n        self.assertEqual(resp.text, 'done')\n    finally:\n        httpd.shutdown()",
          "triple_sequences": [
            {
              "action_api": "new_bakery()",
              "action_description": "Instantiates Bakery class",
              "action_id": "init_browser_class",
              "object": "'loc', None, None",
              "object_description": "",
              "object_id": "",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "threading.Thread()",
              "action_description": "Creates new thread to execute",
              "action_id": "create_thread",
              "object": "target=httpd.serve_forever",
              "object_description": "Thread target and arguments",
              "object_id": "thread_target_arguments",
              "intention_description": "Prepare thread pool for concurrent execution",
              "intention_id": "concurrent_execution_preparation"
            },
            {
              "action_api": "thread.start()",
              "action_description": "Starts thread execution",
              "action_id": "start_thread",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Prepare thread pool for concurrent execution",
              "intention_id": "concurrent_execution_preparation"
            },
            {
              "action_api": "b.oven.macaroon()",
              "action_description": "Instantiates Encrypter class",
              "action_id": "init_encrypter_class",
              "object": "version=bakery.LATEST_VERSION, expiry=AGES, caveats=None, ops=[TEST_OP]",
              "object_description": "",
              "object_id": "",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "srv_macaroon.to_dict()",
              "action_description": "Serializes Python object to JSON string",
              "action_id": "serialize_to_json",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Serialize data",
              "intention_id": "serialize_data"
            },
            {
              "action_api": "json.dumps()",
              "action_description": "Serializes Python object to JSON string",
              "action_id": "serialize_to_json",
              "object": "[srv_macaroon.to_dict().get('m')]",
              "object_description": "JSON string",
              "object_id": "json_string",
              "intention_description": "Serialize data",
              "intention_id": "serialize_data"
            },
            {
              "action_api": "str.encode()",
              "action_description": "Encodes string to bytes using default encoding",
              "action_id": "encode_string_to_bytes",
              "object": "'utf-8'",
              "object_description": "Character encoding type",
              "object_id": "character_encoding_type",
              "intention_description": "Encode string to bytes",
              "intention_id": "encode_string_to_bytes"
            },
            {
              "action_api": "base64.b64encode()",
              "action_description": "Encodes bytes to base64-encoded bytes",
              "action_id": "encode_bytes_to_base64",
              "object": "json.dumps([...]).encode('utf-8')",
              "object_description": "Encoded string to bytes",
              "object_id": "encoded_string_bytes",
              "intention_description": "Prepare data for base64 encoding",
              "intention_id": "prepare_data_base64_encoding"
            },
            {
              "action_api": "bytes.decode()",
              "action_description": "Decodes bytes using default codec",
              "action_id": "decode_bytes_default",
              "object": "'utf-8'",
              "object_description": "Character encoding type",
              "object_id": "character_encoding_type",
              "intention_description": "Decode bytes to string",
              "intention_id": "decode_bytes_to_string"
            },
            {
              "action_api": "requests.cookies.create_cookie()",
              "action_description": "Creates cookie object",
              "action_id": "get_browser_cookies",
              "object": "'macaroon-test', <base64-encoded string>",
              "object_description": "Cookie data string",
              "object_id": "cookie_data_string",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "client.cookies.set_cookie()",
              "action_description": "Retrieve browser cookies",
              "action_id": "get_browser_cookies",
              "object": "requests.cookies.create_cookie(...)",
              "object_description": "Browser cookies data",
              "object_id": "browser_cookies",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "requests.get()",
              "action_description": "Opens URL with GET parameters",
              "action_id": "open_url_get",
              "object": "'http://' + httpd.server_address[0] + ':' + str(httpd.server_address[1])",
              "object_description": "URL string",
              "object_id": "url_string",
              "intention_description": "Download remote content",
              "intention_id": "download_remote_content"
            },
            {
              "action_api": "resp.raise_for_status()",
              "action_description": "Raises HTTPError if response status code indicates error",
              "action_id": "raise_http_error",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Pause execution",
              "intention_id": "pause_execution"
            },
            {
              "action_api": "httpd.shutdown()",
              "action_description": "Closes the HTTP response object",
              "action_id": "close_http_response",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Release connection resource",
              "intention_id": "release_connection_resource"
            }
          ]
        }
      ]
    }
  ]
}