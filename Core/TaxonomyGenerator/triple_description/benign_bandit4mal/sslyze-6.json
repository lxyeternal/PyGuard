{
  "metadata": {
    "package_name": "sslyze-6",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/benign_bandit4mal/sslyze-6.1.0.json",
    "dataset_type": "benign_bandit4mal"
  },
  "code_files": [
    {
      "pyfile": "session_renegotiation_plugin.py",
      "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/sslyze-6.1.0/sslyze-6.1.0/sslyze/plugins/session_renegotiation_plugin.py",
      "line_number": "155",
      "type_description": "B804:connect",
      "context_snippet": "def _test_secure_renegotiation(server_info: ServerConnectivityInfo) -> Tuple[_ScanJobResultEnum, bool]:\n    \"\"\"Check whether the server supports secure renegotiation.\"\"\"\n    # Try with TLS 1.2 even if the server supports TLS 1.3 or higher as there is no reneg with TLS 1.3\n    if server_info.tls_probing_result.highest_tls_version_supported.value >= TlsVersionEnum.TLS_1_3.value:\n        tls_version_to_use = TlsVersionEnum.TLS_1_2\n        downgraded_from_tls_1_3 = True\n    else:\n        tls_version_to_use = server_info.tls_probing_result.highest_tls_version_supported\n        downgraded_from_tls_1_3 = False\n\n    ssl_connection = server_info.get_preconfigured_tls_connection(\n        override_tls_version=tls_version_to_use,\n        should_use_legacy_openssl=True,  # Only the legacy SSL client has methods to check for secure reneg\n    )\n    if not isinstance(ssl_connection.ssl_client, LegacySslClient):\n        raise RuntimeError(\"Should never happen\")\n\n    try:\n        # Perform the TLS handshake\n        ssl_connection.connect()\n        supports_secure_renegotiation = ssl_connection.ssl_client.get_secure_renegotiation_support()\n\n    # Should only happen when the server only supports TLS 1.3\n    except ServerRejectedTlsHandshake:\n        if downgraded_from_tls_1_3:\n            supports_secure_renegotiation = True  # Technically TLS 1.3 has no renegotiation therefore it is secure\n        else:\n            raise\n\n    finally:\n        ssl_connection.close()\n\n    return _ScanJobResultEnum.SUPPORTS_SECURE_RENEG, supports_secure_renegotiation",
      "hash_value": "cc78265639f83faa4b18e7a603fcaea1",
      "severity": "High",
      "confidence": "Medium",
      "code_snippets": [
        {
          "snippet": "def _test_secure_renegotiation(server_info: ServerConnectivityInfo) -> Tuple[_ScanJobResultEnum, bool]:\n    \"\"\"Check whether the server supports secure renegotiation.\"\"\"\n    # Try with TLS 1.2 even if the server supports TLS 1.3 or higher as there is no reneg with TLS 1.3\n    if server_info.tls_probing_result.highest_tls_version_supported.value >= TlsVersionEnum.TLS_1_3.value:\n        tls_version_to_use = TlsVersionEnum.TLS_1_2\n        downgraded_from_tls_1_3 = True\n    else:\n        tls_version_to_use = server_info.tls_probing_result.highest_tls_version_supported\n        downgraded_from_tls_1_3 = False\n\n    ssl_connection = server_info.get_preconfigured_tls_connection(\n        override_tls_version=tls_version_to_use,\n        should_use_legacy_openssl=True,  # Only the legacy SSL client has methods to check for secure reneg\n    )\n    if not isinstance(ssl_connection.ssl_client, LegacySslClient):\n        raise RuntimeError(\"Should never happen\")\n\n    try:\n        # Perform the TLS handshake\n        ssl_connection.connect()\n        supports_secure_renegotiation = ssl_connection.ssl_client.get_secure_renegotiation_support()\n\n    # Should only happen when the server only supports TLS 1.3\n    except ServerRejectedTlsHandshake:\n        if downgraded_from_tls_1_3:\n            supports_secure_renegotiation = True  # Technically TLS 1.3 has no renegotiation therefore it is secure\n        else:\n            raise\n\n    finally:\n        ssl_connection.close()\n\n    return _ScanJobResultEnum.SUPPORTS_SECURE_RENEG, supports_secure_renegotiation",
          "triple_sequences": [
            {
              "action_api": "server_info.get_preconfigured_tls_connection()",
              "action_description": "Creates SSL context with specified protocol",
              "action_id": "create_ssl_context",
              "object": "override_tls_version=tls_version_to_use, should_use_legacy_openssl=True",
              "object_description": "Protocol string",
              "object_id": "protocol_string",
              "intention_description": "Establish connection",
              "intention_id": "establish_connection"
            },
            {
              "action_api": "isinstance()",
              "action_description": "Checks if object is instance of specified type",
              "action_id": "check_instance_type",
              "object": "ssl_connection.ssl_client, LegacySslClient",
              "object_description": "",
              "object_id": "",
              "intention_description": "Determine required module presence",
              "intention_id": "determine_required_module_presence"
            },
            {
              "action_api": "ssl_connection.connect()",
              "action_description": "Establishes TCP connection to specified address",
              "action_id": "establish_tcp_connection",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Establish connection",
              "intention_id": "establish_connection"
            },
            {
              "action_api": "ssl_connection.ssl_client.get_secure_renegotiation_support()",
              "action_description": "Retrieves hardware address as 48-bit integer",
              "action_id": "get_hardware_address",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Extract security key presence",
              "intention_id": "extract_security_key_presence"
            },
            {
              "action_api": "ssl_connection.close()",
              "action_description": "Closes the socket connection",
              "action_id": "close_socket",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Release connection resource",
              "intention_id": "release_connection_resource"
            }
          ]
        }
      ]
    }
  ]
}