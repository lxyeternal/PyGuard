{
  "metadata": {
    "package_name": "python_irodsclient-3",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/benign_bandit4mal/python_irodsclient-3.1.0.json",
    "dataset_type": "benign_bandit4mal"
  },
  "code_files": [
    {
      "pyfile": "login_auth_test_must_run_manually.py",
      "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/python_irodsclient-3.1.0/python_irodsclient-3.1.0/irods/test/login_auth_test_must_run_manually.py",
      "line_number": "360",
      "type_description": "B803:gethostname",
      "context_snippet": "def create_env_dirs(self):\n    dirs = {}\n    retval = []\n    # -- create environment configurations and secrets\n    with pam_password_in_plaintext():\n        for dirname, lookup in self.user_auth_envs.items():\n            if lookup[\"AUTH\"] in (\"pam\", \"pam_password\"):\n                ses = iRODSSession(\n                    host=gethostname(),\n                    user=lookup[\"USER\"],\n                    zone=\"tempZone\",\n                    authentication_scheme=lookup[\"AUTH\"],\n                    password=lookup[\"PASSWORD\"],\n                    port=1247,\n                )\n                try:\n                    pam_hashes = ses.pam_pw_negotiated\n                except AttributeError:\n                    pam_hashes = []\n                if not pam_hashes:\n                    print(\"Warning ** PAM pw couldnt be generated\")\n                    break\n                scrambled_pw = pw_encode(pam_hashes[0])\n            # elif lookup['AUTH'] == 'XXXXXX': # TODO: insert other authentication schemes here\n            elif lookup[\"AUTH\"] in (\"native\", \"\", None):\n                scrambled_pw = pw_encode(lookup[\"PASSWORD\"])\n            cl_env = client_env_keys_from_admin_env(TEST_RODS_USER)\n            if (\n                lookup.get(\"AUTH\", None) is not None\n            ):  # - specify auth scheme only if given\n                cl_env[\"irods_authentication_scheme\"] = lookup[\"AUTH\"]\n            dirbase = os.path.join(os.environ[\"HOME\"], dirname)\n            dirs[dirbase] = {\"secrets\": scrambled_pw, \"client_environment\": cl_env}\n\n    # -- create the environment directories and write into them the configurations just created\n    for absdir in dirs.keys():\n        shutil.rmtree(absdir, ignore_errors=True)\n        os.mkdir(absdir)\n        with open(os.path.join(absdir, \"irods_environment.json\"), \"w\") as envfile:\n            envfile.write(\"{}\")\n        json_file_update(envfile.name, **dirs[absdir][\"client_environment\"])\n        with open(os.path.join(absdir, \".irodsA\"), \"w\") as secrets_file:\n            secrets_file.write(dirs[absdir][\"secrets\"])\n        os.chmod(secrets_file.name, 0o600)\n\n    retval = dirs.keys()\n    return retval",
      "hash_value": "c1ec0c958ce7ad2d35d3670f6df39953",
      "severity": "High",
      "confidence": "Medium",
      "code_snippets": [
        {
          "snippet": "def create_env_dirs(self):\n    dirs = {}\n    retval = []\n    # -- create environment configurations and secrets\n    with pam_password_in_plaintext():\n        for dirname, lookup in self.user_auth_envs.items():\n            if lookup[\"AUTH\"] in (\"pam\", \"pam_password\"):\n                ses = iRODSSession(\n                    host=gethostname(),\n                    user=lookup[\"USER\"],\n                    zone=\"tempZone\",\n                    authentication_scheme=lookup[\"AUTH\"],\n                    password=lookup[\"PASSWORD\"],\n                    port=1247,\n                )\n                try:\n                    pam_hashes = ses.pam_pw_negotiated\n                except AttributeError:\n                    pam_hashes = []\n                if not pam_hashes:\n                    print(\"Warning ** PAM pw couldnt be generated\")\n                    break\n                scrambled_pw = pw_encode(pam_hashes[0])\n            # elif lookup['AUTH'] == 'XXXXXX': # TODO: insert other authentication schemes here\n            elif lookup[\"AUTH\"] in (\"native\", \"\", None):\n                scrambled_pw = pw_encode(lookup[\"PASSWORD\"])\n            cl_env = client_env_keys_from_admin_env(TEST_RODS_USER)\n            if (\n                lookup.get(\"AUTH\", None) is not None\n            ):  # - specify auth scheme only if given\n                cl_env[\"irods_authentication_scheme\"] = lookup[\"AUTH\"]\n            dirbase = os.path.join(os.environ[\"HOME\"], dirname)\n            dirs[dirbase] = {\"secrets\": scrambled_pw, \"client_environment\": cl_env}\n\n    # -- create the environment directories and write into them the configurations just created\n    for absdir in dirs.keys():\n        shutil.rmtree(absdir, ignore_errors=True)\n        os.mkdir(absdir)\n        with open(os.path.join(absdir, \"irods_environment.json\"), \"w\") as envfile:\n            envfile.write(\"{}\")\n        json_file_update(envfile.name, **dirs[absdir][\"client_environment\"])\n        with open(os.path.join(absdir, \".irodsA\"), \"w\") as secrets_file:\n            secrets_file.write(dirs[absdir][\"secrets\"])\n        os.chmod(secrets_file.name, 0o600)\n\n    retval = dirs.keys()\n    return retval",
          "triple_sequences": [
            {
              "action_api": "os.path.join()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "os.environ[\"HOME\"], dirname",
              "object_description": "User home directory",
              "object_id": "user_home_directory",
              "intention_description": "Prepare directory path",
              "intention_id": "prepare_directory_path"
            },
            {
              "action_api": "shutil.rmtree()",
              "action_description": "Recursively deletes directory and its contents",
              "action_id": "delete_directory",
              "object": "absdir",
              "object_description": "Directory path",
              "object_id": "directory_path",
              "intention_description": "Delete directory content",
              "intention_id": "delete_directory_content"
            },
            {
              "action_api": "os.mkdir()",
              "action_description": "Creates directory, ignoring if it already exists",
              "action_id": "create_directory",
              "object": "absdir",
              "object_description": "Directory path",
              "object_id": "directory_path",
              "intention_description": "Ensure directory exists",
              "intention_id": "ensure_directory_exists"
            },
            {
              "action_api": "open()",
              "action_description": "File opening operations for writing (normal writing, binary writing)",
              "action_id": "basic_write_operations",
              "object": "os.path.join(absdir, \"irods_environment.json\")",
              "object_description": "Directory path with file",
              "object_id": "directory_path_with_file",
              "intention_description": "Prepare file for writing",
              "intention_id": "prepare_file_writing"
            },
            {
              "action_api": "envfile.write()",
              "action_description": "File opening operations for writing (normal writing, binary writing)",
              "action_id": "basic_write_operations",
              "object": "\"{}\"",
              "object_description": "File text",
              "object_id": "file_text",
              "intention_description": "Write file content",
              "intention_id": "write_file_content"
            },
            {
              "action_api": "json_file_update()",
              "action_description": "Serializes Python object to JSON string",
              "action_id": "serialize_to_json",
              "object": "envfile.name, **dirs[absdir][\"client_environment\"]",
              "object_description": "JSON string",
              "object_id": "json_string",
              "intention_description": "Serialize data",
              "intention_id": "serialize_data"
            },
            {
              "action_api": "open()",
              "action_description": "File opening operations for writing (normal writing, binary writing)",
              "action_id": "basic_write_operations",
              "object": "os.path.join(absdir, \".irodsA\")",
              "object_description": "Directory path with file",
              "object_id": "directory_path_with_file",
              "intention_description": "Prepare file for writing",
              "intention_id": "prepare_file_writing"
            },
            {
              "action_api": "secrets_file.write()",
              "action_description": "File opening operations for writing (normal writing, binary writing)",
              "action_id": "basic_write_operations",
              "object": "dirs[absdir][\"secrets\"]",
              "object_description": "File text",
              "object_id": "file_text",
              "intention_description": "Write file content",
              "intention_id": "write_file_content"
            },
            {
              "action_api": "os.chmod()",
              "action_description": "Changes file mode to add execute permission",
              "action_id": "change_file_mode_execute",
              "object": "secrets_file.name, 0o600",
              "object_description": "File permission",
              "object_id": "file_permission",
              "intention_description": "Modify file attributes",
              "intention_id": "modify_file_attributes"
            }
          ]
        }
      ]
    }
  ]
}