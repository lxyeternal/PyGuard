{
  "metadata": {
    "package_name": "mysql_connector_python-9",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/benign_bandit4mal/mysql_connector_python-9.2.0-py2.py3-none-any.json",
    "dataset_type": "benign_bandit4mal"
  },
  "code_files": [
    {
      "pyfile": "connection.py",
      "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/mysql_connector_python-9.2.0-py2.py3-none-any/mysql/connector/aio/connection.py",
      "line_number": "302",
      "type_description": "B829:getuser",
      "context_snippet": "async def _do_auth(self) -> None:\n    \"\"\"Authenticate with the MySQL server.\n\n    Authentication happens in two parts. We first send a response to the\n    handshake. The MySQL server will then send either an AuthSwitchRequest\n    or an error packet.\n\n    Raises NotSupportedError when we get the old, insecure password\n    reply back. Raises any error coming from MySQL.\n    \"\"\"\n    if (  # pylint: disable=too-many-boolean-expressions\n        self._auth_plugin\n        and self._auth_plugin.startswith(\"authentication_oci\")\n        or (\n            self._auth_plugin\n            and self._auth_plugin.startswith(\"authentication_kerberos\")\n            and os.name == \"nt\"\n        )\n    ) and not self._user:\n        self._user = getpass.getuser()\n        logger.debug(\n            \"MySQL user is empty, OS user: %s will be used for %s\",\n            self._user,\n            self._auth_plugin,\n        )\n\n    password = (\n        self._password1\n        if self._password1 and self._password != self._password1\n        else self._password\n    )\n\n    self._ssl_active = False\n    if not self._ssl_disabled and (self._client_flags & ClientFlag.SSL):\n        ssl_context = self._socket.build_ssl_context(\n            ssl_ca=self._ssl_ca,\n            ssl_cert=self._ssl_cert,\n            ssl_key=self._ssl_key,\n            ssl_verify_cert=self._ssl_verify_cert,\n            ssl_verify_identity=self._ssl_verify_identity,\n            tls_versions=self._tls_versions,\n            tls_cipher_suites=self._tls_ciphersuites,\n        )\n        packet: bytes = self._protocol.make_auth_ssl(\n            charset=self._charset.charset_id, client_flags=self._client_flags\n        )\n        await self._socket.write(packet)\n        await self._socket.switch_to_ssl(ssl_context)\n        self._ssl_active = True\n\n    # Add the custom configurations required by specific auth plugins\n    self._authenticator.update_plugin_config(\n        config={\n            \"krb_service_principal\": self._krb_service_principal,\n            \"oci_config_file\": self._oci_config_file,\n            \"oci_config_profile\": self._oci_config_profile,\n            \"webauthn_callback\": self._webauthn_callback,\n            \"openid_token_file\": self._openid_token_file,\n        }\n    )\n\n    ok_pkt = await self._authenticator.authenticate(\n        sock=self._socket,\n        handshake=self._handshake,\n        username=self._user,\n        password1=password,\n        password2=self._password2,\n        password3=self._password3,\n        database=self._database,\n        charset=self._charset.charset_id,\n        client_flags=self._client_flags,\n        ssl_enabled=self._ssl_active,\n        auth_plugin=self._auth_plugin,\n        auth_plugin_class=self._auth_plugin_class,\n        conn_attrs=self._connection_attrs,\n    )\n    self._handle_ok(ok_pkt)\n\n    if not (self._client_flags & ClientFlag.CONNECT_WITH_DB) and self._database:\n        await self.cmd_init_db(self._database)\n",
      "hash_value": "c8f102afac91f4a3fd10eb102dae390a",
      "severity": "High",
      "confidence": "Medium",
      "code_snippets": [
        {
          "snippet": "async def _do_auth(self) -> None:\n    \"\"\"Authenticate with the MySQL server.\n\n    Authentication happens in two parts. We first send a response to the\n    handshake. The MySQL server will then send either an AuthSwitchRequest\n    or an error packet.\n\n    Raises NotSupportedError when we get the old, insecure password\n    reply back. Raises any error coming from MySQL.\n    \"\"\"\n    if (  # pylint: disable=too-many-boolean-expressions\n        self._auth_plugin\n        and self._auth_plugin.startswith(\"authentication_oci\")\n        or (\n            self._auth_plugin\n            and self._auth_plugin.startswith(\"authentication_kerberos\")\n            and os.name == \"nt\"\n        )\n    ) and not self._user:\n        self._user = getpass.getuser()\n        logger.debug(\n            \"MySQL user is empty, OS user: %s will be used for %s\",\n            self._user,\n            self._auth_plugin,\n        )\n\n    password = (\n        self._password1\n        if self._password1 and self._password != self._password1\n        else self._password\n    )\n\n    self._ssl_active = False\n    if not self._ssl_disabled and (self._client_flags & ClientFlag.SSL):\n        ssl_context = self._socket.build_ssl_context(\n            ssl_ca=self._ssl_ca,\n            ssl_cert=self._ssl_cert,\n            ssl_key=self._ssl_key,\n            ssl_verify_cert=self._ssl_verify_cert,\n            ssl_verify_identity=self._ssl_verify_identity,\n            tls_versions=self._tls_versions,\n            tls_cipher_suites=self._tls_ciphersuites,\n        )\n        packet: bytes = self._protocol.make_auth_ssl(\n            charset=self._charset.charset_id, client_flags=self._client_flags\n        )\n        await self._socket.write(packet)\n        await self._socket.switch_to_ssl(ssl_context)\n        self._ssl_active = True\n\n    # Add the custom configurations required by specific auth plugins\n    self._authenticator.update_plugin_config(\n        config={\n            \"krb_service_principal\": self._krb_service_principal,\n            \"oci_config_file\": self._oci_config_file,\n            \"oci_config_profile\": self._oci_config_profile,\n            \"webauthn_callback\": self._webauthn_callback,\n            \"openid_token_file\": self._openid_token_file,\n        }\n    )\n\n    ok_pkt = await self._authenticator.authenticate(\n        sock=self._socket,\n        handshake=self._handshake,\n        username=self._user,\n        password1=password,\n        password2=self._password2,\n        password3=self._password3,\n        database=self._database,\n        charset=self._charset.charset_id,\n        client_flags=self._client_flags,\n        ssl_enabled=self._ssl_active,\n        auth_plugin=self._auth_plugin,\n        auth_plugin_class=self._auth_plugin_class,\n        conn_attrs=self._connection_attrs,\n    )\n    self._handle_ok(ok_pkt)\n\n    if not (self._client_flags & ClientFlag.CONNECT_WITH_DB) and self._database:\n        await self.cmd_init_db(self._database)\n",
          "triple_sequences": [
            {
              "action_api": "getpass.getuser()",
              "action_description": "Retrieves current user login name",
              "action_id": "get_username",
              "object": "",
              "object_description": "Current username",
              "object_id": "current_username",
              "intention_description": "Access current username",
              "intention_id": "access_current_username"
            },
            {
              "action_api": "logger.debug()",
              "action_description": "Writes log message to file or console",
              "action_id": "write_file_content",
              "object": "\"MySQL user is empty, OS user: %s will be used for %s\", self._user, self._auth_plugin",
              "object_description": "Log level",
              "object_id": "log_level",
              "intention_description": "Access attribute value",
              "intention_id": "access_attribute_value"
            },
            {
              "action_api": "self._socket.build_ssl_context()",
              "action_description": "Creates SSL context with specified protocol",
              "action_id": "create_ssl_context",
              "object": "ssl_ca=self._ssl_ca, ssl_cert=self._ssl_cert, ssl_key=self._ssl_key, ssl_verify_cert=self._ssl_verify_cert, ssl_verify_identity=self._ssl_verify_identity, tls_versions=self._tls_versions, tls_cipher_suites=self._tls_ciphersuites",
              "object_description": "SSL certificate and key configuration",
              "object_id": "",
              "intention_description": "Establish connection",
              "intention_id": "establish_connection"
            },
            {
              "action_api": "self._protocol.make_auth_ssl()",
              "action_description": "Packs values into bytes using specified format",
              "action_id": "pack_values",
              "object": "charset=self._charset.charset_id, client_flags=self._client_flags",
              "object_description": "Character encoding type",
              "object_id": "character_encoding_type",
              "intention_description": "Prepare data processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "self._socket.write()",
              "action_description": "Sends data over socket connection",
              "action_id": "send_socket_data",
              "object": "packet",
              "object_description": "Encoded string to bytes",
              "object_id": "encoded_string_bytes",
              "intention_description": "Establish connection",
              "intention_id": "establish_connection"
            },
            {
              "action_api": "self._socket.switch_to_ssl()",
              "action_description": "Wraps socket for SSL/TLS communication",
              "action_id": "wrap_socket_ssl",
              "object": "ssl_context",
              "object_description": "SSL certificate and key configuration",
              "object_id": "",
              "intention_description": "Establish connection",
              "intention_id": "establish_connection"
            },
            {
              "action_api": "self._authenticator.update_plugin_config()",
              "action_description": "Sets attribute on builtins object",
              "action_id": "set_builtin_attr",
              "object": "config={...}",
              "object_description": "Custom directory",
              "object_id": "custom_directory",
              "intention_description": "Access configuration value",
              "intention_id": "access_configuration_value"
            },
            {
              "action_api": "self._authenticator.authenticate()",
              "action_description": "Sends HTTP request",
              "action_id": "send_http_request",
              "object": "sock=self._socket, handshake=self._handshake, username=self._user, password1=password, password2=self._password2, password3=self._password3, database=self._database, charset=self._charset.charset_id, client_flags=self._client_flags, ssl_enabled=self._ssl_active, auth_plugin=self._auth_plugin, auth_plugin_class=self._auth_plugin_class, conn_attrs=self._connection_attrs",
              "object_description": "Account name and token",
              "object_id": "account_credentials",
              "intention_description": "Check validity of authentication cookie",
              "intention_id": "check_authentication_cookie"
            },
            {
              "action_api": "self._handle_ok()",
              "action_description": "Process HTTP response content",
              "action_id": "process_http_response",
              "object": "ok_pkt",
              "object_description": "HTTP response content from remote server",
              "object_id": "http_response_remote_content",
              "intention_description": "Access attribute value",
              "intention_id": "access_attribute_value"
            },
            {
              "action_api": "self.cmd_init_db()",
              "action_description": "Executes shell command",
              "action_id": "execute_shell_command",
              "object": "self._database",
              "object_description": "Database name",
              "object_id": "",
              "intention_description": "Change working directory",
              "intention_id": "change_working_directory"
            }
          ]
        }
      ]
    }
  ]
}