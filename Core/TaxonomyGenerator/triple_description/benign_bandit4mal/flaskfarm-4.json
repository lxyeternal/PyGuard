{
  "metadata": {
    "package_name": "flaskfarm-4",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/benign_bandit4mal/flaskfarm-4.1.37.json",
    "dataset_type": "benign_bandit4mal"
  },
  "code_files": [
    {
      "pyfile": "sub_process.py",
      "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/flaskfarm-4.1.37/FlaskFarm-4.1.37/flaskfarm/lib/support/base/sub_process.py",
      "line_number": "149",
      "type_description": "B812:system",
      "context_snippet": "def __execute_thread_function(self):\n    try:\n        self.command = self.command_for_windows(self.command)\n        logger.debug(f\"{self.command=}\")\n        if platform.system() == 'Windows':\n            self.process = subprocess.Popen(self.command, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.STDOUT, universal_newlines=True, shell=self.shell, env=self.env, encoding='utf8', bufsize=0)\n\n        else:\n            if self.uid == None:\n                self.process = subprocess.Popen(self.command, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.STDOUT, universal_newlines=True, shell=self.shell, env=self.env, encoding='utf8', bufsize=0)\n            else:\n                self.process = subprocess.Popen(self.command, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.STDOUT, universal_newlines=True, shell=self.shell, env=self.env, preexec_fn=demote(self.uid, self.gid), encoding='utf8', bufsize=0)\n        SupportSubprocess.__instance_list.append(self)\n        self.send_stdout_callback(self.call_id, 'START', None)\n        self.__start_communicate()\n        self.__start_send_callback()\n        if self.process is not None:\n            if self.timeout != None:\n                self.process.wait(timeout=self.timeout)\n                self.process_close()\n            else:\n                self.process.wait()\n        self.remove_instance(self)\n        logger.info(f\"{self.command} END\")\n    except Exception as e: \n        logger.error(f'Exception:{str(e)}')\n        logger.error(traceback.format_exc())\n        logger.warning(self.command)\n        self.send_stdout_callback(self.call_id, 'ERROR', str(e))\n        self.send_stdout_callback(self.call_id, 'ERROR', str(traceback.format_exc()))\n    finally:\n        if self.stdout_callback != None:\n            #self.stdout_callback(self.call_id, 'thread_end', None)\n            pass",
      "hash_value": "6a0eb01721fe51344e6cc3ef1325c1fa",
      "severity": "High",
      "confidence": "Medium",
      "code_snippets": [
        {
          "snippet": "def __execute_thread_function(self):\n    try:\n        self.command = self.command_for_windows(self.command)\n        logger.debug(f\"{self.command=}\")\n        if platform.system() == 'Windows':\n            self.process = subprocess.Popen(self.command, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.STDOUT, universal_newlines=True, shell=self.shell, env=self.env, encoding='utf8', bufsize=0)\n\n        else:\n            if self.uid == None:\n                self.process = subprocess.Popen(self.command, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.STDOUT, universal_newlines=True, shell=self.shell, env=self.env, encoding='utf8', bufsize=0)\n            else:\n                self.process = subprocess.Popen(self.command, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.STDOUT, universal_newlines=True, shell=self.shell, env=self.env, preexec_fn=demote(self.uid, self.gid), encoding='utf8', bufsize=0)\n        SupportSubprocess.__instance_list.append(self)\n        self.send_stdout_callback(self.call_id, 'START', None)\n        self.__start_communicate()\n        self.__start_send_callback()\n        if self.process is not None:\n            if self.timeout != None:\n                self.process.wait(timeout=self.timeout)\n                self.process_close()\n            else:\n                self.process.wait()\n        self.remove_instance(self)\n        logger.info(f\"{self.command} END\")\n    except Exception as e: \n        logger.error(f'Exception:{str(e)}')\n        logger.error(traceback.format_exc())\n        logger.warning(self.command)\n        self.send_stdout_callback(self.call_id, 'ERROR', str(e))\n        self.send_stdout_callback(self.call_id, 'ERROR', str(traceback.format_exc()))\n    finally:\n        if self.stdout_callback != None:\n            #self.stdout_callback(self.call_id, 'thread_end', None)\n            pass",
          "triple_sequences": [
            {
              "action_api": "subprocess.Popen()",
              "action_description": "Spawns new process to execute command without shell access",
              "action_id": "spawn_process_no_shell",
              "object": "self.command",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Execute command",
              "intention_id": "execute_command"
            },
            {
              "action_api": "SupportSubprocess.__instance_list.append()",
              "action_description": "Creates new thread to execute",
              "action_id": "create_thread",
              "object": "self",
              "object_description": "",
              "object_id": "",
              "intention_description": "Run function in thread pool",
              "intention_id": "run_function_thread_pool"
            },
            {
              "action_api": "self.send_stdout_callback()",
              "action_description": "Sends data over socket connection",
              "action_id": "send_socket_data",
              "object": "self.call_id, 'START', None",
              "object_description": "",
              "object_id": "",
              "intention_description": "Send command output to server",
              "intention_id": "send_command_output_server"
            },
            {
              "action_api": "self.__start_communicate()",
              "action_description": "Creates new thread to execute",
              "action_id": "create_thread",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Run function in thread pool",
              "intention_id": "run_function_thread_pool"
            },
            {
              "action_api": "self.__start_send_callback()",
              "action_description": "Creates new thread to execute",
              "action_id": "create_thread",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Run function in thread pool",
              "intention_id": "run_function_thread_pool"
            },
            {
              "action_api": "self.process.wait()",
              "action_description": "Waits for process to complete execution",
              "action_id": "wait_process_completion",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Wait for events",
              "intention_id": "wait_for_events"
            },
            {
              "action_api": "self.process.wait(timeout=self.timeout)",
              "action_description": "Waits for process to complete execution",
              "action_id": "wait_process_completion",
              "object": "self.timeout",
              "object_description": "Timeout duration value",
              "object_id": "timeout_value",
              "intention_description": "Wait for events",
              "intention_id": "wait_for_events"
            },
            {
              "action_api": "self.process_close()",
              "action_description": "Closes the socket connection",
              "action_id": "close_socket",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Release connection resource",
              "intention_id": "release_connection_resource"
            },
            {
              "action_api": "self.remove_instance()",
              "action_description": "Closes the socket connection",
              "action_id": "close_socket",
              "object": "self",
              "object_description": "",
              "object_id": "",
              "intention_description": "Release connection resource",
              "intention_id": "release_connection_resource"
            },
            {
              "action_api": "logger.debug()",
              "action_description": "Writes file content",
              "action_id": "basic_write_operations",
              "object": "f\"{self.command=}\"",
              "object_description": "File text",
              "object_id": "file_text",
              "intention_description": "Write file content",
              "intention_id": "write_file_content"
            },
            {
              "action_api": "logger.info()",
              "action_description": "Writes file content",
              "action_id": "basic_write_operations",
              "object": "f\"{self.command} END\"",
              "object_description": "File text",
              "object_id": "file_text",
              "intention_description": "Write file content",
              "intention_id": "write_file_content"
            },
            {
              "action_api": "logger.error()",
              "action_description": "Writes file content",
              "action_id": "basic_write_operations",
              "object": "f'Exception:{str(e)}'",
              "object_description": "Error message text",
              "object_id": "error_message",
              "intention_description": "Write file content",
              "intention_id": "write_file_content"
            },
            {
              "action_api": "logger.error()",
              "action_description": "Writes file content",
              "action_id": "basic_write_operations",
              "object": "traceback.format_exc()",
              "object_description": "Error message text",
              "object_id": "error_message",
              "intention_description": "Write file content",
              "intention_id": "write_file_content"
            },
            {
              "action_api": "logger.warning()",
              "action_description": "Writes file content",
              "action_id": "basic_write_operations",
              "object": "self.command",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Write file content",
              "intention_id": "write_file_content"
            },
            {
              "action_api": "self.send_stdout_callback()",
              "action_description": "Sends data over socket connection",
              "action_id": "send_socket_data",
              "object": "self.call_id, 'ERROR', str(e)",
              "object_description": "Error message text",
              "object_id": "error_message",
              "intention_description": "Send command output to server",
              "intention_id": "send_command_output_server"
            },
            {
              "action_api": "self.send_stdout_callback()",
              "action_description": "Sends data over socket connection",
              "action_id": "send_socket_data",
              "object": "self.call_id, 'ERROR', str(traceback.format_exc())",
              "object_description": "Error message text",
              "object_id": "error_message",
              "intention_description": "Send command output to server",
              "intention_id": "send_command_output_server"
            }
          ]
        }
      ]
    }
  ]
}