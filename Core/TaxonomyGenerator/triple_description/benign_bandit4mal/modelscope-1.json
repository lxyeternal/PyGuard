{
  "metadata": {
    "package_name": "modelscope-1",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/benign_bandit4mal/modelscope-1.25.0.json",
    "dataset_type": "benign_bandit4mal"
  },
  "code_files": [
    {
      "pyfile": "video_stabilization_pipeline.py",
      "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/modelscope-1.25.0/modelscope-1.25.0/modelscope/pipelines/cv/video_stabilization_pipeline.py",
      "line_number": "114",
      "type_description": "B812:system",
      "context_snippet": "import os\nimport subprocess\nimport tempfile\nimport cv2\nimport numpy as np\nfrom modelscope.outputs import OutputKeys\n\ndef postprocess(self, inputs: dict, **kwargs) -> dict:\n    output_video_path = kwargs.get('output_video', None)\n    is_cvt_h264 = kwargs.get('is_cvt_h264', False)\n\n    if output_video_path is None:\n        output_video_path = tempfile.NamedTemporaryFile(suffix='.mp4').name\n    h, w = inputs['output'][0].shape[-3:-1]\n    fourcc = cv2.VideoWriter_fourcc(*'mp4v')\n    video_writer = cv2.VideoWriter(output_video_path, fourcc,\n                                   inputs['fps'], (w, h))\n    for idx, frame in enumerate(inputs['output']):\n        horizontal_border = int(inputs['base_crop_width'] * w / 1280)\n        vertical_border = int(horizontal_border * h / w)\n        new_frame = frame[vertical_border:-vertical_border,\n                          horizontal_border:-horizontal_border]\n        new_frame = cv2.resize(new_frame, (w, h))\n        video_writer.write(new_frame)\n    video_writer.release()\n\n    if is_cvt_h264:\n        assert os.system(\n            'ffmpeg -version'\n        ) == 0, 'ffmpeg is not installed correctly, please refer to https://trac.ffmpeg.org/wiki/CompilationGuide.'\n        output_video_path_for_web = output_video_path[:-4] + '_web.mp4'\n        convert_cmd = f'ffmpeg -i {output_video_path} -vcodec h264 -crf 5 {output_video_path_for_web}'\n        subprocess.call(convert_cmd, shell=True)\n        return {OutputKeys.OUTPUT_VIDEO: output_video_path_for_web}\n    else:\n        return {OutputKeys.OUTPUT_VIDEO: output_video_path}\n",
      "hash_value": "487a97e9535bc0afb44704ae41eed8ca",
      "severity": "High",
      "confidence": "Medium",
      "code_snippets": [
        {
          "snippet": "import os\nimport subprocess\nimport tempfile\nimport cv2\nimport numpy as np\nfrom modelscope.outputs import OutputKeys\n\ndef postprocess(self, inputs: dict, **kwargs) -> dict:\n    output_video_path = kwargs.get('output_video', None)\n    is_cvt_h264 = kwargs.get('is_cvt_h264', False)\n\n    if output_video_path is None:\n        output_video_path = tempfile.NamedTemporaryFile(suffix='.mp4').name\n    h, w = inputs['output'][0].shape[-3:-1]\n    fourcc = cv2.VideoWriter_fourcc(*'mp4v')\n    video_writer = cv2.VideoWriter(output_video_path, fourcc,\n                                   inputs['fps'], (w, h))\n    for idx, frame in enumerate(inputs['output']):\n        horizontal_border = int(inputs['base_crop_width'] * w / 1280)\n        vertical_border = int(horizontal_border * h / w)\n        new_frame = frame[vertical_border:-vertical_border,\n                          horizontal_border:-horizontal_border]\n        new_frame = cv2.resize(new_frame, (w, h))\n        video_writer.write(new_frame)\n    video_writer.release()\n\n    if is_cvt_h264:\n        assert os.system(\n            'ffmpeg -version'\n        ) == 0, 'ffmpeg is not installed correctly, please refer to https://trac.ffmpeg.org/wiki/CompilationGuide.'\n        output_video_path_for_web = output_video_path[:-4] + '_web.mp4'\n        convert_cmd = f'ffmpeg -i {output_video_path} -vcodec h264 -crf 5 {output_video_path_for_web}'\n        subprocess.call(convert_cmd, shell=True)\n        return {OutputKeys.OUTPUT_VIDEO: output_video_path_for_web}\n    else:\n        return {OutputKeys.OUTPUT_VIDEO: output_video_path}\n",
          "triple_sequences": [
            {
              "action_api": "tempfile.NamedTemporaryFile()",
              "action_description": "Creates temporary file that is not deleted on close",
              "action_id": "create_temp_file",
              "object": "suffix='.mp4'",
              "object_description": "Temporary file path",
              "object_id": "temporary_file_path",
              "intention_description": "Create temporary file",
              "intention_id": "create_temporary_file"
            },
            {
              "action_api": "cv2.VideoWriter_fourcc()",
              "action_description": "Creates video capture object",
              "action_id": "create_video_capture",
              "object": "'mp4v'",
              "object_description": "Encoding format",
              "object_id": "encoding_format",
              "intention_description": "Prepare file for writing",
              "intention_id": "prepare_file_writing"
            },
            {
              "action_api": "cv2.VideoWriter()",
              "action_description": "Creates video capture object",
              "action_id": "create_video_capture",
              "object": "output_video_path, fourcc, inputs['fps'], (w, h)",
              "object_description": "Video file",
              "object_id": "",
              "intention_description": "Prepare file for writing",
              "intention_id": "prepare_file_writing"
            },
            {
              "action_api": "cv2.resize()",
              "action_description": "Captures screenshot of screen",
              "action_id": "capture_screen_region",
              "object": "new_frame, (w, h)",
              "object_description": "Image file",
              "object_id": "image_file",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "video_writer.write()",
              "action_description": "Saves image to file",
              "action_id": "save_image_file",
              "object": "new_frame",
              "object_description": "Image file",
              "object_id": "image_file",
              "intention_description": "Write file content",
              "intention_id": "write_file_content"
            },
            {
              "action_api": "video_writer.release()",
              "action_description": "Releases video capture device",
              "action_id": "release_video_device",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Release system resource",
              "intention_id": "release_system_resource"
            },
            {
              "action_api": "os.system()",
              "action_description": "Executes shell command",
              "action_id": "execute_shell_command",
              "object": "'ffmpeg -version'",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Execute command",
              "intention_id": "execute_command"
            },
            {
              "action_api": "subprocess.call()",
              "action_description": "Executes shell command",
              "action_id": "execute_shell_command",
              "object": "convert_cmd, shell=True",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Execute command",
              "intention_id": "execute_command"
            }
          ]
        }
      ]
    }
  ]
}