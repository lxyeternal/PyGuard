{
  "metadata": {
    "package_name": "ipwhois-1",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/benign_bandit4mal/ipwhois-1.3.0.json",
    "dataset_type": "benign_bandit4mal"
  },
  "code_files": [
    {
      "pyfile": "experimental.py",
      "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/ipwhois-1.3.0/ipwhois-1.3.0/ipwhois/experimental.py",
      "line_number": "71",
      "type_description": "B808:settimeout",
      "context_snippet": "def get_bulk_asn_whois(addresses=None, retry_count=3, timeout=120):\n    \"\"\"\n    The function for retrieving ASN information for multiple IP addresses from\n    Cymru via port 43/tcp (WHOIS).\n\n    Args:\n        addresses (:obj:`list` of :obj:`str`): IP addresses to lookup.\n        retry_count (:obj:`int`): The number of times to retry in case socket\n            errors, timeouts, connection resets, etc. are encountered.\n            Defaults to 3.\n        timeout (:obj:`int`): The default timeout for socket connections in\n            seconds. Defaults to 120.\n\n    Returns:\n        str: The raw ASN bulk data, new line separated.\n\n    Raises:\n        ValueError: addresses argument must be a list of IPv4/v6 address\n            strings.\n        ASNLookupError: The ASN bulk lookup failed.\n    \"\"\"\n\n    if not isinstance(addresses, list):\n\n        raise ValueError('addresses argument must be a list of IPv4/v6 '\n                         'address strings.')\n\n    try:\n\n        # Create the connection for the Cymru whois query.\n        conn = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n        conn.settimeout(timeout)\n        log.debug('ASN bulk query initiated.')\n        conn.connect((CYMRU_WHOIS, 43))\n\n        # Query the Cymru whois server, and store the results.\n        conn.sendall((\n            ' -r -a -c -p -f begin\\n{0}\\nend'.format(\n                '\\n'.join(addresses))\n        ).encode())\n\n        data = ''\n        while True:\n\n            d = conn.recv(4096).decode()\n            data += d\n\n            if not d:\n\n                break\n\n        conn.close()\n\n        return str(data)\n\n    except (socket.timeout, socket.error) as e:  # pragma: no cover\n\n        log.debug('ASN bulk query socket error: {0}'.format(e))\n        if retry_count > 0:\n\n            log.debug('ASN bulk query retrying (count: {0})'.format(\n                str(retry_count)))\n            return get_bulk_asn_whois(addresses, retry_count - 1, timeout)\n\n        else:\n\n            raise ASNLookupError('ASN bulk lookup failed.')\n\n    except:  # pragma: no cover\n\n        raise ASNLookupError('ASN bulk lookup failed.')",
      "hash_value": "7cea038521f60dbe60d1620de8c94bff",
      "severity": "High",
      "confidence": "Medium",
      "code_snippets": [
        {
          "snippet": "def get_bulk_asn_whois(addresses=None, retry_count=3, timeout=120):\n    \"\"\"\n    The function for retrieving ASN information for multiple IP addresses from\n    Cymru via port 43/tcp (WHOIS).\n\n    Args:\n        addresses (:obj:`list` of :obj:`str`): IP addresses to lookup.\n        retry_count (:obj:`int`): The number of times to retry in case socket\n            errors, timeouts, connection resets, etc. are encountered.\n            Defaults to 3.\n        timeout (:obj:`int`): The default timeout for socket connections in\n            seconds. Defaults to 120.\n\n    Returns:\n        str: The raw ASN bulk data, new line separated.\n\n    Raises:\n        ValueError: addresses argument must be a list of IPv4/v6 address\n            strings.\n        ASNLookupError: The ASN bulk lookup failed.\n    \"\"\"\n\n    if not isinstance(addresses, list):\n\n        raise ValueError('addresses argument must be a list of IPv4/v6 '\n                         'address strings.')\n\n    try:\n\n        # Create the connection for the Cymru whois query.\n        conn = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n        conn.settimeout(timeout)\n        log.debug('ASN bulk query initiated.')\n        conn.connect((CYMRU_WHOIS, 43))\n\n        # Query the Cymru whois server, and store the results.\n        conn.sendall((\n            ' -r -a -c -p -f begin\\n{0}\\nend'.format(\n                '\\n'.join(addresses))\n        ).encode())\n\n        data = ''\n        while True:\n\n            d = conn.recv(4096).decode()\n            data += d\n\n            if not d:\n\n                break\n\n        conn.close()\n\n        return str(data)\n\n    except (socket.timeout, socket.error) as e:  # pragma: no cover\n\n        log.debug('ASN bulk query socket error: {0}'.format(e))\n        if retry_count > 0:\n\n            log.debug('ASN bulk query retrying (count: {0})'.format(\n                str(retry_count)))\n            return get_bulk_asn_whois(addresses, retry_count - 1, timeout)\n\n        else:\n\n            raise ASNLookupError('ASN bulk lookup failed.')\n\n    except:  # pragma: no cover\n\n        raise ASNLookupError('ASN bulk lookup failed.')",
          "triple_sequences": [
            {
              "action_api": "isinstance()",
              "action_description": "Checks if object is instance of specified type",
              "action_id": "check_instance_type",
              "object": "addresses, list",
              "object_description": "",
              "object_id": "",
              "intention_description": "Stop execution on invalid input",
              "intention_id": "stop_execution_invalid_input"
            },
            {
              "action_api": "socket.socket()",
              "action_description": "Creates new socket object",
              "action_id": "create_socket",
              "object": "socket.AF_INET, socket.SOCK_STREAM",
              "object_description": "Socket address",
              "object_id": "socket_address",
              "intention_description": "Establish connection",
              "intention_id": "establish_connection"
            },
            {
              "action_api": "conn.settimeout()",
              "action_description": "Sets timeout for socket operations",
              "action_id": "set_socket_timeout",
              "object": "timeout",
              "object_description": "Timeout duration value",
              "object_id": "timeout_value",
              "intention_description": "Delay next operation",
              "intention_id": "delay_next_operation"
            },
            {
              "action_api": "conn.connect()",
              "action_description": "Establishes TCP connection to specified address",
              "action_id": "establish_tcp_connection",
              "object": "(CYMRU_WHOIS, 43)",
              "object_description": "Public IP address and port",
              "object_id": "public_ip_port",
              "intention_description": "Connect to remote server",
              "intention_id": "connect_remote_server"
            },
            {
              "action_api": "conn.sendall()",
              "action_description": "Sends data over socket connection",
              "action_id": "send_socket_data",
              "object": "' -r -a -c -p -f begin\\n{0}\\nend'.format('\\n'.join(addresses)).encode()",
              "object_description": "String containing environment data",
              "object_id": "string_environment_data",
              "intention_description": "Send DNS request",
              "intention_id": "send_dns_request"
            },
            {
              "action_api": "conn.recv()",
              "action_description": "Receives data from socket connection",
              "action_id": "receive_socket_data",
              "object": "4096",
              "object_description": "",
              "object_id": "",
              "intention_description": "Download remote content",
              "intention_id": "download_remote_content"
            },
            {
              "action_api": "str.decode()",
              "action_description": "Decodes bytes using default codec",
              "action_id": "decode_bytes_default",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Decode downloaded content",
              "intention_id": "decode_downloaded_content"
            },
            {
              "action_api": "conn.close()",
              "action_description": "Closes the socket connection",
              "action_id": "close_socket",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Release connection resource",
              "intention_id": "release_connection_resource"
            },
            {
              "action_api": "str()",
              "action_description": "Encodes string to bytes using default encoding",
              "action_id": "encode_string_to_bytes",
              "object": "data",
              "object_description": "String containing environment data",
              "object_id": "string_environment_data",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "get_bulk_asn_whois()",
              "action_description": "Creates new thread to execute",
              "action_id": "create_thread",
              "object": "addresses, retry_count - 1, timeout",
              "object_description": "Thread function arguments",
              "object_id": "thread_arguments",
              "intention_description": "Run function in thread pool",
              "intention_id": "run_function_thread_pool"
            }
          ]
        }
      ]
    }
  ]
}