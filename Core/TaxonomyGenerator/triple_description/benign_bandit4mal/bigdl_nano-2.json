{
  "metadata": {
    "package_name": "bigdl_nano-2",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/benign_bandit4mal/bigdl_nano-2.5.0b20240324-py3-none-win_amd64.json",
    "dataset_type": "benign_bandit4mal"
  },
  "code_files": [
    {
      "pyfile": "__init__.py",
      "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/bigdl_nano-2.5.0b20240324-py3-none-win_amd64/bigdl/nano/tf/__init__.py",
      "line_number": "36",
      "type_description": "B812:system",
      "context_snippet": "import platform\nimport os\nimport warnings\nfrom bigdl.nano.utils.common import register_suggestion\nfrom bigdl.nano.utils.common import get_affinity_core_num\n\n\n# reset the num of threads\nif platform.system() == \"Linux\":\n    # only UNIX-like system applied\n    preset_thread_nums = int(os.environ.get(\"OMP_NUM_THREADS\", \"0\"))\n    affinity_core_num = get_affinity_core_num()\n\n    if affinity_core_num is not None and preset_thread_nums > affinity_core_num:\n        register_suggestion(f\"CPU Affinity is set to this program and {affinity_core_num} \"\n                            f\"cores are binded. While Tensorflow OpenMP code block will use \"\n                            f\"{preset_thread_nums} cores, which may cause severe performance \"\n                            f\"downgrade. Please set `OMP_NUM_THREADS` to {affinity_core_num}.\")\n\n\nif platform.system() != \"Darwin\":\n    # set tf settings\n    import tensorflow as tf\n    tf.config.set_soft_device_placement(enabled=True)\n\nfrom .dispatcher import patch_tensorflow, unpatch_tensorflow",
      "hash_value": "3dec31ddf6ee3cbe5eef92b55e79c027",
      "severity": "High",
      "confidence": "Medium",
      "code_snippets": [
        {
          "snippet": "import platform\nimport os\nimport warnings\nfrom bigdl.nano.utils.common import register_suggestion\nfrom bigdl.nano.utils.common import get_affinity_core_num\n\n\n# reset the num of threads\nif platform.system() == \"Linux\":\n    # only UNIX-like system applied\n    preset_thread_nums = int(os.environ.get(\"OMP_NUM_THREADS\", \"0\"))\n    affinity_core_num = get_affinity_core_num()\n\n    if affinity_core_num is not None and preset_thread_nums > affinity_core_num:\n        register_suggestion(f\"CPU Affinity is set to this program and {affinity_core_num} \"\n                            f\"cores are binded. While Tensorflow OpenMP code block will use \"\n                            f\"{preset_thread_nums} cores, which may cause severe performance \"\n                            f\"downgrade. Please set `OMP_NUM_THREADS` to {affinity_core_num}.\")\n\n\nif platform.system() != \"Darwin\":\n    # set tf settings\n    import tensorflow as tf\n    tf.config.set_soft_device_placement(enabled=True)\n\nfrom .dispatcher import patch_tensorflow, unpatch_tensorflow",
          "triple_sequences": [
            {
              "action_api": "platform.system()",
              "action_description": "Retrieves operating system identifier",
              "action_id": "get_os_id",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Determine operating system",
              "intention_id": "determine_operating_system"
            },
            {
              "action_api": "os.environ.get()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "OMP_NUM_THREADS",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            },
            {
              "action_api": "get_affinity_core_num()",
              "action_description": "Retrieves processor name",
              "action_id": "get_processor_name",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Get system info",
              "intention_id": "get_system_info"
            },
            {
              "action_api": "register_suggestion()",
              "action_description": "Registers function to be called at program exit",
              "action_id": "register_exit_function",
              "object": "f\"CPU Affinity is set to this program and {affinity_core_num} cores are binded. While Tensorflow OpenMP code block will use {preset_thread_nums} cores, which may cause severe performance downgrade. Please set `OMP_NUM_THREADS` to {affinity_core_num}.\"",
              "object_description": "String containing environment data",
              "object_id": "string_environment_data",
              "intention_description": "Serialize data",
              "intention_id": "serialize_data"
            },
            {
              "action_api": "platform.system()",
              "action_description": "Retrieves operating system identifier",
              "action_id": "get_os_id",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Determine operating system",
              "intention_id": "determine_operating_system"
            },
            {
              "action_api": "tf.config.set_soft_device_placement()",
              "action_description": "Sets attribute on builtins object",
              "action_id": "set_builtin_attr",
              "object": "enabled=True",
              "object_description": "",
              "object_id": "",
              "intention_description": "Access attribute value",
              "intention_id": "access_attribute_value"
            }
          ]
        }
      ]
    }
  ]
}