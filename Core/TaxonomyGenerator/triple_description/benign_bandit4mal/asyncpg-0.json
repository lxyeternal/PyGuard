{
  "metadata": {
    "package_name": "asyncpg-0",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/benign_bandit4mal/asyncpg-0.30.0.json",
    "dataset_type": "benign_bandit4mal"
  },
  "code_files": [
    {
      "pyfile": "test_connect.py",
      "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/asyncpg-0.30.0/asyncpg-0.30.0/tests/test_connect.py",
      "line_number": "1588",
      "type_description": "B804:connect",
      "context_snippet": "    @unittest.skipIf(os.environ.get('PGHOST'), 'unmanaged cluster')\n    async def test_connection_sslmode_no_ssl_server(self):\n        async def verify_works(sslmode):\n            con = None\n            try:\n                con = await self.connect(\n                    dsn='postgresql://foo/?sslmode=' + sslmode,\n                    user='postgres',\n                    database='postgres',\n                    host='localhost')\n                self.assertEqual(await con.fetchval('SELECT 42'), 42)\n                self.assertFalse(con._protocol.is_ssl)\n            finally:\n                if con:\n                    await con.close()\n\n        async def verify_fails(sslmode):\n            con = None\n            try:\n                with self.assertRaises(ConnectionError):\n                    con = await self.connect(\n                        dsn='postgresql://foo/?sslmode=' + sslmode,\n                        user='postgres',\n                        database='postgres',\n                        host='localhost')\n                    await con.fetchval('SELECT 42')\n            finally:\n                if con:\n                    await con.close()\n\n        await verify_works('disable')\n        await verify_works('allow')\n        await verify_works('prefer')\n        await verify_fails('require')\n        with mock_dot_postgresql():\n            await verify_fails('require')\n            await verify_fails('verify-ca')\n            await verify_fails('verify-full')",
      "hash_value": "4565dff84575ad0b15f38bdce643902a",
      "severity": "High",
      "confidence": "Medium",
      "code_snippets": [
        {
          "snippet": "    @unittest.skipIf(os.environ.get('PGHOST'), 'unmanaged cluster')\n    async def test_connection_sslmode_no_ssl_server(self):\n        async def verify_works(sslmode):\n            con = None\n            try:\n                con = await self.connect(\n                    dsn='postgresql://foo/?sslmode=' + sslmode,\n                    user='postgres',\n                    database='postgres',\n                    host='localhost')\n                self.assertEqual(await con.fetchval('SELECT 42'), 42)\n                self.assertFalse(con._protocol.is_ssl)\n            finally:\n                if con:\n                    await con.close()\n\n        async def verify_fails(sslmode):\n            con = None\n            try:\n                with self.assertRaises(ConnectionError):\n                    con = await self.connect(\n                        dsn='postgresql://foo/?sslmode=' + sslmode,\n                        user='postgres',\n                        database='postgres',\n                        host='localhost')\n                    await con.fetchval('SELECT 42')\n            finally:\n                if con:\n                    await con.close()\n\n        await verify_works('disable')\n        await verify_works('allow')\n        await verify_works('prefer')\n        await verify_fails('require')\n        with mock_dot_postgresql():\n            await verify_fails('require')\n            await verify_fails('verify-ca')\n            await verify_fails('verify-full')",
          "triple_sequences": [
            {
              "action_api": "os.environ.get()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "PGHOST",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            },
            {
              "action_api": "self.connect()",
              "action_description": "Establishes TCP connection to specified address",
              "action_id": "establish_tcp_connection",
              "object": "dsn='postgresql://foo/?sslmode=' + sslmode, user='postgres', database='postgres', host='localhost'",
              "object_description": "Request object for private IP",
              "object_id": "request_private_ip",
              "intention_description": "Establish connection",
              "intention_id": "establish_connection"
            },
            {
              "action_api": "con.fetchval()",
              "action_description": "Executes SQL query",
              "action_id": "execute_sql_query",
              "object": "SELECT 42",
              "object_description": "SQL query string",
              "object_id": "sql_query_string",
              "intention_description": "Collect command output",
              "intention_id": "collect_command_output"
            },
            {
              "action_api": "con._protocol.is_ssl",
              "action_description": "Retrieves operating system identifier",
              "action_id": "get_os_id",
              "object": "con._protocol.is_ssl",
              "object_description": "",
              "object_id": "",
              "intention_description": "Access attribute value",
              "intention_id": "access_attribute_value"
            },
            {
              "action_api": "con.close()",
              "action_description": "Closes the SQLite database connection",
              "action_id": "close_sqlite_connection",
              "object": "con",
              "object_description": "",
              "object_id": "",
              "intention_description": "Release connection resource",
              "intention_id": "release_connection_resource"
            },
            {
              "action_api": "self.assertRaises()",
              "action_description": "Handles socket timeout exception",
              "action_id": "handle_socket_timeout",
              "object": "ConnectionError",
              "object_description": "Exception type name",
              "object_id": "exception_type",
              "intention_description": "Stop execution on invalid input",
              "intention_id": "stop_execution_invalid_input"
            },
            {
              "action_api": "mock_dot_postgresql()",
              "action_description": "Instantiates WMI interface for system management",
              "action_id": "instantiate_wmi",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Access configuration value",
              "intention_id": "access_configuration_value"
            }
          ]
        }
      ]
    }
  ]
}