{
  "metadata": {
    "package_name": "kqlmagiccustom-0",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/benign/kqlmagiccustom-0.1.114.post26.json",
    "dataset_type": "benign"
  },
  "code_files": [
    {
      "pyfile": "my_aad_helper.py",
      "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/kqlmagiccustom-0.1.114.post26/KqlmagicCustom-0.1.114.post26/azure/Kqlmagic/my_aad_helper.py",
      "line_number": "346",
      "type_description": "clipboard-access",
      "context_snippet": "def acquire_token(self):\n    \"\"\"Acquire tokens from AAD.\"\"\"\n    previous_token = self._current_token\n    try:\n        ...\n        elif self._authentication_method is AuthenticationMethod.aad_code_login:\n            logger().debug(f\"_MyAadHelper::acquire_token - aad/code - resource: '{self._resource}', client: '{self._client_id}'\")\n            code: dict = self._current_adal_context.acquire_user_code(self._resource, self._client_id)\n            url = code[OAuth2DeviceCodeResponseParameters.VERIFICATION_URL]\n            device_code = code[OAuth2DeviceCodeResponseParameters.USER_CODE].strip()\n\n            device_code_login_notification = self._options.get(\"device_code_login_notification\")\n            if device_code_login_notification == \"auto\":\n                if self._options.get(\"notebook_app\") in [\"azuredatastudiosaw\"]:\n                    device_code_login_notification = \"terminal\"\n                elif self._options.get(\"notebook_app\") in [\"ipython\"]:\n                    device_code_login_notification = \"popup_interaction\"\n                elif self._options.get(\"notebook_app\") in [\"visualstudiocode\", \"azuredatastudio\"]:\n                    device_code_login_notification = \"popup_interaction\"\n                elif self._options.get(\"notebook_app\") in [\"nteract\"]:\n\n                    if self._options.get(\"kernel_location\") == \"local\":\n                        # ntreact cannot execute authentication script, workaround using temp_file_server webbrowser\n                        if self._options.get(\"temp_files_server_address\") is not None:\n                            import urllib.parse\n                            indirect_url = f'{self._options.get(\"temp_files_server_address\")}/webbrowser?url={urllib.parse.quote(url)}&kernelid={self._options.get(\"kernel_id\")}'\n                            url = indirect_url\n                            device_code_login_notification = \"popup_interaction\"\n                        else:\n                            device_code_login_notification = \"browser\"\n                    else:\n                        device_code_login_notification = \"terminal\"\n                else:\n                    device_code_login_notification = \"button\"\n\n            if (self._options.get(\"kernel_location\") == \"local\"\n                    or device_code_login_notification in [\"browser\"]\n                    or (device_code_login_notification == \"popup_interaction\" and self._options.get(\"popup_interaction\") == \"webbrowser_open_at_kernel\")):\n                # copy code to local clipboard\n                try:\n                    pyperclip = Dependencies.get_module(\"pyperclip\", dont_throw=True)\n                    if pyperclip is not None:\n                        pyperclip.copy(device_code)\n                except: # pylint: disable=bare-except\n                    pass\n            ...\n",
      "hash_value": "d3f44ec853181dbc418615cc23d33efc",
      "detection_index": 1,
      "code_snippets": [
        {
          "snippet": "def acquire_token(self):\n    \"\"\"Acquire tokens from AAD.\"\"\"\n    previous_token = self._current_token\n    try:\n        ...\n        elif self._authentication_method is AuthenticationMethod.aad_code_login:\n            logger().debug(f\"_MyAadHelper::acquire_token - aad/code - resource: '{self._resource}', client: '{self._client_id}'\")\n            code: dict = self._current_adal_context.acquire_user_code(self._resource, self._client_id)\n            url = code[OAuth2DeviceCodeResponseParameters.VERIFICATION_URL]\n            device_code = code[OAuth2DeviceCodeResponseParameters.USER_CODE].strip()\n\n            device_code_login_notification = self._options.get(\"device_code_login_notification\")\n            if device_code_login_notification == \"auto\":\n                if self._options.get(\"notebook_app\") in [\"azuredatastudiosaw\"]:\n                    device_code_login_notification = \"terminal\"\n                elif self._options.get(\"notebook_app\") in [\"ipython\"]:\n                    device_code_login_notification = \"popup_interaction\"\n                elif self._options.get(\"notebook_app\") in [\"visualstudiocode\", \"azuredatastudio\"]:\n                    device_code_login_notification = \"popup_interaction\"\n                elif self._options.get(\"notebook_app\") in [\"nteract\"]:\n\n                    if self._options.get(\"kernel_location\") == \"local\":\n                        # ntreact cannot execute authentication script, workaround using temp_file_server webbrowser\n                        if self._options.get(\"temp_files_server_address\") is not None:\n                            import urllib.parse\n                            indirect_url = f'{self._options.get(\"temp_files_server_address\")}/webbrowser?url={urllib.parse.quote(url)}&kernelid={self._options.get(\"kernel_id\")}'\n                            url = indirect_url\n                            device_code_login_notification = \"popup_interaction\"\n                        else:\n                            device_code_login_notification = \"browser\"\n                    else:\n                        device_code_login_notification = \"terminal\"\n                else:\n                    device_code_login_notification = \"button\"\n\n            if (self._options.get(\"kernel_location\") == \"local\"\n                    or device_code_login_notification in [\"browser\"]\n                    or (device_code_login_notification == \"popup_interaction\" and self._options.get(\"popup_interaction\") == \"webbrowser_open_at_kernel\")):\n                # copy code to local clipboard\n                try:\n                    pyperclip = Dependencies.get_module(\"pyperclip\", dont_throw=True)\n                    if pyperclip is not None:\n                        pyperclip.copy(device_code)\n                except: # pylint: disable=bare-except\n                    pass\n            ...\n",
          "triple_sequences": [
            {
              "action_api": "self._current_adal_context.acquire_user_code()",
              "action_description": "Creates HTTP request object with specified URL, data, and headers",
              "action_id": "create_http_request",
              "object": "self._resource, self._client_id",
              "object_description": "API key or token",
              "object_id": "api_key",
              "intention_description": "Prepare URL for HTTP request",
              "intention_id": "prepare_url_http_request"
            },
            {
              "action_api": "str.strip()",
              "action_description": "Decodes bytes using default codec",
              "action_id": "decode_bytes_default",
              "object": "code[OAuth2DeviceCodeResponseParameters.USER_CODE]",
              "object_description": "API key or token",
              "object_id": "api_key",
              "intention_description": "Prepare character for further processing",
              "intention_id": "prepare_character_processing"
            },
            {
              "action_api": "self._options.get()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "\"device_code_login_notification\"",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Access configuration value",
              "intention_id": "access_configuration_value"
            },
            {
              "action_api": "self._options.get()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "\"notebook_app\"",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Access configuration value",
              "intention_id": "access_configuration_value"
            },
            {
              "action_api": "self._options.get()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "\"kernel_location\"",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Access configuration value",
              "intention_id": "access_configuration_value"
            },
            {
              "action_api": "self._options.get()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "\"temp_files_server_address\"",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Access configuration value",
              "intention_id": "access_configuration_value"
            },
            {
              "action_api": "self._options.get()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "\"kernel_id\"",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Access configuration value",
              "intention_id": "access_configuration_value"
            },
            {
              "action_api": "urllib.parse.quote()",
              "action_description": "Percent-encodes bytes for use in URL",
              "action_id": "percent_encode_url",
              "object": "url",
              "object_description": "URL string",
              "object_id": "url_string",
              "intention_description": "Prepare URL for HTTP request",
              "intention_id": "prepare_url_http_request"
            },
            {
              "action_api": "Dependencies.get_module()",
              "action_description": "Dynamically imports specified module",
              "action_id": "import_dynamic",
              "object": "\"pyperclip\", dont_throw=True",
              "object_description": "Module name string",
              "object_id": "module_name_string",
              "intention_description": "Import module dynamically",
              "intention_id": "import_module_dynamically"
            },
            {
              "action_api": "pyperclip.copy()",
              "action_description": "Copies specified text to system clipboard",
              "action_id": "copy_to_clipboard",
              "object": "device_code",
              "object_description": "API key or token",
              "object_id": "api_key",
              "intention_description": "Access clipboard data",
              "intention_id": "access_clipboard_data"
            }
          ]
        }
      ]
    }
  ]
}