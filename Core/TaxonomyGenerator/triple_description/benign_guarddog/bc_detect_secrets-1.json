{
  "metadata": {
    "package_name": "bc_detect_secrets-1",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/benign/bc_detect_secrets-1.5.40.json",
    "dataset_type": "benign"
  },
  "code_files": [
    {
      "pyfile": "ibm_cos_hmac.py",
      "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/bc_detect_secrets-1.5.40/bc_detect_secrets-1.5.40/detect_secrets/plugins/ibm_cos_hmac.py",
      "line_number": "88",
      "type_description": "shady-links",
      "context_snippet": "def verify_ibm_cos_hmac_credentials(\n    access_key: str,\n    secret_key: str,\n    host: str = 's3.us.cloud-object-storage.appdomain.cloud',\n) -> bool:\n    response = query_ibm_cos_hmac(access_key, secret_key, host)\n    return response.status_code == 200\n\n# Helper function used:\ndef query_ibm_cos_hmac(\n    access_key: str,\n    secret_key: str,\n    host: str = 's3.us.cloud-object-storage.appdomain.cloud',\n) -> requests.Response:\n    # Sample code referenced from link below\n    # https://cloud.ibm.com/docs/services/cloud-object-storage/api-reference?topic=cloud-object-storage-hmac-signature  # noqa: E501\n\n    # request elements\n    http_method = 'GET'\n    # region is a wildcard value that takes the place of the AWS region value\n    # as COS doesn't use the same conventions for regions, this parameter can accept any string\n    region = 'us-standard'\n    endpoint = 'https://{}'.format(host)\n    bucket = ''  # add a '/' before the bucket name to list buckets\n    object_key = ''\n    request_parameters = ''\n\n    # assemble the standardized request\n    time = datetime.now(timezone.utc)\n    timestamp = time.strftime('%Y%m%dT%H%M%SZ')\n    datestamp = time.strftime('%Y%m%d')\n\n    standardized_resource = '/' + bucket + '/' + object_key\n    standardized_querystring = request_parameters\n    standardized_headers = 'host:' + host + '\\n' + 'x-amz-date:' + timestamp + '\\n'\n    signed_headers = 'host;x-amz-date'\n    payload_hash = hashlib.sha256(b'').hexdigest()\n\n    standardized_request = (\n        http_method + '\\n'\n        + standardized_resource + '\\n'\n        + standardized_querystring + '\\n'\n        + standardized_headers + '\\n'\n        + signed_headers + '\\n'\n        + payload_hash\n    ).encode('utf-8')\n\n    # assemble string-to-sign\n    hashing_algorithm = 'AWS4-HMAC-SHA256'\n    credential_scope = datestamp + '/' + region + '/' + 's3' + '/' + 'aws4_request'\n    sts = (\n        hashing_algorithm + '\\n'\n        + timestamp + '\\n'\n        + credential_scope + '\\n'\n        + hashlib.sha256(standardized_request).hexdigest()\n    )\n\n    # generate the signature\n    signature_key = createSignatureKey(secret_key, datestamp, region, 's3')\n    signature = hmac.new(\n        signature_key,\n        (sts).encode('utf-8'),\n        hashlib.sha256,\n    ).hexdigest()\n\n    # assemble all elements into the 'authorization' header\n    v4auth_header = (\n        hashing_algorithm + ' '\n        + 'Credential=' + access_key + '/' + credential_scope + ', '\n        + 'SignedHeaders=' + signed_headers + ', '\n        + 'Signature=' + signature\n    )\n\n    # create and send the request\n    headers = {'x-amz-date': timestamp, 'Authorization': v4auth_header}\n    # the 'requests' package automatically adds the required 'host' header\n    request_url = endpoint + standardized_resource + standardized_querystring\n\n    request = requests.get(request_url, headers=headers)\n\n    return request",
      "hash_value": "eacda064a1840de0db258c3b81e78867",
      "detection_index": 1,
      "code_snippets": [
        {
          "snippet": "def verify_ibm_cos_hmac_credentials(\n    access_key: str,\n    secret_key: str,\n    host: str = 's3.us.cloud-object-storage.appdomain.cloud',\n) -> bool:\n    response = query_ibm_cos_hmac(access_key, secret_key, host)\n    return response.status_code == 200\n\n# Helper function used:\ndef query_ibm_cos_hmac(\n    access_key: str,\n    secret_key: str,\n    host: str = 's3.us.cloud-object-storage.appdomain.cloud',\n) -> requests.Response:\n    # Sample code referenced from link below\n    # https://cloud.ibm.com/docs/services/cloud-object-storage/api-reference?topic=cloud-object-storage-hmac-signature  # noqa: E501\n\n    # request elements\n    http_method = 'GET'\n    # region is a wildcard value that takes the place of the AWS region value\n    # as COS doesn't use the same conventions for regions, this parameter can accept any string\n    region = 'us-standard'\n    endpoint = 'https://{}'.format(host)\n    bucket = ''  # add a '/' before the bucket name to list buckets\n    object_key = ''\n    request_parameters = ''\n\n    # assemble the standardized request\n    time = datetime.now(timezone.utc)\n    timestamp = time.strftime('%Y%m%dT%H%M%SZ')\n    datestamp = time.strftime('%Y%m%d')\n\n    standardized_resource = '/' + bucket + '/' + object_key\n    standardized_querystring = request_parameters\n    standardized_headers = 'host:' + host + '\\n' + 'x-amz-date:' + timestamp + '\\n'\n    signed_headers = 'host;x-amz-date'\n    payload_hash = hashlib.sha256(b'').hexdigest()\n\n    standardized_request = (\n        http_method + '\\n'\n        + standardized_resource + '\\n'\n        + standardized_querystring + '\\n'\n        + standardized_headers + '\\n'\n        + signed_headers + '\\n'\n        + payload_hash\n    ).encode('utf-8')\n\n    # assemble string-to-sign\n    hashing_algorithm = 'AWS4-HMAC-SHA256'\n    credential_scope = datestamp + '/' + region + '/' + 's3' + '/' + 'aws4_request'\n    sts = (\n        hashing_algorithm + '\\n'\n        + timestamp + '\\n'\n        + credential_scope + '\\n'\n        + hashlib.sha256(standardized_request).hexdigest()\n    )\n\n    # generate the signature\n    signature_key = createSignatureKey(secret_key, datestamp, region, 's3')\n    signature = hmac.new(\n        signature_key,\n        (sts).encode('utf-8'),\n        hashlib.sha256,\n    ).hexdigest()\n\n    # assemble all elements into the 'authorization' header\n    v4auth_header = (\n        hashing_algorithm + ' '\n        + 'Credential=' + access_key + '/' + credential_scope + ', '\n        + 'SignedHeaders=' + signed_headers + ', '\n        + 'Signature=' + signature\n    )\n\n    # create and send the request\n    headers = {'x-amz-date': timestamp, 'Authorization': v4auth_header}\n    # the 'requests' package automatically adds the required 'host' header\n    request_url = endpoint + standardized_resource + standardized_querystring\n\n    request = requests.get(request_url, headers=headers)\n\n    return request",
          "triple_sequences": [
            {
              "action_api": "datetime.now()",
              "action_description": "Returns current time",
              "action_id": "get_current_time",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "time.strftime('%Y%m%dT%H%M%SZ')",
              "action_description": "Parses string into datetime object",
              "action_id": "parse_datetime",
              "object": "%Y%m%dT%H%M%SZ",
              "object_description": "Character encoding type",
              "object_id": "character_encoding_type",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "time.strftime('%Y%m%d')",
              "action_description": "Parses string into datetime object",
              "action_id": "parse_datetime",
              "object": "%Y%m%d",
              "object_description": "Character encoding type",
              "object_id": "character_encoding_type",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "hashlib.sha256(b'').hexdigest()",
              "action_description": "Returns hexadecimal digest of SHA-256 hash",
              "action_id": "get_sha256_digest",
              "object": "b''",
              "object_description": "Encoded string to bytes",
              "object_id": "encoded_string_bytes",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "str.encode('utf-8')",
              "action_description": "Encodes string to bytes using default encoding",
              "action_id": "encode_string_to_bytes",
              "object": "standardized_request",
              "object_description": "Encoded string to bytes",
              "object_id": "encoded_string_bytes",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "hashlib.sha256(standardized_request).hexdigest()",
              "action_description": "Returns hexadecimal digest of SHA-256 hash",
              "action_id": "get_sha256_digest",
              "object": "standardized_request",
              "object_description": "Encoded string to bytes",
              "object_id": "encoded_string_bytes",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "createSignatureKey()",
              "action_description": "Creates symmetric encryption key",
              "action_id": "init_symmetric_encryption",
              "object": "secret_key, datestamp, region, 's3'",
              "object_description": "Hardcoded key",
              "object_id": "hardcoded_key",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "hmac.new()",
              "action_description": "Creates new hash object",
              "action_id": "create_sha256_hash",
              "object": "signature_key, (sts).encode('utf-8'), hashlib.sha256",
              "object_description": "Hardcoded key",
              "object_id": "hardcoded_key",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "hmac.new().hexdigest()",
              "action_description": "Returns hexadecimal digest of SHA-256 hash",
              "action_id": "get_sha256_digest",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "requests.get()",
              "action_description": "Sends HTTP GET request to URL",
              "action_id": "open_url_get",
              "object": "request_url, headers=headers",
              "object_description": "API endpoint",
              "object_id": "api_endpoint",
              "intention_description": "Download remote content",
              "intention_id": "download_remote_content"
            },
            {
              "action_api": "response.status_code",
              "action_description": "Retrieves HTTP response status code",
              "action_id": "get_http_status",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            }
          ]
        }
      ]
    }
  ]
}