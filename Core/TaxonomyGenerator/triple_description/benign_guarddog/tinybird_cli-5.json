{
  "metadata": {
    "package_name": "tinybird_cli-5",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/benign/tinybird_cli-5.20.1.dev0.json",
    "dataset_type": "benign"
  },
  "code_files": [
    {
      "pyfile": "common.py",
      "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/tinybird_cli-5.20.1.dev0/tinybird_cli-5.20.1.dev0/tinybird/tb_cli_modules/common.py",
      "line_number": "1928",
      "type_description": "clipboard-access",
      "context_snippet": "async def validate_aws_iamrole_integration(\n    client: TinyB,\n    service: str,\n    role_arn: Optional[str],\n    region: Optional[str],\n    policy: str = \"write\",\n    no_validate: Optional[bool] = False,\n):\n    if no_validate is False:\n        access_policy, trust_policy, external_id = await get_aws_iamrole_policies(\n            client, service=service, policy=policy\n        )\n\n        if not role_arn:\n            if not click.confirm(\n                FeedbackManager.prompt_s3_iamrole_connection_login_aws(),\n                show_default=False,\n                prompt_suffix=\"Press y to continue:\",\n            ):\n                sys.exit(1)\n\n            access_policy_copied = True\n            try:\n                pyperclip.copy(access_policy)\n            except Exception:\n                access_policy_copied = False\n\n            replacements_dict = {\n                \"<bucket>\": \"<bucket> with your bucket name\",\n                \"<table_name>\": \"<table_name> with your DynamoDB table name\",\n            }\n\n            replacements = [\n                replacements_dict.get(replacement, \"\")\n                for replacement in replacements_dict.keys()\n                if replacement in access_policy\n            ]\n\n            if not click.confirm(\n                (\n                    FeedbackManager.prompt_s3_iamrole_connection_policy(\n                        access_policy=access_policy, replacements=\", \".join(replacements)\n                    )\n                    if access_policy_copied\n                    else FeedbackManager.prompt_s3_iamrole_connection_policy_not_copied(access_policy=access_policy)\n                ),\n                show_default=False,\n                prompt_suffix=\"Press y to continue:\",\n            ):\n                sys.exit(1)\n\n            trust_policy_copied = True\n            try:\n                pyperclip.copy(trust_policy)\n            except Exception:\n                trust_policy_copied = False\n\n            if not click.confirm(\n                (\n                    FeedbackManager.prompt_s3_iamrole_connection_role(trust_policy=trust_policy)\n                    if trust_policy_copied\n                    else FeedbackManager.prompt_s3_iamrole_connection_role_not_copied(trust_policy=trust_policy)\n                ),\n                show_default=False,\n                prompt_suffix=\"Press y to continue:\",\n            ):\n                sys.exit(1)\n    else:\n        try:\n            trust_policy = await client.get_trust_policy(service)\n            external_id = trust_policy[\"Statement\"][0][\"Condition\"][\"StringEquals\"][\"sts:ExternalId\"]\n        except Exception:\n            external_id = \"\"\n\n    if not role_arn:\n        role_arn = click.prompt(\"Enter the ARN of the role you just created\")\n        validate_string_connector_param(\"Role ARN\", role_arn)\n\n    if not region:\n        region_resource = \"table\" if service == DataConnectorType.AMAZON_DYNAMODB else \"bucket\"\n        region = click.prompt(f\"Enter the region where the {region_resource} is located\")\n        validate_string_connector_param(\"Region\", region)\n\n    return role_arn, region, external_id",
      "hash_value": "79a25499f2450319be0fbd51c85b1c76",
      "detection_index": 1,
      "code_snippets": [
        {
          "snippet": "async def validate_aws_iamrole_integration(\n    client: TinyB,\n    service: str,\n    role_arn: Optional[str],\n    region: Optional[str],\n    policy: str = \"write\",\n    no_validate: Optional[bool] = False,\n):\n    if no_validate is False:\n        access_policy, trust_policy, external_id = await get_aws_iamrole_policies(\n            client, service=service, policy=policy\n        )\n\n        if not role_arn:\n            if not click.confirm(\n                FeedbackManager.prompt_s3_iamrole_connection_login_aws(),\n                show_default=False,\n                prompt_suffix=\"Press y to continue:\",\n            ):\n                sys.exit(1)\n\n            access_policy_copied = True\n            try:\n                pyperclip.copy(access_policy)\n            except Exception:\n                access_policy_copied = False\n\n            replacements_dict = {\n                \"<bucket>\": \"<bucket> with your bucket name\",\n                \"<table_name>\": \"<table_name> with your DynamoDB table name\",\n            }\n\n            replacements = [\n                replacements_dict.get(replacement, \"\")\n                for replacement in replacements_dict.keys()\n                if replacement in access_policy\n            ]\n\n            if not click.confirm(\n                (\n                    FeedbackManager.prompt_s3_iamrole_connection_policy(\n                        access_policy=access_policy, replacements=\", \".join(replacements)\n                    )\n                    if access_policy_copied\n                    else FeedbackManager.prompt_s3_iamrole_connection_policy_not_copied(access_policy=access_policy)\n                ),\n                show_default=False,\n                prompt_suffix=\"Press y to continue:\",\n            ):\n                sys.exit(1)\n\n            trust_policy_copied = True\n            try:\n                pyperclip.copy(trust_policy)\n            except Exception:\n                trust_policy_copied = False\n\n            if not click.confirm(\n                (\n                    FeedbackManager.prompt_s3_iamrole_connection_role(trust_policy=trust_policy)\n                    if trust_policy_copied\n                    else FeedbackManager.prompt_s3_iamrole_connection_role_not_copied(trust_policy=trust_policy)\n                ),\n                show_default=False,\n                prompt_suffix=\"Press y to continue:\",\n            ):\n                sys.exit(1)\n    else:\n        try:\n            trust_policy = await client.get_trust_policy(service)\n            external_id = trust_policy[\"Statement\"][0][\"Condition\"][\"StringEquals\"][\"sts:ExternalId\"]\n        except Exception:\n            external_id = \"\"\n\n    if not role_arn:\n        role_arn = click.prompt(\"Enter the ARN of the role you just created\")\n        validate_string_connector_param(\"Role ARN\", role_arn)\n\n    if not region:\n        region_resource = \"table\" if service == DataConnectorType.AMAZON_DYNAMODB else \"bucket\"\n        region = click.prompt(f\"Enter the region where the {region_resource} is located\")\n        validate_string_connector_param(\"Region\", region)\n\n    return role_arn, region, external_id",
          "triple_sequences": [
            {
              "action_api": "get_aws_iamrole_policies()",
              "action_description": "Instantiates class or retrieves object with custom configuration",
              "action_id": "create_dns_resolver",
              "object": "client, service=service, policy=policy",
              "object_description": "",
              "object_id": "",
              "intention_description": "Access attribute value",
              "intention_id": "access_attribute_value"
            },
            {
              "action_api": "click.confirm()",
              "action_description": "Reads user input from standard input",
              "action_id": "read_user_input",
              "object": "FeedbackManager.prompt_s3_iamrole_connection_login_aws(), show_default=False, prompt_suffix=\"Press y to continue:\"",
              "object_description": "",
              "object_id": "",
              "intention_description": "Collect user input",
              "intention_id": "collect_user_input"
            },
            {
              "action_api": "sys.exit()",
              "action_description": "Exits program",
              "action_id": "exit_program",
              "object": "1",
              "object_description": "",
              "object_id": "",
              "intention_description": "Terminate program execution",
              "intention_id": "terminate_program_execution"
            },
            {
              "action_api": "pyperclip.copy()",
              "action_description": "Copies specified text to system clipboard",
              "action_id": "copy_to_clipboard",
              "object": "access_policy",
              "object_description": "Clipboard content data",
              "object_id": "clipboard_data",
              "intention_description": "Access clipboard data",
              "intention_id": "access_clipboard_data"
            },
            {
              "action_api": "click.confirm()",
              "action_description": "Reads user input from standard input",
              "action_id": "read_user_input",
              "object": "FeedbackManager.prompt_s3_iamrole_connection_policy(access_policy=access_policy, replacements=\", \".join(replacements)) or FeedbackManager.prompt_s3_iamrole_connection_policy_not_copied(access_policy=access_policy), show_default=False, prompt_suffix=\"Press y to continue:\"",
              "object_description": "",
              "object_id": "",
              "intention_description": "Collect user input",
              "intention_id": "collect_user_input"
            },
            {
              "action_api": "sys.exit()",
              "action_description": "Exits program",
              "action_id": "exit_program",
              "object": "1",
              "object_description": "",
              "object_id": "",
              "intention_description": "Terminate program execution",
              "intention_id": "terminate_program_execution"
            },
            {
              "action_api": "pyperclip.copy()",
              "action_description": "Copies specified text to system clipboard",
              "action_id": "copy_to_clipboard",
              "object": "trust_policy",
              "object_description": "Clipboard content data",
              "object_id": "clipboard_data",
              "intention_description": "Access clipboard data",
              "intention_id": "access_clipboard_data"
            },
            {
              "action_api": "click.confirm()",
              "action_description": "Reads user input from standard input",
              "action_id": "read_user_input",
              "object": "FeedbackManager.prompt_s3_iamrole_connection_role(trust_policy=trust_policy) or FeedbackManager.prompt_s3_iamrole_connection_role_not_copied(trust_policy=trust_policy), show_default=False, prompt_suffix=\"Press y to continue:\"",
              "object_description": "",
              "object_id": "",
              "intention_description": "Collect user input",
              "intention_id": "collect_user_input"
            },
            {
              "action_api": "sys.exit()",
              "action_description": "Exits program",
              "action_id": "exit_program",
              "object": "1",
              "object_description": "",
              "object_id": "",
              "intention_description": "Terminate program execution",
              "intention_id": "terminate_program_execution"
            },
            {
              "action_api": "client.get_trust_policy()",
              "action_description": "Instantiates class or retrieves object with custom configuration",
              "action_id": "create_dns_resolver",
              "object": "service",
              "object_description": "",
              "object_id": "",
              "intention_description": "Access attribute value",
              "intention_id": "access_attribute_value"
            },
            {
              "action_api": "click.prompt()",
              "action_description": "Reads user input from standard input",
              "action_id": "read_user_input",
              "object": "\"Enter the ARN of the role you just created\"",
              "object_description": "",
              "object_id": "",
              "intention_description": "Collect user input",
              "intention_id": "collect_user_input"
            },
            {
              "action_api": "validate_string_connector_param()",
              "action_description": "Checks if specified path exists in filesystem",
              "action_id": "check_path_exists",
              "object": "\"Role ARN\", role_arn",
              "object_description": "",
              "object_id": "",
              "intention_description": "Access attribute value",
              "intention_id": "access_attribute_value"
            },
            {
              "action_api": "click.prompt()",
              "action_description": "Reads user input from standard input",
              "action_id": "read_user_input",
              "object": "f\"Enter the region where the {region_resource} is located\"",
              "object_description": "",
              "object_id": "",
              "intention_description": "Collect user input",
              "intention_id": "collect_user_input"
            },
            {
              "action_api": "validate_string_connector_param()",
              "action_description": "Checks if specified path exists in filesystem",
              "action_id": "check_path_exists",
              "object": "\"Region\", region",
              "object_description": "",
              "object_id": "",
              "intention_description": "Access attribute value",
              "intention_id": "access_attribute_value"
            }
          ]
        }
      ]
    }
  ]
}