{
  "metadata": {
    "package_name": "uamqp-1",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/benign/uamqp-1.6.11.json",
    "dataset_type": "benign"
  },
  "code_files": [
    {
      "pyfile": "setup.py",
      "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/uamqp-1.6.11/uamqp-1.6.11/setup.py",
      "line_number": "183",
      "type_description": "code-execution",
      "context_snippet": "import os\nimport subprocess\nimport platform\nimport distutils\nfrom distutils import log as logger\n\ndef get_generator_flags():\n    flags = [\"-G\"]\n    if is_win:\n        flags.append(\"\\\"Visual Studio 17 2022\\\"\")\n        flags.append(\"-A\")\n        flags.append(\"ARM64\" if platform.machine() == \"ARM64\" else \"x64\" if is_x64 else \"Win32\")\n    else:\n        flags.append(\"\\\"Unix Makefiles\\\"\")\n    return \" \".join(flags)\n\ndef get_build_env():\n    build_env = os.environ.copy()\n    return {k.upper(): v for k, v in build_env.items()}\n\nclass build_ext(build_ext_orig):\n    def build_cmake(self, ext):\n        cwd = os.getcwd()\n        self.cmake_build_dir = self.build_temp + \"/cmake\"\n        create_folder_no_exception(self.cmake_build_dir)\n        extdir = self.get_ext_fullpath(ext.name)\n        create_folder_no_exception(extdir)\n        logger.info(\"will build uamqp in %s\", self.cmake_build_dir)\n        os.chdir(cwd + \"/\" + self.cmake_build_dir)\n        generator_flags = get_generator_flags()\n        logger.info(\"Building with generator flags: {}\".format(generator_flags))\n        build_env = get_build_env()\n        # Configure\n        configure_command = [\n            \"cmake\",\n            cwd + \"/src/vendor/azure-uamqp-c/\",\n            generator_flags,\n            \"-Duse_openssl:bool={}\".format(\"ON\" if use_openssl else \"OFF\"),\n            \"-Duse_default_uuid:bool=ON \",\n            \"-Duse_builtin_httpapi:bool=ON \",\n            \"-Dskip_samples:bool=ON\",\n            \"-DCMAKE_POSITION_INDEPENDENT_CODE=TRUE\",\n            \"-DCMAKE_BUILD_TYPE=Release\"\n        ]\n        joined_cmd = \" \".join(configure_command)\n        logger.info(\"calling %s\", joined_cmd)\n        subprocess.check_call(joined_cmd, shell=True, universal_newlines=True, env=build_env)",
      "hash_value": "8979619ed4127c4a17d90ad5d1633f7a",
      "detection_index": 1,
      "code_snippets": [
        {
          "snippet": "import os\nimport subprocess\nimport platform\nimport distutils\nfrom distutils import log as logger\n\ndef get_generator_flags():\n    flags = [\"-G\"]\n    if is_win:\n        flags.append(\"\\\"Visual Studio 17 2022\\\"\")\n        flags.append(\"-A\")\n        flags.append(\"ARM64\" if platform.machine() == \"ARM64\" else \"x64\" if is_x64 else \"Win32\")\n    else:\n        flags.append(\"\\\"Unix Makefiles\\\"\")\n    return \" \".join(flags)\n\ndef get_build_env():\n    build_env = os.environ.copy()\n    return {k.upper(): v for k, v in build_env.items()}\n\nclass build_ext(build_ext_orig):\n    def build_cmake(self, ext):\n        cwd = os.getcwd()\n        self.cmake_build_dir = self.build_temp + \"/cmake\"\n        create_folder_no_exception(self.cmake_build_dir)\n        extdir = self.get_ext_fullpath(ext.name)\n        create_folder_no_exception(extdir)\n        logger.info(\"will build uamqp in %s\", self.cmake_build_dir)\n        os.chdir(cwd + \"/\" + self.cmake_build_dir)\n        generator_flags = get_generator_flags()\n        logger.info(\"Building with generator flags: {}\".format(generator_flags))\n        build_env = get_build_env()\n        # Configure\n        configure_command = [\n            \"cmake\",\n            cwd + \"/src/vendor/azure-uamqp-c/\",\n            generator_flags,\n            \"-Duse_openssl:bool={}\".format(\"ON\" if use_openssl else \"OFF\"),\n            \"-Duse_default_uuid:bool=ON \",\n            \"-Duse_builtin_httpapi:bool=ON \",\n            \"-Dskip_samples:bool=ON\",\n            \"-DCMAKE_POSITION_INDEPENDENT_CODE=TRUE\",\n            \"-DCMAKE_BUILD_TYPE=Release\"\n        ]\n        joined_cmd = \" \".join(configure_command)\n        logger.info(\"calling %s\", joined_cmd)\n        subprocess.check_call(joined_cmd, shell=True, universal_newlines=True, env=build_env)",
          "triple_sequences": [
            {
              "action_api": "os.environ.copy()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            },
            {
              "action_api": "os.getcwd()",
              "action_description": "Returns current working directory",
              "action_id": "get_working_dir",
              "object": "",
              "object_description": "Current working directory",
              "object_id": "current_working_directory",
              "intention_description": "Collect working directory",
              "intention_id": "collect_working_directory"
            },
            {
              "action_api": "create_folder_no_exception()",
              "action_description": "Creates directory, ignoring if it already exists",
              "action_id": "create_directory",
              "object": "self.cmake_build_dir",
              "object_description": "Custom directory",
              "object_id": "custom_directory",
              "intention_description": "Ensure directory exists",
              "intention_id": "ensure_directory_exists"
            },
            {
              "action_api": "create_folder_no_exception()",
              "action_description": "Creates directory, ignoring if it already exists",
              "action_id": "create_directory",
              "object": "extdir",
              "object_description": "Custom directory",
              "object_id": "custom_directory",
              "intention_description": "Ensure directory exists",
              "intention_id": "ensure_directory_exists"
            },
            {
              "action_api": "os.chdir()",
              "action_description": "Changes current working directory",
              "action_id": "change_working_dir",
              "object": "cwd + \"/\" + self.cmake_build_dir",
              "object_description": "Directory path",
              "object_id": "directory_path",
              "intention_description": "Change working directory",
              "intention_id": "change_working_directory"
            },
            {
              "action_api": "subprocess.check_call()",
              "action_description": "Executes shell command",
              "action_id": "execute_shell_command",
              "object": "joined_cmd",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Execute command",
              "intention_id": "execute_command"
            }
          ]
        }
      ]
    }
  ]
}