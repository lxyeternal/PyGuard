{
  "metadata": {
    "package_name": "percy_appium_app-2",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/benign/percy_appium_app-2.0.7.json",
    "dataset_type": "benign"
  },
  "code_files": [
    {
      "pyfile": "cli_wrapper.py",
      "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/percy_appium_app-2.0.7/percy_appium_app-2.0.7/percy/lib/cli_wrapper.py",
      "line_number": "21",
      "type_description": "exfiltrate-sensitive-data",
      "context_snippet": "from functools import lru_cache\nimport os\nimport requests\n\nfrom percy.errors import CLIException\nfrom percy.common import log\nfrom percy.environment import Environment\n\n# Maybe get the CLI API address from the environment\nPERCY_CLI_API = os.environ.get('PERCY_CLI_API') or 'http://localhost:5338'\n\nclass CLIWrapper:\n    def __init__(self) -> None:\n        pass\n\n    # Check if Percy is enabled, caching the result so it is only checked once\n    @staticmethod\n    @lru_cache(maxsize=None)\n    def is_percy_enabled():\n        try:\n            response = requests.get(f'{PERCY_CLI_API}/percy/healthcheck', timeout=10)\n            response.raise_for_status()\n            data = response.json()\n\n            if not data['success']: raise CLIException(data['error'])\n            Environment.percy_build_id = data['build']['id']\n            Environment.percy_build_url = data['build']['url']\n            Environment.session_type = data.get('type', None)\n            version = response.headers.get('x-percy-core-version')\n\n            if version.split('.')[0] != '1':\n                log(f'Unsupported Percy CLI version, {version}')\n                return False\n\n            if int(version.split('.')[1]) < 27:\n                log('Please upgrade to latest CLI version for using this SDK. Minimum compatible version is 1.27.0-beta.0')\n                return False\n\n            return True\n        except Exception as e:\n            log('Percy is not running, disabling screenshots')\n            log(e, on_debug=True)\n            return False",
      "hash_value": "75b8d41ba853f48aa160872496be4123",
      "detection_index": 1,
      "code_snippets": [
        {
          "snippet": "from functools import lru_cache\nimport os\nimport requests\n\nfrom percy.errors import CLIException\nfrom percy.common import log\nfrom percy.environment import Environment\n\n# Maybe get the CLI API address from the environment\nPERCY_CLI_API = os.environ.get('PERCY_CLI_API') or 'http://localhost:5338'\n\nclass CLIWrapper:\n    def __init__(self) -> None:\n        pass\n\n    # Check if Percy is enabled, caching the result so it is only checked once\n    @staticmethod\n    @lru_cache(maxsize=None)\n    def is_percy_enabled():\n        try:\n            response = requests.get(f'{PERCY_CLI_API}/percy/healthcheck', timeout=10)\n            response.raise_for_status()\n            data = response.json()\n\n            if not data['success']: raise CLIException(data['error'])\n            Environment.percy_build_id = data['build']['id']\n            Environment.percy_build_url = data['build']['url']\n            Environment.session_type = data.get('type', None)\n            version = response.headers.get('x-percy-core-version')\n\n            if version.split('.')[0] != '1':\n                log(f'Unsupported Percy CLI version, {version}')\n                return False\n\n            if int(version.split('.')[1]) < 27:\n                log('Please upgrade to latest CLI version for using this SDK. Minimum compatible version is 1.27.0-beta.0')\n                return False\n\n            return True\n        except Exception as e:\n            log('Percy is not running, disabling screenshots')\n            log(e, on_debug=True)\n            return False",
          "triple_sequences": [
            {
              "action_api": "os.environ.get()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "'PERCY_CLI_API'",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            },
            {
              "action_api": "requests.get()",
              "action_description": "Sends HTTP request",
              "action_id": "send_http_request",
              "object": "f'{PERCY_CLI_API}/percy/healthcheck', timeout=10",
              "object_description": "API endpoint",
              "object_id": "api_endpoint",
              "intention_description": "Download remote content",
              "intention_id": "download_remote_content"
            },
            {
              "action_api": "response.raise_for_status()",
              "action_description": "Raises HTTPError if response status code indicates error",
              "action_id": "raise_http_error",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Stop execution on invalid input",
              "intention_id": "stop_execution_invalid_input"
            },
            {
              "action_api": "response.json()",
              "action_description": "Deserializes JSON response body to Python object",
              "action_id": "deserialize_json_response",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Parse JSON data",
              "intention_id": "parse_json_data"
            },
            {
              "action_api": "response.headers.get()",
              "action_description": "Adds HTTP header to request object",
              "action_id": "add_http_header",
              "object": "'x-percy-core-version'",
              "object_description": "HTTP header",
              "object_id": "http_header",
              "intention_description": "Access attribute value",
              "intention_id": "access_attribute_value"
            },
            {
              "action_api": "version.split()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "'.'",
              "object_description": "Space delimiter",
              "object_id": "space_delimiter",
              "intention_description": "Prepare string processing",
              "intention_id": "prepare_string_processing"
            },
            {
              "action_api": "int()",
              "action_description": "Converts integer to bytes with specified length and byte order",
              "action_id": "convert_int_to_bytes",
              "object": "version.split('.')[1]",
              "object_description": "Character code array",
              "object_id": "character_code_array",
              "intention_description": "Convert string to integer",
              "intention_id": "convert_string_to_integer"
            },
            {
              "action_api": "log()",
              "action_description": "Executes shell command",
              "action_id": "execute_shell_command",
              "object": "f'Unsupported Percy CLI version, {version}'",
              "object_description": "Error message text",
              "object_id": "error_message",
              "intention_description": "Access attribute value",
              "intention_id": "access_attribute_value"
            },
            {
              "action_api": "log()",
              "action_description": "Executes shell command",
              "action_id": "execute_shell_command",
              "object": "'Please upgrade to latest CLI version for using this SDK. Minimum compatible version is 1.27.0-beta.0'",
              "object_description": "Error message text",
              "object_id": "error_message",
              "intention_description": "Access attribute value",
              "intention_id": "access_attribute_value"
            },
            {
              "action_api": "log()",
              "action_description": "Executes shell command",
              "action_id": "execute_shell_command",
              "object": "'Percy is not running, disabling screenshots'",
              "object_description": "Error message text",
              "object_id": "error_message",
              "intention_description": "Access attribute value",
              "intention_id": "access_attribute_value"
            },
            {
              "action_api": "log()",
              "action_description": "Executes shell command",
              "action_id": "execute_shell_command",
              "object": "e, on_debug=True",
              "object_description": "Error message text",
              "object_id": "error_message",
              "intention_description": "Access attribute value",
              "intention_id": "access_attribute_value"
            }
          ]
        }
      ]
    }
  ]
}