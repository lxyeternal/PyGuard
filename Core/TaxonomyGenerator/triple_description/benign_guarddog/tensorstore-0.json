{
  "metadata": {
    "package_name": "tensorstore-0",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/benign/tensorstore-0.1.73.json",
    "dataset_type": "benign"
  },
  "code_files": [
    {
      "pyfile": "setup.py",
      "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/tensorstore-0.1.73/tensorstore-0.1.73/setup.py",
      "line_number": "307",
      "type_description": "code-execution",
      "context_snippet": "class BuildExtCommand(setuptools.command.build_ext.build_ext):\n  \"\"\"Overrides default build_ext command to invoke bazel.\"\"\"\n\n  def run(self):\n    if not self.dry_run:\n      ext = self.extensions[0]\n      ext_full_path = self.get_ext_fullpath(ext.name)\n\n      prebuilt_path = os.getenv('TENSORSTORE_PREBUILT_DIR')\n      if not prebuilt_path:\n        # Bazel cache includes PATH; attempt to remove the pip build-env\n        # from the PATH as bazel is already hermetic to improve cache use.\n        action_env = _get_action_env()\n\n        # Ensure python_configure.bzl finds the correct Python verison.\n        os.environ['PYTHON_BIN_PATH'] = sys.executable\n\n        # Ensure it is built against the version of `numpy` in the current\n        # environment (which should be as old as possible for best\n        # compatibility).\n        system_python_libs = [\n            x.strip()\n            for x in os.getenv(SYSTEM_PYTHON_LIBS_ENVVAR, '').split(',')\n            if x.strip()\n        ]\n        if 'numpy' not in system_python_libs:\n          system_python_libs.append('numpy')\n        os.environ[SYSTEM_PYTHON_LIBS_ENVVAR] = ','.join(system_python_libs)\n\n        bazelisk = os.getenv('TENSORSTORE_BAZELISK', 'bazelisk.py')\n        # Controlled via `setup.py build_ext --debug` flag.\n        default_compilation_mode = 'dbg' if self.debug else 'opt'\n        startup_options = shlex.split(\n            os.getenv('TENSORSTORE_BAZEL_STARTUP_OPTIONS', '')\n        )\n        build_options = shlex.split(\n            os.getenv('TENSORSTORE_BAZEL_BUILD_OPTIONS', '')\n        )\n\n        # Build with a specific compilation mode.\n        # When in opt mode also set -O3 optimizations to override bazel -O2.\n        compilation_mode = os.getenv(\n            'TENSORSTORE_BAZEL_COMPILATION_MODE', default_compilation_mode\n        )\n        build_flags = ['build', '-c', compilation_mode]\n        if compilation_mode == 'opt':\n          if 'win32' in sys.platform:\n            # Assumes MSVC compiler.\n            build_flags.append('--copt=/Ox')\n          else:\n            build_flags.append('--copt=-O3')\n\n        build_command = (\n            [sys.executable, '-u', bazelisk]\n            + startup_options\n            + build_flags\n            + [\n                '//python/tensorstore:_tensorstore__shared_objects',\n                '--verbose_failures',\n                # Bazel does not seem to download these files by default when\n                # using remote caching.\n                r'--remote_download_regex=.*/_tensorstore\\.(so|pyd)',\n            ]\n            + action_env\n            + build_options\n        )\n        if 'darwin' in sys.platform:\n          # Note: Bazel does not use the MACOSX_DEPLOYMENT_TARGET environment\n          # variable.\n          build_command += ['--macos_minimum_os=%s' % _macos_deployment_target]\n          # Support cross-compilation on macOS\n          # https://github.com/pypa/cibuildwheel/discussions/997#discussioncomment-2045760\n          darwin_cpus = [\n              x for x in os.getenv('ARCHFLAGS', '').split() if x != '-arch'\n          ]\n          # cibuildwheel sets `ARCHFLAGS` to one of:\n          #     '-arch x86_64'\n          #     '-arch arm64'\n          #     '-arch arm64 -arch x86_64'\n          if darwin_cpus:\n            if len(darwin_cpus) > 1:\n              raise ValueError(\n                  'Fat/universal %r build not supported' % (darwin_cpus,)\n              )\n            darwin_cpu = darwin_cpus[0]\n            build_command += [\n                f'--cpu=darwin_{darwin_cpu}',\n                f'--macos_cpus={darwin_cpu}',\n            ]\n        if sys.platform == 'win32':\n          # Disable newer exception handling from Visual Studio 2019, since it\n          # requires a newer C++ runtime than shipped with Python.\n          #\n          # https://cibuildwheel.readthedocs.io/en/stable/faq/#importerror-dll-load-failed-the-specific-module-could-not-be-found-error-on-windows\n          build_command += ['--copt=/d2FH4-']\n        else:\n          # Build with hidden visibility for more efficient code generation.\n          # Note that this also hides most symbols, but ultimately has no effect\n          # on symbol visibility because a separate linker option is already\n          # used to hide all extraneous symbols anyway.\n          build_command += ['--copt=-fvisibility=hidden']\n\n        self.spawn(build_command)\n        suffix = '.pyd' if os.name == 'nt' else '.so'\n        built_ext_path = os.path.join(\n            'bazel-bin/python/tensorstore/_tensorstore' + suffix\n        )\n      else:\n        # If `TENSORSTORE_PREBUILT_DIR` is set, the extension module is assumed\n        # to have already been built a prior call to `build_ext -b\n        # $TENSORSTORE_PREBUILT_DIR`.\n        #\n        # This is used in conjunction with cibuildwheel to first perform an\n        # in-tree build of the extension module in order to take advantage of\n        # Bazel caching:\n        #\n        # https://github.com/pypa/pip/pull/9091\n        # https://github.com/joerick/cibuildwheel/issues/486\n        built_ext_path = os.path.join(\n            prebuilt_path, 'tensorstore', os.path.basename(ext_full_path)\n        )\n\n      os.makedirs(os.path.dirname(ext_full_path), exist_ok=True)\n      print(\n          'Copying extension %s -> %s'\n          % (\n              built_ext_path,\n              ext_full_path,\n          )\n      )\n      shutil.copyfile(built_ext_path, ext_full_path)\n",
      "hash_value": "42662ce41419bbad7a676bbcb9c13b60",
      "detection_index": 1,
      "code_snippets": [
        {
          "snippet": "class BuildExtCommand(setuptools.command.build_ext.build_ext):\n  \"\"\"Overrides default build_ext command to invoke bazel.\"\"\"\n\n  def run(self):\n    if not self.dry_run:\n      ext = self.extensions[0]\n      ext_full_path = self.get_ext_fullpath(ext.name)\n\n      prebuilt_path = os.getenv('TENSORSTORE_PREBUILT_DIR')\n      if not prebuilt_path:\n        # Bazel cache includes PATH; attempt to remove the pip build-env\n        # from the PATH as bazel is already hermetic to improve cache use.\n        action_env = _get_action_env()\n\n        # Ensure python_configure.bzl finds the correct Python verison.\n        os.environ['PYTHON_BIN_PATH'] = sys.executable\n\n        # Ensure it is built against the version of `numpy` in the current\n        # environment (which should be as old as possible for best\n        # compatibility).\n        system_python_libs = [\n            x.strip()\n            for x in os.getenv(SYSTEM_PYTHON_LIBS_ENVVAR, '').split(',')\n            if x.strip()\n        ]\n        if 'numpy' not in system_python_libs:\n          system_python_libs.append('numpy')\n        os.environ[SYSTEM_PYTHON_LIBS_ENVVAR] = ','.join(system_python_libs)\n\n        bazelisk = os.getenv('TENSORSTORE_BAZELISK', 'bazelisk.py')\n        # Controlled via `setup.py build_ext --debug` flag.\n        default_compilation_mode = 'dbg' if self.debug else 'opt'\n        startup_options = shlex.split(\n            os.getenv('TENSORSTORE_BAZEL_STARTUP_OPTIONS', '')\n        )\n        build_options = shlex.split(\n            os.getenv('TENSORSTORE_BAZEL_BUILD_OPTIONS', '')\n        )\n\n        # Build with a specific compilation mode.\n        # When in opt mode also set -O3 optimizations to override bazel -O2.\n        compilation_mode = os.getenv(\n            'TENSORSTORE_BAZEL_COMPILATION_MODE', default_compilation_mode\n        )\n        build_flags = ['build', '-c', compilation_mode]\n        if compilation_mode == 'opt':\n          if 'win32' in sys.platform:\n            # Assumes MSVC compiler.\n            build_flags.append('--copt=/Ox')\n          else:\n            build_flags.append('--copt=-O3')\n\n        build_command = (\n            [sys.executable, '-u', bazelisk]\n            + startup_options\n            + build_flags\n            + [\n                '//python/tensorstore:_tensorstore__shared_objects',\n                '--verbose_failures',\n                # Bazel does not seem to download these files by default when\n                # using remote caching.\n                r'--remote_download_regex=.*/_tensorstore\\.(so|pyd)',\n            ]\n            + action_env\n            + build_options\n        )\n        if 'darwin' in sys.platform:\n          # Note: Bazel does not use the MACOSX_DEPLOYMENT_TARGET environment\n          # variable.\n          build_command += ['--macos_minimum_os=%s' % _macos_deployment_target]\n          # Support cross-compilation on macOS\n          # https://github.com/pypa/cibuildwheel/discussions/997#discussioncomment-2045760\n          darwin_cpus = [\n              x for x in os.getenv('ARCHFLAGS', '').split() if x != '-arch'\n          ]\n          # cibuildwheel sets `ARCHFLAGS` to one of:\n          #     '-arch x86_64'\n          #     '-arch arm64'\n          #     '-arch arm64 -arch x86_64'\n          if darwin_cpus:\n            if len(darwin_cpus) > 1:\n              raise ValueError(\n                  'Fat/universal %r build not supported' % (darwin_cpus,)\n              )\n            darwin_cpu = darwin_cpus[0]\n            build_command += [\n                f'--cpu=darwin_{darwin_cpu}',\n                f'--macos_cpus={darwin_cpu}',\n            ]\n        if sys.platform == 'win32':\n          # Disable newer exception handling from Visual Studio 2019, since it\n          # requires a newer C++ runtime than shipped with Python.\n          #\n          # https://cibuildwheel.readthedocs.io/en/stable/faq/#importerror-dll-load-failed-the-specific-module-could-not-be-found-error-on-windows\n          build_command += ['--copt=/d2FH4-']\n        else:\n          # Build with hidden visibility for more efficient code generation.\n          # Note that this also hides most symbols, but ultimately has no effect\n          # on symbol visibility because a separate linker option is already\n          # used to hide all extraneous symbols anyway.\n          build_command += ['--copt=-fvisibility=hidden']\n\n        self.spawn(build_command)\n        suffix = '.pyd' if os.name == 'nt' else '.so'\n        built_ext_path = os.path.join(\n            'bazel-bin/python/tensorstore/_tensorstore' + suffix\n        )\n      else:\n        # If `TENSORSTORE_PREBUILT_DIR` is set, the extension module is assumed\n        # to have already been built a prior call to `build_ext -b\n        # $TENSORSTORE_PREBUILT_DIR`.\n        #\n        # This is used in conjunction with cibuildwheel to first perform an\n        # in-tree build of the extension module in order to take advantage of\n        # Bazel caching:\n        #\n        # https://github.com/pypa/pip/pull/9091\n        # https://github.com/joerick/cibuildwheel/issues/486\n        built_ext_path = os.path.join(\n            prebuilt_path, 'tensorstore', os.path.basename(ext_full_path)\n        )\n\n      os.makedirs(os.path.dirname(ext_full_path), exist_ok=True)\n      print(\n          'Copying extension %s -> %s'\n          % (\n              built_ext_path,\n              ext_full_path,\n          )\n      )\n      shutil.copyfile(built_ext_path, ext_full_path)\n",
          "triple_sequences": [
            {
              "action_api": "os.getenv()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "'TENSORSTORE_PREBUILT_DIR'",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            },
            {
              "action_api": "os.getenv()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "SYSTEM_PYTHON_LIBS_ENVVAR",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            },
            {
              "action_api": "os.getenv()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "'TENSORSTORE_BAZELISK', 'bazelisk.py'",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            },
            {
              "action_api": "os.getenv()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "'TENSORSTORE_BAZEL_STARTUP_OPTIONS', ''",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            },
            {
              "action_api": "os.getenv()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "'TENSORSTORE_BAZEL_BUILD_OPTIONS', ''",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            },
            {
              "action_api": "os.getenv()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "'TENSORSTORE_BAZEL_COMPILATION_MODE', default_compilation_mode",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            },
            {
              "action_api": "os.getenv()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "'ARCHFLAGS', ''",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            },
            {
              "action_api": "os.environ.__setitem__()",
              "action_description": "Sets attribute on builtins object",
              "action_id": "set_builtin_attr",
              "object": "'PYTHON_BIN_PATH', sys.executable",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            },
            {
              "action_api": "os.environ.__setitem__()",
              "action_description": "Sets attribute on builtins object",
              "action_id": "set_builtin_attr",
              "object": "SYSTEM_PYTHON_LIBS_ENVVAR, ','.join(system_python_libs)",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            },
            {
              "action_api": "shlex.split()",
              "action_description": "Splits string into list using shell-like syntax",
              "action_id": "path_string_operations",
              "object": "os.getenv('TENSORSTORE_BAZEL_STARTUP_OPTIONS', '')",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "shlex.split()",
              "action_description": "Splits string into list using shell-like syntax",
              "action_id": "path_string_operations",
              "object": "os.getenv('TENSORSTORE_BAZEL_BUILD_OPTIONS', '')",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "self.spawn()",
              "action_description": "Spawns new process to execute command with shell access",
              "action_id": "spawn_process_shell",
              "object": "build_command",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Execute command",
              "intention_id": "execute_command"
            },
            {
              "action_api": "os.path.join()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "'bazel-bin/python/tensorstore/_tensorstore' + suffix",
              "object_description": "Directory path with file",
              "object_id": "directory_path_with_file",
              "intention_description": "Construct file or directory path",
              "intention_id": "construct_file_path"
            },
            {
              "action_api": "os.path.join()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "prebuilt_path, 'tensorstore', os.path.basename(ext_full_path)",
              "object_description": "Directory path with file",
              "object_id": "directory_path_with_file",
              "intention_description": "Construct file or directory path",
              "intention_id": "construct_file_path"
            },
            {
              "action_api": "os.makedirs()",
              "action_description": "Creates directory, ignoring if it already exists",
              "action_id": "create_directory",
              "object": "os.path.dirname(ext_full_path), exist_ok=True",
              "object_description": "Directory path",
              "object_id": "directory_path",
              "intention_description": "Ensure directory exists",
              "intention_id": "ensure_directory_exists"
            },
            {
              "action_api": "shutil.copyfile()",
              "action_description": "Copies file to destination",
              "action_id": "copy_file",
              "object": "built_ext_path, ext_full_path",
              "object_description": "Local file or directory",
              "object_id": "local_file_or_directory",
              "intention_description": "Move file to destination",
              "intention_id": "move_file_destination"
            }
          ]
        }
      ]
    }
  ]
}