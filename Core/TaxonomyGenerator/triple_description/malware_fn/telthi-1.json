{
  "metadata": {
    "package_name": "telthi-1",
    "original_json_path": "/home2/blue/Documents/PyPIAgent/Codes/tool_detect/false_negative/llm_analysis/telthi-1.json",
    "dataset_type": "malware_fn"
  },
  "code_files": [
    {
      "pyfile": "setup.py",
      "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_malware/telthi-1/telthi-1/setup.py",
      "code_snippets": [
        {
          "snippet": "import os\nimport sys\nimport subprocess\nimport shutil\nimport base64\nimport zlib\nimport json\nimport re\nimport uuid\nimport psutil\nimport requests\nimport ctypes\nfrom pathlib import Path\nfrom zipfile import ZipFile\nfrom Crypto.Cipher import AES\nfrom discord import Embed, File, SyncWebhook\nfrom win32crypt import CryptUnprotectData\nimport wmi\nfrom PIL import ImageGrab\n\n# Global data exfiltration lists\n__ùôáùôäùôÇùóúùó°ùó¶__ = []\n__ùòæùòñùó¢ùôÜùôÑùòåùôé__ = []\n__ùôíùòåùòΩ_ùôÉùóúùó¶ùôèùôäùó•ùò†__ = []\n__ùòãùôäùôíùó°ùóüùôäùòºùòøùôé__ = []\n__ùòäùòàùôçùòøùó¶__ = []\n\n# --- Malicious classes and functions ---\n# 1. SystemInfo: collects system/user info, screenshots, and exfiltrates via Discord webhook\n# 2. Startup: achieves persistence by copying itself and editing registry\n# 3. Injection: injects code into Discord installations to maintain persistence and exfiltrate tokens\n# 4. extract_tokens/upload_tokens: steals Discord tokens and exfiltrates them\n# 5. Browsers/Chromium/Opera: steals browser credentials, cookies, history, downloads, credit cards\n# 6. AntiDebug: attempts to evade analysis and kill debuggers\n# 7. main(): runs all above on install\n\n# --- Malicious code starts ---\n\n# 1. SystemInfo: collects and exfiltrates system/user info and screenshot\nclass SystemInfo:\n    def __init__(self, webhook):\n        # ... (obfuscated code omitted for brevity)\n        # Takes screenshot, collects system/user info, and exfiltrates via Discord webhook\n        pass\n    # ... (user_data, system_data, disk_data, network_data, wifi_data)\n\n# 2. Startup: achieves persistence\nclass Startup:\n    def __init__(self):\n        # ... (obfuscated code omitted for brevity)\n        # Copies itself to AppData, writes a stub, and edits registry for persistence\n        pass\n    # ... (check_self, mkdir, write_stub, regedit)\n\n# 3. Injection: injects code into Discord installations\nclass Injection:\n    def __init__(self, webhook):\n        # ... (obfuscated code omitted for brevity)\n        # Downloads malicious code, kills Discord, overwrites core files, restarts Discord\n        pass\n    # ... (get_core, start_discord)\n\n# 4. DiscordToken/extract_tokens/upload_tokens: steals Discord tokens and exfiltrates them\nclass DiscordToken:\n    def __init__(self, webhook):\n        upload_tokens(webhook).upload()\n\nclass extract_tokens:\n    def __init__(self):\n        # ... (obfuscated code omitted for brevity)\n        # Locates Discord/Chrome/Opera tokens, decrypts them, validates, and stores for exfiltration\n        pass\n    # ... (extract, validate_token, decrypt_val, get_master_key)\n\nclass upload_tokens:\n    def __init__(self, webhook):\n        # ... (obfuscated code omitted for brevity)\n        # Exfiltrates tokens and user info to Discord webhook\n        pass\n    # ... (calc_flags, upload)\n\n# 5. Browsers/Chromium/Opera: steals browser credentials, cookies, history, downloads, credit cards\nclass Browsers:\n    def __init__(self, webhook):\n        Chromium()\n        Opera()\n        Upload(webhook)\n\nclass Upload:\n    def __init__(self, webhook):\n        self.webhook = webhook\n        self.write_files()\n        self.send()\n        self.clean()\n    def write_files(self):\n        # Writes stolen data to disk, zips it\n        pass\n    def send(self):\n        # Exfiltrates zipped data to Discord webhook\n        pass\n    def clean(self):\n        # Cleans up traces\n        pass\n    def tree(self, path, prefix='', midfix_folder='', midfix_file=''):\n        # Directory tree for exfiltration\n        pass\n\nclass Chromium:\n    def __init__(self):\n        # ... (obfuscated code omitted for brevity)\n        # Steals passwords, cookies, history, downloads, credit cards from Chromium browsers\n        pass\n    # ... (get_master_key, decrypt_password, get_login_data, get_cookies, get_web_history, get_downloads, get_credit_cards)\n\nclass Opera:\n    def __init__(self):\n        # ... (obfuscated code omitted for brevity)\n        # Steals passwords, cookies, history, downloads, credit cards from Opera\n        pass\n    # ... (get_master_key, decrypt_password, get_login_data, get_cookies, get_web_history, get_downloads, get_credit_cards)\n\n# 6. AntiDebug: attempts to evade analysis and kill debuggers\nclass AntiDebug:\n    def __init__(self):\n        if self.checks():\n            sys.exit(int())\n    def checks(self):\n        # ... (obfuscated code omitted for brevity)\n        # Kills blacklisted processes, checks for blacklisted users, hostnames, HWIDs, IPs, MACs\n        pass\n    def check_process(self):\n        for proc in psutil.process_iter():\n            if any((procstr in proc.name().lower() for procstr in self.blacklistedProcesses)):\n                try:\n                    proc.kill()\n                except (psutil.NoSuchProcess, psutil.AccessDenied):\n                    pass\n    def get_network(self):\n        # ... (obfuscated code omitted for brevity)\n        pass\n    def get_system(self):\n        # ... (obfuscated code omitted for brevity)\n        pass\n\n# 7. main(): runs all above on install\n\ndef main():\n    funcs = [AntiDebug, Browsers, DiscordToken, Injection, Startup, SystemInfo]\n    for func in funcs:\n        if __CONFIG__[func.__name__.lower()]:\n            try:\n                if func.__init__.__code__.co_argcount == 2:\n                    func(__CONFIG__['webhook'])\n                else:\n                    func()\n            except Exception as e:\n                print('Error running {}: {}'.format(func.__name__, e))\n\nif __name__ == '__main__':\n    main()\n",
          "triple_sequences": [
            {
              "action_api": "ImageGrab.grab()",
              "action_description": "Captures screenshot of screen",
              "action_id": "capture_screen_region",
              "object": "",
              "object_description": "Screen region",
              "object_id": "screen_region",
              "intention_description": "Capture screenshot",
              "intention_id": "capture_screenshot"
            },
            {
              "action_api": "requests.post()",
              "action_description": "Sends HTTP request",
              "action_id": "send_http_request",
              "object": "Discord webhook URL",
              "object_description": "Discord webhook URL",
              "object_id": "discord_webhook_url",
              "intention_description": "Send system information to server",
              "intention_id": "send_system_info_server"
            },
            {
              "action_api": "shutil.copy()",
              "action_description": "Copies file to destination",
              "action_id": "copy_file",
              "object": "executable file to AppData directory",
              "object_description": "Executable file",
              "object_id": "executable_file",
              "intention_description": "Copy file to startup directory",
              "intention_id": "copy_file_startup_directory"
            },
            {
              "action_api": "win32crypt.CryptUnprotectData()",
              "action_description": "Decrypts Windows DPAPI-encrypted data",
              "action_id": "decrypt_dpapi_data",
              "object": "encrypted browser credential data",
              "object_description": "Encrypted data",
              "object_id": "encrypted_data",
              "intention_description": "Decrypt browser password",
              "intention_id": "decrypt_browser_password"
            },
            {
              "action_api": "subprocess.Popen()",
              "action_description": "Spawns new process to execute command with shell access",
              "action_id": "spawn_process_shell",
              "object": "Discord executable",
              "object_description": "Executable file",
              "object_id": "executable_file",
              "intention_description": "Execute file",
              "intention_id": "execute_file"
            },
            {
              "action_api": "ZipFile.write()",
              "action_description": "Adds file to ZIP archive with specified archive name",
              "action_id": "add_file_zip",
              "object": "stolen browser data files",
              "object_description": "Browser data",
              "object_id": "browser_data",
              "intention_description": "Add file to zip archive",
              "intention_id": "add_file_to_archive"
            },
            {
              "action_api": "ZipFile()",
              "action_description": "Creates new ZIP archive for writing",
              "action_id": "create_zip_archive",
              "object": "archive file",
              "object_description": "ZIP archive file",
              "object_id": "zip_archive",
              "intention_description": "Create zip archive",
              "intention_id": "create_zip_archive"
            },
            {
              "action_api": "requests.post()",
              "action_description": "Sends HTTP request",
              "action_id": "send_http_request",
              "object": "Discord webhook URL with zipped browser data",
              "object_description": "Discord webhook URL",
              "object_id": "discord_webhook_url",
              "intention_description": "Send browser data to server",
              "intention_id": "send_browser_data_server"
            },
            {
              "action_api": "os.remove()",
              "action_description": "Deletes specified file from filesystem",
              "action_id": "delete_file",
              "object": "temporary files",
              "object_description": "Temporary file path",
              "object_id": "temporary_file_path",
              "intention_description": "Delete file",
              "intention_id": "delete_file"
            },
            {
              "action_api": "psutil.process_iter()",
              "action_description": "Iterates over all running processes",
              "action_id": "iterate_processes",
              "object": "",
              "object_description": "System process",
              "object_id": "system_process",
              "intention_description": "List processes",
              "intention_id": "list_processes"
            },
            {
              "action_api": "proc.kill()",
              "action_description": "Terminates the process",
              "action_id": "terminate_process",
              "object": "blacklisted process",
              "object_description": "Process ID",
              "object_id": "process_id",
              "intention_description": "Terminate process",
              "intention_id": "terminate_process"
            },
            {
              "action_api": "sys.exit()",
              "action_description": "Exits program",
              "action_id": "exit_program",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Terminate program execution",
              "intention_id": "terminate_program_execution"
            },
            {
              "action_api": "os.path.exists()",
              "action_description": "Checks if specified path exists in filesystem",
              "action_id": "check_path_exists",
              "object": "browser data directory",
              "object_description": "Browser data directory",
              "object_id": "browser_data_directory",
              "intention_description": "Determine presence of browser data",
              "intention_id": "determine_browser_data_presence"
            },
            {
              "action_api": "AES.new()",
              "action_description": "Initializes symmetric encryption with provided key",
              "action_id": "init_symmetric_encryption",
              "object": "browser master key",
              "object_description": "Encryption key",
              "object_id": "encryption_key",
              "intention_description": "Decrypt browser master key",
              "intention_id": "decrypt_browser_master_key"
            },
            {
              "action_api": "re.findall()",
              "action_description": "Compiles regular expression pattern",
              "action_id": "compile_regex",
              "object": "regex pattern for Discord tokens",
              "object_description": "Regular expression pattern",
              "object_id": "regex_pattern",
              "intention_description": "Extract browser tokens",
              "intention_id": "extract_browser_tokens"
            },
            {
              "action_api": "json.loads()",
              "action_description": "Deserializes JSON string to Python object",
              "action_id": "deserialize_from_json",
              "object": "browser local state file content",
              "object_description": "Chrome local state file",
              "object_id": "chrome_local_state_file",
              "intention_description": "Access browser local state file",
              "intention_id": "access_browser_local_state"
            },
            {
              "action_api": "wmi.WMI()",
              "action_description": "Instantiates WMI interface for system management",
              "action_id": "instantiate_wmi",
              "object": "",
              "object_description": "",
              "object_id": "",
              "intention_description": "Access WMI interface",
              "intention_id": "access_wmi_interface"
            }
          ]
        }
      ]
    }
  ]
}