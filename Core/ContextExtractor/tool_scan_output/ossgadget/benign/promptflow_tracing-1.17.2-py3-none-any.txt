[31m--[ [0m[34mMatch #[0m[33m1[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/promptflow/tracing/_utils.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m9 | [0m[35m[0m
[30;1m10 | [0m[35m[0m
[30;1m11 | [0m[35mdef is_tracing_disabled():[0m
[30;1m12 | [0m[35m    return os.environ.get("PF_DISABLE_TRACING", "true").lower() == "true"[0m
[30;1m13 | [0m[35m[0m
[30;1m14 | [0m[35m[0m
[30;1m15 | [0m[35mdef serialize(value: object, remove_null: bool = False, serialization_funcs: Dict[type, Callable] = [0m

[31m--[ [0m[34mMatch #[0m[33m2[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/promptflow/tracing/_integrations/_openai_injector.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m205 | [0m[35m        openai.organization = os.environ.get("OPENAI_ORGANIZATION", openai.organization)[0m
[30;1m206 | [0m[35m        openai.api_base = os.environ.get("OPENAI_API_BASE", openai.api_base)[0m
[30;1m207 | [0m[35m        openai.api_type = os.environ.get("OPENAI_API_TYPE", openai.api_type)[0m
[30;1m208 | [0m[35m        openai.api_version = os.environ.get("OPENAI_API_VERSION", openai.api_version)[0m
[30;1m209 | [0m[35m[0m
[30;1m210 | [0m[35m[0m
[30;1m211 | [0m[35mdef recover_openai_api():[0m

[31m--[ [0m[34mMatch #[0m[33m3[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/promptflow/tracing/_integrations/_openai_injector.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m204 | [0m[35m        openai.api_key_path = os.environ.get("OPENAI_API_KEY_PATH", openai.api_key_path)[0m
[30;1m205 | [0m[35m        openai.organization = os.environ.get("OPENAI_ORGANIZATION", openai.organization)[0m
[30;1m206 | [0m[35m        openai.api_base = os.environ.get("OPENAI_API_BASE", openai.api_base)[0m
[30;1m207 | [0m[35m        openai.api_type = os.environ.get("OPENAI_API_TYPE", openai.api_type)[0m
[30;1m208 | [0m[35m        openai.api_version = os.environ.get("OPENAI_API_VERSION", openai.api_version)[0m
[30;1m209 | [0m[35m[0m
[30;1m210 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m4[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/promptflow/tracing/_integrations/_openai_injector.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m203 | [0m[35m        openai.api_key = os.environ.get("OPENAI_API_KEY", openai.api_key)[0m
[30;1m204 | [0m[35m        openai.api_key_path = os.environ.get("OPENAI_API_KEY_PATH", openai.api_key_path)[0m
[30;1m205 | [0m[35m        openai.organization = os.environ.get("OPENAI_ORGANIZATION", openai.organization)[0m
[30;1m206 | [0m[35m        openai.api_base = os.environ.get("OPENAI_API_BASE", openai.api_base)[0m
[30;1m207 | [0m[35m        openai.api_type = os.environ.get("OPENAI_API_TYPE", openai.api_type)[0m
[30;1m208 | [0m[35m        openai.api_version = os.environ.get("OPENAI_API_VERSION", openai.api_version)[0m
[30;1m209 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m5[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/promptflow/tracing/_integrations/_openai_injector.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m202 | [0m[35m        # The issue has been fixed in openai>=1.0.0.[0m
[30;1m203 | [0m[35m        openai.api_key = os.environ.get("OPENAI_API_KEY", openai.api_key)[0m
[30;1m204 | [0m[35m        openai.api_key_path = os.environ.get("OPENAI_API_KEY_PATH", openai.api_key_path)[0m
[30;1m205 | [0m[35m        openai.organization = os.environ.get("OPENAI_ORGANIZATION", openai.organization)[0m
[30;1m206 | [0m[35m        openai.api_base = os.environ.get("OPENAI_API_BASE", openai.api_base)[0m
[30;1m207 | [0m[35m        openai.api_type = os.environ.get("OPENAI_API_TYPE", openai.api_type)[0m
[30;1m208 | [0m[35m        openai.api_version = os.environ.get("OPENAI_API_VERSION", openai.api_version)[0m

[31m--[ [0m[34mMatch #[0m[33m6[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/promptflow/tracing/_integrations/_openai_injector.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m201 | [0m[35m        # Please refer to this issue: https://github.com/openai/openai-python/issues/557.[0m
[30;1m202 | [0m[35m        # The issue has been fixed in openai>=1.0.0.[0m
[30;1m203 | [0m[35m        openai.api_key = os.environ.get("OPENAI_API_KEY", openai.api_key)[0m
[30;1m204 | [0m[35m        openai.api_key_path = os.environ.get("OPENAI_API_KEY_PATH", openai.api_key_path)[0m
[30;1m205 | [0m[35m        openai.organization = os.environ.get("OPENAI_ORGANIZATION", openai.organization)[0m
[30;1m206 | [0m[35m        openai.api_base = os.environ.get("OPENAI_API_BASE", openai.api_base)[0m
[30;1m207 | [0m[35m        openai.api_type = os.environ.get("OPENAI_API_TYPE", openai.api_type)[0m

[31m--[ [0m[34mMatch #[0m[33m7[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000702[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration.Environment[0m
  Severity: [36mImportant[0m, Confidence: [36mHigh[0m
  Filename: [33m/promptflow/tracing/_integrations/_openai_injector.py[0m
   Pattern: [32m(env|environment).{1,50}(get|post|curl|nc|invoke-restmethod)[0m
[30;1m200 | [0m[35m        # import time. So we need to update the openai api configs from environment variables here.[0m
[30;1m201 | [0m[35m        # Please refer to this issue: https://github.com/openai/openai-python/issues/557.[0m
[30;1m202 | [0m[35m        # The issue has been fixed in openai>=1.0.0.[0m
[30;1m203 | [0m[35m        openai.api_key = os.environ.get("OPENAI_API_KEY", openai.api_key)[0m
[30;1m204 | [0m[35m        openai.api_key_path = os.environ.get("OPENAI_API_KEY_PATH", openai.api_key_path)[0m
[30;1m205 | [0m[35m        openai.organization = os.environ.get("OPENAI_ORGANIZATION", openai.organization)[0m
[30;1m206 | [0m[35m        openai.api_base = os.environ.get("OPENAI_API_BASE", openai.api_base)[0m

[31m--[ [0m[34mMatch #[0m[33m8[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_thread_local_singleton.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m16 | [0m[35m[0m
[30;1m17 | [0m[35m    @classmethod[0m
[30;1m18 | [0m[35m    def active_instance(cls: Type[T]) -> T:[0m
[30;1m19 | [0m[35m        return cls.context_var.get()[0m
[30;1m20 | [0m[35m[0m
[30;1m21 | [0m[35m    @classmethod[0m
[30;1m22 | [0m[35m    def active(cls) -> bool:[0m

[31m--[ [0m[34mMatch #[0m[33m9[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_tracer.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m82 | [0m[35m        return obj[0m
[30;1m83 | [0m[35m[0m
[30;1m84 | [0m[35m    def _get_current_trace(self):[0m
[30;1m85 | [0m[35m        trace_id = self._current_trace_id.get()[0m
[30;1m86 | [0m[35m        if not trace_id:[0m
[30;1m87 | [0m[35m            return None[0m
[30;1m88 | [0m[35m        return self._id_to_trace[trace_id][0m

[31m--[ [0m[34mMatch #[0m[33m10[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_tracer.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m211 | [0m[35m    if tracer is not None:[0m
[30;1m212 | [0m[35m        if used_for_span_name:[0m
[30;1m213 | [0m[35m            # Since only the direct children of flow span should have the node name as span name, we[0m
[30;1m214 | [0m[35m            # the node span is created, if created, the current span is not a node span, its name sh[0m
[30;1m215 | [0m[35m            # function name.[0m
[30;1m216 | [0m[35m            if not tracer._is_node_span_created:[0m
[30;1m217 | [0m[35m                tracer._is_node_span_created = True[0m

[31m--[ [0m[34mMatch #[0m[33m11[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_tracer.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m211 | [0m[35m    if tracer is not None:[0m
[30;1m212 | [0m[35m        if used_for_span_name:[0m
[30;1m213 | [0m[35m            # Since only the direct children of flow span should have the node name as span name, we[0m
[30;1m214 | [0m[35m            # the node span is created, if created, the current span is not a node span, its name sh[0m
[30;1m215 | [0m[35m            # function name.[0m
[30;1m216 | [0m[35m            if not tracer._is_node_span_created:[0m
[30;1m217 | [0m[35m                tracer._is_node_span_created = True[0m

[31m--[ [0m[34mMatch #[0m[33m12[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_tracer.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m210 | [0m[35m    tracer = Tracer.active_instance()[0m
[30;1m211 | [0m[35m    if tracer is not None:[0m
[30;1m212 | [0m[35m        if used_for_span_name:[0m
[30;1m213 | [0m[35m            # Since only the direct children of flow span should have the node name as span name, we[0m
[30;1m214 | [0m[35m            # the node span is created, if created, the current span is not a node span, its name sh[0m
[30;1m215 | [0m[35m            # function name.[0m
[30;1m216 | [0m[35m            if not tracer._is_node_span_created:[0m

[31m--[ [0m[34mMatch #[0m[33m13[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_utils.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m9 | [0m[35m[0m
[30;1m10 | [0m[35m[0m
[30;1m11 | [0m[35mdef is_tracing_disabled():[0m
[30;1m12 | [0m[35m    return os.environ.get("PF_DISABLE_TRACING", "true").lower() == "true"[0m
[30;1m13 | [0m[35m[0m
[30;1m14 | [0m[35m[0m
[30;1m15 | [0m[35mdef serialize(value: object, remove_null: bool = False, serialization_funcs: Dict[type, Callable] = [0m

[31m--[ [0m[34mMatch #[0m[33m14[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_utils.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m71 | [0m[35m        return [][0m
[30;1m72 | [0m[35m[0m
[30;1m73 | [0m[35m    input_names = [][0m
[30;1m74 | [0m[35m    env = Environment()[0m
[30;1m75 | [0m[35m    template = env.parse(template_str)[0m
[30;1m76 | [0m[35m    input_names.extend(sorted(meta.find_undeclared_variables(template), key=lambda x: template_str.f[0m
[30;1m77 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m15[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_operation_context.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m164 | [0m[35m[0m
[30;1m165 | [0m[35m    def get_request_id(self):[0m
[30;1m166 | [0m[35m        if OperationContext.REQUEST_ID_KEY in self:[0m
[30;1m167 | [0m[35m            return self.get(OperationContext.REQUEST_ID_KEY)[0m
[30;1m168 | [0m[35m        return "unknown"[0m
[30;1m169 | [0m[35m[0m
[30;1m170 | [0m[35m    def set_default_tracing_keys(self, keys: set):[0m

[31m--[ [0m[34mMatch #[0m[33m16[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_operation_context.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m137 | [0m[35m[0m
[30;1m138 | [0m[35m        def parts():[0m
[30;1m139 | [0m[35m            if OperationContext.USER_AGENT_KEY in self:[0m
[30;1m140 | [0m[35m                yield self.get(OperationContext.USER_AGENT_KEY)[0m
[30;1m141 | [0m[35m            yield f"promptflow-tracing/{VERSION}"[0m
[30;1m142 | [0m[35m[0m
[30;1m143 | [0m[35m        # strip to avoid leading or trailing spaces, which may cause error when sending request[0m

[31m--[ [0m[34mMatch #[0m[33m17[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_operation_context.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m61 | [0m[35m            OperationContext: The OperationContext instance.[0m
[30;1m62 | [0m[35m        """[0m
[30;1m63 | [0m[35m        # get the OperationContext instance from the current context[0m
[30;1m64 | [0m[35m        instance = cls._current_context.get()[0m
[30;1m65 | [0m[35m        if instance is None:[0m
[30;1m66 | [0m[35m            # create a new instance and set it in the current context[0m
[30;1m67 | [0m[35m            instance = OperationContext()[0m

[31m--[ [0m[34mMatch #[0m[33m18[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_operation_context.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m45 | [0m[35m        self[OperationContext._OTEL_ATTRIBUTES] = attributes[0m
[30;1m46 | [0m[35m[0m
[30;1m47 | [0m[35m    def _get_otel_attributes(self):[0m
[30;1m48 | [0m[35m        attr_dict = self.get(OperationContext._OTEL_ATTRIBUTES, {})[0m
[30;1m49 | [0m[35m        # Filter None value out to avoid error.[0m
[30;1m50 | [0m[35m        # case: Experiment run may set 'reference.batch_run_id' to None which cause some exception.[0m
[30;1m51 | [0m[35m        return {k: v for k, v in attr_dict.items() if v is not None}[0m

[31m--[ [0m[34mMatch #[0m[33m19[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_operation_context.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m39 | [0m[35m    def _remove_otel_attributes(self, keys: list):[0m
[30;1m40 | [0m[35m        if isinstance(keys, str):[0m
[30;1m41 | [0m[35m            keys = [keys][0m
[30;1m42 | [0m[35m        attributes = self.get(OperationContext._OTEL_ATTRIBUTES, {})[0m
[30;1m43 | [0m[35m        for key in keys:[0m
[30;1m44 | [0m[35m            attributes.pop(key, None)[0m
[30;1m45 | [0m[35m        self[OperationContext._OTEL_ATTRIBUTES] = attributes[0m

[31m--[ [0m[34mMatch #[0m[33m20[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_operation_context.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m32 | [0m[35m        return ctx[0m
[30;1m33 | [0m[35m[0m
[30;1m34 | [0m[35m    def _add_otel_attributes(self, key, value):[0m
[30;1m35 | [0m[35m        attributes = self.get(OperationContext._OTEL_ATTRIBUTES, {})[0m
[30;1m36 | [0m[35m        attributes[key] = value[0m
[30;1m37 | [0m[35m        self[OperationContext._OTEL_ATTRIBUTES] = attributes[0m
[30;1m38 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m21[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_operation_context.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m14 | [0m[35m    This class is used to store the context information for the current operation. It is a dictionar[0m
[30;1m15 | [0m[35m    that can be used to store any primitive context information. The object is a context variable th[0m
[30;1m16 | [0m[35m    accessed from anywhere in the current context. The context information is used to provide additi[0m
[30;1m17 | [0m[35m    to the service for logging and telemetry purposes.[0m
[30;1m18 | [0m[35m    """[0m
[30;1m19 | [0m[35m[0m
[30;1m20 | [0m[35m    _CONTEXT_KEY = "operation_context"[0m

[31m--[ [0m[34mMatch #[0m[33m22[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_integrations/_openai_injector.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m205 | [0m[35m        openai.organization = os.environ.get("OPENAI_ORGANIZATION", openai.organization)[0m
[30;1m206 | [0m[35m        openai.api_base = os.environ.get("OPENAI_API_BASE", openai.api_base)[0m
[30;1m207 | [0m[35m        openai.api_type = os.environ.get("OPENAI_API_TYPE", openai.api_type)[0m
[30;1m208 | [0m[35m        openai.api_version = os.environ.get("OPENAI_API_VERSION", openai.api_version)[0m
[30;1m209 | [0m[35m[0m
[30;1m210 | [0m[35m[0m
[30;1m211 | [0m[35mdef recover_openai_api():[0m

[31m--[ [0m[34mMatch #[0m[33m23[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_integrations/_openai_injector.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m204 | [0m[35m        openai.api_key_path = os.environ.get("OPENAI_API_KEY_PATH", openai.api_key_path)[0m
[30;1m205 | [0m[35m        openai.organization = os.environ.get("OPENAI_ORGANIZATION", openai.organization)[0m
[30;1m206 | [0m[35m        openai.api_base = os.environ.get("OPENAI_API_BASE", openai.api_base)[0m
[30;1m207 | [0m[35m        openai.api_type = os.environ.get("OPENAI_API_TYPE", openai.api_type)[0m
[30;1m208 | [0m[35m        openai.api_version = os.environ.get("OPENAI_API_VERSION", openai.api_version)[0m
[30;1m209 | [0m[35m[0m
[30;1m210 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m24[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_integrations/_openai_injector.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m203 | [0m[35m        openai.api_key = os.environ.get("OPENAI_API_KEY", openai.api_key)[0m
[30;1m204 | [0m[35m        openai.api_key_path = os.environ.get("OPENAI_API_KEY_PATH", openai.api_key_path)[0m
[30;1m205 | [0m[35m        openai.organization = os.environ.get("OPENAI_ORGANIZATION", openai.organization)[0m
[30;1m206 | [0m[35m        openai.api_base = os.environ.get("OPENAI_API_BASE", openai.api_base)[0m
[30;1m207 | [0m[35m        openai.api_type = os.environ.get("OPENAI_API_TYPE", openai.api_type)[0m
[30;1m208 | [0m[35m        openai.api_version = os.environ.get("OPENAI_API_VERSION", openai.api_version)[0m
[30;1m209 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m25[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_integrations/_openai_injector.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m202 | [0m[35m        # The issue has been fixed in openai>=1.0.0.[0m
[30;1m203 | [0m[35m        openai.api_key = os.environ.get("OPENAI_API_KEY", openai.api_key)[0m
[30;1m204 | [0m[35m        openai.api_key_path = os.environ.get("OPENAI_API_KEY_PATH", openai.api_key_path)[0m
[30;1m205 | [0m[35m        openai.organization = os.environ.get("OPENAI_ORGANIZATION", openai.organization)[0m
[30;1m206 | [0m[35m        openai.api_base = os.environ.get("OPENAI_API_BASE", openai.api_base)[0m
[30;1m207 | [0m[35m        openai.api_type = os.environ.get("OPENAI_API_TYPE", openai.api_type)[0m
[30;1m208 | [0m[35m        openai.api_version = os.environ.get("OPENAI_API_VERSION", openai.api_version)[0m

[31m--[ [0m[34mMatch #[0m[33m26[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_integrations/_openai_injector.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m201 | [0m[35m        # Please refer to this issue: https://github.com/openai/openai-python/issues/557.[0m
[30;1m202 | [0m[35m        # The issue has been fixed in openai>=1.0.0.[0m
[30;1m203 | [0m[35m        openai.api_key = os.environ.get("OPENAI_API_KEY", openai.api_key)[0m
[30;1m204 | [0m[35m        openai.api_key_path = os.environ.get("OPENAI_API_KEY_PATH", openai.api_key_path)[0m
[30;1m205 | [0m[35m        openai.organization = os.environ.get("OPENAI_ORGANIZATION", openai.organization)[0m
[30;1m206 | [0m[35m        openai.api_base = os.environ.get("OPENAI_API_BASE", openai.api_base)[0m
[30;1m207 | [0m[35m        openai.api_type = os.environ.get("OPENAI_API_TYPE", openai.api_type)[0m

[31m--[ [0m[34mMatch #[0m[33m27[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_integrations/_openai_injector.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m200 | [0m[35m        # import time. So we need to update the openai api configs from environment variables here.[0m
[30;1m201 | [0m[35m        # Please refer to this issue: https://github.com/openai/openai-python/issues/557.[0m
[30;1m202 | [0m[35m        # The issue has been fixed in openai>=1.0.0.[0m
[30;1m203 | [0m[35m        openai.api_key = os.environ.get("OPENAI_API_KEY", openai.api_key)[0m
[30;1m204 | [0m[35m        openai.api_key_path = os.environ.get("OPENAI_API_KEY_PATH", openai.api_key_path)[0m
[30;1m205 | [0m[35m        openai.organization = os.environ.get("OPENAI_ORGANIZATION", openai.organization)[0m
[30;1m206 | [0m[35m        openai.api_base = os.environ.get("OPENAI_API_BASE", openai.api_base)[0m

[31m--[ [0m[34mMatch #[0m[33m28[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_integrations/_openai_injector.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m68 | [0m[35m    def inject_headers(kwargs):[0m
[30;1m69 | [0m[35m        # Inject headers from operation context, overwrite injected header with headers from kwargs.[0m
[30;1m70 | [0m[35m        injected_headers = get_aoai_telemetry_headers()[0m
[30;1m71 | [0m[35m        original_headers = kwargs.get("headers" if IS_LEGACY_OPENAI else "extra_headers")[0m
[30;1m72 | [0m[35m        if original_headers and isinstance(original_headers, dict):[0m
[30;1m73 | [0m[35m            for header in original_headers.keys():[0m
[30;1m74 | [0m[35m                if header in injected_headers:[0m

[31m--[ [0m[34mMatch #[0m[33m29[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000600[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Windows[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_integrations/_openai_injector.py[0m
   Pattern: [32m\s(advpack\.dll|appvlp|at|atbroker|bash|bginfo|bitsadmin|cdb|certutil|cl_invocation\.ps1|cl_mutexverifiers\.ps1|cmd|cmdkey|cmstp|comsvcs\.dll|control|csc|cscript|csi|devtoolslauncher|dfsvc|diskshadow|dnscmd|dnx|dotnet|dxcap|esentutl|eventvwr|excel|expand|extexport|extrac32|findstr|forfiles|ftp|gfxdownloadwrapper|gpscript|hh|ie4uinit|ieadvpack\.dll|ieaframe\.dll|ic|infdefaultinstall|installutil|jsc|makecab|manage-bde\.wsf|mavinject|mftrace|microsoft\.workflow\.compiler|mmc|msbuild|msconfig|msdeploy|msdt|mshta|mshtml\.dll|msc|msxsl|netsh|odbcconf|pcalua|pcwrun|pcwutl\.dll|pester\.bat|powerpnt|presentationhost|pubprn\.vbs|rcsi|reg|regasm|regedit|register-cimprovider|regsvcs|regsvr32|rpcping|rundll32|runonce|runscripthelper|sc|schtasks|scriptrunner|setupapi\.dll|shdocvw\.dll|shell32\.dll|slmgr\.vbs|sqldumper|sqlps|sqltoolsps|squirrel|syncappvpublishingserver|syncappvpublishingserver\.vbs|syssetup\.dll|te|tracker|tttracer|update|url\.dll|verclsid|vsjitdebugger|wab|winrm\.vbs|winword|wmic|wscript|wsl|wsreset|xwizard|zipfldr\.dll)\s[0m
[30;1m197 | [0m[35m[0m
[30;1m198 | [0m[35m    if IS_LEGACY_OPENAI:[0m
[30;1m199 | [0m[35m        # For the openai versions lower than 1.0.0, it reads api configs from environment variables [0m
[30;1m200 | [0m[35m        # import time. So we need to update the openai api configs from environment variables here.[0m
[30;1m201 | [0m[35m        # Please refer to this issue: https://github.com/openai/openai-python/issues/557.[0m
[30;1m202 | [0m[35m        # The issue has been fixed in openai>=1.0.0.[0m
[30;1m203 | [0m[35m        openai.api_key = os.environ.get("OPENAI_API_KEY", openai.api_key)[0m

[31m--[ [0m[34mMatch #[0m[33m30[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000600[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Windows[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_integrations/_openai_injector.py[0m
   Pattern: [32m\s(advpack\.dll|appvlp|at|atbroker|bash|bginfo|bitsadmin|cdb|certutil|cl_invocation\.ps1|cl_mutexverifiers\.ps1|cmd|cmdkey|cmstp|comsvcs\.dll|control|csc|cscript|csi|devtoolslauncher|dfsvc|diskshadow|dnscmd|dnx|dotnet|dxcap|esentutl|eventvwr|excel|expand|extexport|extrac32|findstr|forfiles|ftp|gfxdownloadwrapper|gpscript|hh|ie4uinit|ieadvpack\.dll|ieaframe\.dll|ic|infdefaultinstall|installutil|jsc|makecab|manage-bde\.wsf|mavinject|mftrace|microsoft\.workflow\.compiler|mmc|msbuild|msconfig|msdeploy|msdt|mshta|mshtml\.dll|msc|msxsl|netsh|odbcconf|pcalua|pcwrun|pcwutl\.dll|pester\.bat|powerpnt|presentationhost|pubprn\.vbs|rcsi|reg|regasm|regedit|register-cimprovider|regsvcs|regsvr32|rpcping|rundll32|runonce|runscripthelper|sc|schtasks|scriptrunner|setupapi\.dll|shdocvw\.dll|shell32\.dll|slmgr\.vbs|sqldumper|sqlps|sqltoolsps|squirrel|syncappvpublishingserver|syncappvpublishingserver\.vbs|syssetup\.dll|te|tracker|tttracer|update|url\.dll|verclsid|vsjitdebugger|wab|winrm\.vbs|winword|wmic|wscript|wsl|wsreset|xwizard|zipfldr\.dll)\s[0m
[30;1m196 | [0m[35m            setattr(api, method, injector(getattr(api, method), trace_type, name))[0m
[30;1m197 | [0m[35m[0m
[30;1m198 | [0m[35m    if IS_LEGACY_OPENAI:[0m
[30;1m199 | [0m[35m        # For the openai versions lower than 1.0.0, it reads api configs from environment variables [0m
[30;1m200 | [0m[35m        # import time. So we need to update the openai api configs from environment variables here.[0m
[30;1m201 | [0m[35m        # Please refer to this issue: https://github.com/openai/openai-python/issues/557.[0m
[30;1m202 | [0m[35m        # The issue has been fixed in openai>=1.0.0.[0m
[30;1m203 | [0m[35m        openai.api_key = os.environ.get("OPENAI_API_KEY", openai.api_key)[0m

[31m--[ [0m[34mMatch #[0m[33m31[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000600[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Windows[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_integrations/_openai_injector.py[0m
   Pattern: [32m\s(advpack\.dll|appvlp|at|atbroker|bash|bginfo|bitsadmin|cdb|certutil|cl_invocation\.ps1|cl_mutexverifiers\.ps1|cmd|cmdkey|cmstp|comsvcs\.dll|control|csc|cscript|csi|devtoolslauncher|dfsvc|diskshadow|dnscmd|dnx|dotnet|dxcap|esentutl|eventvwr|excel|expand|extexport|extrac32|findstr|forfiles|ftp|gfxdownloadwrapper|gpscript|hh|ie4uinit|ieadvpack\.dll|ieaframe\.dll|ic|infdefaultinstall|installutil|jsc|makecab|manage-bde\.wsf|mavinject|mftrace|microsoft\.workflow\.compiler|mmc|msbuild|msconfig|msdeploy|msdt|mshta|mshtml\.dll|msc|msxsl|netsh|odbcconf|pcalua|pcwrun|pcwutl\.dll|pester\.bat|powerpnt|presentationhost|pubprn\.vbs|rcsi|reg|regasm|regedit|register-cimprovider|regsvcs|regsvr32|rpcping|rundll32|runonce|runscripthelper|sc|schtasks|scriptrunner|setupapi\.dll|shdocvw\.dll|shell32\.dll|slmgr\.vbs|sqldumper|sqlps|sqltoolsps|squirrel|syncappvpublishingserver|syncappvpublishingserver\.vbs|syssetup\.dll|te|tracker|tttracer|update|url\.dll|verclsid|vsjitdebugger|wab|winrm\.vbs|winword|wmic|wscript|wsl|wsreset|xwizard|zipfldr\.dll)\s[0m
[30;1m58 | [0m[35m    # init headers[0m
[30;1m59 | [0m[35m    headers = {USER_AGENT_HEADER: operation_context.get_user_agent()}[0m
[30;1m60 | [0m[35m[0m
[30;1m61 | [0m[35m    # update header with promptflow info[0m
[30;1m62 | [0m[35m    headers[PROMPTFLOW_HEADER] = json.dumps(tracking_info)[0m
[30;1m63 | [0m[35m[0m
[30;1m64 | [0m[35m    return headers[0m

[31m--[ [0m[34mMatch #[0m[33m32[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_trace.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m197 | [0m[35m        if prompt_tpl_param_name is not None:[0m
[30;1m198 | [0m[35m            prompt_tpl = kwargs.get(prompt_tpl_param_name)[0m
[30;1m199 | [0m[35m            prompt_vars = {[0m
[30;1m200 | [0m[35m                name: kwargs.get(name) for name in get_input_names_for_prompt_template(prompt_tpl) i[0m
[30;1m201 | [0m[35m            }[0m
[30;1m202 | [0m[35m            enrich_prompt_template(template=prompt_tpl, variables=prompt_vars, span=span)[0m
[30;1m203 | [0m[35m    except Exception as e:[0m

[31m--[ [0m[34mMatch #[0m[33m33[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_trace.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m195 | [0m[35m        # we use the first one by default if there are multiple.[0m
[30;1m196 | [0m[35m        prompt_tpl_param_name = get_prompt_param_name_from_func(func)[0m
[30;1m197 | [0m[35m        if prompt_tpl_param_name is not None:[0m
[30;1m198 | [0m[35m            prompt_tpl = kwargs.get(prompt_tpl_param_name)[0m
[30;1m199 | [0m[35m            prompt_vars = {[0m
[30;1m200 | [0m[35m                name: kwargs.get(name) for name in get_input_names_for_prompt_template(prompt_tpl) i[0m
[30;1m201 | [0m[35m            }[0m

[31m--[ [0m[34mMatch #[0m[33m34[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_trace.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m158 | [0m[35m[0m
[30;1m159 | [0m[35m    def try_get_openai_tokens(self, span_id):[0m
[30;1m160 | [0m[35m        with self._lock:[0m
[30;1m161 | [0m[35m            return self._span_id_to_tokens.get(span_id, None)[0m
[30;1m162 | [0m[35m[0m
[30;1m163 | [0m[35m[0m
[30;1m164 | [0m[35mtoken_collector = TokenCollector()[0m

[31m--[ [0m[34mMatch #[0m[33m35[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_trace.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m143 | [0m[35m                    merged_tokens = {}[0m
[30;1m144 | [0m[35m                    for key in set(self._span_id_to_tokens[parent_span_id]) | set(tokens):[0m
[30;1m145 | [0m[35m                        parent_value = self._span_id_to_tokens[parent_span_id].get(key, 0)[0m
[30;1m146 | [0m[35m                        token_value = tokens.get(key, 0)[0m
[30;1m147 | [0m[35m                        if isinstance(parent_value, dict) and isinstance(token_value, dict):[0m
[30;1m148 | [0m[35m                            # Handle the case where both values are dictionaries[0m
[30;1m149 | [0m[35m                            merged_tokens[key] = {**parent_value, **token_value}[0m

[31m--[ [0m[34mMatch #[0m[33m36[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_trace.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m142 | [0m[35m                if parent_span_id in self._span_id_to_tokens:[0m
[30;1m143 | [0m[35m                    merged_tokens = {}[0m
[30;1m144 | [0m[35m                    for key in set(self._span_id_to_tokens[parent_span_id]) | set(tokens):[0m
[30;1m145 | [0m[35m                        parent_value = self._span_id_to_tokens[parent_span_id].get(key, 0)[0m
[30;1m146 | [0m[35m                        token_value = tokens.get(key, 0)[0m
[30;1m147 | [0m[35m                        if isinstance(parent_value, dict) and isinstance(token_value, dict):[0m
[30;1m148 | [0m[35m                            # Handle the case where both values are dictionaries[0m

[31m--[ [0m[34mMatch #[0m[33m37[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_trace.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m545 | [0m[35m            return func(*args, **kwargs)[0m
[30;1m546 | [0m[35m[0m
[30;1m547 | [0m[35m        trace = create_trace(func, args, kwargs)[0m
[30;1m548 | [0m[35m        # For node span we set the span name to node name, otherwise we use the function name.[0m
[30;1m549 | [0m[35m        span_name = get_node_name_from_context(used_for_span_name=True) or trace.name[0m
[30;1m550 | [0m[35m        # need to get everytime to ensure tracer is latest[0m
[30;1m551 | [0m[35m        otel_tracer = otel_trace.get_tracer("promptflow")[0m

[31m--[ [0m[34mMatch #[0m[33m38[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_trace.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m545 | [0m[35m            return func(*args, **kwargs)[0m
[30;1m546 | [0m[35m[0m
[30;1m547 | [0m[35m        trace = create_trace(func, args, kwargs)[0m
[30;1m548 | [0m[35m        # For node span we set the span name to node name, otherwise we use the function name.[0m
[30;1m549 | [0m[35m        span_name = get_node_name_from_context(used_for_span_name=True) or trace.name[0m
[30;1m550 | [0m[35m        # need to get everytime to ensure tracer is latest[0m
[30;1m551 | [0m[35m        otel_tracer = otel_trace.get_tracer("promptflow")[0m

[31m--[ [0m[34mMatch #[0m[33m39[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_trace.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m476 | [0m[35m            return await func(*args, **kwargs)[0m
[30;1m477 | [0m[35m[0m
[30;1m478 | [0m[35m        trace = create_trace(func, args, kwargs)[0m
[30;1m479 | [0m[35m        # For node span we set the span name to node name, otherwise we use the function name.[0m
[30;1m480 | [0m[35m        span_name = get_node_name_from_context(used_for_span_name=True) or trace.name[0m
[30;1m481 | [0m[35m        # need to get everytime to ensure tracer is latest[0m
[30;1m482 | [0m[35m        otel_tracer = otel_trace.get_tracer("promptflow")[0m

[31m--[ [0m[34mMatch #[0m[33m40[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_trace.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m476 | [0m[35m            return await func(*args, **kwargs)[0m
[30;1m477 | [0m[35m[0m
[30;1m478 | [0m[35m        trace = create_trace(func, args, kwargs)[0m
[30;1m479 | [0m[35m        # For node span we set the span name to node name, otherwise we use the function name.[0m
[30;1m480 | [0m[35m        span_name = get_node_name_from_context(used_for_span_name=True) or trace.name[0m
[30;1m481 | [0m[35m        # need to get everytime to ensure tracer is latest[0m
[30;1m482 | [0m[35m        otel_tracer = otel_trace.get_tracer("promptflow")[0m

[31m--[ [0m[34mMatch #[0m[33m41[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_span_enricher.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m42 | [0m[35m        self._type2enricher[trace_type] = enricher[0m
[30;1m43 | [0m[35m[0m
[30;1m44 | [0m[35m    def _enrich(self, span, inputs, output, trace_type):[0m
[30;1m45 | [0m[35m        enricher = self._type2enricher.get(trace_type, self._base_enricher)[0m
[30;1m46 | [0m[35m        enricher.enrich(span, inputs, output)[0m
[30;1m47 | [0m[35m[0m
[30;1m48 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m42[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_openai_utils.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m197 | [0m[35m[0m
[30;1m198 | [0m[35m    def merge_metrics_dict(self, metrics: dict, metrics_to_merge: dict):[0m
[30;1m199 | [0m[35m        for k, v in metrics_to_merge.items():[0m
[30;1m200 | [0m[35m            metrics[k] = metrics.get(k, 0) + v[0m
[30;1m201 | [0m[35m[0m
[30;1m202 | [0m[35m    def _log_warning(self, msg):[0m
[30;1m203 | [0m[35m        if self._logger:[0m

[31m--[ [0m[34mMatch #[0m[33m43[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_openai_utils.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m190 | [0m[35m        if isinstance(choices, list):[0m
[30;1m191 | [0m[35m            for ch in choices:[0m
[30;1m192 | [0m[35m                if isinstance(ch, dict):[0m
[30;1m193 | [0m[35m                    text = ch.get("text")[0m
[30;1m194 | [0m[35m                    if isinstance(text, str):[0m
[30;1m195 | [0m[35m                        completion_tokens += len(enc.encode(text))[0m
[30;1m196 | [0m[35m        return completion_tokens[0m

[31m--[ [0m[34mMatch #[0m[33m44[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_openai_utils.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m186 | [0m[35m[0m
[30;1m187 | [0m[35m    def _get_completion_tokens_for_completion_api(self, output, enc):[0m
[30;1m188 | [0m[35m        completion_tokens = 0[0m
[30;1m189 | [0m[35m        choices = output.get("choices")[0m
[30;1m190 | [0m[35m        if isinstance(choices, list):[0m
[30;1m191 | [0m[35m            for ch in choices:[0m
[30;1m192 | [0m[35m                if isinstance(ch, dict):[0m

[31m--[ [0m[34mMatch #[0m[33m45[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_openai_utils.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m158 | [0m[35m        try:[0m
[30;1m159 | [0m[35m            enc = self._get_encoding_for_completion_api(self._try_get_model(inputs, output))[0m
[30;1m160 | [0m[35m            metrics["prompt_tokens"] = 0[0m
[30;1m161 | [0m[35m            prompt = inputs.get("prompt")[0m
[30;1m162 | [0m[35m            if isinstance(prompt, str):[0m
[30;1m163 | [0m[35m                metrics["prompt_tokens"] = len(enc.encode(prompt))[0m
[30;1m164 | [0m[35m            elif isinstance(prompt, list):[0m

[31m--[ [0m[34mMatch #[0m[33m46[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_openai_utils.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m148 | [0m[35m                if isinstance(ch, dict):[0m
[30;1m149 | [0m[35m                    message = ch.get("message")[0m
[30;1m150 | [0m[35m                    if isinstance(message, dict):[0m
[30;1m151 | [0m[35m                        content = message.get("content")[0m
[30;1m152 | [0m[35m                        if isinstance(content, str):[0m
[30;1m153 | [0m[35m                            completion_tokens += len(enc.encode(content))[0m
[30;1m154 | [0m[35m        return completion_tokens[0m

[31m--[ [0m[34mMatch #[0m[33m47[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_openai_utils.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m146 | [0m[35m        if isinstance(choices, list):[0m
[30;1m147 | [0m[35m            for ch in choices:[0m
[30;1m148 | [0m[35m                if isinstance(ch, dict):[0m
[30;1m149 | [0m[35m                    message = ch.get("message")[0m
[30;1m150 | [0m[35m                    if isinstance(message, dict):[0m
[30;1m151 | [0m[35m                        content = message.get("content")[0m
[30;1m152 | [0m[35m                        if isinstance(content, str):[0m

[31m--[ [0m[34mMatch #[0m[33m48[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_openai_utils.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m142 | [0m[35m[0m
[30;1m143 | [0m[35m    def _get_completion_tokens_for_chat_api(self, output, enc):[0m
[30;1m144 | [0m[35m        completion_tokens = 0[0m
[30;1m145 | [0m[35m        choices = output.get("choices")[0m
[30;1m146 | [0m[35m        if isinstance(choices, list):[0m
[30;1m147 | [0m[35m            for ch in choices:[0m
[30;1m148 | [0m[35m                if isinstance(ch, dict):[0m

[31m--[ [0m[34mMatch #[0m[33m49[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_openai_utils.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m83 | [0m[35m                        model = chunk.model[0m
[30;1m84 | [0m[35m                        break[0m
[30;1m85 | [0m[35m            if not model:[0m
[30;1m86 | [0m[35m                model = inputs.get("model")[0m
[30;1m87 | [0m[35m        if not model:[0m
[30;1m88 | [0m[35m            raise Exception([0m
[30;1m89 | [0m[35m                "Cannot get a valid model to calculate metrics."[0m

[31m--[ [0m[34mMatch #[0m[33m50[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_openai_utils.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m75 | [0m[35m                model = inputs.get("model")[0m
[30;1m76 | [0m[35m        else:[0m
[30;1m77 | [0m[35m            if isinstance(output, dict):[0m
[30;1m78 | [0m[35m                model = output.get("model")[0m
[30;1m79 | [0m[35m            else:[0m
[30;1m80 | [0m[35m                model = None[0m
[30;1m81 | [0m[35m                for chunk in output:[0m

[31m--[ [0m[34mMatch #[0m[33m51[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_openai_utils.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m72 | [0m[35m            if api_type == "azure":[0m
[30;1m73 | [0m[35m                model = inputs.get("engine")[0m
[30;1m74 | [0m[35m            else:[0m
[30;1m75 | [0m[35m                model = inputs.get("model")[0m
[30;1m76 | [0m[35m        else:[0m
[30;1m77 | [0m[35m            if isinstance(output, dict):[0m
[30;1m78 | [0m[35m                model = output.get("model")[0m

[31m--[ [0m[34mMatch #[0m[33m52[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_openai_utils.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m70 | [0m[35m            if not api_type:[0m
[30;1m71 | [0m[35m                raise Exception("Cannot calculate metrics for none or empty api_type.")[0m
[30;1m72 | [0m[35m            if api_type == "azure":[0m
[30;1m73 | [0m[35m                model = inputs.get("engine")[0m
[30;1m74 | [0m[35m            else:[0m
[30;1m75 | [0m[35m                model = inputs.get("model")[0m
[30;1m76 | [0m[35m        else:[0m

[31m--[ [0m[34mMatch #[0m[33m53[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_openai_utils.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m66 | [0m[35m[0m
[30;1m67 | [0m[35m    def _try_get_model(self, inputs, output):[0m
[30;1m68 | [0m[35m        if IS_LEGACY_OPENAI:[0m
[30;1m69 | [0m[35m            api_type = inputs.get("api_type")[0m
[30;1m70 | [0m[35m            if not api_type:[0m
[30;1m71 | [0m[35m                raise Exception("Cannot calculate metrics for none or empty api_type.")[0m
[30;1m72 | [0m[35m            if api_type == "azure":[0m

[31m--[ [0m[34mMatch #[0m[33m54[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_openai_utils.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m49 | [0m[35m                "Cannot find openai metrics in output, will calculate metrics from response data dir[0m
[30;1m50 | [0m[35m            )[0m
[30;1m51 | [0m[35m[0m
[30;1m52 | [0m[35m        name = api_call.get("name")[0m
[30;1m53 | [0m[35m        # Support both legacy api and OpenAI v1 api[0m
[30;1m54 | [0m[35m        # Legacy api:[0m
[30;1m55 | [0m[35m        #   https://github.com/openai/openai-python/blob/v0.28.1/openai/api_resources/chat_completio[0m

[31m--[ [0m[34mMatch #[0m[33m55[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_openai_utils.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m42 | [0m[35m        inputs = api_call.get("inputs")[0m
[30;1m43 | [0m[35m        output = api_call.get("output")[0m
[30;1m44 | [0m[35m        if isinstance(output, dict):[0m
[30;1m45 | [0m[35m            usage = output.get("usage")[0m
[30;1m46 | [0m[35m            if isinstance(usage, dict):[0m
[30;1m47 | [0m[35m                return usage[0m
[30;1m48 | [0m[35m            self._log_warning([0m

[31m--[ [0m[34mMatch #[0m[33m56[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_openai_utils.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m40 | [0m[35m[0m
[30;1m41 | [0m[35m    def _get_openai_metrics_for_signal_api(self, api_call: dict):[0m
[30;1m42 | [0m[35m        inputs = api_call.get("inputs")[0m
[30;1m43 | [0m[35m        output = api_call.get("output")[0m
[30;1m44 | [0m[35m        if isinstance(output, dict):[0m
[30;1m45 | [0m[35m            usage = output.get("usage")[0m
[30;1m46 | [0m[35m            if isinstance(usage, dict):[0m

[31m--[ [0m[34mMatch #[0m[33m57[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_openai_utils.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m39 | [0m[35m        return True[0m
[30;1m40 | [0m[35m[0m
[30;1m41 | [0m[35m    def _get_openai_metrics_for_signal_api(self, api_call: dict):[0m
[30;1m42 | [0m[35m        inputs = api_call.get("inputs")[0m
[30;1m43 | [0m[35m        output = api_call.get("output")[0m
[30;1m44 | [0m[35m        if isinstance(output, dict):[0m
[30;1m45 | [0m[35m            usage = output.get("usage")[0m

[31m--[ [0m[34mMatch #[0m[33m58[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_openai_utils.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m33 | [0m[35m        output = api_call.get("output")[0m
[30;1m34 | [0m[35m        if not isinstance(output, dict) and not isinstance(output, list):[0m
[30;1m35 | [0m[35m            return False[0m
[30;1m36 | [0m[35m        inputs = api_call.get("inputs")[0m
[30;1m37 | [0m[35m        if not isinstance(inputs, dict):[0m
[30;1m38 | [0m[35m            return False[0m
[30;1m39 | [0m[35m        return True[0m

[31m--[ [0m[34mMatch #[0m[33m59[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_openai_utils.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m30 | [0m[35m    def _need_collect_metrics(self, api_call: dict):[0m
[30;1m31 | [0m[35m        if api_call.get("type") != "LLM":[0m
[30;1m32 | [0m[35m            return False[0m
[30;1m33 | [0m[35m        output = api_call.get("output")[0m
[30;1m34 | [0m[35m        if not isinstance(output, dict) and not isinstance(output, list):[0m
[30;1m35 | [0m[35m            return False[0m
[30;1m36 | [0m[35m        inputs = api_call.get("inputs")[0m

[31m--[ [0m[34mMatch #[0m[33m60[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_openai_utils.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m28 | [0m[35m        return total_metrics[0m
[30;1m29 | [0m[35m[0m
[30;1m30 | [0m[35m    def _need_collect_metrics(self, api_call: dict):[0m
[30;1m31 | [0m[35m        if api_call.get("type") != "LLM":[0m
[30;1m32 | [0m[35m            return False[0m
[30;1m33 | [0m[35m        output = api_call.get("output")[0m
[30;1m34 | [0m[35m        if not isinstance(output, dict) and not isinstance(output, list):[0m

[31m--[ [0m[34mMatch #[0m[33m61[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_openai_utils.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m19 | [0m[35m            except Exception as ex:[0m
[30;1m20 | [0m[35m                self._log_warning(f"Failed to calculate metrics due to exception: {ex}.")[0m
[30;1m21 | [0m[35m[0m
[30;1m22 | [0m[35m        children = api_call.get("children")[0m
[30;1m23 | [0m[35m        if children is not None:[0m
[30;1m24 | [0m[35m            for child in children:[0m
[30;1m25 | [0m[35m                child_metrics = self.get_openai_metrics_from_api_call(child)[0m

[31m--[ [0m[34mMatch #[0m[33m62[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_openai_utils.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m46 | [0m[35m            if isinstance(usage, dict):[0m
[30;1m47 | [0m[35m                return usage[0m
[30;1m48 | [0m[35m            self._log_warning([0m
[30;1m49 | [0m[35m                "Cannot find openai metrics in output, will calculate metrics from response data dir[0m
[30;1m50 | [0m[35m            )[0m
[30;1m51 | [0m[35m[0m
[30;1m52 | [0m[35m        name = api_call.get("name")[0m

[31m--[ [0m[34mMatch #[0m[33m63[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/contracts/trace.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m50 | [0m[35m    end_time: Optional[float] = None  # The timestamp of the end time[0m
[30;1m51 | [0m[35m    error: Optional[str] = None[0m
[30;1m52 | [0m[35m    children: Optional[List["Trace"]] = None[0m
[30;1m53 | [0m[35m    node_name: Optional[str] = None  # The node name of the trace, used for flow level trace[0m
[30;1m54 | [0m[35m    parent_id: str = ""  # The parent trace id of the trace[0m
[30;1m55 | [0m[35m    id: str = ""  # The trace id[0m
[30;1m56 | [0m[35m    function: str = ""  # The function name of the trace[0m

[31m--[ [0m[34mMatch #[0m[33m64[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/contracts/trace.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m47 | [0m[35m    inputs: Dict[str, Any][0m
[30;1m48 | [0m[35m    output: Optional[Any] = None[0m
[30;1m49 | [0m[35m    start_time: Optional[float] = None  # The timestamp of the start time[0m
[30;1m50 | [0m[35m    end_time: Optional[float] = None  # The timestamp of the end time[0m
[30;1m51 | [0m[35m    error: Optional[str] = None[0m
[30;1m52 | [0m[35m    children: Optional[List["Trace"]] = None[0m
[30;1m53 | [0m[35m    node_name: Optional[str] = None  # The node name of the trace, used for flow level trace[0m
[30;1m54 | [0m[35m    parent_id: str = ""  # The parent trace id of the trace[0m

[31m--[ [0m[34mMatch #[0m[33m65[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/contracts/trace.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m46 | [0m[35m    type: TraceType[0m
[30;1m47 | [0m[35m    inputs: Dict[str, Any][0m
[30;1m48 | [0m[35m    output: Optional[Any] = None[0m
[30;1m49 | [0m[35m    start_time: Optional[float] = None  # The timestamp of the start time[0m
[30;1m50 | [0m[35m    end_time: Optional[float] = None  # The timestamp of the end time[0m
[30;1m51 | [0m[35m    error: Optional[str] = None[0m
[30;1m52 | [0m[35m    children: Optional[List["Trace"]] = None[0m
[30;1m53 | [0m[35m    node_name: Optional[str] = None  # The node name of the trace, used for flow level trace[0m

[31m--[ [0m[34mMatch #[0m[33m66[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000610[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Linux[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/contracts/trace.py[0m
   Pattern: [32m\s(apt|apt\-get|aria2c|arp|ash|awk|base64|bash|bpftrace|busybox|cat|chmod|chown|cp|cpan|cpulimit|crontab|csh|curl|cut|dash|dd|diff|dmesg|dmsetup|dnf|docker|dpkg|easy_install|ed|emacs|env|expand|expect|facter|find|finger|flock|fmt|ftp|gawk|gdb|gimp|git|grep|head|iftop|ionice|ip|irb|jjs|journalctl|jrunscript|ksh|ld\.so|ldconfig|logsave|ltrace|lua|mail|mawk|mount|mtr|mv|mysql|nano|nawk|nc|nice|nl|nmap|node|od|openssl|perl|pg|php|pic|pico|pip|puppet|readelf|red|rlogin|rlwrap|rpm|rpmquery|rsync|ruby|run\-mailcap|run\-parts|rvim|scp|screen|script|sed|service|setarch|sftp|shuf|smbclient|socat|sort|sqlite3|ssh|start\-stop\-daemon|stdbuf|strace|systemctl|tail|tar|taskset|tclsh|tcpdump|tee|telnet|tftp|time|timeout|tmux|top|ul|unexpand|uniq|unshare|vi|vim|watch|wget|whois|wish|xargs|xxd|yum|zsh|zypper)\s[0m
[30;1m38 | [0m[35m    :type error: Optional[str][0m
[30;1m39 | [0m[35m    :param children: The list of child traces, or None if no children.[0m
[30;1m40 | [0m[35m    :type children: Optional[List[Trace]][0m
[30;1m41 | [0m[35m    :param node_name: The node name of the trace, used for flow level trace, or None if not applicab[0m
[30;1m42 | [0m[35m    :type node_name: Optional[str][0m
[30;1m43 | [0m[35m    """[0m
[30;1m44 | [0m[35m[0m

[31m--[ [0m[34mMatch #[0m[33m67[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_start_trace.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m101 | [0m[35m            print(warning_msg)[0m
[30;1m102 | [0m[35m            logging.debug("will pass `collection`, `attributes`, and `run`...")[0m
[30;1m103 | [0m[35m            _attributes = kwargs.get("attributes", None)[0m
[30;1m104 | [0m[35m            _run = kwargs.get("run", None)[0m
[30;1m105 | [0m[35m            logging.debug("collection: %s", collection)[0m
[30;1m106 | [0m[35m            logging.debug("attributes: %s", _attributes)[0m
[30;1m107 | [0m[35m            logging.debug("run: %s", _run)[0m

[31m--[ [0m[34mMatch #[0m[33m68[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_start_trace.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m100 | [0m[35m            logging.warning(warning_msg)[0m
[30;1m101 | [0m[35m            print(warning_msg)[0m
[30;1m102 | [0m[35m            logging.debug("will pass `collection`, `attributes`, and `run`...")[0m
[30;1m103 | [0m[35m            _attributes = kwargs.get("attributes", None)[0m
[30;1m104 | [0m[35m            _run = kwargs.get("run", None)[0m
[30;1m105 | [0m[35m            logging.debug("collection: %s", collection)[0m
[30;1m106 | [0m[35m            logging.debug("attributes: %s", _attributes)[0m

[31m--[ [0m[34mMatch #[0m[33m69[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000700[0m
       Tag: [34mSecurity.Backdoor.DataExfiltration[0m
  Severity: [36mImportant[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_start_trace.py[0m
   Pattern: [32m\.(request|post|get)\([0m
[30;1m62 | [0m[35m        logging.debug("collection is not user specified")[0m
[30;1m63 | [0m[35m        if is_collection_writeable():[0m
[30;1m64 | [0m[35m            # internal parameter for devkit call[0m
[30;1m65 | [0m[35m            _collection = kwargs.get("_collection", None)[0m
[30;1m66 | [0m[35m            if _collection is not None:[0m
[30;1m67 | [0m[35m                logging.debug("received internal parameter _collection: %s, will use this", _collect[0m
[30;1m68 | [0m[35m                collection = _collection[0m

[31m--[ [0m[34mMatch #[0m[33m70[0m[34m of [0m[33m70[0m[31m ]--[0m
   Rule Id: [34mBD000600[0m
       Tag: [34mSecurity.Backdoor.LOLBAS.Windows[0m
  Severity: [36mModerate[0m, Confidence: [36mLow[0m
  Filename: [33m/promptflow/tracing/_start_trace.py[0m
   Pattern: [32m\s(advpack\.dll|appvlp|at|atbroker|bash|bginfo|bitsadmin|cdb|certutil|cl_invocation\.ps1|cl_mutexverifiers\.ps1|cmd|cmdkey|cmstp|comsvcs\.dll|control|csc|cscript|csi|devtoolslauncher|dfsvc|diskshadow|dnscmd|dnx|dotnet|dxcap|esentutl|eventvwr|excel|expand|extexport|extrac32|findstr|forfiles|ftp|gfxdownloadwrapper|gpscript|hh|ie4uinit|ieadvpack\.dll|ieaframe\.dll|ic|infdefaultinstall|installutil|jsc|makecab|manage-bde\.wsf|mavinject|mftrace|microsoft\.workflow\.compiler|mmc|msbuild|msconfig|msdeploy|msdt|mshta|mshtml\.dll|msc|msxsl|netsh|odbcconf|pcalua|pcwrun|pcwutl\.dll|pester\.bat|powerpnt|presentationhost|pubprn\.vbs|rcsi|reg|regasm|regedit|register-cimprovider|regsvcs|regsvr32|rpcping|rundll32|runonce|runscripthelper|sc|schtasks|scriptrunner|setupapi\.dll|shdocvw\.dll|shell32\.dll|slmgr\.vbs|sqldumper|sqlps|sqltoolsps|squirrel|syncappvpublishingserver|syncappvpublishingserver\.vbs|syssetup\.dll|te|tracker|tttracer|update|url\.dll|verclsid|vsjitdebugger|wab|winrm\.vbs|winword|wmic|wscript|wsl|wsreset|xwizard|zipfldr\.dll)\s[0m
[30;1m39 | [0m[35m    """[0m
[30;1m40 | [0m[35m[0m
[30;1m41 | [0m[35m    # When PF_TRACING_SKIP_LOCAL_SETUP_ENVIRON is set to true, the start_trace should be skipped.[0m
[30;1m42 | [0m[35m    # An example is that user call start_trace at cloud mode. Nothing should happen.[0m
[30;1m43 | [0m[35m    if _skip_tracing_local_setup():[0m
[30;1m44 | [0m[35m        logging.info("skip tracing local setup as the environment variable is set.")[0m
[30;1m45 | [0m[35m        return[0m

70 matches found.
