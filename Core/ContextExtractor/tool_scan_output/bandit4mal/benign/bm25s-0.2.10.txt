Run started:2025-04-12 11:18:37.989614

Test results:
>> Issue: [B840:executor] concurrent.futures.Executor
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/bm25s-0.2.10/bm25s-0.2.10/bm25s/__init__.py:819
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b840_executor.html
818	            # Use concurrent.futures.ProcessPoolExecutor to parallelize the computation
819	            with ThreadPoolExecutor(max_workers=n_threads) as executor:
820	                process_map = executor.map(

--------------------------------------------------
>> Issue: [B815:write] os.write
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/bm25s-0.2.10/bm25s-0.2.10/bm25s/__init__.py:924
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b815_write.html
923	        with open(vocab_path, "wt", encoding="utf-8") as f:
924	            f.write(json_functions.dumps(self.vocab_dict, ensure_ascii=False))
925	

--------------------------------------------------
>> Issue: [B815:write] os.write
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/bm25s-0.2.10/bm25s-0.2.10/bm25s/__init__.py:969
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b815_write.html
968	                    else:
969	                        f.write(doc_str + "\n")
970	

--------------------------------------------------
>> Issue: [B814:read] os.read
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/bm25s-0.2.10/bm25s-0.2.10/bm25s/__init__.py:1102
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b814_read.html
1101	        with open(params_path, "r") as f:
1102	            params: dict = json_functions.loads(f.read())
1103	

--------------------------------------------------
>> Issue: [B814:read] os.read
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/bm25s-0.2.10/bm25s-0.2.10/bm25s/__init__.py:1108
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b814_read.html
1107	            with open(vocab_path, "r", encoding="utf-8") as f:
1108	                vocab_dict: dict = json_functions.loads(f.read())
1109	        else:

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/bm25s-0.2.10/bm25s-0.2.10/bm25s/hf.py:17
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
16	
17	README_TEMPLATE = """---
18	language: en
19	library_name: bm25s
20	tags:
21	- bm25
22	- bm25s
23	- retrieval
24	- search
25	- lexical
26	---
27	
28	# BM25S Index
29	
30	This is a BM25S index created with the [`bm25s` library](https://github.com/xhluca/bm25s) (version `{version}`), an ultra-fast implementation of BM25. It can be used for lexical retrieval tasks.
31	
32	BM25S Related Links:
33	
34	* ðŸ [Homepage](https://bm25s.github.io)
35	* ðŸ’»[GitHub Repository](https://github.com/xhluca/bm25s)
36	* ðŸ¤—[Blog Post](https://huggingface.co/blog/xhluca/bm25s)
37	* ðŸ“[Technical Report](https://arxiv.org/abs/2407.03618)
38	
39	
40	## Installation
41	
42	You can install the `bm25s` library with `pip`:
43	
44	```bash
45	pip install "bm25s=={version}"
46	
47	# Include extra dependencies like stemmer
48	pip install "bm25s[full]=={version}"
49	
50	# For huggingface hub usage
51	pip install huggingface_hub
52	```
53	
54	## Loading a `bm25s` index
55	
56	You can use this index for information retrieval tasks. Here is an example:
57	
58	```python
59	import bm25s
60	from bm25s.hf import BM25HF
61	
62	# Load the index
63	retriever = BM25HF.load_from_hub("{username}/{repo_name}")
64	
65	# You can retrieve now
66	query = "a cat is a feline"
67	results = retriever.retrieve(bm25s.tokenize(query), k=3)
68	```
69	
70	## Saving a `bm25s` index
71	
72	You can save a `bm25s` index to the Hugging Face Hub. Here is an example:
73	
74	```python
75	import bm25s
76	from bm25s.hf import BM25HF
77	
78	corpus = [
79	    "a cat is a feline and likes to purr",
80	    "a dog is the human's best friend and loves to play",
81	    "a bird is a beautiful animal that can fly",
82	    "a fish is a creature that lives in water and swims",
83	]
84	
85	retriever = BM25HF(corpus=corpus)
86	retriever.index(bm25s.tokenize(corpus))
87	
88	token = None  # You can get a token from the Hugging Face website
89	retriever.save_to_hub("{username}/{repo_name}", token=token)
90	```
91	
92	## Advanced usage
93	
94	You can leverage more advanced features of the BM25S library during `load_from_hub`:
95	
96	```python
97	# Load corpus and index in memory-map (mmap=True) to reduce memory
98	retriever = BM25HF.load_from_hub("{username}/{repo_name}", load_corpus=True, mmap=True)
99	
100	# Load a different branch/revision
101	retriever = BM25HF.load_from_hub("{username}/{repo_name}", revision="main")
102	
103	# Change directory where the local files should be downloaded
104	retriever = BM25HF.load_from_hub("{username}/{repo_name}", local_dir="/path/to/dir")
105	
106	# Load private repositories with a token:
107	retriever = BM25HF.load_from_hub("{username}/{repo_name}", token=token)
108	```
109	
110	## Tokenizer
111	
112	If you have saved a `Tokenizer` object with the index using the following approach:
113	
114	```python
115	from bm25s.hf import TokenizerHF
116	
117	token = "your_hugging_face_token"
118	tokenizer = TokenizerHF(corpus=corpus, stopwords="english")
119	tokenizer.save_to_hub("{username}/{repo_name}", token=token)
120	
121	# and stopwords too
122	tokenizer.save_stopwords_to_hub("{username}/{repo_name}", token=token)
123	```
124	
125	Then, you can load the tokenizer using the following code:
126	
127	```python
128	from bm25s.hf import TokenizerHF
129	
130	tokenizer = TokenizerHF(corpus=corpus, stopwords=[])
131	tokenizer.load_vocab_from_hub("{username}/{repo_name}", token=token)
132	tokenizer.load_stopwords_from_hub("{username}/{repo_name}", token=token)
133	```
134	
135	
136	## Stats
137	
138	This dataset was created using the following data:
139	
140	| Statistic | Value |
141	| --- | --- |
142	| Number of documents | {num_docs} |
143	| Number of tokens | {num_tokens} |
144	| Average tokens per document | {avg_tokens_per_doc} |
145	
146	## Parameters
147	
148	The index was created with the following parameters:
149	
150	| Parameter | Value |
151	| --- | --- |
152	| k1 | `{k1}` |
153	| b | `{b}` |
154	| delta | `{delta}` |
155	| method | `{method}` |
156	| idf method | `{idf_method}` |
157	
158	## Citation
159	
160	To cite `bm25s`, please use the following bibtex:
161	
162	```
163	@misc{{lu_2024_bm25s,
164	      title={{BM25S: Orders of magnitude faster lexical search via eager sparse scoring}}, 
165	      author={{Xing Han LÃ¹}},
166	      year={{2024}},
167	      eprint={{2407.03618}},
168	      archivePrefix={{arXiv}},
169	      primaryClass={{cs.IR}},
170	      url={{https://arxiv.org/abs/2407.03618}}, 
171	}}
172	```
173	
174	"""
175	
176	
177	def batch_tokenize(tokenizer, texts, add_special_tokens=False):

--------------------------------------------------
>> Issue: [B836:rmtree] shutil.rmtree
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/bm25s-0.2.10/bm25s-0.2.10/bm25s/hf.py:313
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b836_rmtree.html
312	        if not saving_locally:
313	            shutil.rmtree(save_dir)
314	

--------------------------------------------------
>> Issue: [B836:rmtree] shutil.rmtree
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/bm25s-0.2.10/bm25s-0.2.10/bm25s/hf.py:425
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b836_rmtree.html
424	        if not saving_locally:
425	            shutil.rmtree(save_dir)
426	

--------------------------------------------------
>> Issue: [B815:write] os.write
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/bm25s-0.2.10/bm25s-0.2.10/bm25s/hf.py:567
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b815_write.html
566	            with open(os.path.join(save_dir, "README.md"), "w") as f:
567	                f.write(results)
568	

--------------------------------------------------
>> Issue: [B832:write] tempfile_NamedTemporaryFile_write
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/bm25s-0.2.10/bm25s-0.2.10/bm25s/hf.py:567
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b832_write.html
566	            with open(os.path.join(save_dir, "README.md"), "w") as f:
567	                f.write(results)
568	

--------------------------------------------------
>> Issue: [B836:rmtree] shutil.rmtree
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/bm25s-0.2.10/bm25s-0.2.10/bm25s/hf.py:580
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b836_rmtree.html
579	        if not saving_locally:
580	            shutil.rmtree(save_dir)
581	

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/bm25s-0.2.10/bm25s-0.2.10/bm25s/utils/beir.py:15
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
14	
15	BASE_URL = "https://public.ukp.informatik.tu-darmstadt.de/thakur/BEIR/datasets/{}.zip"
16	GH_URL = "https://github.com/xhluca/bm25s/releases/download/data/{}.zip"

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/bm25s-0.2.10/bm25s-0.2.10/bm25s/utils/beir.py:16
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
15	BASE_URL = "https://public.ukp.informatik.tu-darmstadt.de/thakur/BEIR/datasets/{}.zip"
16	GH_URL = "https://github.com/xhluca/bm25s/releases/download/data/{}.zip"
17	
18	
19	def clean_results_keys(beir_results):

--------------------------------------------------
>> Issue: [B818:urlopen] urllib.request.urlopen
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/bm25s-0.2.10/bm25s-0.2.10/bm25s/utils/beir.py:151
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b818_urlopen.html
150	        with open(save_zip_path, "wb") as f:
151	            response = urllib.request.urlopen(url)
152	            total_size = int(response.headers.get("content-length", 0))

--------------------------------------------------
>> Issue: [B815:write] os.write
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/bm25s-0.2.10/bm25s-0.2.10/bm25s/utils/corpus.py:58
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b815_write.html
57	    with open(index_file, "w", encoding=encoding) as f:
58	        f.write(json_functions.dumps(indexes))
59	

--------------------------------------------------
>> Issue: [B814:read] os.read
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/bm25s-0.2.10/bm25s-0.2.10/bm25s/utils/corpus.py:65
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b814_read.html
64	    with open(index_file, "r", encoding=encoding) as f:
65	        return json_functions.loads(f.read())
66	

--------------------------------------------------
>> Issue: [B800:exec_used] exec
   Severity: Medium   Confidence: High
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/bm25s-0.2.10/bm25s-0.2.10/setup.py:6
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b800_exec_used.html
5	with open(f"{package_name}/version.py", encoding="utf8") as fp:
6	    exec(fp.read(), version)
7	

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/bm25s-0.2.10/bm25s-0.2.10/setup.py:27
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
26	    author_email=f"{package_name}@googlegroups.com",
27	    url=f"https://github.com/xhluca/{package_name}",
28	    description=f"An ultra-fast implementation of BM25 based on sparse matrices.",

--------------------------------------------------

Code scanned:
	Total lines of code: 5850
	Total lines skipped (#nosec): 0

Run metrics:
	Total issues (by severity):
		Undefined: 0.0
		Low: 0.0
		Medium: 5.0
		High: 13.0
	Total issues (by confidence):
		Undefined: 0.0
		Low: 0.0
		Medium: 17.0
		High: 1.0
Files skipped (0):
