Run started:2025-04-12 18:21:01.774194

Test results:
>> Issue: [B820:get] requests.get
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/azure_content_safety.py:84
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b820_get.html
83	    }
84	    return switcher.get(sensitivity, f"Non-supported sensitivity: {sensitivity}")
85	

--------------------------------------------------
>> Issue: [B821:post] requests.post
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/azure_content_safety.py:210
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b821_post.html
209	        payload = json.dumps(request_body)
210	        response = requests.post(url, headers=headers, data=payload)
211	        print("status code: " + response.status_code.__str__())

--------------------------------------------------
>> Issue: [B820:get] requests.get
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/azure_content_safety.py:221
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b820_get.html
220	        if category == Category.Hate:
221	            return detect_result.get("hateResult", None)
222	        elif category == Category.SelfHarm:

--------------------------------------------------
>> Issue: [B820:get] requests.get
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/azure_content_safety.py:223
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b820_get.html
222	        elif category == Category.SelfHarm:
223	            return detect_result.get("selfHarmResult", None)
224	        elif category == Category.Sexual:

--------------------------------------------------
>> Issue: [B820:get] requests.get
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/azure_content_safety.py:225
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b820_get.html
224	        elif category == Category.Sexual:
225	            return detect_result.get("sexualResult", None)
226	        elif category == Category.Violence:

--------------------------------------------------
>> Issue: [B820:get] requests.get
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/azure_content_safety.py:227
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b820_get.html
226	        elif category == Category.Violence:
227	            return detect_result.get("violenceResult", None)
228	        else:

--------------------------------------------------
>> Issue: [B820:get] requests.get
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/azure_content_safety.py:233
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b820_get.html
232	    def get_detect_result_by_category_1001(self, category: Category, detect_result: dict) -> Union[int, None]:
233	        category_res = detect_result.get("categoriesAnalysis", None)
234	        for res in category_res:

--------------------------------------------------
>> Issue: [B820:get] requests.get
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/azure_content_safety.py:235
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b820_get.html
234	        for res in category_res:
235	            if category.name == res.get("category", None):
236	                return res

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/common.py:113
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
112	        error_message = (
113	            f"The Chat API requires a specific format for prompt definition, and the prompt should include separate "
114	            f"lines as role delimiters: {valid_roles_str}. Current parsed role '{unescaped_invalid_role}'"
115	            f" does not meet the requirement. If you intend to use the Completion API, please select the appropriate"

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/common.py:172
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
171	    })
172	    common_tsg = f"Here is a valid function example: {function_example}. See more details at " \
173	                 "https://platform.openai.com/docs/api-reference/chat/create#chat/create-functions " \

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/common.py:204
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
203	    common_tsg = (
204	        f"Here is a valid tool example: {tool_example}. See more details at "
205	        "https://platform.openai.com/docs/api-reference/chat/create"

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/common.py:264
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
263	        raise ChatAPIToolRoleInvalidFormat(
264	            message="Failed to parse tool role prompt. Please make sure the prompt follows the "
265	            "format: 'tool_call_id:\\ntool_call_id\\ncontent:\\ntool_content'. "

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/common.py:318
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
317	                    raise ChatAPIFunctionRoleInvalidFormat(
318	                        message="Failed to parse function role prompt. Please make sure the prompt follows the "
319	                                "format: 'name:\\nfunction_name\\ncontent:\\nfunction_content'. "

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/common.py:818
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
817	        function_call_example = json.dumps({"name": "function_name"})
818	        common_tsg = f"Here is a valid example: {function_call_example}. See the guide at " \
819	                     "https://platform.openai.com/docs/api-reference/chat/create#chat/create-function_call " \

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/common.py:842
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
841	        common_tsg = (
842	            f"Here is a valid example: {tool_choice_example}. See the guide at "
843	            "https://platform.openai.com/docs/api-reference/chat/create."

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/exception.py:5
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
4	
5	openai_error_code_ref_message = "Error reference: https://platform.openai.com/docs/guides/error-codes/api-errors"
6	
7	
8	def to_openai_error_message(e: Exception) -> str:

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/exception.py:14
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
13	    tool_chat_prompt_tsg = (
14	        "Please make sure your chat prompt includes 'tool_calls' within the 'assistant' role. Also, the assistant "
15	        "message must be followed by messages with role 'tool', matching ids of assistant message 'tool_calls' "
16	        "property. You could refer to guideline at https://aka.ms/pfdoc/chat-prompt"
17	    )
18	    if error_message == "<empty message>":
19	        msg = "The api key is invalid or revoked. " \

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/exception.py:24
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
23	    elif "Unrecognized request argument supplied: functions" in error_message:
24	        msg = "Current model does not support the `functions` parameter. If you are using openai connection, then " \
25	              "please use gpt-3.5-turbo, gpt-4, gpt-4-32k, gpt-3.5-turbo-0613 or gpt-4-0613. You can refer to " \
26	              "https://platform.openai.com/docs/guides/gpt/function-calling. If you are using azure openai " \
27	              "connection, then please first go to your Azure OpenAI resource, deploy model 'gpt-35-turbo' or " \
28	              "'gpt-4' with version 0613, then go to prompt flow connection page, upgrade connection api version to " \
29	              "'2023-07-01-preview'. You can refer to " \
30	              "https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/function-calling."
31	        return f"OpenAI API hits {ex_type}: {msg}"

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/exception.py:35
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
34	             and any(param in error_message for param in params_chat_model_cannot_accept)):
35	        msg = "The completion operation does not work with the current model. " \
36	              "Completion API is a legacy api and is going to be deprecated soon. " \
37	              "Please change to use Chat API for current model. " \
38	              "You could refer to guideline at https://aka.ms/pfdoc/chat-prompt " \
39	              "or view the samples in our gallery that contain 'Chat' in the name."
40	        return f"OpenAI API hits {ex_type}: {msg}"

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/exception.py:42
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
41	    elif "Invalid content type. image_url is only supported by certain models" in error_message:
42	        msg = "Current model does not support the image input. If you are using openai connection, then please use " \
43	              "gpt-4-vision-preview. You can refer to https://platform.openai.com/docs/guides/vision." \
44	              "If you are using azure openai connection, then please first go to your Azure OpenAI resource, " \
45	              "create a GPT-4 Turbo with Vision deployment by selecting model name: \"gpt-4\" and "\
46	              "model version \"vision-preview\". You can refer to " \
47	              "https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/gpt-with-vision"
48	        return f"OpenAI API hits {ex_type}: {msg}"

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/exception.py:52
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
51	                and "unexpected) - \'response_format\'" in error_message):
52	        msg = "The response_format parameter needs to be a dictionary such as {\"type\": \"text\"}. " \
53	              "The value associated with the type key should be either 'text' or 'json_object' " \
54	              "If you are using openai connection, you can only set response_format to { \"type\": \"json_object\" } " \
55	              "when calling gpt-3.5-turbo-1106 or gpt-4-1106-preview to enable JSON mode. You can refer to " \
56	              "https://platform.openai.com/docs/guides/text-generation/json-mode. If you are using azure openai " \
57	              "connection, then please first go to your Azure OpenAI resource, deploy model 'gpt-35-turbo-1106' or " \
58	              "'gpt-4-1106-preview'. You can refer to " \
59	              "https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/json-mode?tabs=python."
60	        return f"OpenAI API hits {ex_type}: {msg}"

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/exception.py:62
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
61	    elif "Principal does not have access to API/Operation" in error_message:
62	        msg = "Principal does not have access to API/Operation. If you are using azure openai connection, " \
63	              "please make sure you have proper role assignment on your azure openai resource. You can refer to " \
64	              "https://learn.microsoft.com/en-us/azure/ai-services/openai/how-to/role-based-access-control"
65	        return f"OpenAI API hits {ex_type}: {msg}"

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/open_model_llm.py:124
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
123	        suffix = "" if suffix is None else f"/{suffix}"
124	        return f"https://management.azure.com/subscriptions/{subscription_id}" \
125	            + f"/resourceGroups/{resource_group}/providers/Microsoft.MachineLearningServices" \

--------------------------------------------------
>> Issue: [B820:get] requests.get
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/open_model_llm.py:133
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b820_get.html
132	        try:
133	            response = requests.get(url, headers=headers, timeout=50)
134	            return json.loads(response.content)['value']

--------------------------------------------------
>> Issue: [B820:get] requests.get
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/open_model_llm.py:141
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b820_get.html
140	        try:
141	            if serverless_endpoint.get('properties', {}).get('provisioningState') != "Succeeded":
142	                return None

--------------------------------------------------
>> Issue: [B820:get] requests.get
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/open_model_llm.py:141
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b820_get.html
140	        try:
141	            if serverless_endpoint.get('properties', {}).get('provisioningState') != "Succeeded":
142	                return None

--------------------------------------------------
>> Issue: [B821:post] requests.post
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/open_model_llm.py:191
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b821_post.html
190	        try:
191	            response = requests.post(url, headers=headers, timeout=50)
192	            return json.loads(response.content)

--------------------------------------------------
>> Issue: [B820:get] requests.get
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/open_model_llm.py:206
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b820_get.html
205	        try:
206	            response = requests.get(url, headers=headers, timeout=50)
207	            return json.loads(response.content)

--------------------------------------------------
>> Issue: [B820:get] requests.get
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/open_model_llm.py:310
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b820_get.html
309	
310	        connection = pf.connections.get(connection_name, with_secrets=True)
311	

--------------------------------------------------
>> Issue: [B820:get] requests.get
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/open_model_llm.py:328
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b820_get.html
327	
328	        connection = azure_pf_client._arm_connections.get(connection_name)
329	

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/open_model_llm.py:434
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
433	    def get_endpoint_url(self, endpoint_name, subscription_id, resource_group_name, workspace_name):
434	        return f"https://ml.azure.com/endpoints/realtime/{endpoint_name}" \
435	            + f"/detail?wsid=/subscriptions/{subscription_id}" \

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/open_model_llm.py:558
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
557	        credential = DefaultAzureCredential(exclude_interactive_browser_credential=False)
558	        token = credential.get_token("https://management.azure.com/.default").token
559	    except Exception as e:

--------------------------------------------------
>> Issue: [B821:post] requests.post
   Severity: High   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/open_model_llm.py:939
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b821_post.html
938	
939	        result = requests.post(self.endpoint_url, data=request_body, headers=headers)
940	        if result.status_code != 200:

--------------------------------------------------
>> Issue: [B824:url_found] url_found
   Severity: Medium   Confidence: Medium
   Location: /home/blue/PyPIAgent/Dataset/study/unzip_benign/promptflow_tools-1.6.0-py3-none-any/promptflow/tools/open_model_llm.py:1046
   More Info: https://bandit.readthedocs.io/en/latest/plugins/b824_url_found.html
1045	                credential = DefaultAzureCredential(exclude_interactive_browser_credential=False)
1046	                token = credential.get_token("https://management.azure.com/.default").token
1047	            except Exception as e:

--------------------------------------------------

Code scanned:
	Total lines of code: 3100
	Total lines skipped (#nosec): 0

Run metrics:
	Total issues (by severity):
		Undefined: 0.0
		Low: 0.0
		Medium: 18.0
		High: 16.0
	Total issues (by confidence):
		Undefined: 0.0
		Low: 0.0
		Medium: 34.0
		High: 0.0
Files skipped (0):
