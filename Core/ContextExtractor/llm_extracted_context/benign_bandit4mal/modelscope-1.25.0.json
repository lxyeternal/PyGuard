[
  {
    "metadata": {
      "package_name": "modelscope-1.25.0",
      "total_matches": 1,
      "processing_date": "2025-05-18 01:49:39"
    }
  },
  {
    "pyfile": "video_stabilization_pipeline.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/modelscope-1.25.0/modelscope-1.25.0/modelscope/pipelines/cv/video_stabilization_pipeline.py",
    "line_number": "114",
    "type_description": "B812:system",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "113\t        if is_cvt_h264:\n114\t            assert os.system(\n115\t                'ffmpeg -version'\n116\t            ) == 0, 'ffmpeg is not installed correctly, please refer to https://trac.ffmpeg.org/wiki/CompilationGuide.'",
    "context_snippet": "import os\nimport subprocess\nimport tempfile\nimport cv2\nimport numpy as np\nfrom modelscope.outputs import OutputKeys\n\ndef postprocess(self, inputs: dict, **kwargs) -> dict:\n    output_video_path = kwargs.get('output_video', None)\n    is_cvt_h264 = kwargs.get('is_cvt_h264', False)\n\n    if output_video_path is None:\n        output_video_path = tempfile.NamedTemporaryFile(suffix='.mp4').name\n    h, w = inputs['output'][0].shape[-3:-1]\n    fourcc = cv2.VideoWriter_fourcc(*'mp4v')\n    video_writer = cv2.VideoWriter(output_video_path, fourcc,\n                                   inputs['fps'], (w, h))\n    for idx, frame in enumerate(inputs['output']):\n        horizontal_border = int(inputs['base_crop_width'] * w / 1280)\n        vertical_border = int(horizontal_border * h / w)\n        new_frame = frame[vertical_border:-vertical_border,\n                          horizontal_border:-horizontal_border]\n        new_frame = cv2.resize(new_frame, (w, h))\n        video_writer.write(new_frame)\n    video_writer.release()\n\n    if is_cvt_h264:\n        assert os.system(\n            'ffmpeg -version'\n        ) == 0, 'ffmpeg is not installed correctly, please refer to https://trac.ffmpeg.org/wiki/CompilationGuide.'\n        output_video_path_for_web = output_video_path[:-4] + '_web.mp4'\n        convert_cmd = f'ffmpeg -i {output_video_path} -vcodec h264 -crf 5 {output_video_path_for_web}'\n        subprocess.call(convert_cmd, shell=True)\n        return {OutputKeys.OUTPUT_VIDEO: output_video_path_for_web}\n    else:\n        return {OutputKeys.OUTPUT_VIDEO: output_video_path}\n",
    "hash_value": "487a97e9535bc0afb44704ae41eed8ca"
  }
]