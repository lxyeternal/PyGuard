[
  {
    "metadata": {
      "package_name": "google_cloud_spanner-3.53.0",
      "total_matches": 1,
      "processing_date": "2025-05-18 01:49:39"
    }
  },
  {
    "pyfile": "test_spanner.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/google_cloud_spanner-3.53.0/google_cloud_spanner-3.53.0/tests/unit/gapic/spanner_v1/test_spanner.py",
    "line_number": "10844",
    "type_description": "B814:read",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "10843\t        req.return_value.headers = {\"header-1\": \"value-1\", \"header-2\": \"value-2\"}\n10844\t        response = client.streaming_read(request)\n10845",
    "context_snippet": "def test_streaming_read_rest_use_cached_wrapped_rpc():\n    # Clients should use _prep_wrapped_messages to create cached wrapped rpcs,\n    # instead of constructing them on each call\n    with mock.patch(\"google.api_core.gapic_v1.method.wrap_method\") as wrapper_fn:\n        client = SpannerClient(\n            credentials=ga_credentials.AnonymousCredentials(),\n            transport=\"rest\",\n        )\n\n        # Should wrap all calls on client creation\n        assert wrapper_fn.call_count > 0\n        wrapper_fn.reset_mock()\n\n        # Ensure method has been cached\n        assert client._transport.streaming_read in client._transport._wrapped_methods\n\n        # Replace cached wrapped function with mock\n        mock_rpc = mock.Mock()\n        mock_rpc.return_value.name = (\n            \"foo\"  # operation_request.operation in compute client(s) expect a string.\n        )\n        client._transport._wrapped_methods[client._transport.streaming_read] = mock_rpc\n\n        request = {}\n        client.streaming_read(request)\n\n        # Establish that the underlying gRPC stub method was called.\n        assert mock_rpc.call_count == 1\n\n        client.streaming_read(request)\n\n        # Establish that a new wrapper was not created for this call\n        assert wrapper_fn.call_count == 0\n        assert mock_rpc.call_count == 2",
    "hash_value": "b82f15b3af55e568fb0ef73e1361e95d"
  }
]