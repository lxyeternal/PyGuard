[
  {
    "metadata": {
      "package_name": "testrepository-0.0.21",
      "total_matches": 3,
      "processing_date": "2025-05-18 01:49:39"
    }
  },
  {
    "pyfile": "console.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/testrepository-0.0.21/testrepository-0.0.21/lib/python3.11/site-packages/pip/_vendor/rich/console.py",
    "line_number": "2060",
    "type_description": "B815:write",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "2059\t                        try:\n2060\t                            self.file.write(text)\n2061\t                        except UnicodeEncodeError as error:",
    "context_snippet": "def _check_buffer(self) -> None:\n    \"\"\"Check if the buffer may be rendered. Render it if it can (e.g. Console.quiet is False)\n    Rendering is supported on Windows, Unix and Jupyter environments. For\n    legacy Windows consoles, the win32 API is called directly.\n    This method will also record what it renders if recording is enabled via Console.record.\n    \"\"\"\n    if self.quiet:\n        del self._buffer[:]\n        return\n    with self._lock:\n        if self.record:\n            with self._record_buffer_lock:\n                self._record_buffer.extend(self._buffer[:])\n\n        if self._buffer_index == 0:\n            if self.is_jupyter:  # pragma: no cover\n                from .jupyter import display\n\n                display(self._buffer, self._render_buffer(self._buffer[:]))\n                del self._buffer[:]\n            else:\n                if WINDOWS:\n                    use_legacy_windows_render = False\n                    if self.legacy_windows:\n                        fileno = get_fileno(self.file)\n                        if fileno is not None:\n                            use_legacy_windows_render = (\n                                fileno in _STD_STREAMS_OUTPUT\n                            )\n\n                    if use_legacy_windows_render:\n                        from pip._vendor.rich._win32_console import LegacyWindowsTerm\n                        from pip._vendor.rich._windows_renderer import legacy_windows_render\n\n                        buffer = self._buffer[:]\n                        if self.no_color and self._color_system:\n                            buffer = list(Segment.remove_color(buffer))\n\n                        legacy_windows_render(buffer, LegacyWindowsTerm(self.file))\n                    else:\n                        # Either a non-std stream on legacy Windows, or modern Windows.\n                        text = self._render_buffer(self._buffer[:])\n                        # https://bugs.python.org/issue37871\n                        # https://github.com/python/cpython/issues/82052\n                        # We need to avoid writing more than 32Kb in a single write, due to the above bug\n                        write = self.file.write\n                        # Worse case scenario, every character is 4 bytes of utf-8\n                        MAX_WRITE = 32 * 1024 // 4\n                        try:\n                            if len(text) <= MAX_WRITE:\n                                write(text)\n                            else:\n                                batch: List[str] = []\n                                batch_append = batch.append\n                                size = 0\n                                for line in text.splitlines(True):\n                                    if size + len(line) > MAX_WRITE and batch:\n                                        write(\"\".join(batch))\n                                        batch.clear()\n                                        size = 0\n                                    batch_append(line)\n                                    size += len(line)\n                                if batch:\n                                    write(\"\".join(batch))\n                                    batch.clear()\n                        except UnicodeEncodeError as error:\n                            error.reason = f\"{error.reason}\\n*** You may need to add PYTHONIOENCODING=utf-8 to your environment ***\"\n                            raise\n                else:\n                    text = self._render_buffer(self._buffer[:])\n                    try:\n                        self.file.write(text)\n                    except UnicodeEncodeError as error:\n                        error.reason = f\"{error.reason}\\n*** You may need to add PYTHONIOENCODING=utf-8 to your environment ***\"\n                        raise\n\n                self.file.flush()\n                del self._buffer[:]",
    "hash_value": "b6d25c6ca761df06a50a46d2c1c55fd7"
  },
  {
    "pyfile": "build_ext.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/testrepository-0.0.21/testrepository-0.0.21/lib/python3.11/site-packages/setuptools/command/build_ext.py",
    "line_number": "343",
    "type_description": "B815:write",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "342\t            f = open(stub_file, 'w')\n343\t            f.write(\n344\t                '\\n'.join(\n345\t                    [\n346\t                        \"def __bootstrap__():\",\n347\t                        \"   global __bootstrap__, __file__, __loader__\",\n348\t                        \"   import sys, os, pkg_resources, importlib.util\"\n349\t                        + if_dl(\", dl\"),\n350\t                        \"   __file__ = pkg_resources.resource_filename\"\n351\t                        \"(__name__,%r)\" % os.path.basename(ext._file_name),\n352\t                        \"   del __bootstrap__\",\n353\t                        \"   if '__loader__' in globals():\",\n354\t                        \"       del __loader__\",\n355\t                        if_dl(\"   old_flags = sys.getdlopenflags()\"),\n356\t                        \"   old_dir = os.getcwd()\",\n357\t                        \"   try:\",\n358\t                        \"     os.chdir(os.path.dirname(__file__))\",\n359\t                        if_dl(\"     sys.setdlopenflags(dl.RTLD_NOW)\"),\n360\t                        \"     spec = importlib.util.spec_from_file_location(\",\n361\t                        \"                __name__, __file__)\",\n362\t                        \"     mod = importlib.util.module_from_spec(spec)\",\n363\t                        \"     spec.loader.exec_module(mod)\",\n364\t                        \"   finally:\",\n365\t                        if_dl(\"     sys.setdlopenflags(old_flags)\"),\n366\t                        \"     os.chdir(old_dir)\",\n367\t                        \"__bootstrap__()\",\n368\t                        \"\",  # terminal \\n\n369\t                    ]",
    "context_snippet": "def _write_stub_file(self, stub_file: str, ext: Extension, compile=False):\n    log.info(\"writing stub loader for %s to %s\", ext._full_name, stub_file)\n    if compile and os.path.exists(stub_file):\n        raise BaseError(stub_file + \" already exists! Please delete.\")\n    if not self.dry_run:\n        f = open(stub_file, 'w')\n        f.write(\n            '\\n'.join(\n                [\n                    \"def __bootstrap__():\",\n                    \"   global __bootstrap__, __file__, __loader__\",\n                    \"   import sys, os, pkg_resources, importlib.util\"\n                    + if_dl(\", dl\"),\n                    \"   __file__ = pkg_resources.resource_filename\"\n                    \"(__name__,%r)\" % os.path.basename(ext._file_name),\n                    \"   del __bootstrap__\",\n                    \"   if '__loader__' in globals():\",\n                    \"       del __loader__\",\n                    if_dl(\"   old_flags = sys.getdlopenflags()\"),\n                    \"   old_dir = os.getcwd()\",\n                    \"   try:\",\n                    \"     os.chdir(os.path.dirname(__file__))\",\n                    if_dl(\"     sys.setdlopenflags(dl.RTLD_NOW)\"),\n                    \"     spec = importlib.util.spec_from_file_location(\",\n                    \"                __name__, __file__)\",\n                    \"     mod = importlib.util.module_from_spec(spec)\",\n                    \"     spec.loader.exec_module(mod)\",\n                    \"   finally:\",\n                    if_dl(\"     sys.setdlopenflags(old_flags)\"),\n                    \"     os.chdir(old_dir)\",\n                    \"__bootstrap__()\",\n                    \"\",  # terminal \\n\n                ]\n            )\n        )\n        f.close()\n    if compile:\n        self._compile_and_remove_stub(stub_file)\n\ndef if_dl(s):\n    return s if have_rtld else ''\n",
    "hash_value": "8aa50c82c138ef1dd0e8ec3e36c660fe"
  },
  {
    "pyfile": "py312compat.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/testrepository-0.0.21/testrepository-0.0.21/lib/python3.11/site-packages/setuptools/py312compat.py",
    "line_number": "12",
    "type_description": "B836:rmtree",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "11\n12\t    return shutil.rmtree(path, ignore_errors, onerror=_handler)",
    "context_snippet": "import sys\nimport shutil\n\ndef shutil_rmtree(path, ignore_errors=False, onexc=None):\n    if sys.version_info >= (3, 12):\n        return shutil.rmtree(path, ignore_errors, onexc=onexc)\n\n    def _handler(fn, path, excinfo):\n        return onexc(fn, path, excinfo[1])\n\n    return shutil.rmtree(path, ignore_errors, onerror=_handler)",
    "hash_value": "063fe25471882817c74848baec7244af"
  }
]