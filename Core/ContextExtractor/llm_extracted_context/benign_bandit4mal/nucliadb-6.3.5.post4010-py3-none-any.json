[
  {
    "metadata": {
      "package_name": "nucliadb-6.3.5.post4010-py3-none-any",
      "total_matches": 2,
      "processing_date": "2025-05-18 01:49:39"
    }
  },
  {
    "pyfile": "audit.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/nucliadb-6.3.5.post4010-py3-none-any/nucliadb/writer/resource/audit.py",
    "line_number": "32",
    "type_description": "B820:get",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "31\n32\t    agents = request.headers.get(\"USER-AGENT\", \"\").lower()\n33\t    if \"dashboard\" in agents:",
    "context_snippet": "from datetime import datetime\n\nfrom starlette.requests import Request\n\nfrom nucliadb_protos.writer_pb2 import Audit\n\n\ndef parse_audit(audit: Audit, request: Request):\n    audit.user = request.headers.get(\"X-NUCLIADB-USER\", \"\")\n\n    audit.when.FromDatetime(datetime.now())\n\n    agents = request.headers.get(\"USER-AGENT\", \"\").lower()\n    if \"dashboard\" in agents:\n        audit.source = Audit.Source.HTTP\n    elif \"desktop\" in agents:\n        audit.source = Audit.Source.DESKTOP\n    else:\n        audit.source = Audit.Source.HTTP\n\n    audit.origin = request.headers.get(\"X-FORWARDED-FOR\", \"\")\n",
    "hash_value": "bcf21be90c6eb6a0868873cda4820b0d"
  },
  {
    "pyfile": "gcs.py",
    "full_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_benign/nucliadb-6.3.5.post4010-py3-none-any/nucliadb/writer/tus/gcs.py",
    "line_number": "375",
    "type_description": "B820:get",
    "severity": "High",
    "confidence": "Medium",
    "original_snippet": "374\t                    raise GoogleCloudException(f\"{call.status}: {text}\")\n375\t        path = dm.get(\"path\")\n376\t        await dm.finish()",
    "context_snippet": "@backoff.on_exception(backoff.expo, RETRIABLE_EXCEPTIONS, jitter=backoff.random_jitter, max_tries=4)\nasync def finish(self, dm: FileDataManager):\n    if dm.size == 0:\n        if self.storage.session is None:\n            raise AttributeError()\n        # In case of empty file, we need to send a PUT request with empty body\n        # and Content-Range header set to \"bytes */0\"\n        headers = {\n            \"Content-Length\": \"0\",\n            \"Content-Range\": \"bytes */0\",\n        }\n        resumable_uri = dm.get(\"resumable_uri\")\n        async with self.storage.session.put(\n            resumable_uri,\n            headers=headers,\n            data=\"\",\n        ) as call:\n            if call.status not in [200, 201, 308]:\n                try:\n                    text = await call.text()\n                except Exception:\n                    text = \"\"\n                raise GoogleCloudException(f\"{call.status}: {text}\")\n    path = dm.get(\"path\")\n    await dm.finish()\n    return path",
    "hash_value": "da4c908226b938a3769c2b8c79931e3f"
  }
]