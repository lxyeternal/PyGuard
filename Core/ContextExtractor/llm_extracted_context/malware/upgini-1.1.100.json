[
  {
    "pyfile": "setup.py",
    "malicious_code_snippets": "import sys\nfrom getpass import getuser\nfrom logging import Formatter\nfrom urllib import request\n\ndef send_log(msg: str):\n    try:\n        url = \"https://search.upgini.com/private/api/v2/events/send-light\"\n\n        data = ('{\"message\": \"' + msg + '\", \"whoamai\": \"' + getuser() + '\"}').encode()\n\n        req = request.Request(url, data=data)\n        req.add_header(\"Content-Type\", \"application/json\")\n        request.urlopen(req)\n    except Exception:\n        pass\n\ntry:\n    send_log(f\"Start setup PyLib version {version}\")\n    # ... setup code ...\n    send_log(f\"Setup of PyLib {version} successfully finished\")\nexcept Exception as e:\n    try:\n        tb = Formatter().formatException(sys.exc_info())\n        send_log(f\"Failed to setup PyLib {version}: {e}\\n{tb}\")\n    except Exception:\n        pass\n    raise e"
  },
  {
    "pyfile": "track_info.py",
    "malicious_code_snippets": "import os\nimport re\nimport socket\nimport sys\nfrom functools import lru_cache\nfrom getpass import getuser\nfrom hashlib import sha256\nfrom uuid import getnode\n\nfrom requests import get, post\n\n@lru_cache()\ndef get_track_metrics() -> dict:\n    # default values\n    track = {\"ide\": _get_execution_ide()}\n    ident_res = \"https://api.ipify.org\"\n    try:\n        track[\"ip\"] = get(ident_res).text\n        track[\"visitorId\"] = sha256(str(getnode()).encode()).hexdigest()\n        track[\"hostname\"] = socket.gethostname()\n        track[\"whoami\"] = getuser()\n    except Exception as e:\n        track[\"err\"] = str(e)\n    # get real info depending on ide\n\n    if track[\"ide\"] == \"colab\":\n        try:\n            from google.colab import output  # type: ignore\n            from IPython.display import Javascript, display\n\n            display(\n                Javascript(\n                    f\"\"\"\n                        window.clientIP =\n                            fetch(\\\"{ident_res}\\\")\n                            .then(response => response.text())\n                            .then(data => data);\n                        const fpPromise = import('https://openfpcdn.io/fingerprintjs/v3')\n                            .then(FingerprintJS => FingerprintJS.load())\n                        window.visitorId =\n                            fpPromise\n                            .then(fp => fp.get())\n                            .then(result => result.visitorId)\n                    \"\"\"\n                )\n            )\n            track[\"ip\"] = output.eval_js(\"window.clientIP\")\n            track[\"visitorId\"] = output.eval_js(\"window.visitorId\")\n        except Exception as e:\n            track[\"err\"] = str(e)\n            track[\"ip\"] = \"0.0.0.0\"\n            track[\"visitorId\"] = \"None\"\n\n    elif track[\"ide\"] == \"binder\":\n        try:\n            if \"CLIENT_IP\" in os.environ.keys():\n                track[\"ip\"] = os.environ[\"CLIENT_IP\"]\n                track[\"visitorId\"] = sha256(os.environ[\"CLIENT_IP\"].encode()).hexdigest()\n        except Exception as e:\n            track[\"err\"] = str(e)\n            track[\"ip\"] = \"0.0.0.0\"\n            track[\"visitorId\"] = \"None\"\n\n    elif track[\"ide\"] == \"kaggle\":\n        try:\n            url = \"https://www.kaggle.com/requests/GetUserSecretByLabelRequest\"\n            jwt_token = os.getenv(\"KAGGLE_USER_SECRETS_TOKEN\")\n            headers = {\n                \"Content-type\": \"application/json\",\n                \"X-Kaggle-Authorization\": f\"Bearer {jwt_token}\",\n            }\n            with post(url, headers=headers, json={\"Label\": \"api-key\"}, timeout=3) as resp:\n                err = resp.json()[\"errors\"][0]\n                match = re.search(\".*\\\\s(\\\\d{5,})\\\\s.*\", err)\n                if match:\n                    track[\"visitorId\"] = match.group(1)\n                else:\n                    raise Exception(err)\n        except Exception as e:\n            track[\"err\"] = str(e)\n            track[\"ip\"] = \"0.0.0.0\"\n            track[\"visitorId\"] = \"None\"\n\n    return track"
  },
  {
    "metadata": {
      "package_name": "upgini-1.1.100",
      "report_path": "/home/blue/PyPIAgent/Codes/tooldetect/detect_output/guarddog/malware/upgini-1.1.100.txt"
    }
  }
]